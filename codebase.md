# app\api\telegram\route.ts

```ts
import { NextResponse } from 'next/server'; import { telegramBotService } from '@/lib/telegram-bot'; // Initialize the bot on first API call if conditions are met let botInitialized = false; const initializeBot = () => { // Only initialize once if (botInitialized) return; // Only start the bot in production or if explicitly enabled if ( process.env.NODE_ENV !== 'development' || process.env.ENABLE_TELEGRAM_BOT === 'true' ) { console.log('Initializing Telegram bot from API route...'); telegramBotService.startBot(); botInitialized = true; } }; // GET endpoint to check bot status export async function GET() { initializeBot(); const bot = telegramBotService.getBot(); if (!bot) { // Return more specific error information const errorReason = !process.env.TELEGRAM_BOT_TOKEN ? 'Missing TELEGRAM_BOT_TOKEN environment variable' : !process.env.NEXT_PUBLIC_WEB_APP_URL ? 'Missing NEXT_PUBLIC_WEB_APP_URL environment variable' : 'Telegram bot not initialized'; return NextResponse.json( { error: errorReason, status: 'error' }, { status: 500 } ); } return NextResponse.json({ status: 'Telegram bot is running' }); } // POST endpoint to send messages export async function POST(request: Request) { try { // Initialize bot if not already done initializeBot(); const bot = telegramBotService.getBot(); if (!bot) { return NextResponse.json( { error: 'Telegram bot not initialized' }, { status: 500 } ); } // Parse request data const data = await request.json(); const { chatId, message, options } = data; // Validate required parameters if (!chatId) { return NextResponse.json( { error: 'Missing required parameter: chatId' }, { status: 400 } ); } if (!message) { return NextResponse.json( { error: 'Missing required parameter: message' }, { status: 400 } ); } // Send message const result = await telegramBotService.sendMessage( chatId, message, options ); if (!result) { return NextResponse.json( { error: 'Failed to send message' }, { status: 500 } ); } // Return success response with message details return NextResponse.json({ success: true, messageId: result.message_id, chatId: result.chat.id, date: result.date, }); } catch (error: any) { console.error('Error in POST /api/telegram:', error); // Return more detailed error information return NextResponse.json( { error: 'Internal server error', message: error.message || 'Unknown error', status: 'error', }, { status: 500 } ); } }
```

# app\cargos\page.tsx

```tsx
// 'use client'; // import React, { useState, useEffect } from 'react'; // import { Button } from '@/components/ui/button'; // import { Input } from '@/components/ui/input'; // import { // Select, // SelectContent, // SelectItem, // SelectTrigger, // SelectValue, // } from '@/components/ui/select'; // import { Textarea } from '@/components/ui/textarea'; // import { // Dialog, // DialogContent, // DialogHeader, // DialogTitle, // } from '@/components/ui/dialog'; // import { Checkbox } from '@/components/ui/checkbox'; // import { Card, CardContent } from '@/components/ui/card'; // import { Badge } from '@/components/ui/badge'; // import { ScrollArea } from '@/components/ui/scroll-area'; // import { // X, // Plus, // TruckIcon, // MapPinIcon, // CalendarIcon, // CreditCardIcon, // BellIcon, // } from 'lucide-react'; // import NavigationMenu from '../components/NavigationMenu'; // import { Router } from 'next/router'; // import { useRouter } from 'next/navigation'; // import Link from 'next/link'; // import { useUser } from '@/contexts/UserContext'; // interface CargoFormData { // cargo: { // name: string; // weight: string; // volume: string; // length: string; // width: string; // height: string; // diameter: string; // packaging: string; // notes: string; // }; // route: { // loading: string; // unloading: string; // }; // transport: { // bodyType: string; // loadingType: string; // }; // when: { // loadingDates: string; // isConstant: boolean; // isReady: boolean; // }; // payment: { // method: string; // options: string[]; // }; // notifications: { // enabled: boolean; // }; // } // const initialFormData: CargoFormData = { // cargo: { // name: '', // weight: '', // volume: '', // length: '', // width: '', // height: '', // diameter: '', // packaging: '', // notes: '', // }, // route: { loading: '', unloading: '' }, // transport: { bodyType: '', loadingType: '' }, // when: { loadingDates: '', isConstant: false, isReady: false }, // payment: { method: '', options: [] }, // notifications: { enabled: false }, // }; // const sections = [ // { id: 'cargo', title: 'Груз', icon: TruckIcon }, // { id: 'route', title: 'Маршрут', icon: MapPinIcon }, // { id: 'transport', title: 'Транспорт', icon: TruckIcon }, // { id: 'when', title: 'Когда', icon: CalendarIcon }, // { id: 'payment', title: 'Оплата', icon: CreditCardIcon }, // { id: 'notifications', title: 'Уведомления', icon: BellIcon }, // ]; // type CargoSection = { // name: string; // weight: string; // volume: string; // length: string; // width: string; // height: string; // diameter: string; // packaging: string; // notes: string; // }; // type RouteSection = { // loading: string; // unloading: string; // }; // type TransportSection = { // bodyType: string; // loadingType: string; // }; // type WhenSection = { // loadingDates: string; // isConstant: boolean; // isReady: boolean; // }; // type PaymentSection = { // method: string; // options: string[]; // }; // type NotificationsSection = { // enabled: boolean; // }; // // Обновленный интерфейс CargoFormData // interface CargoFormData { // cargo: CargoSection; // route: RouteSection; // transport: TransportSection; // when: WhenSection; // payment: PaymentSection; // notifications: NotificationsSection; // } // export default function MyCargoPage() { // const [isAddingCargo, setIsAddingCargo] = useState<boolean>(false); // const [cargoCount, setCargoCount] = useState<number>(1); // const { userState } = useUser(); // const [formData, setFormData] = useState<CargoFormData>(initialFormData); // const [activeSection, setActiveSection] = useState<string>('cargo'); // const [isDialogOpen, setIsDialogOpen] = useState<boolean>(false); // const [isAllFilled, setIsAllFilled] = useState<boolean>(false); // const router = useRouter(); // useEffect(() => { // checkAllFilled(); // }, [formData]); // const checkAllFilled = () => { // const isFilled = Object.values(formData).every((section) => // Object.values(section).every((value) => // typeof value === 'boolean' // ? true // : Array.isArray(value) // ? value.length > 0 // : value !== '' // ) // ); // setIsAllFilled(isFilled); // }; // const handleInputChange = ( // section: keyof CargoFormData, // field: string, // value: string | boolean | string[] // ) => { // setFormData((prev) => ({ // ...prev, // [section]: { // ...prev[section], // [field]: value, // }, // })); // }; // const clearSection = (section: keyof CargoFormData) => { // setFormData((prev) => ({ // ...prev, // [section]: initialFormData[section], // })); // }; // const goToNextSection = () => { // const currentIndex = sections.findIndex( // (section) => section.id === activeSection // ); // if (currentIndex < sections.length - 1) { // setActiveSection(sections[currentIndex + 1].id); // } else { // setIsDialogOpen(false); // } // }; // // Типы-защитники // function isCargo(section: any): section is CargoSection { // return 'name' in section && 'weight' in section && 'volume' in section; // } // function isRoute(section: any): section is RouteSection { // return 'loading' in section && 'unloading' in section; // } // function isTransport(section: any): section is TransportSection { // return 'bodyType' in section && 'loadingType' in section; // } // function isWhen(section: any): section is WhenSection { // return ( // 'loadingDates' in section && // 'isConstant' in section && // 'isReady' in section // ); // } // function isPayment(section: any): section is PaymentSection { // return ( // 'method' in section && // 'options' in section && // Array.isArray(section.options) // ); // } // function isNotifications(section: any): section is NotificationsSection { // return 'enabled' in section; // } // // Обновленная функция getSectionSummary // const getSectionSummary = (sectionId: keyof CargoFormData): string => { // const sectionData = formData[sectionId]; // if (isCargo(sectionData)) { // return sectionData.name // ? `${sectionData.name}, ${sectionData.weight} ${sectionData.volume}` // : ''; // } // if (isRoute(sectionData)) { // return sectionData.loading && sectionData.unloading // ? `${sectionData.loading} - ${sectionData.unloading}` // : ''; // } // if (isTransport(sectionData)) { // return sectionData.bodyType || sectionData.loadingType // ? `${sectionData.bodyType || ''}, ${sectionData.loadingType || ''}` // .trim() // .replace(/^,\s|,\s$/g, '') // : ''; // } // if (isWhen(sectionData)) { // return sectionData.loadingDates // ? `${sectionData.loadingDates}${ // sectionData.isConstant ? ', постоянно' : '' // }` // : ''; // } // if (isPayment(sectionData)) { // return sectionData.method // ? `${sectionData.method}, ${sectionData.options.join(', ')}` // : ''; // } // if (isNotifications(sectionData)) { // return sectionData.enabled ? 'Включены' : 'Выключены'; // } // return ''; // }; // const renderSectionButton = (section: { // id: string; // title: string; // icon: React.ElementType; // }) => { // const Icon = section.icon; // const summary = getSectionSummary(section.id as keyof CargoFormData); // return ( // <Button // key={section.id} // variant='outline' // className='w-full text-left justify-start items-center flex p-4 h-auto' // onClick={() => { // setActiveSection(section.id); // setIsDialogOpen(true); // }} // > // <Icon className='mr-2 h-5 w-5' /> // <div className='flex flex-col items-start'> // <span className='font-semibold'>{section.title}</span> // {summary && ( // <span className='text-sm text-gray-500 mt-1 truncate w-full'> // {summary} // </span> // )} // </div> // </Button> // ); // }; // const renderCargoContent = () => ( // <div className='space-y-4'> // <Input // placeholder='Название груза*' // value={formData.cargo.name} // onChange={(e) => handleInputChange('cargo', 'name', e.target.value)} // /> // <div className='grid grid-cols-2 gap-2'> // <Input // placeholder='Вес (тонн/кг)*' // value={formData.cargo.weight} // onChange={(e) => handleInputChange('cargo', 'weight', e.target.value)} // /> // <Input // placeholder='Объем (м³)*' // value={formData.cargo.volume} // onChange={(e) => handleInputChange('cargo', 'volume', e.target.value)} // /> // </div> // <div className='grid grid-cols-2 gap-2'> // <Input // placeholder='Длина' // value={formData.cargo.length} // onChange={(e) => handleInputChange('cargo', 'length', e.target.value)} // /> // <Input // placeholder='Ширина' // value={formData.cargo.width} // onChange={(e) => handleInputChange('cargo', 'width', e.target.value)} // /> // <Input // placeholder='Высота' // value={formData.cargo.height} // onChange={(e) => handleInputChange('cargo', 'height', e.target.value)} // /> // <Input // placeholder='Диаметр' // value={formData.cargo.diameter} // onChange={(e) => // handleInputChange('cargo', 'diameter', e.target.value) // } // /> // </div> // <Input // placeholder='Упаковка' // value={formData.cargo.packaging} // onChange={(e) => // handleInputChange('cargo', 'packaging', e.target.value) // } // /> // <Textarea // placeholder='Примечание' // value={formData.cargo.notes} // onChange={(e) => handleInputChange('cargo', 'notes', e.target.value)} // /> // </div> // ); // const renderRouteContent = () => ( // <div className='space-y-4'> // <Input // placeholder='Погрузка*' // value={formData.route.loading} // onChange={(e) => handleInputChange('route', 'loading', e.target.value)} // /> // <Input // placeholder='Выгрузка*' // value={formData.route.unloading} // onChange={(e) => // handleInputChange('route', 'unloading', e.target.value) // } // /> // </div> // ); // const renderTransportContent = () => ( // <div className='space-y-4'> // <Select // onValueChange={(value) => // handleInputChange('transport', 'bodyType', value) // } // > // <SelectTrigger> // <SelectValue placeholder='Тип кузова' /> // </SelectTrigger> // <SelectContent> // <SelectItem value='isothermal'>Изотермический</SelectItem> // <SelectItem value='tented'>Тентованный</SelectItem> // <SelectItem value='container'>Контейнер</SelectItem> // <SelectItem value='van'>Фургон</SelectItem> // </SelectContent> // </Select> // <Select // onValueChange={(value) => // handleInputChange('transport', 'loadingType', value) // } // > // <SelectTrigger> // <SelectValue placeholder='Тип погрузки' /> // </SelectTrigger> // <SelectContent> // <SelectItem value='ramps'>Аппарели</SelectItem> // <SelectItem value='no-doors'>Без ворот</SelectItem> // <SelectItem value='side'>Боковая</SelectItem> // <SelectItem value='top'>Верхняя</SelectItem> // <SelectItem value='hydroboard'>Гидроборт</SelectItem> // </SelectContent> // </Select> // </div> // ); // const renderWhenContent = () => ( // <div className='space-y-4'> // <Input // type='date' // placeholder='Дата погрузки*' // value={formData.when.loadingDates} // onChange={(e) => // handleInputChange('when', 'loadingDates', e.target.value) // } // /> // <div className='flex items-center space-x-2'> // <Checkbox // id='constant' // checked={formData.when.isConstant} // onCheckedChange={(checked) => // handleInputChange('when', 'isConstant', Boolean(checked)) // } // /> // <label htmlFor='constant'>Постоянно</label> // </div> // <div className='flex items-center space-x-2'> // <Checkbox // id='ready' // checked={formData.when.isReady} // onCheckedChange={(checked) => // handleInputChange('when', 'isReady', Boolean(checked)) // } // /> // <label htmlFor='ready'>Груз готов</label> // </div> // </div> // ); // const renderPaymentContent = () => ( // <div className='space-y-4'> // <Select // onValueChange={(value) => handleInputChange('payment', 'method', value)} // > // <SelectTrigger> // <SelectValue placeholder='Метод оплаты' /> // </SelectTrigger> // <SelectContent> // <SelectItem value='cash'>Наличные</SelectItem> // <SelectItem value='card'>Карта</SelectItem> // <SelectItem value='transfer'>Перечисление</SelectItem> // <SelectItem value='advance'>Аванс</SelectItem> // </SelectContent> // </Select> // <div className='space-y-2'> // {[ // 'Возможен торг', // 'Оплата на выгрузке', // 'Оплата после выгрузки', // 'Через несколько банковских дней', // 'Запрос ставки', // ].map((option) => ( // <div key={option} className='flex items-center space-x-2'> // <Checkbox // id={option} // checked={formData.payment.options.includes(option)} // onCheckedChange={(checked) => { // const newOptions = checked // ? [...formData.payment.options, option] // : formData.payment.options.filter((item) => item !== option); // handleInputChange('payment', 'options', newOptions); // }} // /> // <label htmlFor={option}>{option}</label> // </div> // ))} // </div> // </div> // ); // const renderNotificationsContent = () => ( // <div className='space-y-4'> // <div className='flex items-center space-x-2'> // <Checkbox // id='notifications' // checked={formData.notifications.enabled} // onCheckedChange={(checked) => // handleInputChange('notifications', 'enabled', Boolean(checked)) // } // /> // <label htmlFor='notifications'>Включить уведомления</label> // </div> // </div> // ); // const renderContent = () => { // switch (activeSection) { // case 'cargo': // return renderCargoContent(); // case 'route': // return renderRouteContent(); // case 'transport': // return renderTransportContent(); // case 'when': // return renderWhenContent(); // case 'payment': // return renderPaymentContent(); // case 'notifications': // return renderNotificationsContent(); // default: // return null; // } // }; // return ( // <div className='min-h-screen bg-gray-50 p-4 pb-20'> // <h1 className='text-3xl font-bold text-center mb-6 text-gray-800'> // Мои грузы // </h1> // <div className='space-y-4 mb-8'> // <Button // onClick={() => setIsAddingCargo(true)} // className='w-full bg-blue-600 hover:bg-blue-700 text-white' // > // <Plus className='mr-2 h-4 w-4' /> Добавить груз // </Button> // <Button // variant='outline' // className='w-full' // onClick={() => { // router.push('/my-cargo'); // }} // > // <TruckIcon className='mr-2 h-4 w-4' /> Мои грузы{' '} // <Badge variant='secondary' className='ml-2'> // {cargoCount} // </Badge> // </Button> // </div> // {isAddingCargo && ( // <Card className='mb-8 shadow-lg'> // <CardContent className='p-6'> // <h2 className='text-2xl font-semibold mb-4 text-gray-800'> // Добавить груз // </h2> // <ScrollArea className='h-[60vh]'> // <div className='space-y-4'> // {sections.map(renderSectionButton)} // </div> // </ScrollArea> // {isAllFilled && ( // <Button // onClick={() => { // router.push('/my-cargo'); // /* Логика публикации */ // }} // className='w-full mt-6 bg-green-600 hover:bg-green-700 text-white' // > // Опубликовать // </Button> // )} // </CardContent> // </Card> // )} // <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}> // <DialogContent className='sm:max-w-[425px]'> // <DialogHeader> // <DialogTitle> // {sections.find((s) => s.id === activeSection)?.title} // </DialogTitle> // </DialogHeader> // <ScrollArea className='max-h-[60vh] pr-4'> // {renderContent()} // </ScrollArea> // <div className='flex justify-between mt-6'> // <Button // variant='outline' // onClick={() => clearSection(activeSection as keyof CargoFormData)} // > // <X className='mr-2 h-4 w-4' /> Очистить // </Button> // <Button onClick={goToNextSection}> // Далее <Plus className='ml-2 h-4 w-4' /> // </Button> // </div> // </DialogContent> // </Dialog> // <NavigationMenu // userRole={userState.role === 'carrier' ? 'carrier' : 'other'} // /> // {/* <NavigationMenu userRole={'carrier'} /> */} // </div> // ); // } 'use client'; import React, { useState, useEffect, useRef } from 'react'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Textarea } from '@/components/ui/textarea'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage, } from '@/components/ui/form'; import { FormProvider, useForm } from 'react-hook-form'; import { Checkbox } from '@/components/ui/checkbox'; import { Card, CardContent } from '@/components/ui/card'; import { ScrollArea } from '@/components/ui/scroll-area'; import { X, Plus, TruckIcon, MapPinIcon, BoxIcon, CalendarIcon, CreditCardIcon, Check, ChevronsUpDown, AlertCircle, Loader2, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { useUser } from '@/contexts/UserContext'; import { api } from '@/lib/api'; import { toast } from 'sonner'; import { cn } from '@/lib/utils'; import { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList, } from '@/components/ui/command'; import { Popover, PopoverContent, PopoverTrigger, } from '@/components/ui/popover'; // Type definitions for location data interface Location { id: number; name: string; level: number; // 1 = Country, 2 = Region/State, 3 = City parent_name?: string; country_name?: string; full_name?: string; } interface CargoFormData { title: string; description: string; weight: number; volume?: number; length?: number; width?: number; height?: number; loading_point: string; unloading_point: string; loading_location?: number; unloading_location?: number; additional_points?: { point: string; type: 'loading' | 'unloading'; location_id?: number; }[]; loading_date: string; is_constant: boolean; is_ready: boolean; vehicle_type: string; loading_type: string; payment_method: string; price?: number; payment_details?: { advance_payment?: number; payment_terms?: string; payment_location?: string; }; } const initialFormData: CargoFormData = { title: '', description: '', weight: 0, loading_point: '', unloading_point: '', loading_date: '', is_constant: false, is_ready: false, vehicle_type: '', loading_type: '', payment_method: '', loading_location: undefined, unloading_location: undefined, additional_points: [], }; const vehicleTypes = [ { value: 'tent', label: 'Тентованный' }, { value: 'refrigerator', label: 'Рефрижератор' }, { value: 'isothermal', label: 'Изотермический' }, { value: 'container', label: 'Контейнер' }, { value: 'car_carrier', label: 'Автовоз' }, { value: 'board', label: 'Бортовой' }, ]; const loadingTypes = [ { value: 'ramps', label: 'Аппарели' }, { value: 'no_doors', label: 'Без ворот' }, { value: 'side', label: 'Боковая' }, { value: 'top', label: 'Верхняя' }, { value: 'hydro_board', label: 'Гидроборт' }, ]; const paymentMethods = [ { value: 'cash', label: 'Наличные' }, { value: 'card', label: 'Карта' }, { value: 'transfer', label: 'Банковский перевод' }, { value: 'advance', label: 'Аванс' }, ]; const sections = [ { id: 'cargo', title: 'Груз', icon: TruckIcon }, { id: 'route', title: 'Маршрут', icon: MapPinIcon }, { id: 'transport', title: 'Транспорт', icon: TruckIcon }, { id: 'when', title: 'Когда', icon: CalendarIcon }, { id: 'payment', title: 'Оплата', icon: CreditCardIcon }, ]; export default function CargoPage() { const [isAddingCargo, setIsAddingCargo] = useState<boolean>(false); const [formData, setFormData] = useState<CargoFormData>(initialFormData); const [activeSection, setActiveSection] = useState<string>('cargo'); const [isDialogOpen, setIsDialogOpen] = useState<boolean>(false); const [isAllFilled, setIsAllFilled] = useState<boolean>(false); const [isSubmitting, setIsSubmitting] = useState<boolean>(false); const [errors, setErrors] = useState<Record<string, string>>({}); // const [loadingLocations, setLoadingLocations] = useState<Location[]>([]); // const [unloadingLocations, setUnloadingLocations] = useState<Location[]>([]); // const [isLoadingLocations, setIsLoadingLocations] = useState<boolean>(false); // const [isUnloadingLocations, setIsUnloadingLocations] = // useState<boolean>(false); // const [loadingLocationOpen, setLoadingLocationOpen] = useState(false); // const [unloadingLocationOpen, setUnloadingLocationOpen] = useState(false); // const [loadingOpen, setLoadingOpen] = useState(false); // const [unloadingOpen, setUnloadingOpen] = useState(false); // const [open, setOpen] = useState(false); // const [searchQuery, setSearchQuery] = useState(''); // const [locations, setLocations] = useState<Location[]>([]); // const [isLoading, setIsLoading] = useState(false); // const inputRef = useRef<HTMLInputElement>(null); const { userState } = useUser(); const router = useRouter(); useEffect(() => { validateForm(); }, [formData]); const validateForm = () => { const newErrors: Record<string, string> = {}; const requiredFields = [ 'title', 'weight', 'loading_point', 'unloading_point', 'loading_date', 'vehicle_type', 'loading_type', 'payment_method', ]; requiredFields.forEach((field) => { if (!formData[field as keyof CargoFormData]) { newErrors[field] = 'Это поле обязательно'; } }); if (formData.weight <= 0) { newErrors.weight = 'Вес должен быть больше 0'; } if ( formData.payment_method === 'advance' && !formData.payment_details?.advance_payment ) { newErrors.advance_payment = 'Укажите сумму аванса'; } setErrors(newErrors); setIsAllFilled(Object.keys(newErrors).length === 0); }; const handleInputChange = (name: string, value: any) => { setFormData((prev) => { const updated = { ...prev, [name]: value }; // Calculate volume if dimensions are provided if ( ['length', 'width', 'height'].includes(name) && updated.length && updated.width && updated.height ) { updated.volume = updated.length * updated.width * updated.height; } return updated; }); }; const searchLocations = async ( query: string, setLocations: React.Dispatch<React.SetStateAction<Location[]>>, setIsLoading: React.Dispatch<React.SetStateAction<boolean>> ) => { if (!query || query.length < 2) { setLocations([]); return; } setIsLoading(true); try { // Call your API to search locations const response = await api.searchLocations(query); if (Array.isArray(response)) { setLocations(response); } else { setLocations([]); } console.log(response, 'fdfdgdf'); } catch (error) { console.error('Error searching locations:', error); toast.error('Ошибка при поиске местоположения'); } finally { setIsLoading(false); } }; const handlePaymentDetailsChange = (field: string, value: any) => { setFormData((prev) => ({ ...prev, payment_details: { ...prev.payment_details, [field]: value, }, })); }; const handleSubmit = async () => { try { setIsSubmitting(true); validateForm(); if (!isAllFilled) { toast.error('Пожалуйста, заполните все обязательные поля'); return; } // Prepare the data for API submission const submissionData = { ...formData, loading_location: formData.loading_location ? Number(formData.loading_location) : null, unloading_location: formData.unloading_location ? Number(formData.unloading_location) : null, }; console.log('Submitting cargo with locations:', { loading_location: submissionData.loading_location, unloading_location: submissionData.unloading_location, }); console.log(submissionData, 'submitdata'); const response = await api.createCargo(submissionData); toast.success('Груз успешно создан'); setIsAddingCargo(false); setFormData(initialFormData); router.push('/my-cargo'); } catch (error: any) { toast.error(error.response?.data?.detail || 'Ошибка при создании груза'); console.error('Create cargo error:', error); } finally { setIsSubmitting(false); } }; const renderCargoContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'> Название груза* </label> <Input placeholder='Название груза' value={formData.title} onChange={(e) => handleInputChange('title', e.target.value)} /> {errors.title && ( <p className='text-sm text-red-500 mt-1'>{errors.title}</p> )} </div> <div className='grid grid-cols-2 gap-4'> <div> <label className='block text-sm font-medium mb-2'>Вес (тонн)*</label> <Input type='number' placeholder='Вес' value={formData.weight || ''} onChange={(e) => handleInputChange('weight', parseFloat(e.target.value)) } /> {errors.weight && ( <p className='text-sm text-red-500 mt-1'>{errors.weight}</p> )} </div> <div> <label className='block text-sm font-medium mb-2'>Объем (м³)</label> <Input type='number' placeholder='Объем' value={formData.volume || ''} onChange={(e) => handleInputChange('volume', parseFloat(e.target.value)) } /> </div> </div> <div className='grid grid-cols-3 gap-4'> <div> <label className='block text-sm font-medium mb-2'>Длина (м)</label> <Input type='number' placeholder='Длина' value={formData.length || ''} onChange={(e) => handleInputChange('length', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Ширина (м)</label> <Input type='number' placeholder='Ширина' value={formData.width || ''} onChange={(e) => handleInputChange('width', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Высота (м)</label> <Input type='number' placeholder='Высота' value={formData.height || ''} onChange={(e) => handleInputChange('height', parseFloat(e.target.value)) } /> </div> </div> <div> <label className='block text-sm font-medium mb-2'>Описание</label> <Textarea placeholder='Описание груза' value={formData.description} onChange={(e) => handleInputChange('description', e.target.value)} /> </div> </div> ); const LocationSelector = ({ value, onChange, placeholder, error, errorMessage, }: any) => { const [open, setOpen] = useState(false); const [searchQuery, setSearchQuery] = useState(''); const [locations, setLocations] = useState<Location[]>([]); const [isLoading, setIsLoading] = useState(false); const containerRef = useRef<HTMLInputElement>(null); // Обработка клика вне компонента для закрытия выпадающего списка useEffect(() => { const handleClickOutside = (event: any) => { if ( containerRef.current && !containerRef.current.contains(event.target) ) { setOpen(false); } }; document.addEventListener('mousedown', handleClickOutside); return () => { document.removeEventListener('mousedown', handleClickOutside); }; }, []); // Поиск локаций при вводе useEffect(() => { if (searchQuery.length >= 2) { setIsLoading(true); setOpen(true); // Открываем список при вводе const timer = setTimeout(() => { api .searchLocations(searchQuery) .then((data) => { setLocations(Array.isArray(data) ? data : []); setIsLoading(false); }) .catch((err) => { console.error('Search error:', err); setLocations([]); setIsLoading(false); }); }, 300); return () => clearTimeout(timer); } else { setLocations([]); if (searchQuery.length === 0) { setOpen(false); } } }, [searchQuery]); const handleSelect = (location: any) => { onChange({ id: location.id, name: location.full_name || location.name, }); setSearchQuery(''); setOpen(false); }; return ( <div className='relative w-full' ref={containerRef}> <Input placeholder={placeholder} value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} onFocus={() => searchQuery.length >= 2 && setOpen(true)} className={cn(error && 'border-red-500')} /> {/* Показываем выбранное значение если оно есть и поиск пустой */} {value.name && searchQuery === '' && ( <div className='absolute right-0 top-0 h-full flex items-center pr-3 text-sm text-muted-foreground'> {value.name} </div> )} {open && ( <div className='absolute z-10 w-full mt-1 bg-popover rounded-md border shadow-md'> <div className='p-1'> {isLoading ? ( <div className='p-4 text-center text-sm text-muted-foreground'> Загрузка... </div> ) : locations.length === 0 ? ( <div className='p-4 text-center text-sm text-muted-foreground'> {searchQuery.length < 2 ? 'Введите минимум 2 символа для поиска' : 'Ничего не найдено'} </div> ) : ( <ScrollArea className='h-[300px]'> {locations.map((location) => ( <div key={location.id} onClick={() => handleSelect(location)} className={cn( 'flex items-center gap-2 rounded-md px-2 py-1.5 cursor-pointer', 'hover:bg-muted' )} > <div className='flex-1'> <p className='text-sm font-medium'> {location.name} {location.level === 3 && location.parent_name && ( <span className='text-muted-foreground'> {' '} - {location.parent_name} </span> )} {location.country_name && location.level !== 1 && ( <span className='text-muted-foreground'> , {location.country_name} </span> )} </p> {location.full_name && ( <p className='text-xs text-muted-foreground'> {location.full_name} </p> )} </div> {value.id === location.id && ( <Check className='h-4 w-4' /> )} </div> ))} </ScrollArea> )} </div> </div> )} {error && errorMessage && ( <p className='text-sm text-red-500 mt-1'>{errorMessage}</p> )} </div> ); }; const renderRouteContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'> Пункт погрузки* </label> <LocationSelector value={{ id: formData.loading_location, name: formData.loading_point, }} onChange={({ id, name }: any) => { handleInputChange('loading_location', id); handleInputChange('loading_point', name); }} placeholder='Выберите пункт погрузки' error={!!errors.loading_point} errorMessage={errors.loading_point} /> </div> <div> <label className='block text-sm font-medium mb-2'> Пункт выгрузки* </label> <LocationSelector value={{ id: formData.unloading_location, name: formData.unloading_point, }} onChange={({ id, name }: any) => { handleInputChange('unloading_location', id); handleInputChange('unloading_point', name); }} placeholder='Выберите пункт выгрузки' error={!!errors.unloading_point} errorMessage={errors.unloading_point} /> </div> {/* Остальной код для дополнительных точек маршрута */} {formData.additional_points?.map((point, index) => ( <div key={index} className='flex items-center gap-2'> <Input placeholder={ point.type === 'loading' ? 'Пункт погрузки' : 'Пункт выгрузки' } value={point.point} onChange={(e) => { const newPoints = [...(formData.additional_points || [])]; newPoints[index].point = e.target.value; handleInputChange('additional_points', newPoints); }} /> <Button variant='outline' size='icon' onClick={() => { const newPoints = formData.additional_points?.filter( (_, i) => i !== index ); handleInputChange('additional_points', newPoints); }} > <X className='h-4 w-4' /> </Button> </div> ))} <Button variant='outline' onClick={() => { const newPoints = [...(formData.additional_points || [])]; newPoints.push({ point: '', type: 'loading', location_id: undefined, }); handleInputChange('additional_points', newPoints); }} > <Plus className='h-4 w-4 mr-2' /> Добавить точку маршрута </Button> </div> ); const renderTransportContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'> Тип транспорта* </label> <Select value={formData.vehicle_type} onValueChange={(value) => handleInputChange('vehicle_type', value)} > <SelectTrigger className={errors.vehicle_type ? 'border-red-500' : ''} > <SelectValue placeholder='Выберите тип транспорта' /> </SelectTrigger> <SelectContent> {vehicleTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} </SelectItem> ))} </SelectContent> </Select> {errors.vehicle_type && ( <p className='text-sm text-red-500 mt-1'>{errors.vehicle_type}</p> )} </div> <div> <label className='block text-sm font-medium mb-2'>Тип погрузки*</label> <Select value={formData.loading_type} onValueChange={(value) => handleInputChange('loading_type', value)} > <SelectTrigger className={errors.loading_type ? 'border-red-500' : ''} > <SelectValue placeholder='Выберите тип погрузки' /> </SelectTrigger> <SelectContent> {loadingTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} </SelectItem> ))} </SelectContent> </Select> {errors.loading_type && ( <p className='text-sm text-red-500 mt-1'>{errors.loading_type}</p> )} </div> </div> ); const renderWhenContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'>Дата погрузки*</label> <Input type='date' value={formData.loading_date} onChange={(e) => handleInputChange('loading_date', e.target.value)} min={new Date().toISOString().split('T')[0]} /> {errors.loading_date && ( <p className='text-sm text-red-500 mt-1'>{errors.loading_date}</p> )} </div> <div className='flex items-center space-x-2'> <Checkbox id='constant' checked={formData.is_constant} onCheckedChange={(checked) => handleInputChange('is_constant', checked) } /> <label htmlFor='constant'>Постоянный</label> </div> <div className='flex items-center space-x-2'> <Checkbox id='ready' checked={formData.is_ready} onCheckedChange={(checked) => handleInputChange('is_ready', checked)} /> <label htmlFor='ready'>Груз готов к отправке</label> </div> </div> ); const renderPaymentContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'>Способ оплаты*</label> <Select value={formData.payment_method} onValueChange={(value) => handleInputChange('payment_method', value)} > <SelectTrigger className={errors.payment_method ? 'border-red-500' : ''} > <SelectValue placeholder='Выберите способ оплаты' /> </SelectTrigger> <SelectContent> {paymentMethods.map((method) => ( <SelectItem key={method.value} value={method.value}> {method.label} </SelectItem> ))} </SelectContent> </Select> {errors.payment_method && ( <p className='text-sm text-red-500 mt-1'>{errors.payment_method}</p> )} </div> <div> <label className='block text-sm font-medium mb-2'>Цена</label> <Input type='number' placeholder='Введите сумму' value={formData.price || ''} onChange={(e) => handleInputChange('price', parseFloat(e.target.value)) } /> </div> {formData.payment_method === 'advance' && ( <div> <label className='block text-sm font-medium mb-2'> Сумма аванса* </label> <div> <Input type='number' placeholder='Введите сумму аванса' value={formData.payment_details?.advance_payment || ''} onChange={(e) => handlePaymentDetailsChange( 'advance_payment', parseFloat(e.target.value) ) } className={errors.advance_payment ? 'border-red-500' : ''} /> {errors.advance_payment && ( <p className='text-sm text-red-500 mt-1'> {errors.advance_payment} </p> )} </div> </div> )} <div> <label className='block text-sm font-medium mb-2'>Условия оплаты</label> <Select value={formData.payment_details?.payment_terms || ''} onValueChange={(value) => handlePaymentDetailsChange('payment_terms', value) } > <SelectTrigger> <SelectValue placeholder='Выберите условия оплаты' /> </SelectTrigger> <SelectContent> <SelectItem value='on_loading'>При погрузке</SelectItem> <SelectItem value='on_unloading'>При выгрузке</SelectItem> <SelectItem value='after_unloading'>После выгрузки</SelectItem> <SelectItem value='delayed'>Отсрочка платежа</SelectItem> </SelectContent> </Select> </div> <div> <label className='block text-sm font-medium mb-2'>Место оплаты</label> <Select value={formData.payment_details?.payment_location || ''} onValueChange={(value) => handlePaymentDetailsChange('payment_location', value) } > <SelectTrigger> <SelectValue placeholder='Выберите место оплаты' /> </SelectTrigger> <SelectContent> <SelectItem value='loading_point'>В пункте погрузки</SelectItem> <SelectItem value='unloading_point'>В пункте выгрузки</SelectItem> <SelectItem value='office'>В офисе</SelectItem> </SelectContent> </Select> </div> </div> ); const renderContent = () => { switch (activeSection) { case 'cargo': return renderCargoContent(); case 'route': return renderRouteContent(); case 'transport': return renderTransportContent(); case 'when': return renderWhenContent(); case 'payment': return renderPaymentContent(); default: return null; } }; const getSectionSummary = (sectionId: string) => { switch (sectionId) { case 'cargo': return formData.title ? `${formData.title}, ${formData.weight} т${ formData.volume ? `, ${formData.volume} м³` : '' }` : ''; case 'route': return formData.loading_point && formData.unloading_point ? `${formData.loading_point} - ${formData.unloading_point}` : ''; case 'transport': return formData.vehicle_type ? `${ vehicleTypes.find((t) => t.value === formData.vehicle_type) ?.label || '' }, ${ loadingTypes.find((t) => t.value === formData.loading_type) ?.label || '' }` : ''; case 'when': return formData.loading_date ? `${new Date(formData.loading_date).toLocaleDateString()}${ formData.is_constant ? ', постоянный' : '' }${formData.is_ready ? ', готов' : ''}` : ''; case 'payment': return formData.payment_method ? `${ paymentMethods.find((m) => m.value === formData.payment_method) ?.label || '' }${formData.price ? `, ${formData.price} ₽` : ''}` : ''; default: return ''; } }; return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <h1 className='text-3xl font-bold text-center mb-6 text-gray-800'> Мои грузы </h1> <div className='space-y-4 mb-8'> <Button onClick={() => setIsAddingCargo(true)} className='w-full bg-blue-600 hover:bg-blue-700 text-white' > <Plus className='mr-2 h-4 w-4' /> Добавить груз </Button> <Button variant='outline' className='w-full' onClick={() => { router.push('/my-cargo'); }} > <TruckIcon className='mr-2 h-4 w-4' /> Мои грузы{' '} </Button> </div> {isAddingCargo && ( <Card className='mb-8 shadow-lg'> <CardContent className='p-6'> <h2 className='text-2xl font-semibold mb-4 text-gray-800'> Добавить груз </h2> <ScrollArea className='h-[60vh]'> <div className='space-y-4'> {sections.map((section) => { const Icon = section.icon; const summary = getSectionSummary(section.id); return ( <Button key={section.id} variant='outline' className='w-full text-left justify-start items-center flex p-4 h-auto' onClick={() => { setActiveSection(section.id); setIsDialogOpen(true); }} > <Icon className='mr-2 h-5 w-5' /> <div className='flex flex-col items-start'> <span className='font-semibold'>{section.title}</span> {summary && ( <span className='text-sm text-gray-500 mt-1 truncate w-full'> {summary} </span> )} </div> {errors[section.id] && ( <AlertCircle className='ml-auto h-5 w-5 text-red-500' /> )} </Button> ); })} </div> </ScrollArea> {isAllFilled && ( <Button onClick={handleSubmit} className='w-full mt-6 bg-green-600 hover:bg-green-700 text-white' disabled={isSubmitting} > {isSubmitting ? ( <> <Loader2 className='mr-2 h-4 w-4 animate-spin' /> Создание... </> ) : ( 'Опубликовать' )} </Button> )} </CardContent> </Card> )} <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}> <DialogContent className='sm:max-w-[425px]'> <DialogHeader> <DialogTitle> {sections.find((s) => s.id === activeSection)?.title} </DialogTitle> </DialogHeader> <ScrollArea className='max-h-[60vh] pr-4'> {renderContent()} </ScrollArea> <div className='flex justify-between mt-6'> <Button variant='outline' onClick={() => { const sectionData = formData[activeSection as keyof CargoFormData]; if (typeof sectionData === 'object') { handleInputChange(activeSection, {}); } else { handleInputChange(activeSection, ''); } }} > <X className='mr-2 h-4 w-4' /> Очистить </Button> <Button onClick={() => { const currentIndex = sections.findIndex( (s) => s.id === activeSection ); if (currentIndex < sections.length - 1) { setActiveSection(sections[currentIndex + 1].id); } else { setIsDialogOpen(false); } }} > Далее <Plus className='ml-2 h-4 w-4' /> </Button> </div> </DialogContent> </Dialog> {userState.role === 'student' && ( <div className='space-y-4 mb-8'> <Button onClick={() => { router.push('/student/cargos/'); }} className='w-full bg-blue-600 hover:bg-blue-700 text-white' > <BoxIcon className='mr-2 h-4 w-4' /> Смотреть все </Button> </div> )} <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); }
```

# app\carrier-animation\page.tsx

```tsx
'use client'; import { useState, useEffect } from 'react'; import { motion, AnimatePresence } from 'framer-motion'; import Image from 'next/image'; import { useRouter } from 'next/navigation'; import img from '../blue.png'; export default function CarrierAnimationPage() { const [animationStage, setAnimationStage] = useState(0); const router = useRouter(); useEffect(() => { const timers = [ setTimeout(() => setAnimationStage(1), 4000), setTimeout(() => setAnimationStage(2), 8000), setTimeout(() => setAnimationStage(3), 10000), setTimeout(() => router.push('/registration-confirm'), 13000), // Перенаправление после показа статистики ]; return () => timers.forEach(clearTimeout); }, [router]); const logoVariants = { hidden: { x: '120%', opacity: 0, scale: 0.8 }, visible: { x: '0%', opacity: 1, scale: 1, transition: { type: 'spring', stiffness: 100, damping: 20, duration: 3 }, }, exit: { x: '-120%', opacity: 0, scale: 0.8, transition: { type: 'spring', stiffness: 100, damping: 20, duration: 3 }, }, }; const textVariants = { hidden: { opacity: 0, y: 20 }, visible: { opacity: 1, y: 0, transition: { type: 'spring', stiffness: 100, damping: 10, delay: 0.5 }, }, exit: { opacity: 0, y: -20, transition: { duration: 0.5 }, }, }; const statsVariants = { hidden: { opacity: 0, scale: 0.9 }, visible: { opacity: 1, scale: 1, transition: { type: 'spring', stiffness: 100, damping: 10, delayChildren: 0.3, staggerChildren: 0.2, }, }, exit: { opacity: 0, scale: 0.9, transition: { duration: 0.5 }, }, }; const statItemVariants = { hidden: { y: 20, opacity: 0 }, visible: { y: 0, opacity: 1, transition: { type: 'spring', stiffness: 100, damping: 10 }, }, }; return ( <div className='flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 via-purple-500 to-pink-500 overflow-hidden p-4'> <AnimatePresence mode='wait'> {animationStage < 3 && ( <motion.div key='logo' variants={logoVariants} initial='hidden' animate={animationStage < 2 ? 'visible' : 'exit'} exit='exit' className='relative w-64 h-64 mb-8' > <Image src={img} alt='Company Logo' layout='fill' objectFit='contain' /> </motion.div> )} {animationStage === 1 && ( <motion.div key='text' variants={textVariants} initial='hidden' animate='visible' exit='exit' className='text-center mb-8' > <motion.h1 className='text-4xl font-bold text-white mb-4' style={{ textShadow: '2px 2px 4px rgba(0,0,0,0.3)' }} > Следуй за мечтой </motion.h1> <motion.p className='text-xl text-white'> Вместе мы достигнем новых высот </motion.p> </motion.div> )} {animationStage === 3 && ( <motion.div key='stats' variants={statsVariants} initial='hidden' animate='visible' exit='exit' className='w-full max-w-4xl' > <div className='grid grid-cols-1 md:grid-cols-3 gap-6'> {[ { label: 'Пользователи', value: '+48,437', icon: '👥' }, { label: 'Перевозчики', value: '+43,743', icon: '🚚' }, { label: 'Заявки', value: '+4,343', icon: '📦' }, ].map((stat, index) => ( <motion.div key={index} variants={statItemVariants} className='bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col items-center justify-center text-center' > <span className='text-5xl mb-4'>{stat.icon}</span> <h3 className='text-2xl font-semibold text-white mb-2'> {stat.label} </h3> <p className='text-4xl font-bold text-yellow-300'> {stat.value} </p> </motion.div> ))} </div> </motion.div> )} </AnimatePresence> </div> ); }
```

# app\carrier-welcome\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { ArrowRight } from 'lucide-react'; export default function CarrierWelcomePage() { return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Уважаемые перевозчики! </h1> <section className='mb-8 text-center text-white'> <p> Для удобства работы и получения всей необходимой информации, пожалуйста перейдите на наш мини-вебсайт по следующей кнопке "начать"👇. </p> <br /> <p>Вся работа будет осуществляться через этот вебсайт.</p> <p className='mt-4 font-semibold'>Спасибо за сотрудничество!</p> </section> </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0 flex flex-col'> <Link href='/carrier-animation' className='w-full bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center' > Начать <ArrowRight className='ml-2' size={24} /> </Link> </footer> </div> ); }
```

# app\components\AssignedCargo.tsx

```tsx
import React, { useState, useEffect } from 'react'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Button } from '@/components/ui/button'; import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, } from '@/components/ui/dialog'; import { ScrollArea } from '@/components/ui/scroll-area'; import { AlertTriangle, CheckCircle, XCircle, Loader2 } from 'lucide-react'; import { api } from '@/lib/api'; import { toast } from 'sonner'; interface AssignedCargoResponse { results: AssignedCargo[]; } interface AssignedCargo { id: string; title: string; loading_point: string; unloading_point: string; loading_date: string; weight: number; volume?: number; price?: number; payment_method: string; status: string; owner: { full_name: string; company_name?: string; }; assigned_by: { full_name: string; }; } export default function AssignedCargosSection() { const [assignedCargos, setAssignedCargos] = useState<AssignedCargoResponse>({ results: [], }); const [isLoading, setIsLoading] = useState(true); const [selectedCargo, setSelectedCargo] = useState<AssignedCargo | null>( null ); const [showConfirmDialog, setShowConfirmDialog] = useState(false); const [action, setAction] = useState<'accept' | 'reject' | null>(null); const [isSubmitting, setIsSubmitting] = useState(false); useEffect(() => { fetchAssignedCargos(); }, []); const fetchAssignedCargos = async () => { try { setIsLoading(true); const response = await api.get('/cargo/cargos/', { params: { status: 'assigned', assigned_to: 'me' }, }); setAssignedCargos(response); console.log(response, 'assign'); } catch (error) { toast.error('Ошибка при загрузке назначенных грузов'); console.error('Fetch assigned cargos error:', error); } finally { setIsLoading(false); } }; const handleAction = async ( cargo: AssignedCargo, action: 'accept' | 'reject' ) => { setSelectedCargo(cargo); setAction(action); setShowConfirmDialog(true); }; const handleConfirm = async () => { if (!selectedCargo || !action) return; try { setIsSubmitting(true); await api.post(`/cargo/cargos/${selectedCargo.id}/accept_assignment/`, { decision: action, }); toast.success( action === 'accept' ? 'Груз успешно принят' : 'Груз отклонен' ); await fetchAssignedCargos(); setShowConfirmDialog(false); } catch (error) { toast.error('Ошибка при обработке груза'); console.error('Cargo action error:', error); } finally { setIsSubmitting(false); } }; if (isLoading) { return ( <div className='flex justify-center items-center p-8'> <Loader2 className='h-8 w-8 animate-spin text-primary' /> </div> ); } if (assignedCargos?.results?.length === 0) { return null; } const assignedddCargos = assignedCargos.results.filter( (c) => c.status !== 'pending' ); console.log(assignedddCargos, 'tttt'); return ( <div className='mb-8'> <h2 className='text-xl font-semibold text-white mb-4'> Назначенные грузы </h2> <div className='space-y-4'> {assignedCargos?.results?.map((cargo) => ( <> {cargo.status !== 'pending' && ( <Card key={cargo?.id} className='bg-white'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-4'> <div> <h3 className='font-bold text-lg'>{cargo?.title}</h3> <p className='text-sm text-gray-600'> От:{' '} {cargo?.owner?.company_name || cargo?.owner?.full_name} </p> <p className='text-sm text-gray-600'> Назначен: {cargo?.assigned_by?.full_name} </p> </div> <Badge variant='secondary'> {cargo?.status === 'assigned' ? 'Требует подтверждения' : cargo?.status} </Badge> </div> <div className='grid grid-cols-2 gap-2 mb-4 text-sm'> <div> <span className='font-medium'>Маршрут:</span> <p> {cargo?.loading_point} → {cargo?.unloading_point} </p> </div> <div> <span className='font-medium'>Дата загрузки:</span> <p> {new Date(cargo?.loading_date).toLocaleDateString()} </p> </div> <div> <span className='font-medium'>Груз:</span> <p> {cargo?.weight} т {cargo?.volume && `, ${cargo.volume} м³`} </p> </div> <div> <span className='font-medium'>Оплата:</span> <p> {cargo?.payment_method} {cargo?.price && ` (${cargo?.price} ₽)`} </p> </div> </div> {cargo?.status === 'assigned' && ( <div className='flex justify-end space-x-2'> <Button variant='outline' onClick={() => handleAction(cargo, 'reject')} > <XCircle className='h-4 w-4 mr-2' /> Отклонить </Button> <Button onClick={() => handleAction(cargo, 'accept')}> <CheckCircle className='h-4 w-4 mr-2' /> Принять </Button> </div> )} </CardContent> </Card> )} </> ))} </div> <Dialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}> <DialogContent> <DialogHeader> <DialogTitle> {action === 'accept' ? 'Принять груз' : 'Отклонить груз'} </DialogTitle> </DialogHeader> <div className='py-4'> <div className='flex items-center space-x-2 text-amber-600'> <AlertTriangle className='h-5 w-5' /> <p> {action === 'accept' ? 'Вы уверены, что хотите принять этот груз?' : 'Вы уверены, что хотите отклонить этот груз?'} </p> </div> {selectedCargo && ( <div className='mt-4 p-4 bg-gray-50 rounded-lg'> <p className='font-medium'>{selectedCargo?.title}</p> <p className='text-sm text-gray-600'> {selectedCargo?.loading_point} →{' '} {selectedCargo?.unloading_point} </p> </div> )} </div> <DialogFooter> <Button variant='outline' onClick={() => setShowConfirmDialog(false)} disabled={isSubmitting} > Отмена </Button> <Button variant={action === 'accept' ? 'default' : 'destructive'} onClick={handleConfirm} disabled={isSubmitting} > {isSubmitting ? ( <> <Loader2 className='h-4 w-4 mr-2 animate-spin' /> Обработка... </> ) : action === 'accept' ? ( 'Принять' ) : ( 'Отклонить' )} </Button> </DialogFooter> </DialogContent> </Dialog> </div> ); }
```

# app\components\Button.tsx

```tsx
'use client'; import React from 'react'; interface ButtonProps { children: React.ReactNode; onClick?: () => void; className?: string; } const Button: React.FC<ButtonProps> = ({ children, onClick, className }) => { return ( <button className={`px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors ${className}`} onClick={onClick} > {children} </button> ); }; export default Button;
```

# app\components\Form.tsx

```tsx
'use client'; import React, { ReactNode } from 'react'; interface FormProps { onSubmit: (e: React.FormEvent<HTMLFormElement>) => void; children: ReactNode; className?: string; } const Form: React.FC<FormProps> = ({ onSubmit, children, className }) => { return ( <form onSubmit={onSubmit} className={className}> {children} </form> ); }; export default Form;
```

# app\components\Input.tsx

```tsx
'use client'; import React, { ChangeEvent } from 'react'; interface InputProps { type: string; placeholder: string; value: string; onChange: (e: ChangeEvent<HTMLInputElement>) => void; className?: string; name: string; } const Input: React.FC<InputProps> = ({ type, placeholder, value, onChange, className, name }) => { return ( <input type={type} placeholder={placeholder} value={value} onChange={onChange} name={name} className={`px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary ${className}`} /> ); }; export default Input;
```

# app\components\Layout.tsx

```tsx
import React from 'react'; interface LayoutProps { children: React.ReactNode; } const Layout: React.FC<LayoutProps> = ({ children }) => { return ( <div className="min-h-screen bg-gray-100 flex flex-col"> <main className="flex-grow container mx-auto px-4 py-8">{children}</main> </div> ); }; export default Layout;
```

# app\components\NavigationMenu.tsx

```tsx
// 'use client'; // import Link from 'next/link'; // import { usePathname } from 'next/navigation'; // import { Button } from '@/components/ui/button'; // import { Home, Package, Menu, Heart, Car, WorkflowIcon } from 'lucide-react'; // import { memo, useEffect } from 'react'; // interface NavigationMenuProps { // userRole: 'carrier' | 'other'; // } // const NavigationMenu = memo(function NavigationMenu({ // userRole, // }: NavigationMenuProps) { // const pathname = usePathname(); // const isActive = (path: string) => { // return pathname === path ? 'text-blue-600' : ''; // }; // const menuItems = // userRole === 'carrier' // ? [ // { href: '/home', icon: Home, label: 'Главная' }, // { // href: '/favorites', // icon: Heart, // label: 'Избр.', // }, // { href: '/my-cars', icon: Car, label: 'Машины' }, // { href: '/menu', icon: Menu, label: 'Меню' }, // ] // : [ // { href: '/home', icon: Home, label: 'Главная' }, // { // href: '/favorites', // icon: Heart, // label: 'Избр.', // }, // { href: '/cargos', icon: Package, label: 'Грузы' }, // { href: '/menu', icon: Menu, label: 'Меню' }, // { href: 'manager', icon: WorkflowIcon, label: 'менеджер' }, // ]; // useEffect(() => {}, [menuItems, pathname]); // return ( // <div className='fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 py-2 px-4 flex justify-between items-center'> // {menuItems.map((item) => ( // <Link key={item.href} href={item.href} passHref> // <Button // variant='ghost' // size='sm' // className={`flex flex-col items-center relative ${isActive( // item.href // )}`} // > // <item.icon className='h-5 w-5' /> // <span className='text-xs'>{item.label}</span> // </Button> // </Link> // ))} // </div> // ); // }); // export default NavigationMenu; 'use client'; import Link from 'next/link'; import { usePathname } from 'next/navigation'; import { Button } from '@/components/ui/button'; import { Home, Package, Menu, Heart, Car, WorkflowIcon } from 'lucide-react'; import { memo, useEffect } from 'react'; interface NavigationMenuProps { userRole: 'carrier' | 'other'; } const NavigationMenu = memo(function NavigationMenu({ userRole, }: NavigationMenuProps) { const pathname = usePathname(); const isActive = (path: string) => { return pathname === path ? 'text-blue-600' : ''; }; // Base menu items that all users can see const baseMenuItems = [ { href: '/home', icon: Home, label: 'Главная' }, { href: '/favorites', icon: Heart, label: 'Избр.' }, ]; // Role-specific menu items const roleSpecificItems = userRole === 'carrier' ? [{ href: '/my-cars', icon: Car, label: 'Машины' }] : [{ href: '/cargos', icon: Package, label: 'Грузы' }]; // Common menu items for all users const commonItems = [{ href: '/menu', icon: Menu, label: 'Меню' }]; // Get the user's role from localStorage to handle manager view specifically const userRoleFromStorage = typeof window !== 'undefined' ? JSON.parse(localStorage.getItem('logit_user_state') || '{}') : null; console.log(userRoleFromStorage?.role, 'userrolefromstorage'); // Show manager menu item only for managers const managerItems = userRoleFromStorage.role === 'manager' ? [{ href: '/manager', icon: WorkflowIcon, label: 'Менеджер' }] : []; // Combine all menu items const menuItems = [ ...baseMenuItems, ...roleSpecificItems, ...commonItems, ...managerItems, ]; useEffect(() => {}, [menuItems, pathname]); return ( <div className='fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 py-2 px-4 flex justify-between items-center'> {menuItems.map((item) => ( <Link key={item.href} href={item.href} passHref> <Button variant='ghost' size='sm' className={`flex flex-col items-center relative ${isActive( item.href )}`} > <item.icon className='h-5 w-5' /> <span className='text-xs'>{item.label}</span> </Button> </Link> ))} </div> ); }); export default NavigationMenu;
```

# app\debug\page.tsx

```tsx
'use client'; import React, { useEffect, useState } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { enableUserSwitcher, disableUserSwitcher, isUserSwitcherEnabled, } from '@/lib/userswitcherutils'; import { useRouter } from 'next/navigation'; export default function DebugPage() { const [isEnabled, setIsEnabled] = useState(false); const router = useRouter(); useEffect(() => { setIsEnabled(isUserSwitcherEnabled()); }, []); const handleEnable = () => { enableUserSwitcher(); }; const handleDisable = () => { disableUserSwitcher(); }; return ( <div className='min-h-screen bg-gray-100 flex items-center justify-center p-4'> <Card className='w-full max-w-md'> <CardHeader> <CardTitle className='text-center'>Debug Tools</CardTitle> </CardHeader> <CardContent className='space-y-6'> <div className='space-y-2'> <h3 className='text-lg font-medium'>User Switcher</h3> <p className='text-sm text-gray-500'> Current status:{' '} <span className={ isEnabled ? 'text-green-500 font-bold' : 'text-red-500 font-bold' } > {isEnabled ? 'ENABLED' : 'DISABLED'} </span> </p> <div className='flex space-x-2'> <Button onClick={handleEnable} variant='default' className='w-full' disabled={isEnabled} > Enable User Switcher </Button> <Button onClick={handleDisable} variant='destructive' className='w-full' disabled={!isEnabled} > Disable User Switcher </Button> </div> </div> <div className='pt-4 border-t'> <Button onClick={() => router.push('/home')} variant='outline' className='w-full' > Return to Home </Button> </div> <div className='text-xs text-gray-500 pt-4'> <p> For testing purposes only. The user switcher allows you to test different user roles without creating actual Telegram accounts. </p> </div> </CardContent> </Card> </div> ); }
```

# app\driver-verification\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { motion, AnimatePresence } from 'framer-motion'; import { FileUpload } from '@/components/FileUpload'; import { Button } from '@/components/ui/button'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Loader2 } from 'lucide-react'; import { useRouter } from 'next/navigation'; import { AuthService } from '@/lib/auth'; import { toast } from 'sonner'; type VerificationStage = 'initial' | 'uploading' | 'verifying' | 'result'; interface VerificationResult { isApproved: boolean; message: string; } interface Document { id: string; type: string; url: string; } const DriverVerificationPage: React.FC = () => { const router = useRouter(); const [stage, setStage] = useState<VerificationStage>('initial'); const [isModalOpen, setIsModalOpen] = useState<boolean>(false); const [documents, setDocuments] = useState<Document[]>([]); const [verificationResult, setVerificationResult] = useState<VerificationResult | null>(null); const [isLoading, setIsLoading] = useState(false); // const handleDocumentUpload = async (documentData: any, type: string) => { // try { // const response = await AuthService.uploadDocument( // documentData.file, // type // ); // setDocuments((prev) => [...prev, response]); // toast.success('Документ успешно загружен'); // } catch (error) { // toast.error('Ошибка при загрузке документа'); // console.error('Document upload error:', error); // } // }; const handleVerification = async () => { if (documents.length < 2) { toast.error('Необходимо загрузить обе стороны водительских прав'); return; } setStage('verifying'); setIsModalOpen(false); setIsLoading(true); try { // Имитация процесса проверки await new Promise((resolve) => setTimeout(resolve, 2000)); const isApproved = Math.random() > 0.1; setVerificationResult({ isApproved, message: isApproved ? 'Ваша категория водительского права соответствует нашим требованиям. Теперь можете пройти идентификацию через платформу MyID.' : "К сожалению, ваша категория водительского права не соответствует нашим требованиям.\n Чтобы получить разрешение на прохождение идентификации, категория водительских прав должна быть как минимум 'C'. ", }); setStage('result'); } catch (error) { toast.error('Ошибка при проверке документов'); console.error('Verification error:', error); setStage('initial'); } finally { setIsLoading(false); } }; const pageVariants = { initial: { opacity: 0, y: 20 }, in: { opacity: 1, y: 0 }, out: { opacity: 0, y: -20 }, }; const pageTransition = { type: 'tween', ease: 'anticipate', duration: 0.5, }; return ( <div className='min-h-screen bg-blue-600 flex items-center justify-center p-4'> <AnimatePresence mode='wait'> {stage === 'initial' && ( <motion.div key='initial' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center' > <h1 className='text-2xl font-bold mb-6 text-blue-800'> Уважаемый перевозчик </h1> <p className='mb-8 text-gray-600'> Чтобы пользоваться нашим сервисом бесплатно, просим вас подтвердить вашу личность. Для этого сначала загрузите ваши водительские права. </p> <Button onClick={() => setIsModalOpen(true)} className='bg-blue-500 hover:bg-blue-600 text-white' > Загрузить водительские права </Button> </motion.div> )} {stage === 'verifying' && ( <motion.div key='verifying' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center' > <Loader2 className='animate-spin h-16 w-16 text-blue-500 mx-auto mb-4' /> <h2 className='text-xl font-semibold text-blue-800'> Проверка документов </h2> <p className='text-gray-600 mt-2'> Пожалуйста, подождите. Мы проверяем ваши документы. </p> </motion.div> )} {stage === 'result' && verificationResult && ( <motion.div key='result' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center' > <h1 className='text-2xl font-bold mb-6 text-blue-800'> Результат проверки </h1> <p className={`mb-8 ${ verificationResult.isApproved ? 'text-green-600' : 'text-red-600' }`} > {verificationResult.message} </p> {verificationResult.isApproved && ( <Button className='bg-green-500 hover:bg-green-600 text-white' onClick={() => { router.push('/registration-confirm'); }} > Перейти к MyID </Button> )} </motion.div> )} </AnimatePresence> <Dialog open={isModalOpen} onOpenChange={setIsModalOpen}> <DialogContent className='sm:max-w-md'> <DialogHeader> <DialogTitle className='text-center text-xl font-semibold text-blue-800'> Загрузка водительских прав </DialogTitle> </DialogHeader> <div className='space-y-6'> <div> <label className='block text-sm font-medium mb-2 text-gray-700'> Передняя сторона </label> {/* <FileUpload type='driver_license_front' onUpload={(data) => handleDocumentUpload(data, 'driver_license_front') } allowedTypes={['image/jpeg', 'image/png']} maxSize={5 * 1024 * 1024} label='Загрузить переднюю сторону' /> */} </div> <div> <label className='block text-sm font-medium mb-2 text-gray-700'> Задняя сторона </label> {/* <FileUpload type='driver_license_back' onUpload={(data) => handleDocumentUpload(data, 'driver_license_back') } allowedTypes={['image/jpeg', 'image/png']} maxSize={5 * 1024 * 1024} label='Загрузить заднюю сторону' /> */} </div> <Button onClick={handleVerification} disabled={documents.length < 2 || isLoading} className='w-full bg-blue-500 hover:bg-blue-600 text-white' > {isLoading ? ( <> <Loader2 className='animate-spin h-4 w-4 mr-2' /> Проверка... </> ) : ( 'Отправить на проверку' )} </Button> </div> </DialogContent> </Dialog> </div> ); }; export default DriverVerificationPage;
```

# app\favorites\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Heart, ArrowLeft, Trash2, ChevronDown, ChevronUp } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { useApp } from '@/contexts/AppContext'; import { formatDate } from '@/lib/utils'; import { motion, AnimatePresence } from 'framer-motion'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { useUser } from '@/contexts/UserContext'; export default function FavoritesPage() { const router = useRouter(); const { favorites, removeFromFavorites, clearAllFavorites } = useApp(); const [expandedItems, setExpandedItems] = useState<string[]>([]); const [showDeleteConfirm, setShowDeleteConfirm] = useState(false); const [itemToDelete, setItemToDelete] = useState<number | null>(null); const { userState } = useUser(); const toggleExpand = (id: string) => { setExpandedItems((prev) => prev.includes(id) ? prev.filter((item) => item !== id) : [...prev, id] ); }; const getFavoriteIcon = (type: string) => { switch (type) { case 'cargo': return '📦'; case 'route': return '🚚'; case 'carrier': return '🚛'; default: return '❤️'; } }; const handleDelete = (id: number) => { setItemToDelete(id); setShowDeleteConfirm(true); }; const confirmDelete = () => { if (itemToDelete) { removeFromFavorites(itemToDelete); } setShowDeleteConfirm(false); setItemToDelete(null); }; const groupedFavorites = favorites.reduce( (acc: Record<string, any[]>, item) => { // const groupedFavorites = favorites.reduce((acc, item) => { if (!acc[item.type]) { acc[item.type] = []; } acc[item.type].push(item); return acc; }, {} as Record<string, any[]> ); return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <div className='flex items-center mb-6'> <Button variant='ghost' onClick={() => router.back()} className='mr-2'> <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-2xl font-bold'>Избранное</h1> </div> <div className='flex justify-between items-center mb-4'> <div className='flex items-center'> <Heart className='h-5 w-5 mr-2 text-red-500' /> <span className='font-semibold'>Всего: {favorites.length}</span> </div> {favorites.length > 0 && ( <Button variant='outline' size='sm' onClick={clearAllFavorites}> <Trash2 className='h-4 w-4 mr-2' /> Очистить все </Button> )} </div> <AnimatePresence mode='popLayout'> {Object.entries(groupedFavorites).length === 0 ? ( <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }} className='text-center py-8 text-gray-500' > У вас пока нет избранных элементов </motion.div> ) : ( Object.entries(groupedFavorites).map(([type, items]) => ( <motion.div key={type} layout initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className='mb-6' > <h2 className='text-lg font-semibold mb-3 flex items-center'> {getFavoriteIcon(type)} <span className='ml-2'> {type === 'cargo' && 'Грузы'} {type === 'route' && 'Маршруты'} {type === 'carrier' && 'Перевозчики'} </span> <Badge variant='secondary' className='ml-2'> {items.length} </Badge> </h2> <AnimatePresence mode='popLayout'> {items.map((item) => ( <motion.div key={item.id} layout initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: 20 }} transition={{ duration: 0.2 }} > <Card className='mb-3'> <CardContent className='p-4'> <div className='flex justify-between items-start'> <div className='flex-1'> <div className='flex items-center justify-between'> <h3 className='font-medium'>{item.title}</h3> <Button variant='ghost' size='sm' onClick={() => handleDelete(item.orderId)} > <Trash2 className='h-4 w-4 text-red-500' /> </Button> </div> <p className='text-sm text-gray-500 mb-2'> {formatDate(item.createdAt)} </p> <p className='text-sm'>{item.description}</p> <AnimatePresence> {expandedItems.includes(item.id) && ( <motion.div initial={{ height: 0, opacity: 0 }} animate={{ height: 'auto', opacity: 1 }} exit={{ height: 0, opacity: 0 }} className='mt-4 space-y-2 text-sm' > {Object.entries(item.details).map( ([key, value]) => ( <p key={key}> <span className='font-medium'> {key}: </span>{' '} {value as React.ReactNode} </p> ) )} </motion.div> )} </AnimatePresence> </div> </div> <Button variant='ghost' size='sm' onClick={() => toggleExpand(item.id)} className='mt-2 w-full' > {expandedItems.includes(item.id) ? ( <> <ChevronUp className='h-4 w-4 mr-2' /> Скрыть детали </> ) : ( <> <ChevronDown className='h-4 w-4 mr-2' /> Показать детали </> )} </Button> </CardContent> </Card> </motion.div> ))} </AnimatePresence> </motion.div> )) )} </AnimatePresence> <Dialog open={showDeleteConfirm} onOpenChange={setShowDeleteConfirm}> <DialogContent> <DialogHeader> <DialogTitle>Подтверждение удаления</DialogTitle> </DialogHeader> <p>Вы уверены, что хотите удалить этот элемент из избранного?</p> <div className='flex justify-end space-x-2 mt-4'> <Button variant='outline' onClick={() => setShowDeleteConfirm(false)} > Отмена </Button> <Button variant='destructive' onClick={confirmDelete}> Удалить </Button> </div> </DialogContent> </Dialog> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> {/* <NavigationMenu userRole='carrier' /> */} </div> ); }
```

# app\globals.css

```css
@tailwind base; @tailwind components; @tailwind utilities; @layer base { :root { --background: #ffffff; --background-secondary: #f3f4f6; --foreground: #020817; --foreground-secondary: #4b5563; --primary: #0066ff; --primary-foreground: #ffffff; --secondary: #ff6b00; --secondary-foreground: #ffffff; --muted: #f3f4f6; --muted-foreground: #6b7280; --accent: #f3f4f6; --accent-foreground: #0066ff; --destructive: #ef4444; --destructive-foreground: #ffffff; --border: #e5e7eb; --input: #e5e7eb; --ring: #0066ff; --radius: 0.5rem; } .dark { --background: #020817; --background-secondary: #1f2937; --foreground: #ffffff; --foreground-secondary: #9ca3af; --primary: #3b82f6; --primary-foreground: #ffffff; --secondary: #ff8533; --secondary-foreground: #ffffff; --muted: #1f2937; --muted-foreground: #9ca3af; --accent: #1f2937; --accent-foreground: #3b82f6; --destructive: #ef4444; --destructive-foreground: #ffffff; --border: #374151; --input: #374151; --ring: #3b82f6; } } @layer base { * { @apply border-border; } body { @apply bg-background text-foreground; font-feature-settings: 'rlig' 1, 'calt' 1; } } .text-balance { text-wrap: balance; }
```

# app\home\page.tsx

```tsx
// 'use client'; // import React, { useState, useEffect } from 'react'; // import { Input } from '@/components/ui/input'; // import { Button } from '@/components/ui/button'; // import { Card, CardContent } from '@/components/ui/card'; // import { Badge } from '@/components/ui/badge'; // import { // Dialog, // DialogContent, // DialogHeader, // DialogTitle, // } from '@/components/ui/dialog'; // import { Checkbox } from '@/components/ui/checkbox'; // import { // Select, // SelectContent, // SelectItem, // SelectTrigger, // SelectValue, // } from '@/components/ui/select'; // import { DateRange, Range, RangeKeyDict } from 'react-date-range'; // import 'react-date-range/dist/styles.css'; // import 'react-date-range/dist/theme/default.css'; // import { // Filter, // Star, // CheckCircle, // Clock, // Bell, // Heart, // ChevronDown, // ChevronUp, // } from 'lucide-react'; // import NavigationMenu from '../components/NavigationMenu'; // import { useUser } from '@/contexts/UserContext'; // import { useRouter } from 'next/navigation'; // import { useFavorites } from '@/hooks/useFavorites'; // import { useNotifications } from '@/hooks/useNotifications'; // import { useApp } from '@/contexts/AppContext'; // type UserRole = 'carrier' | 'other'; // interface Order { // id: number; // cargo: string; // weight: number; // date: string; // payment: string; // price: string; // from: string; // to: string; // vehicleType: string; // description: string; // isTop: boolean; // isVerified: boolean; // experience: number; // rating: number; // dimensions: string; // loadingType: string; // unloadingType: string; // additionalRequirements: string; // } // interface FilterState { // category: string; // from: string; // to: string; // dateRange: Range; // notifications: boolean; // } // const mockOrders: Order[] = [ // { // id: 1, // cargo: 'Металл', // weight: 22, // date: '12.12.2023 14:34', // payment: 'Комбо', // price: 'Договорная', // from: 'Ташкент', // to: 'Москва', // vehicleType: 'Тент', // description: // 'Ташкент-Москва, нужен-тент, груз-металл, вес:22т, оплата:комбо, дата сообщения: 12.12.2023', // isTop: true, // isVerified: true, // experience: 2, // rating: 4, // dimensions: '5x2x2 м', // loadingType: 'Боковая', // unloadingType: 'Задняя', // additionalRequirements: 'Требуется крепление груза', // }, // { // id: 2, // cargo: 'Текстиль', // weight: 15, // date: '10.12.2023 11:00', // payment: 'Безналичный расчет', // price: '2500$', // from: 'Бухара', // to: 'Алматы', // vehicleType: 'Рефрижератор', // description: // 'Бухара-Алматы, требуется рефрижератор, текстильные изделия, вес: 15т, оплата: безналичный расчет, дата сообщения: 10.12.2023', // isTop: false, // isVerified: true, // experience: 3, // rating: 5, // dimensions: '6x2.5x2.5 м', // loadingType: 'Задняя', // unloadingType: 'Задняя', // additionalRequirements: 'Температурный контроль -5°C', // }, // { // id: 3, // cargo: 'Автозапчасти', // weight: 8, // date: '08.12.2023 09:30', // payment: 'Наличные', // price: '1200$', // from: 'Самарканд', // to: 'Киев', // vehicleType: 'Тент', // description: // 'Самарканд-Киев, тент, автозапчасти, вес: 8т, оплата: наличные, дата сообщения: 08.12.2023', // isTop: false, // isVerified: true, // experience: 1, // rating: 3.5, // dimensions: '4x2x2 м', // loadingType: 'Боковая', // unloadingType: 'Задняя', // additionalRequirements: 'Нет дополнительных требований', // }, // { // id: 4, // cargo: 'Строительные материалы', // weight: 30, // date: '05.12.2023 07:45', // payment: 'Договорная', // price: 'По запросу', // from: 'Ташкент', // to: 'Санкт-Петербург', // vehicleType: 'Тент', // description: // 'Ташкент-Санкт-Петербург, тент, строительные материалы, вес: 30т, оплата: договорная, дата сообщения: 05.12.2023', // isTop: true, // isVerified: false, // experience: 5, // rating: 4.5, // dimensions: '10x3x3 м', // loadingType: 'Задняя', // unloadingType: 'Задняя', // additionalRequirements: 'Требуются сертификаты соответствия материалов', // }, // // Добавьте больше заказов с дополнительными полями // ]; // const cargoCategories = [ // 'Металл', // 'Текстиль', // 'Продукты', // 'Техника', // 'Стройматериалы', // ]; // const cities = [ // 'Ташкент', // 'Москва', // 'Бухара', // 'Андижан', // 'Самарканд', // 'Санкт-Петербург', // ]; // const RoleConfirmationDialog: React.FC<{ // onConfirm: (role: 'carrier' | 'other') => void; // }> = ({ onConfirm }) => { // return ( // <Dialog open={true}> // <DialogContent> // <DialogHeader> // <DialogTitle>Подтвердите вашу роль</DialogTitle> // </DialogHeader> // <div className='space-y-4'> // <Button onClick={() => onConfirm('carrier')} className='w-full'> // Я перевозчик // </Button> // <Button onClick={() => onConfirm('other')} className='w-full'> // Я другой пользователь // </Button> // </div> // </DialogContent> // </Dialog> // ); // }; // const FilterModal: React.FC<{ // isOpen: boolean; // onClose: () => void; // onApply: (filters: FilterState) => void; // }> = ({ isOpen, onClose, onApply }) => { // const [filters, setFilters] = useState<FilterState>({ // category: '', // from: '', // to: '', // dateRange: { // startDate: undefined, // endDate: undefined, // key: 'selection', // }, // notifications: false, // }); // const handleSelectChange = (name: keyof FilterState, value: string) => { // setFilters((prev) => ({ ...prev, [name]: value })); // }; // const handleDateRangeChange = (ranges: RangeKeyDict) => { // setFilters((prev) => ({ ...prev, dateRange: ranges.selection })); // }; // const handleCheckboxChange = (checked: boolean) => { // setFilters((prev) => ({ ...prev, notifications: checked })); // }; // const handleApply = () => { // onApply(filters); // onClose(); // }; // return ( // <Dialog open={isOpen} onOpenChange={onClose}> // <DialogContent className='bg-blue-600 text-white'> // <DialogHeader> // <DialogTitle className='text-white text-center'> // Поиск грузов // </DialogTitle> // </DialogHeader> // <div className='space-y-4 max-w-[100vw] overflow-y-auto'> // <Select // onValueChange={(value) => handleSelectChange('category', value)} // > // <SelectTrigger className='bg-blue-500 text-white border-blue-400'> // <SelectValue placeholder='Категория грузов' /> // </SelectTrigger> // <SelectContent> // {cargoCategories.map((category) => ( // <SelectItem key={category} value={category}> // {category} // </SelectItem> // ))} // </SelectContent> // </Select> // <Select onValueChange={(value) => handleSelectChange('from', value)}> // <SelectTrigger className='bg-blue-500 text-white border-blue-400'> // <SelectValue placeholder='Откуда' /> // </SelectTrigger> // <SelectContent> // {cities.map((city) => ( // <SelectItem key={city} value={city}> // {city} // </SelectItem> // ))} // </SelectContent> // </Select> // <Select onValueChange={(value) => handleSelectChange('to', value)}> // <SelectTrigger className='bg-blue-500 text-white border-blue-400'> // <SelectValue placeholder='Куда' /> // </SelectTrigger> // <SelectContent> // {cities.map((city) => ( // <SelectItem key={city} value={city}> // {city} // </SelectItem> // ))} // </SelectContent> // </Select> // <div className='bg-white rounded-md p-2'> // <DateRange // ranges={[filters.dateRange]} // onChange={handleDateRangeChange} // months={1} // direction='vertical' // className='w-full' // /> // </div> // <div className='flex items-center space-x-2'> // <Checkbox // id='notifications' // checked={filters.notifications} // onCheckedChange={handleCheckboxChange} // /> // <label htmlFor='notifications' className='text-white'> // Включить уведомления // </label> // </div> // <Button // onClick={handleApply} // className='w-full bg-yellow-400 text-blue-800 hover:bg-yellow-500' // > // Найти грузы // </Button> // </div> // </DialogContent> // </Dialog> // ); // }; // export default function OrdersPage() { // const [searchTerm, setSearchTerm] = useState(''); // const [orders, setOrders] = useState<Order[]>(mockOrders); // const [isFilterModalOpen, setIsFilterModalOpen] = useState(false); // const [showNotificationDialog, setShowNotificationDialog] = useState(false); // const [expandedOrder, setExpandedOrder] = useState<number | null>(null); // const { userState, setUserRole } = useUser(); // // const router = useRouter(); // const [currentOrder, setCurrentOrder] = useState<Order | null>(null); // // const { userState } = useUser(); // const router = useRouter(); // const { // addNotification, // addToFavorites, // removeFromFavorites, // isFavorite, // notifications, // favorites, // } = useApp(); // // const { addNotification } = useNotifications(); // // const { addToFavorites, removeFromFavorites, isFavorite } = useFavorites(); // const [showErrorDialog, setShowErrorDialog] = useState(false); // const [errorMessage, setErrorMessage] = useState(''); // useEffect(() => { // // if (!userState.isAuthenticated && !userState.role) { // // router.push('/select-lang'); // // } // // const savedRole = localStorage.getItem('userRole') as UserRole | null; // // if (savedRole) { // // setUserRole(savedRole); // // } // setOrders(mockOrders); // const handleBeforeUnload = () => { // localStorage.clear(); // }; // window.addEventListener('beforeunload', handleBeforeUnload); // return () => { // window.removeEventListener('beforeunload', handleBeforeUnload); // }; // }, [ // userState, // router, // addNotification, // addToFavorites, // removeFromFavorites, // isFavorite, // orders, // ]); // const handleRoleConfirm = (role: 'carrier' | 'other') => { // setUserRole(role === 'carrier' ? 'carrier' : 'cargo-owner'); // }; // const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => { // setSearchTerm(e.target.value); // // Здесь должна быть логика фильтрации заказов // }; // const handleApplyFilters = (filters: FilterState) => { // console.log('Applied filters:', filters); // // Здесь должна быть логика применения фильтров к заказам // }; // const handleNotificationToggle = (order: Order) => { // if ( // notifications.some( // (notification) => // notification.orderId === order.id && !notification.isRead // ) // ) { // setErrorMessage('Для этого груза уже включены нотификации'); // setShowErrorDialog(true); // } else { // setCurrentOrder(order); // setShowNotificationDialog(true); // } // }; // const handleEnableNotification = () => { // if (currentOrder) { // addNotification({ // orderId: currentOrder.id, // type: 'cargo', // message: `Включены уведомления для груза: ${currentOrder.cargo} (${currentOrder.from} - ${currentOrder.to})`, // }); // setShowNotificationDialog(false); // } // }; // const handleFavoriteToggle = (order: Order) => { // // const favoriteId = `cargo-${order.id}`; // if (isFavorite(order.id)) { // setErrorMessage('Этот груз уже находится в избранном'); // setShowErrorDialog(true); // } else { // addToFavorites({ // orderId: order.id, // type: order.cargo, // title: `${order.cargo}: ${order.from} - ${order.to}`, // description: order.description, // details: { // Вес: `${order.weight} т`, // Габариты: order.dimensions, // 'Тип погрузки': order.loadingType, // 'Тип разгрузки': order.unloadingType, // Оплата: order.payment, // Цена: order.price, // }, // }); // } // }; // const renderStars = (rating: number) => { // return Array(5) // .fill(0) // .map((_, i) => ( // <Star // key={i} // className={`h-4 w-4 ${ // i < rating ? 'text-yellow-400 fill-current' : 'text-gray-300' // }`} // /> // )); // }; // const toggleOrderExpansion = (orderId: number) => { // setExpandedOrder(expandedOrder === orderId ? null : orderId); // }; // if (!userState.role && !userState.isAuthenticated) { // return <RoleConfirmationDialog onConfirm={handleRoleConfirm} />; // } // return ( // <div className='min-h-screen bg-blue-600 p-4 pb-20'> // <div className='flex items-center mb-4 bg-white rounded-lg p-2'> // <Input // type='text' // placeholder='Поиск заказов...' // value={searchTerm} // onChange={handleSearch} // className='mr-2 flex-grow' // /> // <Button // variant='default' // size='sm' // className='bg-yellow-400 text-black hover:bg-yellow-500 whitespace-nowrap' // onClick={() => setIsFilterModalOpen(true)} // > // <Filter className='h-4 w-4 mr-2' /> // Фильтры // </Button> // </div> // <FilterModal // isOpen={isFilterModalOpen} // onClose={() => setIsFilterModalOpen(false)} // onApply={handleApplyFilters} // /> // <div className='space-y-4 mb-20'> // {orders.map((order) => ( // <Card key={order.id} className='bg-white overflow-hidden'> // <CardContent className='p-4'> // <div className='flex justify-between items-start mb-2'> // <div className='flex space-x-1'> // {order.isTop && ( // <Badge // variant='secondary' // className='bg-yellow-100 text-yellow-800' // title='Топ заявки от наших студентов' // > // <Star className='h-4 w-4' /> // </Badge> // )} // {order.isVerified && ( // <Badge // variant='secondary' // className='bg-green-100 text-green-800' // title='Профиль подтвержден' // > // <CheckCircle className='h-4 w-4' /> // </Badge> // )} // {order.experience > 1 && ( // <Badge // variant='secondary' // className='bg-blue-100 text-blue-800' // title='Опыт логиста' // > // <Clock className='h-4 w-4' /> {order.experience}г // </Badge> // )} // </div> // <div className='flex items-center'> // <span className='font-bold mr-1'>{order.rating}</span> // <div className='flex'>{renderStars(order.rating)}</div> // </div> // </div> // <div className='flex justify-between items-center mb-2'> // <span className='font-bold text-lg'> // {order.from} - {order.to} // </span> // <span className='text-sm text-gray-500'>{order.date}</span> // </div> // <div className='grid grid-cols-2 gap-2 mb-2 text-sm'> // <span>Груз: {order.cargo}</span> // <span>Вес: {order.weight} т</span> // <span>Тип: {order.vehicleType}</span> // <span>Оплата: {order.payment}</span> // </div> // <div className='mb-2'> // <span className='font-semibold'>Цена: {order.price}</span> // </div> // {expandedOrder === order.id && ( // <div className='mt-4 text-sm'> // <p>Размеры: {order.dimensions}</p> // <p>Тип погрузки: {order.loadingType}</p> // <p>Тип разгрузки: {order.unloadingType}</p> // <p>Доп. требования: {order.additionalRequirements}</p> // <p className='mt-2'>Описание: {order.description}</p> // </div> // )} // <div className='flex justify-between mt-4'> // <Button // variant='outline' // size='sm' // className='flex-1 mr-1' // onClick={() => toggleOrderExpansion(order.id)} // > // {expandedOrder === order.id ? ( // <ChevronUp className='h-4 w-4 mr-1' /> // ) : ( // <ChevronDown className='h-4 w-4 mr-1' /> // )} // {expandedOrder === order.id ? 'Скрыть' : 'Подробнее'} // </Button> // <Button // variant='outline' // size='sm' // className='flex-1 ml-1 mr-1' // onClick={() => handleNotificationToggle(order)} // > // <Bell className='h-4 w-4 mr-1' /> // </Button> // {/* <Button // variant='outline' // size='sm' // className='flex-1 ml-1 mr-1' // onClick={() => setShowNotificationDialog(true)} // > // <Bell className='h-4 w-4 mr-1' /> // </Button> */} // <Button // variant='outline' // size='sm' // className={`flex-1 ${ // isFavorite(order.id) // ? 'text-red-500 hover:text-red-600' // : '' // }`} // onClick={() => handleFavoriteToggle(order)} // > // <Heart className='h-4 w-4 mr-1' /> // </Button> // {/* <Button variant='outline' size='sm' className='flex-1'> // <Heart className='h-4 w-4 mr-1' /> // </Button> */} // </div> // </CardContent> // </Card> // ))} // </div> // <Dialog // open={showNotificationDialog} // onOpenChange={setShowNotificationDialog} // > // <DialogContent> // <DialogHeader> // <DialogTitle>Включить уведомления?</DialogTitle> // </DialogHeader> // <p> // Вы будете получать уведомления о новых предложениях по этому // направлению и типу груза. // </p> // <div className='flex justify-end space-x-2 mt-4'> // <Button // variant='outline' // onClick={() => setShowNotificationDialog(false)} // > // Отмена // </Button> // <Button onClick={handleEnableNotification}>Включить</Button> // </div> // </DialogContent> // </Dialog> // {/* <Dialog // open={showNotificationDialog} // onOpenChange={setShowNotificationDialog} // > // <DialogContent> // <DialogHeader> // <DialogTitle>Включить уведомления?</DialogTitle> // </DialogHeader> // <p> // Хотите включить уведомления по выбранным типам груза и направлениям? // </p> // <div className='flex justify-end space-x-2 mt-4'> // <Button // variant='outline' // onClick={() => setShowNotificationDialog(false)} // > // Отмена // </Button> // <Button // onClick={() => { // // Логика включения уведомлений // setShowNotificationDialog(false); // }} // > // Включить // </Button> // </div> // </DialogContent> // </Dialog> */} // <Dialog open={showErrorDialog} onOpenChange={setShowErrorDialog}> // <DialogContent> // <DialogHeader> // <DialogTitle>Внимание</DialogTitle> // </DialogHeader> // <p>{errorMessage}</p> // <div className='flex justify-end space-x-2 mt-4'> // <Button onClick={() => setShowErrorDialog(false)}>Понятно</Button> // </div> // </DialogContent> // </Dialog> // <NavigationMenu // userRole={userState.role === 'carrier' ? 'carrier' : 'other'} // /> // </div> // ); // // <NavigationMenu // // userRole={userState.role === 'carrier' ? 'carrier' : 'other'} // // /> // // {/* <NavigationMenu userRole={userRole} /> */} // // </div> // // ); // } // ........................................................................................................................................................................................................................................................... // 'use client'; // import React, { useState, useEffect } from 'react'; // import { Button } from '@/components/ui/button'; // import { Input } from '@/components/ui/input'; // import { Card, CardContent } from '@/components/ui/card'; // import { Badge } from '@/components/ui/badge'; // import { // Dialog, // DialogContent, // DialogHeader, // DialogTitle, // } from '@/components/ui/dialog'; // import { // Select, // SelectContent, // SelectItem, // SelectTrigger, // SelectValue, // } from '@/components/ui/select'; // import { Checkbox } from '@/components/ui/checkbox'; // import { ScrollArea } from '@/components/ui/scroll-area'; // import { // Filter, // Star, // CheckCircle, // Clock, // Bell, // Heart, // ChevronDown, // ChevronUp, // Search, // Loader2, // } from 'lucide-react'; // import NavigationMenu from '../components/NavigationMenu'; // import { useRouter } from 'next/navigation'; // import { useUser } from '@/contexts/UserContext'; // import { useApp } from '@/contexts/AppContext'; // import { api } from '@/lib/api'; // import { toast } from 'sonner'; // interface CargoResponse { // results: Cargo[]; // } // interface Cargo { // id: string; // title: string; // description: string; // owner: { // id: string; // role: string; // company_name?: string; // full_name: string; // rating?: number; // is_verified?: boolean; // }; // weight: number; // volume?: number; // loading_point: string; // unloading_point: string; // loading_date: string; // vehicle_type: string; // payment_method: string; // price?: number; // status: string; // created_at: string; // } // export default function OrdersPage() { // const [searchTerm, setSearchTerm] = useState(''); // const [cargos, setCargos] = useState<CargoResponse>({ results: [] }); // const [isFilterModalOpen, setIsFilterModalOpen] = useState(false); // const [showNotificationDialog, setShowNotificationDialog] = useState(false); // const [expandedOrder, setExpandedOrder] = useState<string | null>(null); // const [isLoading, setIsLoading] = useState(true); // const [currentCargo, setCurrentCargo] = useState<Cargo | null>(null); // const [filters, setFilters] = useState({ // vehicle_type: '', // loading_point: '', // unloading_point: '', // }); // const { userState } = useUser(); // const router = useRouter(); // const { // addNotification, // addToFavorites, // removeFromFavorites, // isFavorite, // notifications, // } = useApp(); // useEffect(() => { // fetchCargos(); // }, [searchTerm, filters]); // const fetchCargos = async () => { // try { // setIsLoading(true); // const response = await api.getCargos({ // search: searchTerm, // ...filters, // }); // setCargos(response); // console.log(response, 'response bro'); // } catch (error) { // toast.error('Ошибка при загрузке грузов'); // console.error('Fetch cargos error:', error); // } finally { // setIsLoading(false); // } // }; // const handleNotificationToggle = (cargo: Cargo) => { // if ( // notifications.some( // (notification) => // notification.orderId === Number(cargo.id) && !notification.isRead // ) // ) { // toast.error('Для этого груза уже включены уведомления'); // return; // } // setCurrentCargo(cargo); // setShowNotificationDialog(true); // }; // const handleEnableNotification = () => { // if (currentCargo) { // addNotification({ // orderId: Number(currentCargo.id), // type: 'cargo', // message: `Включены уведомления для груза: ${currentCargo.title} (${currentCargo.loading_point} - ${currentCargo.unloading_point})`, // }); // setShowNotificationDialog(false); // } // }; // const handleFavoriteToggle = (cargo: Cargo) => { // if (isFavorite(Number(cargo.id))) { // toast.error('Этот груз уже находится в избранном'); // return; // } // addToFavorites({ // orderId: Number(cargo.id), // type: cargo.vehicle_type, // title: `${cargo.title}: ${cargo.loading_point} - ${cargo.unloading_point}`, // description: cargo.description, // details: { // Вес: `${cargo.weight} т`, // Объем: cargo.volume ? `${cargo.volume} м³` : 'Не указан', // 'Тип транспорта': cargo.vehicle_type, // Оплата: cargo.payment_method, // Цена: cargo.price ? `${cargo.price} ₽` : 'Договорная', // }, // }); // }; // const renderStars = (rating: number = 0) => { // return Array(5) // .fill(0) // .map((_, i) => ( // <Star // key={i} // className={`h-4 w-4 ${ // i < rating ? 'text-yellow-400 fill-current' : 'text-gray-300' // }`} // /> // )); // }; // const toggleOrderExpansion = (orderId: string) => { // setExpandedOrder(expandedOrder === orderId ? null : orderId); // }; // if (isLoading) { // return ( // <div className='min-h-screen bg-gray-100 flex items-center justify-center'> // <Loader2 className='h-8 w-8 animate-spin text-blue-600' /> // </div> // ); // } // return ( // <div className='min-h-screen bg-blue-600 p-4 pb-20'> // <div className='flex items-center mb-4 bg-white rounded-lg p-2'> // <Input // type='text' // placeholder='Поиск заказов...' // value={searchTerm} // onChange={(e) => setSearchTerm(e.target.value)} // className='mr-2 flex-grow' // /> // <Button // variant='default' // size='sm' // className='bg-yellow-400 text-black hover:bg-yellow-500 whitespace-nowrap' // onClick={() => setIsFilterModalOpen(true)} // > // <Filter className='h-4 w-4 mr-2' /> // Фильтры // </Button> // </div> // <div className='space-y-4 mb-20'> // {cargos?.results?.map((cargo) => ( // <Card key={cargo.id} className='bg-white overflow-hidden'> // <CardContent className='p-4'> // {cargo.owner && ( // <> // <div className='flex justify-between items-start mb-2'> // <div className='flex space-x-1'> // {cargo.owner && cargo.owner.rating && cargo.owner.rating > 4 && ( // <Badge // variant='secondary' // className='bg-yellow-100 text-yellow-800' // title='Высокий рейтинг' // > // <Star className='h-4 w-4' /> // </Badge> // )} // {cargo.owner && cargo.owner.is_verified && ( // <Badge // variant='secondary' // className='bg-green-100 text-green-800' // title='Профиль подтвержден' // > // <CheckCircle className='h-4 w-4' /> // </Badge> // )} // </div> // <div className='flex items-center'> // {cargo.owner && cargo.owner.rating && ( // <> // <span className='font-bold mr-1'> // {cargo.owner.rating} // </span> // <div className='flex'> // {renderStars(cargo.owner.rating)} // </div> // </> // )} // </div> // </div> // </> // )} // <div className='flex justify-between items-center mb-2'> // <span className='font-bold text-lg'> // {cargo.loading_point} - {cargo.unloading_point} // </span> // <span className='text-sm text-gray-500'> // {new Date(cargo.created_at).toLocaleString()} // </span> // </div> // <div className='grid grid-cols-2 gap-2 mb-2 text-sm'> // <span>Груз: {cargo.title}</span> // <span>Вес: {cargo.weight} т</span> // <span>Тип: {cargo.vehicle_type}</span> // <span>Оплата: {cargo.payment_method}</span> // </div> // <div className='mb-2'> // <span className='font-semibold'> // Цена: {cargo.price ? `${cargo.price} ₽` : 'Договорная'} // </span> // </div> // {expandedOrder === cargo.id && ( // <div className='mt-4 text-sm'> // <p>Описание: {cargo.description}</p> // {cargo.volume && <p>Объем: {cargo.volume} м³</p>} // <p> // Дата загрузки:{' '} // {new Date(cargo.loading_date).toLocaleDateString()} // </p> // </div> // )} // <div className='flex justify-between mt-4'> // <Button // variant='outline' // size='sm' // className='flex-1 mr-1' // onClick={() => toggleOrderExpansion(cargo.id)} // > // {expandedOrder === cargo.id ? ( // <ChevronUp className='h-4 w-4 mr-1' /> // ) : ( // <ChevronDown className='h-4 w-4 mr-1' /> // )} // {expandedOrder === cargo.id ? 'Скрыть' : 'Подробнее'} // </Button> // <Button // variant='outline' // size='sm' // className='flex-1 ml-1 mr-1' // onClick={() => handleNotificationToggle(cargo)} // > // <Bell className='h-4 w-4 mr-1' /> // </Button> // <Button // variant='outline' // size='sm' // className={`flex-1 ${ // isFavorite(Number(cargo.id)) // ? 'text-red-500 hover:text-red-600' // : '' // }`} // onClick={() => handleFavoriteToggle(cargo)} // > // <Heart className='h-4 w-4 mr-1' /> // </Button> // </div> // </CardContent> // </Card> // ))} // </div> // <Dialog // open={showNotificationDialog} // onOpenChange={setShowNotificationDialog} // > // <DialogContent> // <DialogHeader> // <DialogTitle>Включить уведомления?</DialogTitle> // </DialogHeader> // <p> // Вы будете получать уведомления о новых предложениях по этому // направлению и типу груза. // </p> // <div className='flex justify-end space-x-2 mt-4'> // <Button // variant='outline' // onClick={() => setShowNotificationDialog(false)} // > // Отмена // </Button> // <Button onClick={handleEnableNotification}>Включить</Button> // </div> // </DialogContent> // </Dialog> // <NavigationMenu // userRole={userState.role === 'carrier' ? 'carrier' : 'other'} // /> // </div> // ); // } 'use client'; import React, { useState, useEffect, useRef } from 'react'; import { Input } from '@/components/ui/input'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Checkbox } from '@/components/ui/checkbox'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { ScrollArea } from '@/components/ui/scroll-area'; import { DateRange, Range, RangeKeyDict } from 'react-date-range'; import 'react-date-range/dist/styles.css'; import 'react-date-range/dist/theme/default.css'; import { Filter, Star, CheckCircle, Clock, Bell, Heart, ChevronDown, ChevronUp, X, Check, Loader2, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useUser } from '@/contexts/UserContext'; import { useRouter } from 'next/navigation'; import { useApp } from '@/contexts/AppContext'; import { api } from '@/lib/api'; import { toast } from 'sonner'; import { cn } from '@/lib/utils'; import { Slider } from '@/components/ui/slider'; interface Location { id: string; name: string; full_name?: string; level?: number; parent_name?: string; country_name?: string; latitude?: number; longitude?: number; } interface FilterState { category: string; loading_location: { id: string; name: string }; unloading_location: { id: string; name: string }; vehicleType: string; dateRange: Range; notifications: boolean; radius: number; // Добавлено для радиуса поиска } interface CargoResponse { results: Cargo[]; } interface Cargo { id: string; title: string; description: string; owner: { id: string; role: string; company_name?: string; full_name: string; rating?: number; is_verified?: boolean; }; weight: number; volume?: number; loading_point: string; unloading_point: string; loading_location?: string; unloading_location?: string; loading_date: string; vehicle_type: string; payment_method: string; price?: number; status: string; created_at: string; } const cargoCategories = [ 'Металл', 'Текстиль', 'Продукты', 'Техника', 'Стройматериалы', ]; const vehicleTypes = [ 'tent', 'refrigerator', 'isothermal', 'container', 'car_carrier', 'board', ]; const LocationSelector = ({ value, onChange, placeholder, error, errorMessage, }: { value: { id: string; name: string }; onChange: (value: { id: string; name: string }) => void; placeholder: string; error?: boolean; errorMessage?: string; }) => { const [open, setOpen] = useState(false); const [searchQuery, setSearchQuery] = useState(''); const [locations, setLocations] = useState<Location[]>([]); const [isLoading, setIsLoading] = useState(false); const containerRef = useRef<HTMLDivElement>(null); // Обработка клика вне компонента для закрытия выпадающего списка useEffect(() => { const handleClickOutside = (event: MouseEvent) => { if ( containerRef.current && !containerRef.current.contains(event.target as Node) ) { setOpen(false); } }; document.addEventListener('mousedown', handleClickOutside); return () => { document.removeEventListener('mousedown', handleClickOutside); }; }, []); // Поиск локаций при вводе useEffect(() => { if (searchQuery.length >= 2) { setIsLoading(true); setOpen(true); // Открываем список при вводе const timer = setTimeout(() => { api .searchLocations(searchQuery) .then((data) => { setLocations(Array.isArray(data) ? data : []); setIsLoading(false); }) .catch((err) => { console.error('Search error:', err); setLocations([]); setIsLoading(false); }); }, 300); return () => clearTimeout(timer); } else { setLocations([]); if (searchQuery.length === 0) { setOpen(false); } } }, [searchQuery]); const handleSelect = (location: Location) => { onChange({ id: location.id, name: location.full_name || location.name, }); setSearchQuery(''); setOpen(false); }; return ( <div className='relative w-full' ref={containerRef}> <Input placeholder={placeholder} value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} onFocus={() => searchQuery.length >= 2 && setOpen(true)} className={cn(error && 'border-red-500')} /> {/* Показываем выбранное значение если оно есть и поиск пустой */} {value.name && searchQuery === '' && ( <div className='absolute right-0 top-0 h-full flex items-center pr-3 text-sm text-muted-foreground'> {value.name} </div> )} {open && ( <div className='absolute z-10 w-full mt-1 bg-white rounded-md border shadow-md'> <div className='p-1'> {isLoading ? ( <div className='p-4 text-center text-sm text-muted-foreground'> Загрузка... </div> ) : locations.length === 0 ? ( <div className='p-4 text-center text-sm text-muted-foreground'> {searchQuery.length < 2 ? 'Введите минимум 2 символа для поиска' : 'Ничего не найдено'} </div> ) : ( <ScrollArea className='h-[300px]'> {locations.map((location) => ( <div key={location.id} onClick={() => handleSelect(location)} className={cn( 'flex items-center gap-2 rounded-md px-2 py-1.5 cursor-pointer', 'hover:bg-blue-50' )} > <div className='flex-1'> <p className='text-sm font-medium'> {location.name} {location.level === 3 && location.parent_name && ( <span className='text-gray-500'> {' - '} {location.parent_name} </span> )} {location.country_name && location.level !== 1 && ( <span className='text-gray-500'> {', '} {location.country_name} </span> )} </p> {location.full_name && ( <p className='text-xs text-gray-500'> {location.full_name} </p> )} </div> {value.id === location.id && <Check className='h-4 w-4' />} </div> ))} </ScrollArea> )} </div> </div> )} {error && errorMessage && ( <p className='text-sm text-red-500 mt-1'>{errorMessage}</p> )} </div> ); }; const FilterModal: React.FC<{ isOpen: boolean; onClose: () => void; onApply: (filters: any) => void; }> = ({ isOpen, onClose, onApply }) => { const [filters, setFilters] = useState<FilterState>({ category: '', loading_location: { id: '', name: '' }, unloading_location: { id: '', name: '' }, vehicleType: '', dateRange: { startDate: undefined, endDate: undefined, key: 'selection', }, notifications: false, radius: 100, // Значение по умолчанию }); const handleSelectChange = (name: string, value: string) => { setFilters((prev) => ({ ...prev, [name]: value })); }; const handleDateRangeChange = (ranges: RangeKeyDict) => { setFilters((prev) => ({ ...prev, dateRange: ranges.selection })); }; const handleCheckboxChange = (checked: boolean) => { setFilters((prev) => ({ ...prev, notifications: checked })); }; const handleRadiusChange = (value: number[]) => { setFilters((prev) => ({ ...prev, radius: value[0] })); }; const handleApply = () => { onApply({ category: filters.category, loading_location_id: filters.loading_location.id, // Изменено с loading_location unloading_location_id: filters.unloading_location.id, // Изменено с unloading_location vehicle_type: filters.vehicleType, date_from: filters.dateRange.startDate ? new Date(filters.dateRange.startDate).toISOString().split('T')[0] : undefined, date_to: filters.dateRange.endDate ? new Date(filters.dateRange.endDate).toISOString().split('T')[0] : undefined, notifications: filters.notifications, radius: filters.radius, // Добавляем радиус в фильтры }); onClose(); }; return ( <Dialog open={isOpen} onOpenChange={onClose}> <DialogContent className='bg-blue-600 text-white max-w-lg'> <DialogHeader> <DialogTitle className='text-white text-center'> Поиск грузов </DialogTitle> </DialogHeader> <ScrollArea className='pr-4 h-[70vh] max-h-[600px]'> <div className='space-y-4 px-1'> <Select onValueChange={(value) => handleSelectChange('category', value)} > <SelectTrigger className='bg-blue-500 text-white border-blue-400'> <SelectValue placeholder='Категория грузов' /> </SelectTrigger> <SelectContent> {cargoCategories.map((category) => ( <SelectItem key={category} value={category}> {category} </SelectItem> ))} </SelectContent> </Select> <Select onValueChange={(value) => handleSelectChange('vehicleType', value) } > <SelectTrigger className='bg-blue-500 text-white border-blue-400'> <SelectValue placeholder='Тип транспорта' /> </SelectTrigger> <SelectContent> {vehicleTypes.map((type) => ( <SelectItem key={type} value={type}> {type === 'tent' ? 'Тент' : type === 'refrigerator' ? 'Рефрижератор' : type === 'isothermal' ? 'Изотерм' : type === 'container' ? 'Контейнер' : type === 'car_carrier' ? 'Автовоз' : 'Борт'} </SelectItem> ))} </SelectContent> </Select> <div className='space-y-2'> <label className='text-white text-sm'>Откуда</label> <LocationSelector value={filters.loading_location} onChange={(value) => setFilters((prev) => ({ ...prev, loading_location: value, })) } placeholder='Выберите пункт погрузки' /> </div> <div className='space-y-2'> <label className='text-white text-sm'>Куда</label> <LocationSelector value={filters.unloading_location} onChange={(value) => setFilters((prev) => ({ ...prev, unloading_location: value, })) } placeholder='Выберите пункт выгрузки' /> </div> {/* Радиус поиска */} <div className='space-y-2'> <div className='flex justify-between items-center'> <label className='text-white text-sm'> Радиус поиска: {filters.radius} км </label> </div> <Slider defaultValue={[100]} max={500} min={0} step={10} value={[filters.radius]} onValueChange={handleRadiusChange} className='py-4' /> <p className='text-xs text-blue-200'> Поиск грузов в радиусе до {filters.radius} км от выбранных точек </p> </div> <div className='bg-white rounded-md p-2'> <DateRange ranges={[filters.dateRange]} onChange={handleDateRangeChange} months={1} direction='vertical' className='w-full' /> </div> <div className='flex items-center space-x-2'> <Checkbox id='notifications' checked={filters.notifications} onCheckedChange={handleCheckboxChange} /> <label htmlFor='notifications' className='text-white'> Включить уведомления </label> </div> <Button onClick={handleApply} className='w-full bg-yellow-400 text-blue-800 hover:bg-yellow-500' > Найти грузы </Button> </div> </ScrollArea> </DialogContent> </Dialog> ); }; export default function OrdersPage() { const [searchTerm, setSearchTerm] = useState(''); const [cargos, setCargos] = useState<CargoResponse>({ results: [] }); const [isFilterModalOpen, setIsFilterModalOpen] = useState(false); const [showNotificationDialog, setShowNotificationDialog] = useState(false); const [expandedOrder, setExpandedOrder] = useState<string | null>(null); const [isLoading, setIsLoading] = useState(true); const [currentCargo, setCurrentCargo] = useState<Cargo | null>(null); const [filterParams, setFilterParams] = useState<any>({}); const [showErrorDialog, setShowErrorDialog] = useState(false); const [errorMessage, setErrorMessage] = useState(''); const { userState } = useUser(); const router = useRouter(); const { addNotification, addToFavorites, removeFromFavorites, isFavorite, notifications, } = useApp(); useEffect(() => { fetchCargos(); }, [searchTerm, filterParams]); const fetchCargos = async () => { try { setIsLoading(true); console.log(searchTerm, 'searchterm'); console.log(filterParams, 'filterparams'); const response = await api.getCargos({ search: searchTerm, ...filterParams, }); setCargos(response); console.log(response, 'res') } catch (error) { toast.error('Ошибка при загрузке грузов'); console.error('Fetch cargos error:', error); } finally { setIsLoading(false); } }; const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => { setSearchTerm(e.target.value); }; const handleApplyFilters = (filters: any) => { console.log('Applied filters:', filters); setFilterParams(filters); // If notifications are enabled, add a notification for the filter if (filters.notifications) { const notificationMessage = `Включены уведомления для поиска: ${ filters.category ? `${filters.category}, ` : '' }${filters.loading_location ? `Из: ${filters.loading_location}, ` : ''}${ filters.unloading_location ? `В: ${filters.unloading_location}` : '' }${filters.radius ? `, Радиус: ${filters.radius} км` : ''}`; addNotification({ orderId: Date.now(), // Use timestamp as ID type: 'filter', message: notificationMessage, }); toast.success('Уведомления о новых грузах включены'); } }; const handleNotificationToggle = (cargo: Cargo) => { if ( notifications.some( (notification) => notification.orderId === Number(cargo.id) && !notification.isRead ) ) { setErrorMessage('Для этого груза уже включены нотификации'); setShowErrorDialog(true); return; } setCurrentCargo(cargo); setShowNotificationDialog(true); }; const handleEnableNotification = () => { if (currentCargo) { addNotification({ orderId: Number(currentCargo.id), type: 'cargo', message: `Включены уведомления для груза: ${currentCargo.title} (${currentCargo.loading_point} - ${currentCargo.unloading_point})`, }); setShowNotificationDialog(false); toast.success('Уведомления включены'); } }; const handleFavoriteToggle = (cargo: Cargo) => { if (isFavorite(Number(cargo.id))) { removeFromFavorites(Number(cargo.id)); toast.success('Груз удален из избранного'); } else { addToFavorites({ orderId: Number(cargo.id), type: cargo.vehicle_type, title: `${cargo.title}: ${cargo.loading_point} - ${cargo.unloading_point}`, description: cargo.description, details: { Вес: `${cargo.weight} т`, Объем: cargo.volume ? `${cargo.volume} м³` : 'Не указан', 'Тип транспорта': cargo.vehicle_type, Оплата: cargo.payment_method, Цена: cargo.price ? `${cargo.price} ₽` : 'Договорная', }, }); toast.success('Груз добавлен в избранное'); } }; const renderStars = (rating: number = 0) => { return Array(5) .fill(0) .map((_, i) => ( <Star key={i} className={`h-4 w-4 ${ i < rating ? 'text-yellow-400 fill-current' : 'text-gray-300' }`} /> )); }; const toggleOrderExpansion = (orderId: string) => { setExpandedOrder(expandedOrder === orderId ? null : orderId); }; return ( <div className='min-h-screen bg-blue-600 p-4 pb-20'> <div className='flex items-center mb-4 bg-white rounded-lg p-2'> <Input type='text' placeholder='Поиск заказов...' value={searchTerm} onChange={handleSearch} className='mr-2 flex-grow' /> <Button variant='default' size='sm' className='bg-yellow-400 text-black hover:bg-yellow-500 whitespace-nowrap' onClick={() => setIsFilterModalOpen(true)} > <Filter className='h-4 w-4 mr-2' /> Фильтры </Button> </div> <FilterModal isOpen={isFilterModalOpen} onClose={() => setIsFilterModalOpen(false)} onApply={handleApplyFilters} /> {isLoading ? ( <div className='flex items-center justify-center h-64'> <Loader2 className='h-8 w-8 animate-spin text-white' /> </div> ) : ( <div className='space-y-4 mb-20'> {filterParams.radius && (filterParams.loading_location || filterParams.unloading_location) && ( <div className='bg-white p-3 rounded-lg mb-2 text-sm'> <Badge variant='secondary' className='bg-blue-100 text-blue-800' > Поиск в радиусе {filterParams.radius} км </Badge> {filterParams.loading_location && ( <span className='ml-2'>от точки погрузки</span> )} {filterParams.loading_location && filterParams.unloading_location && <span> и </span>} {filterParams.unloading_location && ( <span>от точки выгрузки</span> )} </div> )} {cargos.results && cargos.results.length > 0 ? ( cargos.results.map((cargo) => ( <Card key={cargo.id} className='bg-white overflow-hidden'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-2'> <div className='flex space-x-1'> {cargo.owner && cargo.owner.rating && cargo.owner.rating > 4 && ( <Badge variant='secondary' className='bg-yellow-100 text-yellow-800' title='Высокий рейтинг' > <Star className='h-4 w-4' /> </Badge> )} {cargo.owner && cargo.owner.is_verified && ( <Badge variant='secondary' className='bg-green-100 text-green-800' title='Профиль подтвержден' > <CheckCircle className='h-4 w-4' /> </Badge> )} </div> <div className='flex items-center'> {cargo.owner && cargo.owner.rating && ( <> <span className='font-bold mr-1'> {cargo.owner.rating} </span> <div className='flex'> {renderStars(cargo.owner.rating)} </div> </> )} </div> </div> <div className='flex justify-between items-center mb-2'> <span className='font-bold text-lg'> {cargo.loading_point} - {cargo.unloading_point} </span> <span className='text-sm text-gray-500'> {new Date(cargo.created_at).toLocaleString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', })} </span> </div> <div className='grid grid-cols-2 gap-2 mb-2 text-sm'> <span>Груз: {cargo.title}</span> <span>Вес: {cargo.weight} т</span> <span>Тип: {cargo.vehicle_type}</span> <span>Оплата: {cargo.payment_method}</span> </div> <div className='mb-2'> <span className='font-semibold'> Цена: {cargo.price ? `${cargo.price} ₽` : 'Договорная'} </span> </div> {expandedOrder === cargo.id && ( <div className='mt-4 text-sm'> <p>Описание: {cargo.description}</p> {cargo.volume && <p>Объем: {cargo.volume} м³</p>} <p> Дата загрузки:{' '} {new Date(cargo.loading_date).toLocaleDateString()} </p> </div> )} <div className='flex justify-between mt-4'> <Button variant='outline' size='sm' className='flex-1 mr-1' onClick={() => toggleOrderExpansion(cargo.id)} > {expandedOrder === cargo.id ? ( <ChevronUp className='h-4 w-4 mr-1' /> ) : ( <ChevronDown className='h-4 w-4 mr-1' /> )} {expandedOrder === cargo.id ? 'Скрыть' : 'Подробнее'} </Button> <Button variant='outline' size='sm' className='flex-1 ml-1 mr-1' onClick={() => handleNotificationToggle(cargo)} > <Bell className='h-4 w-4 mr-1' /> </Button> <Button variant='outline' size='sm' className={`flex-1 ${ isFavorite(Number(cargo.id)) ? 'text-red-500 hover:text-red-600' : '' }`} onClick={() => handleFavoriteToggle(cargo)} > <Heart className='h-4 w-4 mr-1' /> </Button> </div> </CardContent> </Card> )) ) : ( <div className='bg-white p-6 rounded-lg text-center text-gray-600'> Грузы не найдены. Попробуйте изменить параметры поиска. </div> )} </div> )} <Dialog open={showNotificationDialog} onOpenChange={setShowNotificationDialog} > <DialogContent> <DialogHeader> <DialogTitle>Включить уведомления?</DialogTitle> </DialogHeader> <p> Вы будете получать уведомления о новых предложениях по этому направлению и типу груза. </p> <div className='flex justify-end space-x-2 mt-4'> <Button onClick={() => setShowErrorDialog(false)}>Понятно</Button> </div> </DialogContent> </Dialog> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); }
```

# app\layout.tsx

```tsx
'use client'; import './globals.css'; import { Inter } from 'next/font/google'; import { ErrorBoundary } from '@/components/ErrorBoundary'; import { AppProvider } from '@/contexts/AppContext'; import { ThemeProvider } from '@/contexts/ThemeContext'; import { LoadingProvider } from '@/components/LoadingProvider'; import { ToastProvider } from '@/components/ToastProvider'; import Script from 'next/script'; import { UserProvider } from '@/contexts/UserContext'; import UserSwitcher from '@/components/UserSwitcher'; const inter = Inter({ subsets: ['latin'] }); export default function RootLayout({ children, }: { children: React.ReactNode; }) { return ( <html lang='en' suppressHydrationWarning> <head> <Script src='https://telegram.org/js/telegram-web-app.js' strategy='beforeInteractive' /> </head> <body className={inter.className}> <ErrorBoundary> <AppProvider> <UserProvider> {/* <ThemeProvider> */} <LoadingProvider> <ToastProvider /> <UserSwitcher /> {children} </LoadingProvider> </UserProvider> {/* </ThemeProvider> */} </AppProvider> </ErrorBoundary> </body> </html> ); }
```

# app\manager\page.tsx

```tsx
'use client'; import React, { useState, useEffect } from 'react'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Button } from '@/components/ui/button'; import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, } from '@/components/ui/dialog'; import { ScrollArea } from '@/components/ui/scroll-area'; import { AlertTriangle, CheckCircle, XCircle, Loader2 } from 'lucide-react'; import { api } from '@/lib/api'; import { toast } from 'sonner'; import { useUser } from '@/contexts/UserContext'; import NavigationMenu from '@/app/components/NavigationMenu'; import { useRouter } from 'next/navigation'; interface ManagerCargoResponse { results: ManagerCargo[]; } interface ManagerCargo { id: string; title: string; loading_point: string; unloading_point: string; loading_date: string; weight: number; volume?: number; price?: number; payment_method: string; status: string; owner: { full_name: string; company_name?: string; }; approval_notes?: string; created_at: string; } export default function ManagerPage() { const [pendingCargos, setPendingCargos] = useState<ManagerCargoResponse>({ results: [], }); const [approvedCargos, setApprovedCargos] = useState<ManagerCargoResponse>({ results: [], }); const [allCargos, setAllCargos] = useState<ManagerCargoResponse>({ results: [], }); const [isLoading, setIsLoading] = useState(true); const [selectedCargo, setSelectedCargo] = useState<ManagerCargo | null>(null); const [showConfirmDialog, setShowConfirmDialog] = useState(false); const [action, setAction] = useState<'approve' | 'reject' | null>(null); const [isSubmitting, setIsSubmitting] = useState(false); const [approvalNotes, setApprovalNotes] = useState(''); const { userState } = useUser(); const router = useRouter(); useEffect(() => { if (userState.role && userState.role.toString() !== 'manager') { router.push('/'); return; } fetchCargos(); }, [userState.role, router]); const fetchCargos = async () => { try { setIsLoading(true); // Fetch pending approval cargos const pendingResponse = await api.get('/cargo/manager/pending_approval/'); setPendingCargos(pendingResponse); console.log(pendingCargos, 'pending cargos'); // Fetch approved cargos const approvedResponse = await api.get('/cargo/manager/approved/'); setApprovedCargos(approvedResponse); console.log(approvedCargos, 'approved cargos'); // Fetch all cargos const allResponse = await api.get('/cargo/cargos/'); setAllCargos(allResponse); console.log(allResponse, 'all cargos'); } catch (error) { toast.error('Ошибка при загрузке грузов'); console.error('Fetch cargos error:', error); } finally { setIsLoading(false); } }; const handleAction = async ( cargo: ManagerCargo, action: 'approve' | 'reject' ) => { setSelectedCargo(cargo); setAction(action); setShowConfirmDialog(true); }; const handleConfirm = async () => { if (!selectedCargo || !action) return; try { setIsSubmitting(true); await api.post(`/cargo/manager/${selectedCargo.id}/${action}/`, { approval_notes: approvalNotes, }); toast.success( action === 'approve' ? 'Груз успешно одобрен' : 'Груз отклонен' ); await fetchCargos(); setShowConfirmDialog(false); setApprovalNotes(''); } catch (error) { toast.error('Ошибка при обработке груза'); console.error('Cargo action error:', error); } finally { setIsSubmitting(false); } }; const renderCargoCard = (cargo: ManagerCargo, isPending: boolean = false) => ( <Card key={cargo?.id} className={`mb-4 ${isPending ? 'border-blue-500' : ''}`} > <CardContent className='p-4'> <div className='flex justify-between items-start mb-4'> <div> <h3 className='font-bold text-lg'>{cargo?.title}</h3> <p className='text-sm text-gray-600'> От: {cargo?.owner?.company_name || cargo?.owner?.full_name} </p> <p className='text-sm text-gray-600'> Создан: {new Date(cargo?.created_at).toLocaleDateString()} </p> </div> <Badge variant={ cargo?.status === 'pending_approval' ? 'secondary' : cargo?.status === 'manager_approved' ? 'outline' : 'default' } > {cargo.status === 'pending_approval' ? 'Ожидает проверки' : cargo?.status === 'manager_approved' ? 'Одобрен' : cargo?.status} </Badge> </div> <div className='grid grid-cols-2 gap-2 mb-4 text-sm'> <div> <span className='font-medium'>Маршрут:</span> <p> {cargo?.loading_point} → {cargo?.unloading_point} </p> </div> <div> <span className='font-medium'>Дата загрузки:</span> <p>{new Date(cargo?.loading_date).toLocaleDateString()}</p> </div> <div> <span className='font-medium'>Груз:</span> <p> {cargo?.weight} т{cargo?.volume && `, ${cargo?.volume} м³`} </p> </div> <div> <span className='font-medium'>Оплата:</span> <p> {cargo?.payment_method} {cargo?.price && ` (${cargo?.price} ₽)`} </p> </div> </div> {isPending || (cargo.status === 'pending_approval' && ( <div className='flex justify-end space-x-2'> <Button variant='outline' onClick={() => handleAction(cargo, 'reject')} > <XCircle className='h-4 w-4 mr-2' /> Отклонить </Button> <Button onClick={() => handleAction(cargo, 'approve')}> <CheckCircle className='h-4 w-4 mr-2' /> Одобрить </Button> </div> ))} </CardContent> </Card> ); if (isLoading) { return ( <div className='flex justify-center items-center min-h-screen'> <Loader2 className='h-8 w-8 animate-spin text-blue-600' /> </div> ); } return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <h1 className='text-2xl font-bold mb-6'>Панель менеджера</h1> {/* Pending Approval Section */} {pendingCargos?.results?.length > 0 && ( <div className='mb-8'> <h2 className='text-xl font-semibold mb-4'> Ожидают проверки{' '} <Badge variant='secondary'>{pendingCargos?.results?.length}</Badge> </h2> <div className='space-y-4'> {pendingCargos?.results?.map((cargo) => renderCargoCard(cargo, true) )} </div> </div> )} {/* Approved Cargos Section */} <div className='mb-8'> <h2 className='text-xl font-semibold mb-4'> Одобренные грузы{' '} <Badge variant='secondary'>{approvedCargos?.results?.length}</Badge> </h2> <div className='space-y-4'> {approvedCargos?.results?.map((cargo) => renderCargoCard(cargo))} </div> </div> {/* All Cargos Section */} <div className='mb-20'> <h2 className='text-xl font-semibold mb-4'> Все грузы{' '} <Badge variant='secondary'>{allCargos?.results?.length}</Badge> </h2> <div className='space-y-4'> {allCargos?.results?.map((cargo) => renderCargoCard(cargo))} </div> </div> <Dialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}> <DialogContent> <DialogHeader> <DialogTitle> {action === 'approve' ? 'Одобрить груз' : 'Отклонить груз'} </DialogTitle> </DialogHeader> <div className='py-4'> <div className='flex items-center space-x-2 text-amber-600'> <AlertTriangle className='h-5 w-5' /> <p> {action === 'approve' ? 'Вы уверены, что хотите одобрить этот груз?' : 'Вы уверены, что хотите отклонить этот груз?'} </p> </div> {selectedCargo && ( <div className='mt-4'> <div className='p-4 bg-gray-50 rounded-lg mb-4'> <p className='font-medium'>{selectedCargo?.title}</p> <p className='text-sm text-gray-600'> {selectedCargo?.loading_point} →{' '} {selectedCargo?.unloading_point} </p> </div> <textarea className='w-full p-2 border rounded-lg' placeholder='Добавить комментарий (необязательно)' value={approvalNotes} onChange={(e) => setApprovalNotes(e.target.value)} rows={3} /> </div> )} </div> <DialogFooter> <Button variant='outline' onClick={() => setShowConfirmDialog(false)} disabled={isSubmitting} > Отмена </Button> <Button variant={action === 'approve' ? 'default' : 'destructive'} onClick={handleConfirm} disabled={isSubmitting} > {isSubmitting ? ( <> <Loader2 className='h-4 w-4 mr-2 animate-spin' /> Обработка... </> ) : action === 'approve' ? ( 'Одобрить' ) : ( 'Отклонить' )} </Button> </DialogFooter> </DialogContent> </Dialog> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); }
```

# app\menu\page.tsx

```tsx
'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Avatar } from '@/components/ui/avatar'; import { Input } from '@/components/ui/input'; import { ScrollArea } from '@/components/ui/scroll-area'; import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, } from '@/components/ui/dialog'; import { Separator } from '@/components/ui/separator'; import { toast } from 'sonner'; import { Search, MapPin, Heart, FileText, HelpCircle, Settings, MessageSquare, LogOut, ChevronRight, Camera, Trash2, ArrowLeft, User, Building2, Truck, GraduationCap, Loader2, Gamepad, FileIcon, Plus, Trash2Icon, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { useUser } from '@/contexts/UserContext'; import { api } from '@/lib/api'; import { Language, UserRole, UserType } from '@/types'; import { Badge } from '@/components/ui/badge'; import { FileUpload } from '@/components/FileUpload'; import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem, } from '@radix-ui/react-select'; interface ProfileField { key: string; label: string; type: 'text' | 'tel' | 'email' | 'date'; required?: boolean; } const defaultProfiles: Record<string, ProfileField[]> = { student: [ { key: 'full_name', label: 'ФИО', type: 'text', required: true }, { key: 'student_id', label: 'Студенческий ID', type: 'text', required: true, }, { key: 'username', label: 'Telegram', type: 'text' }, { key: 'whatsapp_number', label: 'WhatsApp', type: 'tel' }, { key: 'phone_number', label: 'Телефон', type: 'tel', required: true }, { key: 'group_name', label: 'Группа', type: 'text', required: true }, { key: 'end_date', label: 'Дата окончания', type: 'date' }, ], carrier: [ { key: 'full_name', label: 'ФИО', type: 'text', required: true }, { key: 'company_name', label: 'Название компании', type: 'text' }, // { key: 'telegramNumber', label: 'Telegram', type: 'text' }, { key: 'whatsapp_number', label: 'WhatsApp', type: 'tel' }, { key: 'phone_number', label: 'Телефон', type: 'tel', required: true }, // { // key: 'licenseNumber', // label: 'Номер лицензии', // type: 'text', // required: true, // }, ], 'cargo-owner': [ { key: 'full_name', label: 'ФИО', type: 'text', required: true }, { key: 'company_name', label: 'Название компании', type: 'text', required: true, }, // { key: 'telegramNumber', label: 'Telegram', type: 'text' }, { key: 'whatsapp_number', label: 'WhatsApp', type: 'tel' }, { key: 'phone_number', label: 'Телефон', type: 'tel', required: true }, // { // key: 'registration_certificate', // label: 'Рег. номер', // type: 'file', // required: true, // }, ], }; const getRoleIcon = (role: string) => { switch (role) { case 'student': return GraduationCap; case 'carrier': return Truck; case 'cargo-owner': return Building2; default: return User; } }; const documentTypes = [ { value: 'driver_license', label: 'Водительские права', required: true }, { value: 'passport', label: 'Паспорт', required: true }, { value: 'company_certificate', label: 'Свидетельство о регистрации компании', required: false, }, { value: 'other', label: 'Другое', required: false }, ] as const; interface DocumentFormData { file: File; type: 'driver_license' | 'passport' | 'company_certificate' | 'other'; title: string; } export interface Document { id: string; type: string; title: string; file_url: string; file: any; uploaded_at: string; verified: boolean; verified_at?: string; notes?: string; } export interface VehicleDocument extends Document { vehicle_id: string; expiry_date?: string; } export interface UserDocument extends Document { user_id: string; } const DocumentsSection = () => { const [documents, setDocuments] = useState<UserDocument[]>([]); const [isAddingDocument, setIsAddingDocument] = useState(false); const [isLoading, setIsLoading] = useState(true); const [selectedDocument, setSelectedDocument] = useState<DocumentFormData | null>(null); const [isViewerOpen, setIsViewerOpen] = useState(false); const [viewingDocument, setViewingDocument] = useState<UserDocument | null>( null ); // Add this function to handle opening the document viewer const handleViewDocument = (document: UserDocument) => { setViewingDocument(document); setIsViewerOpen(true); }; useEffect(() => { fetchDocuments(); }, []); const fetchDocuments = async () => { try { setIsLoading(true); const response = await api.getUserDocuments(); setDocuments(response); console.log(response, 'document users'); } catch (error) { toast.error('Ошибка при загрузке документов'); } finally { setIsLoading(false); } }; const handleDocumentUpload = async (document: DocumentFormData) => { try { await api.addUserDocument(document); toast.success('Документ успешно загружен'); fetchDocuments(); setIsAddingDocument(false); } catch (error) { toast.error('Ошибка при загрузке документа'); } }; const handleDeleteDocument = async (id: string) => { try { await api.deleteUserDocument(id); toast.success('Документ удален'); fetchDocuments(); } catch (error) { toast.error('Ошибка при удалении документа'); } }; const renderDocumentCard = (document: UserDocument) => ( <Card key={document.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start'> <div> <h3 className='font-semibold'>{document.title}</h3> <p className='text-sm text-gray-600'> {documentTypes.find((t) => t.value === document.type)?.label} </p> </div> <div className='flex space-x-2'> <Badge variant={document.verified ? 'outline' : 'secondary'}> {document.verified ? 'Проверен' : 'На проверке'} </Badge> <Button variant='ghost' size='sm' onClick={() => handleViewDocument(document)} > <FileIcon className='h-4 w-4 mr-1' /> Просмотр </Button> <Button variant='ghost' size='sm' className='text-red-600' onClick={() => handleDeleteDocument(document.id)} > <Trash2Icon className='h-4 w-4' /> </Button> </div> </div> </CardContent> </Card> ); // Add this function to determine the document type const getDocumentType = (url: string): 'image' | 'pdf' | 'other' => { const extension = url?.split('.')?.pop()?.toLowerCase(); if ( ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp']?.includes(extension || '') ) { return 'image'; } else if (extension === 'pdf') { return 'pdf'; } return 'other'; }; // Add this document viewer dialog component to the end of the render function before the return statement const renderDocumentViewer = () => ( <Dialog open={isViewerOpen} onOpenChange={setIsViewerOpen}> <DialogContent className='max-w-4xl w-[90vw]'> <DialogHeader> <DialogTitle>{viewingDocument?.title}</DialogTitle> </DialogHeader> <div className='my-4 max-h-[70vh] overflow-auto'> {viewingDocument && ( <> {getDocumentType(viewingDocument.file) === 'image' ? ( <img src={`${'http://localhost:8000/' + viewingDocument.file}`} alt={viewingDocument.title} className='max-w-full h-auto mx-auto' /> ) : getDocumentType(viewingDocument.file) === 'pdf' ? ( <iframe src={`${ 'http://localhost:8000/' + viewingDocument.file }#toolbar=0`} className='w-full h-[60vh]' title={viewingDocument.title} /> ) : ( <div className='text-center py-8'> <p>Невозможно отобразить данный тип файла в браузере.</p> <Button className='mt-4' onClick={() => window.open( 'http://localhost:8000/' + viewingDocument.file, '_blank' ) } > Открыть в новой вкладке </Button> </div> )} </> )} </div> <DialogFooter> <Button variant='outline' onClick={() => setIsViewerOpen(false)}> Закрыть </Button> <Button onClick={() => window.open( 'http://localhost:8000/' + viewingDocument?.file, '_blank' ) } > Открыть в новой вкладке </Button> </DialogFooter> </DialogContent> </Dialog> ); const renderAddDocumentDialog = () => ( <Dialog open={isAddingDocument} onOpenChange={setIsAddingDocument}> <DialogContent> <DialogHeader> <DialogTitle>Добавить документ</DialogTitle> </DialogHeader> <div className='space-y-4'> <div className='border-2'> {/* <label className='block text-sm font-medium mb-2'>type*</label> */} <Select value={selectedDocument?.type} onValueChange={(value: any) => setSelectedDocument( (prev) => ({ ...prev, type: value } as DocumentFormData) ) } > <SelectTrigger> <SelectValue placeholder='Выберите тип документа' /> </SelectTrigger> <SelectContent> {documentTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} {type.required && ' *'} </SelectItem> ))} </SelectContent> </Select> </div> {/* <Select value={selectedDocument?.type} onValueChange={(value: any) => setSelectedDocument( (prev) => ({ ...prev, type: value } as DocumentFormData) ) } > <SelectTrigger> <SelectValue placeholder='Выберите тип документа' /> </SelectTrigger> <SelectContent> {documentTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} {type.required && ' *'} </SelectItem> ))} </SelectContent> </Select> */} <Input placeholder='Название документа' value={selectedDocument?.title || ''} onChange={(e) => setSelectedDocument( (prev) => ({ ...prev, title: e.target.value } as DocumentFormData) ) } /> <FileUpload onUpload={(file) => { if (selectedDocument?.type) { handleDocumentUpload({ file, type: selectedDocument.type, title: selectedDocument.title || file.name, }); } else { toast.error('Выберите тип документа'); } }} maxSize={5 * 1024 * 1024} label='Загрузить документ' /> </div> </DialogContent> </Dialog> ); if (isLoading) { return <Loader2 className='h-8 w-8 animate-spin text-blue-600' />; } return ( <div className='space-y-4'> <div className='flex justify-between items-center'> <h2 className='text-xl font-semibold'>Мои документы</h2> <Button onClick={() => setIsAddingDocument(true)}> <Plus className='h-4 w-4 mr-2' /> Добавить документ </Button> </div> {documents.length === 0 ? ( <div className='text-center text-gray-500 py-8'> У вас пока нет загруженных документов </div> ) : ( documents.map(renderDocumentCard) )} {renderAddDocumentDialog()} {renderDocumentViewer()} </div> ); }; // Add DocumentsSection to your menu page layout where appropriate export default function MenuPage() { const [showProfile, setShowProfile] = useState<boolean>(false); const [isEditModalOpen, setIsEditModalOpen] = useState<boolean>(false); const [showLogoutConfirm, setShowLogoutConfirm] = useState<boolean>(false); const [formData, setFormData] = useState<Record<string, string>>({}); const [isUploading, setIsUploading] = useState<boolean>(false); const [isMobile, setIsMobile] = useState<boolean>(false); const [isLoading, setIsLoading] = useState<boolean>(true); const [isSaving, setIsSaving] = useState<boolean>(false); const router = useRouter(); const { userState, setUserRole, setLanguage, setUserType, logout } = useUser(); useEffect(() => { fetchUserProfile(); // Check if running in Telegram WebApp const isTelegramWebApp = window.Telegram?.WebApp; // Check viewport width for mobile const checkMobile = () => { setIsMobile(window.innerWidth < 768 || !!isTelegramWebApp); }; checkMobile(); window.addEventListener('resize', checkMobile); return () => window.removeEventListener('resize', checkMobile); }, []); const fetchUserProfile = async () => { try { setIsLoading(true); const userData = await api.getCurrentUser(); console.log(userData, 'userdata bro'); setUserRole(userData.role); // if (userData.role === 'carrier' && userData.is_verified === false) { // router.push('driver-verification/'); // } setFormData(userData); console.log(formData); } catch (error) { toast.error('Ошибка при загрузке профиля'); console.error('Error fetching profile:', error); } finally { setIsLoading(false); } }; const handleInputChange = (key: string, value: string) => { setFormData((prev) => ({ ...prev, [key]: value })); }; const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => { const file = e.target.files?.[0]; if (!file) return; if (!file.type.startsWith('image/')) { toast.error('Пожалуйста, загрузите изображение'); return; } if (file.size > 5 * 1024 * 1024) { toast.error('Размер файла не должен превышать 5MB'); return; } try { setIsUploading(true); // Here you would normally upload the file to your server // const formData = new FormData(); // formData.append('photo', file); // const response = await api.uploadProfilePhoto(formData); // For now, just create a local preview const previewUrl = URL.createObjectURL(file); setFormData((prev) => ({ ...prev, photo: previewUrl })); toast.success('Фото профиля успешно обновлено'); } catch (error) { toast.error('Ошибка при загрузке фото'); console.error('Error uploading photo:', error); } finally { setIsUploading(false); } }; const handleRemovePhoto = async () => { try { // Here you would normally call an API endpoint to remove the photo // await api.removeProfilePhoto(); setFormData((prev) => { const newData = { ...prev }; delete newData.photo; return newData; }); toast.success('Фото профиля удалено'); } catch (error) { toast.error('Ошибка при удалении фото'); console.error('Error removing photo:', error); } }; const handleSaveProfile = async () => { try { setIsSaving(true); const data = { student_id: formData.telegram_id, ...formData }; console.log(data, 'data'); await api.updateProfile(data); setUserRole(formData?.role as UserRole); setUserType(formData.type as UserType); setLanguage(formData.preferred_language as Language); setIsEditModalOpen(false); toast.success('Профиль успешно обновлен'); fetchUserProfile(); // Refresh profile data } catch (error) { toast.error('Ошибка при обновлении профиля'); console.error('Error updating profile:', error); } finally { setIsSaving(false); } }; const handleLogout = () => { logout(); router.push('/'); toast.success('Вы успешно вышли из системы'); }; const getProfileFields = () => { return ( defaultProfiles[formData.role || 'carrier'] || defaultProfiles.carrier ); }; console.log(formData, 'formdataa'); const RoleIcon = getRoleIcon(userState.role || 'carrier'); const menuItems = [ { icon: Search, text: 'Поиск участников и список фирм', action: () => router.push('/search'), }, { icon: MapPin, text: 'Расчет расстояний', action: () => router.push('/calculate-distance'), }, { icon: Heart, text: 'Избранное', action: () => router.push('/favorites') }, { icon: FileText, text: 'Инструкции', action: () => router.push('/instructions'), }, { icon: HelpCircle, text: 'Поддержка', action: () => router.push('/support'), }, { icon: Settings, text: 'Настройки приложения', action: () => router.push('/settings'), }, { icon: MessageSquare, text: 'Отзывы', action: () => router.push('/reviews'), }, { icon: Gamepad, text: 'Игра', action: () => router.push('/game'), }, ]; if (isLoading) { return ( <div className='min-h-screen flex items-center justify-center'> <Loader2 className='h-8 w-8 animate-spin text-primary' /> </div> ); } const renderProfileContent = () => ( <Card className='mt-4'> <CardContent className='p-4'> <div className='flex flex-col sm:flex-row items-center justify-between mb-6'> <div className='flex flex-col sm:flex-row items-center text-center sm:text-left'> <Avatar className='h-20 w-20 sm:h-16 sm:w-16 mb-4 sm:mb-0 sm:mr-4'> <img src={formData.photo || 'https://i.pravatar.cc/150'} alt={formData.full_name || 'Профиль'} className='object-cover' /> </Avatar> <div> <h2 className='text-xl sm:text-2xl font-bold mb-2 sm:mb-1'> {formData.full_name || 'Пользователь'} </h2> <div className='flex items-center justify-center sm:justify-start text-gray-600'> <RoleIcon className='h-4 w-4 mr-1' /> <span className='text-sm'> {formData.role || 'Пользователь'} </span> </div> <div className='flex items-center justify-center sm:justify-start text-gray-600'> <span className='text-sm'> {formData.is_verified ? 'Пользователь Верифицирован' : 'Пользователь Не Верифицирован'}{' '} </span> </div> </div> </div> <Button variant='outline' size='sm' onClick={() => setIsEditModalOpen(true)} className='mt-4 sm:mt-0' > <Camera className='h-4 w-4 mr-2' /> Изменить </Button> </div> <Separator className='my-4' /> <ScrollArea className='h-[calc(100vh-400px)] sm:h-auto pr-4'> <div className='space-y-4'> {getProfileFields().map((field) => ( <div key={field.key} className='space-y-1'> <label className='text-sm font-medium text-gray-500'> {field.label} </label> <p className='text-base break-words'> {formData[field.key] || '—'} </p> </div> ))} </div> </ScrollArea> <Button variant='destructive' className='w-full mt-6' onClick={() => setShowLogoutConfirm(true)} > <LogOut className='h-5 w-5 mr-2' /> Выйти </Button> </CardContent> </Card> ); return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <div className='flex items-center mb-6'> <Button variant='ghost' onClick={() => router.back()} className='p-2'> <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-xl sm:text-2xl font-bold ml-2'>Меню</h1> </div> <div className='flex items-center justify-between mb-4'> <div className='flex items-center'> <Avatar className='h-12 w-12 mr-4'> <img src={formData.photo || 'https://i.pravatar.cc/150'} alt={formData.full_name || 'Профиль'} className='object-cover' /> </Avatar> <div> <p className='font-semibold'> {formData.full_name || 'Пользователь'} </p> <Button variant='link' className='p-0 h-auto text-sm' onClick={() => setShowProfile(!showProfile)} > Личный кабинет </Button> </div> </div> <Button variant='ghost' size='sm' onClick={() => setIsEditModalOpen(true)} className='p-2' > <ChevronRight className='h-5 w-5' /> </Button> </div> {showProfile ? ( renderProfileContent() ) : ( <div className='space-y-2'> {menuItems.map((item, index) => ( <Button key={index} variant='ghost' className='w-full justify-start p-4 h-auto text-left' onClick={item.action} > <item.icon className='h-5 w-5 mr-3 flex-shrink-0' /> <span className='line-clamp-1'>{item.text}</span> </Button> ))} </div> )} <Dialog open={isEditModalOpen} onOpenChange={setIsEditModalOpen}> <DialogContent className={`${ isMobile ? 'w-full h-[100vh] max-w-none m-0 rounded-none' : 'sm:max-w-[425px]' } overflow-hidden flex flex-col`} > <DialogHeader className='px-4 py-3'> <DialogTitle>Редактировать профиль</DialogTitle> </DialogHeader> <ScrollArea className='flex-grow px-4'> <div className='space-y-4 py-4'> <div className='flex flex-col items-center justify-center mb-6'> <Avatar className='h-24 w-24 mb-4'> <img src={formData.photo || 'https://i.pravatar.cc/150'} alt={formData.full_name || 'Профиль'} className='object-cover' /> </Avatar> <div className='space-y-2 w-full flex flex-col items-center'> <div className='relative w-full'> <Input type='file' accept='image/*' onChange={handleImageUpload} className='hidden' id='photo-upload' /> <Button variant='outline' size='sm' disabled={isUploading} onClick={() => document.getElementById('photo-upload')?.click() } className='w-full' > <Camera className='h-4 w-4 mr-2' /> {isUploading ? 'Загрузка...' : 'Изменить фото'} </Button> </div> <Button variant='outline' size='sm' onClick={handleRemovePhoto} disabled={!formData.photo} className='w-full' > <Trash2 className='h-4 w-4 mr-2' /> Удалить фото </Button> </div> </div> {getProfileFields().map((field) => ( <div key={field.key} className='space-y-2'> <label className='text-sm font-medium'> {field.label} {field.required && ( <span className='text-red-500 ml-1'>*</span> )} </label> <Input type={field.type} value={formData[field.key] || ''} onChange={(e) => handleInputChange(field.key, e.target.value) } required={field.required} className='w-full' placeholder={`Введите ${field.label.toLowerCase()}`} /> </div> ))} </div> </ScrollArea> <DialogFooter className='px-4 py-3 mt-2 border-t'> <div className={`flex ${ isMobile ? 'flex-col w-full gap-2' : 'flex-row gap-4' }`} > <Button variant='outline' onClick={() => setIsEditModalOpen(false)} className={isMobile ? 'w-full' : ''} disabled={isSaving} > Отмена </Button> <Button onClick={handleSaveProfile} className={isMobile ? 'w-full' : ''} disabled={isSaving} > {isSaving ? ( <> <Loader2 className='h-4 w-4 mr-2 animate-spin' /> Сохранение... </> ) : ( 'Сохранить' )} </Button> </div> </DialogFooter> </DialogContent> </Dialog> <DocumentsSection /> <Dialog open={showLogoutConfirm} onOpenChange={setShowLogoutConfirm}> <DialogContent className={`${ isMobile ? 'w-[95%] max-w-[95%] mx-auto' : 'sm:max-w-[425px]' }`} > <DialogHeader> <DialogTitle>Подтверждение выхода</DialogTitle> </DialogHeader> <p className='py-4'>Вы уверены, что хотите выйти?</p> <DialogFooter className={`${isMobile ? 'flex-col gap-2' : ''}`}> <Button variant='outline' onClick={() => setShowLogoutConfirm(false)} className={isMobile ? 'w-full' : ''} > Отмена </Button> <Button variant='destructive' onClick={handleLogout} className={isMobile ? 'w-full' : ''} > Выйти </Button> </DialogFooter> </DialogContent> </Dialog> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); }
```

# app\my-cargo\page.tsx

```tsx
'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { ScrollArea } from '@/components/ui/scroll-area'; import { EyeIcon, PencilIcon, PowerIcon, PlusIcon, Loader2, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useUser } from '@/contexts/UserContext'; import { api } from '@/lib/api'; import { toast } from 'sonner'; import { useRouter } from 'next/navigation'; import Link from 'next/link'; interface CargoResponse { results: Cargo[]; } interface Cargo { id: string; title: string; status: string; loading_point: string; unloading_point: string; weight: number; vehicle_type: string; payment_method: string; price?: number; loading_date: string; created_at: string; } export default function MyCargoPage() { const [activeTab, setActiveTab] = useState<'active' | 'inactive'>('active'); const [cargos, setCargos] = useState<CargoResponse>({ results: [] }); const [isLoading, setIsLoading] = useState(true); const [actionInProgress, setActionInProgress] = useState<string | null>(null); const [iscarrier, setiscarrier] = useState(false); const { userState } = useUser(); const router = useRouter(); useEffect(() => { fetchCargos(); if (userState.role === 'carrier') { setiscarrier(true); } }, []); const fetchCargos = async () => { try { setIsLoading(true); const response = await api.getCargos(); setCargos(response); console.log(response, 'cargos'); } catch (error) { toast.error('Ошибка при загрузке грузов'); console.error('Fetch cargos error:', error); } finally { setIsLoading(false); } }; const handleStatusChange = async (id: string, status: string) => { try { setActionInProgress(id); await api.updateCargo(id, { status }); toast.success('Статус груза обновлен'); await fetchCargos(); } catch (error) { toast.error('Ошибка при обновлении статуса'); console.error('Update status error:', error); } finally { setActionInProgress(null); } }; const getStatusBadgeVariant = (status: string) => { switch (status) { case 'active': case 'pending': return 'default'; case 'completed': return 'secondary'; case 'cancelled': return 'destructive'; default: return 'secondary'; } }; const getStatusLabel = (status: string) => { const labels: Record<string, string> = { active: 'Активный', pending: 'Ожидает', completed: 'Завершен', cancelled: 'Отменен', draft: 'Черновик', inactive: 'Неактивный', }; return labels[status] || status; }; const activeCargos = cargos?.results?.filter((cargo) => ['active', 'pending', 'draft'].includes(cargo.status) ); const inactiveCargos = cargos?.results?.filter((cargo) => ['completed', 'cancelled', 'inactive'].includes(cargo.status) ); const handleView = (id: string) => { router.push(`/cargo/${id}`); }; const handleEdit = (id: string) => { router.push(`/cargo/${id}/edit`); }; const renderCargoCard = (cargo: Cargo) => ( <Card key={cargo.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-2'> <h3 className='font-semibold'>{cargo.title}</h3> <Badge variant={getStatusBadgeVariant(cargo.status)}> {getStatusLabel(cargo.status)} </Badge> </div> <p className='text-sm text-gray-600 mb-2'> {cargo.loading_point} - {cargo.unloading_point} </p> <p className='text-sm text-gray-600 mb-4'> {cargo.weight} т, {cargo.vehicle_type} {cargo.price && `, ${cargo.price} ₽`} </p> <div className='flex justify-between'> <Button variant='outline' size='sm' onClick={() => handleView(cargo.id)} > <EyeIcon className='h-4 w-4 mr-2' /> Показать </Button> <Button variant='outline' size='sm' onClick={() => handleEdit(cargo.id)} > <PencilIcon className='h-4 w-4 mr-2' /> Редактировать </Button> {cargo.status === 'active' && ( <Button variant='outline' size='sm' onClick={() => handleStatusChange(cargo.id, 'inactive')} disabled={actionInProgress === cargo.id} > {actionInProgress === cargo.id ? ( <Loader2 className='h-4 w-4 mr-2 animate-spin' /> ) : ( <PowerIcon className='h-4 w-4 mr-2' /> )} Деактивировать </Button> )} {/* {cargo.status === 'completed' && cargo.assigned_to && ( <Button variant='outline' size='sm' onClick={() => router.push('/reviews')} > <Star className='h-4 w-4 mr-2' /> Оценить </Button> )} */} </div> </CardContent> </Card> ); if (isLoading) { return ( <div className='min-h-screen bg-gray-100 p-4 flex items-center justify-center'> <Loader2 className='h-8 w-8 animate-spin text-blue-600' /> </div> ); } if (iscarrier === true) { return ( <div className='min-h-screen bg-gray-100 p-4 flex items-center justify-center'> <Loader2 className='h-8 w-8 animate-spin text-blue-600' /> You don't have enough permissions to access this page{' '} <Link href={'/'}>go to home page</Link> </div> ); } return ( <div className='min-h-screen bg-gray-100 p-4 pb-24'> <h1 className='text-3xl font-bold text-center mb-6'>Мои грузы</h1> <div className='flex mb-4'> <Button variant={activeTab === 'active' ? 'default' : 'outline'} className='flex-1 mr-2' onClick={() => setActiveTab('active')} > Активные <Badge variant='secondary' className='ml-2'> {activeCargos?.length} </Badge> </Button> <Button variant={activeTab === 'inactive' ? 'default' : 'outline'} className='flex-1' onClick={() => setActiveTab('inactive')} > Неактивные <Badge variant='secondary' className='ml-2'> {inactiveCargos?.length} </Badge> </Button> </div> <ScrollArea className='h-[calc(100vh-250px)]'> {activeTab === 'active' ? activeCargos?.map(renderCargoCard) : inactiveCargos?.map(renderCargoCard)} {((activeTab === 'active' && activeCargos?.length === 0) || (activeTab === 'inactive' && inactiveCargos?.length === 0)) && ( <div className='text-center text-gray-500 mt-8'> Нет {activeTab === 'active' ? 'активных' : 'неактивных'} грузов </div> )} </ScrollArea> <div className='fixed bottom-20 left-4 right-4'> <Button className='w-full' onClick={() => router.push('/cargos')}> <PlusIcon className='h-4 w-4 mr-2' /> Добавить еще груз </Button> </div> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); }
```

# app\my-cars\page.tsx

```tsx
'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Card, CardContent } from '@/components/ui/card'; import { Avatar } from '@/components/ui/avatar'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Checkbox } from '@/components/ui/checkbox'; import { ScrollArea } from '@/components/ui/scroll-area'; import { Badge } from '@/components/ui/badge'; import { FileUpload } from '@/components/FileUpload'; import { Camera, FileIcon, Edit2Icon, Trash2Icon, Plus, Loader2, ChevronDown, ChevronUp, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { api } from '@/lib/api'; import { ApiClient } from '@/lib/api'; import { toast } from 'sonner'; import { useUser } from '@/contexts/UserContext'; import AssignedCargosSection from '../components/AssignedCargo'; interface VehicleResponse { results: Vehicle[]; } interface CarrierRequestResponse { results: CarrierRequest[]; } interface Vehicle { id: string; registration_number: string; body_type: string; loading_type: string; capacity: number; volume: number; length: number; width: number; height: number; registration_country: string; adr: boolean; dozvol: boolean; tir: boolean; license_number?: string; is_active: boolean; is_verified: boolean; documents: VehicleDocument[]; } interface VehicleDocument { id: string; type: string; title: string; file: string; expiry_date?: string; verified: boolean; } interface CarrierRequest { id: string; loading_point: string; unloading_point: string; ready_date: string; vehicle: any; vehicle_count: number; price_expectation?: number; payment_terms?: string; notes?: string; status: | 'pending' | 'assigned' | 'accepted' | 'rejected' | 'completed' | 'cancelled'; } const bodyTypes = [ { value: 'tent', label: 'Тентованный' }, { value: 'refrigerator', label: 'Рефрижератор' }, { value: 'isothermal', label: 'Изотермический' }, { value: 'container', label: 'Контейнер' }, { value: 'car_carrier', label: 'Автовоз' }, { value: 'board', label: 'Бортовой' }, ]; const loadingTypes = [ { value: 'ramps', label: 'Аппарели' }, { value: 'no_doors', label: 'Без ворот' }, { value: 'side', label: 'Боковая' }, { value: 'top', label: 'Верхняя' }, { value: 'hydro_board', label: 'Гидроборт' }, ]; const countries = [ { value: 'UZ', label: 'Узбекистан' }, { value: 'RU', label: 'Россия' }, { value: 'KZ', label: 'Казахстан' }, ]; const initialVehicleForm = { id: '', registration_number: '', body_type: '', loading_type: '', capacity: 0, volume: 0, length: 0, width: 0, height: 0, registration_country: '', adr: false, dozvol: false, tir: false, license_number: '', }; const initialCarrierRequestForm = { loading_point: '', unloading_point: '', ready_date: '', vehicle: '', vehicle_count: 1, price_expectation: undefined, payment_terms: '', notes: '', }; interface DocumentFormData { file: File; type: | 'tech_passport' | 'license' | 'insurance' | 'adr_cert' | 'dozvol' | 'tir' | 'other'; title: string; expiry_date?: string; } const documentTypes = [ { value: 'tech_passport', label: 'Технический паспорт', required: true }, { value: 'license', label: 'Водительские права', required: false }, { value: 'insurance', label: 'Страховка', required: true }, { value: 'adr_cert', label: 'ADR сертификат', required: false }, { value: 'dozvol', label: 'DOZVOL', required: false }, { value: 'tir', label: 'TIR', required: false }, { value: 'other', label: 'Другое', required: false }, ] as const; // const documentTypes = [ // { value: 'tech_passport', label: 'Технический паспорт' }, // { value: 'driver_license', label: 'Водительские права' }, // { value: 'insurance', label: 'Страховка' }, // { value: 'adr_cert', label: 'ADR сертификат' }, // { value: 'dozvol', label: 'DOZVOL' }, // { value: 'tir', label: 'TIR' }, // ]; export default function MyVehiclesPage() { const [vehicles, setVehicles] = useState<VehicleResponse>({ results: [] }); // const [vehicles, setVehicles] = useState<Vehicle[]>([]); const [carrierRequests, setCarrierRequests] = useState<CarrierRequestResponse>({ results: [] }); const [isLoading, setIsLoading] = useState(true); const [isAddingVehicle, setIsAddingVehicle] = useState(false); const [isAddingRequest, setIsAddingRequest] = useState(false); const [selectedVehicle, setSelectedVehicle] = useState<Vehicle | null>(null); const [expandedVehicle, setExpandedVehicle] = useState<string | null>(null); const [isSubmitting, setIsSubmitting] = useState(false); const [vehicleForm, setVehicleForm] = useState(initialVehicleForm); const [requestForm, setRequestForm] = useState(initialCarrierRequestForm); const [documents, setDocuments] = useState<DocumentFormData[]>([]); // const [documents, setDocuments] = useState<{ type: string; file: File }[]>( // [] // ); const { userState } = useUser(); const router = useRouter(); useEffect(() => { fetchVehicles(); fetchCarrierRequests(); }, []); const fetchVehicles = async () => { try { setIsLoading(true); const response = await api.getVehicles(); setVehicles(response); console.log(response, 'res'); } catch (error) { toast.error('Ошибка при загрузке транспорта'); console.error('Fetch vehicles error:', error); } finally { setIsLoading(false); } }; const fetchCarrierRequests = async () => { try { const response = await api.get('/cargo/carrier-requests/'); setCarrierRequests(response); console.log(response, 'res'); } catch (error) { toast.error('Ошибка при загрузке заявок'); console.error('Fetch carrier requests error:', error); } }; const handleVehicleSubmit = async () => { try { setIsSubmitting(true); if (selectedVehicle) { // Check required documents const requiredDocs = documentTypes.filter((dt) => dt.required); const missingDocs = requiredDocs.filter( (dt) => !documents.some((d) => d.type === dt.value) ); if (missingDocs.length > 0) { toast.error( `Необходимо загрузить следующие документы: ${missingDocs .map((d) => d.label) .join(', ')}` ); return; } const vehicleResponse = await api.updateVehicle( vehicleForm.id, vehicleForm ); console.log(vehicleResponse, 'vehres'); const vehicleId = vehicleResponse?.id; console.log(vehicleResponse, 'vehres'); console.log(vehicleId, 'id'); // Upload documents const documentsUploaded = await handleDocumentUpload( vehicleForm.id, documents ); if (!documentsUploaded) { throw new Error('Failed to upload documents'); } // Upload documents // for (const doc of documents) { // const formData = new FormData(); // formData.append('file', doc.file); // formData.append('type', doc.type); // formData.append('vehicle', vehicleId); // const documents = await api.post( // `/vehicles/${vehicleForm.id}/documents/`, // formData // ); // console.log(documents, 'documents'); // } } else { const vehicleResponse = await api.createVehicle(vehicleForm); // Create vehicle console.log(vehicleResponse, 'vehres'); // const vehicleId = vehicleResponse?.id; // console.log(vehicleResponse, 'vehres'); // console.log(vehicleId, 'id'); // Upload documents // const documentsUploaded = await handleDocumentUpload( // vehicleId, // documents // ); // if (!documentsUploaded) { // throw new Error('Failed to upload documents'); // } // // Upload documents // for (const doc of documents) { // const formData = new FormData(); // formData.append('file', doc.file); // formData.append('type', doc.type); // formData.append('vehicle', vehicleId); // const documents = await api.post( // `/vehicles/${vehicleId}/documents/`, // formData // ); // console.log(documents, 'documents'); // } // .then((res) => console.log(res)) // .catch((err) => console.log(err, 'document errror')); } toast.success('Транспорт успешно добавлен'); setIsAddingVehicle(false); setVehicleForm(initialVehicleForm); setDocuments([]); fetchVehicles(); } catch (error) { toast.error('Ошибка при добавлении транспорта'); console.error('Add vehicle error:', error); } finally { setIsSubmitting(false); } }; const handleRequestSubmit = async () => { try { setIsSubmitting(true); await api.post('/cargo/carrier-requests/', requestForm); toast.success('Заявка успешно создана'); setIsAddingRequest(false); setRequestForm(initialCarrierRequestForm); fetchCarrierRequests(); } catch (error) { toast.error('Ошибка при создании заявки'); console.error('Add request error:', error); } finally { setIsSubmitting(false); } }; // Update document upload handler const handleDocumentUpload = async ( vehicleId: string, documents: DocumentFormData[] ) => { try { for (const doc of documents) { await api.addVehicleDocument(vehicleId, { file: doc.file, type: doc.type, title: doc.title, expiry_date: doc.expiry_date, }); } return true; } catch (error) { console.error('Upload documents error:', error); return false; } }; // const handleDocumentUpload = (file: File, type: string) => { // setDocuments((prev) => [...prev, { file, type }]); // }; const handleVehicleInputChange = (name: string, value: any) => { setVehicleForm((prev) => { const updated = { ...prev, [name]: value }; // Calculate volume if dimensions are provided if (['length', 'width', 'height'].includes(name)) { if (updated.length && updated.width && updated.height) { updated.volume = updated.length * updated.width * updated.height; } } return updated; }); }; const handleRequestInputChange = (name: string, value: any) => { setRequestForm((prev) => ({ ...prev, [name]: value, })); }; const renderVehicleForm = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'>Гос. номер*</label> <Input value={vehicleForm.registration_number} onChange={(e) => handleVehicleInputChange('registration_number', e.target.value) } placeholder='Введите гос. номер' /> </div> <div> <label className='block text-sm font-medium mb-2'> Страна регистрации* </label> <Select value={vehicleForm.registration_country} onValueChange={(value) => handleVehicleInputChange('registration_country', value) } > <SelectTrigger> <SelectValue placeholder='Выберите страну' /> </SelectTrigger> <SelectContent> {countries.map((country) => ( <SelectItem key={country.value} value={country.value}> {country.label} </SelectItem> ))} </SelectContent> </Select> </div> <div> <label className='block text-sm font-medium mb-2'>Тип кузова*</label> <Select value={vehicleForm.body_type} onValueChange={(value) => handleVehicleInputChange('body_type', value) } > <SelectTrigger> <SelectValue placeholder='Выберите тип кузова' /> </SelectTrigger> <SelectContent> {bodyTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} </SelectItem> ))} </SelectContent> </Select> </div> <div> <label className='block text-sm font-medium mb-2'>Тип погрузки*</label> <Select value={vehicleForm.loading_type} onValueChange={(value) => handleVehicleInputChange('loading_type', value) } > <SelectTrigger> <SelectValue placeholder='Выберите тип погрузки' /> </SelectTrigger> <SelectContent> {loadingTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} </SelectItem> ))} </SelectContent> </Select> </div> <div className='grid grid-cols-2 gap-4'> <div> <label className='block text-sm font-medium mb-2'> Грузоподъемность (тонн)* </label> <Input type='number' value={vehicleForm.capacity || ''} onChange={(e) => handleVehicleInputChange('capacity', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Объем (м³)</label> <Input type='number' value={vehicleForm.volume || ''} onChange={(e) => handleVehicleInputChange('volume', parseFloat(e.target.value)) } /> </div> </div> <div className='grid grid-cols-3 gap-4'> <div> <label className='block text-sm font-medium mb-2'>Длина (м)</label> <Input type='number' value={vehicleForm.length || ''} onChange={(e) => handleVehicleInputChange('length', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Ширина (м)</label> <Input type='number' value={vehicleForm.width || ''} onChange={(e) => handleVehicleInputChange('width', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Высота (м)</label> <Input type='number' value={vehicleForm.height || ''} onChange={(e) => handleVehicleInputChange('height', parseFloat(e.target.value)) } /> </div> </div> <div className='grid grid-cols-3 gap-4'> <div className='flex items-center'> <Checkbox id='adr' checked={vehicleForm.adr} onCheckedChange={(checked) => handleVehicleInputChange('adr', checked) } /> <label htmlFor='adr' className='ml-2'> ADR </label> </div> <div className='flex items-center'> <Checkbox id='dozvol' checked={vehicleForm.dozvol} onCheckedChange={(checked) => handleVehicleInputChange('dozvol', checked) } /> <label htmlFor='dozvol' className='ml-2'> DOZVOL </label> </div> <div className='flex items-center'> <Checkbox id='tir' checked={vehicleForm.tir} onCheckedChange={(checked) => handleVehicleInputChange('tir', checked) } /> <label htmlFor='tir' className='ml-2'> TIR </label> </div> </div> {selectedVehicle ? ( <div> <label className='block text-sm font-medium mb-2'>Документы</label> {documentTypes.map((docType) => ( <div key={docType.value} className='border rounded-lg p-4 space-y-4' > <div className='flex items-center justify-between'> <span className='font-medium'> {docType.label} {docType.required && ( <span className='text-red-500 ml-1'>*</span> )} </span> </div> <Input type='text' placeholder='Название документа' className='mb-2' onChange={(e) => { const existingDoc = documents.find( (d) => d.type === docType.value ); if (existingDoc) { setDocuments((docs) => docs.map((d) => d.type === docType.value ? { ...d, title: e.target.value } : d ) ); } }} /> <div className='grid grid-cols-2 gap-4'> <Input type='date' placeholder='Срок действия' onChange={(e) => { const existingDoc = documents.find( (d) => d.type === docType.value ); if (existingDoc) { setDocuments((docs) => docs.map((d) => d.type === docType.value ? { ...d, expiry_date: e.target.value } : d ) ); } }} /> <FileUpload onUpload={(file: any) => { const existingDocIndex = documents.findIndex( (d) => d.type === docType.value ); const newDoc: DocumentFormData = { file, type: docType.value, title: `${docType.label} - ${file.name}`, }; if (existingDocIndex !== -1) { setDocuments((docs) => docs.map((d, i) => i === existingDocIndex ? newDoc : d ) ); } else { setDocuments((docs) => [...docs, newDoc]); } }} // allowedTypes={['image/jpeg', 'image/png', 'application/pdf']} maxSize={5 * 1024 * 1024} label={`Загрузить ${docType.label}`} /> </div> </div> ))} </div> ) : ( // </div> <p>u will add the documents later</p> )} </div> ); const renderCarrierRequestForm = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'> Пункт погрузки* </label> <Input placeholder='Откуда' value={requestForm.loading_point} onChange={(e) => handleRequestInputChange('loading_point', e.target.value) } /> </div> <div> <label className='block text-sm font-medium mb-2'> Пункт выгрузки* </label> <Input placeholder='Куда' value={requestForm.unloading_point} onChange={(e) => handleRequestInputChange('unloading_point', e.target.value) } /> </div> <div> <label className='block text-sm font-medium mb-2'> Дата готовности* </label> <Input type='date' value={requestForm.ready_date} onChange={(e) => handleRequestInputChange('ready_date', e.target.value) } min={new Date().toISOString().split('T')[0]} /> </div> <div> <label className='block text-sm font-medium mb-2'>Транспорт*</label> <Select value={requestForm.vehicle} onValueChange={(value) => handleRequestInputChange('vehicle', value)} > <SelectTrigger> <SelectValue placeholder='Выберите транспорт' /> </SelectTrigger> <SelectContent> {vehicles?.results?.map((vehicle: any) => ( <SelectItem key={vehicle.id} value={vehicle.id}> {vehicle.registration_number} -{' '} {bodyTypes.find((t) => t.value === vehicle.body_type)?.label} </SelectItem> ))} </SelectContent> </Select> </div> <div className='grid grid-cols-2 gap-4'> <div> <label className='block text-sm font-medium mb-2'> Количество машин </label> <Input type='number' min={1} value={requestForm.vehicle_count} onChange={(e) => handleRequestInputChange( 'vehicle_count', parseInt(e.target.value) ) } /> </div> <div> <label className='block text-sm font-medium mb-2'> Ожидаемая цена </label> <Input type='number' placeholder='Цена' value={requestForm.price_expectation || ''} onChange={(e) => handleRequestInputChange( 'price_expectation', parseFloat(e.target.value) ) } /> </div> </div> <div> <label className='block text-sm font-medium mb-2'>Условия оплаты</label> <Select value={requestForm.payment_terms || ''} onValueChange={(value) => handleRequestInputChange('payment_terms', value) } > <SelectTrigger> <SelectValue placeholder='Выберите условия оплаты' /> </SelectTrigger> <SelectContent> <SelectItem value='on_loading'>При погрузке</SelectItem> <SelectItem value='on_unloading'>При выгрузке</SelectItem> <SelectItem value='after_unloading'>После выгрузки</SelectItem> <SelectItem value='delayed'>Отсрочка платежа</SelectItem> </SelectContent> </Select> </div> <div> <label className='block text-sm font-medium mb-2'>Примечания</label> <Input placeholder='Дополнительная информация' value={requestForm.notes} onChange={(e) => handleRequestInputChange('notes', e.target.value)} /> </div> </div> ); const renderVehicleCard = (vehicle: Vehicle) => { const isExpanded = expandedVehicle === vehicle.id; // console.log(vehicle, 'vehicelrender'); return ( <Card key={vehicle.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-4'> <div> <h3 className='font-bold text-lg'> {vehicle.registration_number} </h3> <p className='text-sm text-gray-600'> {bodyTypes.find((t) => t.value === vehicle.body_type)?.label} </p> </div> <div className='flex space-x-2'> {vehicle.adr && <Badge>ADR</Badge>} {vehicle.dozvol && <Badge>DOZVOL</Badge>} {vehicle.tir && <Badge>TIR</Badge>} <Badge variant={vehicle.is_verified ? 'default' : 'secondary'}> {/* <Badge variant={vehicle.is_verified ? 'success' : 'secondary'}> */} {vehicle.is_verified ? 'Проверен' : 'На проверке'} </Badge> </div> </div> <div className='space-y-2 text-sm'> <p> {vehicle.capacity} т / {vehicle.volume} м³ </p> <p> Габариты: {vehicle.length}x{vehicle.width}x{vehicle.height} м </p> </div> {isExpanded && ( <div className='mt-4 space-y-4'> <div className='grid grid-cols-1 md:grid-cols-2 gap-4'> {vehicle?.documents?.map((doc) => ( <div key={doc.id} className='flex items-center space-x-2'> <FileIcon className='h-4 w-4' /> <span> {documentTypes.find((t) => t.value === doc.type)?.label} </span> <Badge variant={doc.verified ? 'default' : 'secondary'}> {doc.verified ? 'Проверен' : 'На проверке'} </Badge> </div> ))} </div> <div className='space-y-2'> <p> Тип погрузки:{' '} { loadingTypes.find((t) => t.value === vehicle.loading_type) ?.label } </p> <p> Страна регистрации:{' '} { countries.find( (c) => c.value === vehicle.registration_country )?.label } </p> {vehicle.license_number && ( <p>Номер лицензии: {vehicle.license_number}</p> )} </div> </div> )} <div className='flex justify-between mt-4'> <Button variant='ghost' size='sm' onClick={() => setExpandedVehicle(isExpanded ? null : vehicle.id)} > {isExpanded ? ( <ChevronUp className='h-4 w-4 mr-1' /> ) : ( <ChevronDown className='h-4 w-4 mr-1' /> )} {isExpanded ? 'Скрыть' : 'Подробнее'} </Button> <div className='space-x-2'> <Button variant='outline' size='sm' onClick={() => { setSelectedVehicle(vehicle); setVehicleForm({ ...vehicle, id: vehicle.id || '', license_number: vehicle.license_number || '', }); setIsAddingVehicle(true); }} > <Edit2Icon className='h-4 w-4 mr-1' /> Изменить </Button> <Button variant='outline' size='sm' className='text-red-600' onClick={async () => { try { await api.delete(`/vehicles/${vehicle.id}/`); toast.success('Транспорт удален'); fetchVehicles(); } catch (error) { toast.error('Ошибка при удалении транспорта'); } }} > <Trash2Icon className='h-4 w-4 mr-1' /> Удалить </Button> </div> </div> </CardContent> </Card> ); }; const renderCarrierRequestCard = (request: CarrierRequest) => { console.log(request, 'carriererquest'); return ( <Card key={request.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-4'> <div> <h3 className='font-bold'> {request.loading_point} - {request.unloading_point} </h3> <p className='text-sm text-gray-600'> {request?.vehicle?.registration_number} -{' '} {request.vehicle.body_type} </p> </div> <Badge variant={request.status === 'pending' ? 'secondary' : 'outline'} > {request.status === 'pending' ? 'В ожидании' : 'В работе'} </Badge> </div> <div className='space-y-2 text-sm'> <p> Дата готовности:{' '} {new Date(request.ready_date).toLocaleDateString()} </p> <p>Количество машин: {request.vehicle_count}</p> {request.price_expectation && ( <p>Ожидаемая цена: {request.price_expectation} ₽</p> )} {request.payment_terms && ( <p>Условия оплаты: {request.payment_terms}</p> )} {request.notes && <p>Примечания: {request.notes}</p>} </div> <div className='flex justify-end mt-4 space-x-2'> <Button variant='outline' size='sm' onClick={async () => { try { await api.delete(`/cargo/carrier-requests/${request.id}/`); toast.success('Заявка удалена'); fetchCarrierRequests(); } catch (error) { toast.error('Ошибка при удалении заявки'); } }} > <Trash2Icon className='h-4 w-4 mr-1' /> Удалить </Button> </div> </CardContent> </Card> ); }; if (isLoading) { return ( <div className='min-h-screen bg-gray-100 flex items-center justify-center'> <Loader2 className='h-8 w-8 animate-spin text-blue-600' /> </div> ); } return ( <div className='min-h-screen bg-blue-600 p-4 pb-20'> <h1 className='text-2xl font-bold text-white text-center mb-6'> Мои машины и заявки </h1> <AssignedCargosSection /> {!isAddingVehicle && !isAddingRequest && ( <div className='flex flex-col items-center justify-center space-y-4 mt-10'> <Button className='w-64 h-12' onClick={() => setIsAddingVehicle(true)} > <Plus className='h-5 w-5 mr-2' /> Добавить машину </Button> <Button className='w-64 h-12' onClick={() => setIsAddingRequest(true)} > <Plus className='h-5 w-5 mr-2' /> Добавить заявку </Button> </div> )} {isAddingVehicle && ( <Card className='mb-8 shadow-lg'> <CardContent className='p-6'> <h2 className='text-xl font-semibold mb-4'> {selectedVehicle ? 'Редактировать машину' : 'Добавить машину'} </h2> {renderVehicleForm()} <div className='flex justify-end space-x-4 mt-6'> <Button variant='outline' onClick={() => { setIsAddingVehicle(false); setSelectedVehicle(null); setVehicleForm(initialVehicleForm); }} > Отмена </Button> <Button onClick={handleVehicleSubmit} disabled={isSubmitting}> {isSubmitting ? ( <> <Loader2 className='h-4 w-4 mr-2 animate-spin' /> Сохранение... </> ) : ( 'Сохранить' )} </Button> </div> </CardContent> </Card> )} {isAddingRequest && ( <Card className='mb-8 shadow-lg'> <CardContent className='p-6'> <h2 className='text-xl font-semibold mb-4'>Добавить заявку</h2> {renderCarrierRequestForm()} <div className='flex justify-end space-x-4 mt-6'> <Button variant='outline' onClick={() => { setIsAddingRequest(false); setRequestForm(initialCarrierRequestForm); }} > Отмена </Button> <Button onClick={handleRequestSubmit} disabled={isSubmitting}> {isSubmitting ? ( <> <Loader2 className='h-4 w-4 mr-2 animate-spin' /> Создание... </> ) : ( 'Создать' )} </Button> </div> </CardContent> </Card> )} {vehicles?.results?.length > 0 && ( <div className='mb-8'> <h2 className='text-xl font-semibold text-white mb-4'>Мои машины</h2> {vehicles?.results?.map(renderVehicleCard)} </div> )} {carrierRequests?.results?.length > 0 && ( <div className='mb-20'> <h2 className='text-xl font-semibold text-white mb-4'>Мои заявки</h2> {carrierRequests?.results?.map(renderCarrierRequestCard)} </div> )} <NavigationMenu userRole='carrier' /> </div> ); }
```

# app\notifications\page.tsx

```tsx
'use client'; import React, { useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Bell, CheckCircle, Trash2, ArrowLeft } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { useApp } from '@/contexts/AppContext'; import { useNotifications } from '@/hooks/useNotifications'; import { formatDate } from '@/lib/utils'; import { motion, AnimatePresence } from 'framer-motion'; import { useUser } from '@/contexts/UserContext'; export default function NotificationsPage() { const router = useRouter(); const { notifications, notificationsCount, markNotificationAsRead, markAllNotificationsAsRead, deleteNotification, clearAllNotifications, } = useApp(); const { userState } = useUser(); const getNotificationIcon = (type: string) => { switch (type) { case 'cargo': return '📦'; case 'route': return '🚚'; default: return '🔔'; } }; return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <div className='flex items-center mb-6'> <Button variant='ghost' onClick={() => router.back()} className='mr-2'> <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-2xl font-bold'>Уведомления</h1> </div> <div className='flex justify-between items-center mb-4'> <div className='flex items-center'> <Bell className='h-5 w-5 mr-2' /> <span className='font-semibold'> Всего: {notifications.length} {notificationsCount > 0 && ( <Badge variant='secondary' className='ml-2'> Новых: {notificationsCount} </Badge> )} </span> </div> <div className='space-x-2'> <Button variant='outline' size='sm' onClick={markAllNotificationsAsRead} disabled={notificationsCount === 0} > <CheckCircle className='h-4 w-4 mr-2' /> Прочитать все </Button> <Button variant='outline' size='sm' onClick={clearAllNotifications} disabled={notifications.length === 0} > <Trash2 className='h-4 w-4 mr-2' /> Очистить все </Button> </div> </div> <AnimatePresence mode='popLayout'> {notifications.length === 0 ? ( <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }} className='text-center py-8 text-gray-500' > Нет уведомлений </motion.div> ) : ( <div className='space-y-3'> {notifications.map((notification) => ( <motion.div key={notification.id} layout initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: 20 }} transition={{ duration: 0.2 }} > <Card className={`transition-colors ${ !notification.isRead ? 'bg-blue-50' : '' }`} > <CardContent className='p-4'> <div className='flex items-start justify-between'> <div className='flex items-start space-x-3'> <div className='text-2xl'> {getNotificationIcon(notification.type)} </div> <div> <p className='font-medium'>{notification.message}</p> <p className='text-sm text-gray-500'> {formatDate(notification.createdAt)} </p> </div> </div> <div className='flex space-x-2'> {!notification.isRead && ( <Button variant='ghost' size='sm' onClick={() => markNotificationAsRead(notification.id) } > <CheckCircle className='h-4 w-4' /> </Button> )} <Button variant='ghost' size='sm' onClick={() => deleteNotification(notification.id)} > <Trash2 className='h-4 w-4' /> </Button> </div> </div> </CardContent> </Card> </motion.div> ))} </div> )} </AnimatePresence> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> {/* <NavigationMenu userRole='carrier' /> */} </div> ); }
```

# app\page.tsx

```tsx
// import Link from 'next/link'; // export default function Home() { // return ( // <div className='flex flex-col min-h-screen bg-red-700'> // <main className='flex-grow flex items-center justify-center p-4'> // <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white-500 text-white'> // <h1 className='text-3xl font-bold mb-4 text-center text-white'> // Что Умеет Бот? // </h1> // <section className='mb-8 text-center text-white'> // <p> // Logit-Smartbot - №1 Крупнейшая ассоциация логистики в Узбекистане // </p> // </section> // </div> // </main> // <footer className='p-4 fixed bottom-0 left-0 right-0'> // <Link // href='/select-lang' // className='block w-full bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' // > // START // </Link> // </footer> // </div> // ); // } 'use client'; import { useEffect, useState } from 'react'; import Link from 'next/link'; declare global { interface Window { Telegram?: { WebApp: { colorScheme: any; themeParams: any; isExpanded: any; isFullscreen: any; viewportHeight: any; viewportStableHeight: any; enableClosingConfirmation(): unknown; ready(): unknown; expand(): unknown; close(): unknown; onEvent(eventType: any, eventHandler: any): unknown; requestFullscreen(): unknown; exitFullscreen(): unknown; offEvent(eventType: any, eventHandler: any): unknown; initData: string; initDataUnsafe: { query_id: string; user: { id: number; first_name: string; last_name?: string; username?: string; language_code: string; }; auth_date: string; hash: string; }; }; }; } } export default function Home() { const [webAppData, setWebAppData] = useState<any>(null); useEffect(() => { // Check if running in Telegram WebApp environment if (window.Telegram?.WebApp) { const tg = window.Telegram.WebApp; // Get all available WebApp data const webAppInitData = { initDataRaw: tg.initData, initDataParsed: tg.initDataUnsafe, // You can add more WebApp properties here as needed colorScheme: tg.colorScheme, themeParams: tg.themeParams, isExpanded: tg.isExpanded, viewportHeight: tg.viewportHeight, viewportStableHeight: tg.viewportStableHeight, }; // setWebAppData(webAppInitData); // Enable closing confirmation if needed tg.enableClosingConfirmation(); // Ready event to Telegram tg.ready(); setWebAppData(tg); } }, []); return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white-500 text-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Что Умеет Бот? </h1> <section className='mb-8 text-center text-white'> <p> Logit-Smartbot - №1 Крупнейшая ассоциация логистики в Узбекистане </p> </section> {/* Display WebApp Data */} {/* {webAppData && ( <div className='mt-4 p-4 bg-white/10 rounded-lg'> <h2 className='text-xl font-bold mb-2'>Telegram WebApp Data:</h2> <pre className='whitespace-pre-wrap text-sm'> {JSON.stringify(webAppData, null, 2)} </pre> </div> )} */} </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0'> <Link href='/select-lang' className='block w-full bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' > START </Link> </footer> </div> ); }
```

# app\profile\page.tsx

```tsx
// app/profile/page.tsx import React from 'react'; import Layout from '../components/Layout'; import Image from 'next/image'; import Link from 'next/link'; const ProfilePage: React.FC = () => { // Dummy data const user = { id: '12345', name: 'John Doe', username: 'johndoe', role: 'Logistics Manager', verified: true, rating: 4.8, complaints: 1, recommendations: 15, experience: '5 years', position: 'Senior Logistics Coordinator', contact: { email: 'john.doe@example.com', phone: '+1 234 567 8900', }, photoUrl: '/api/placeholder/150/150', }; return ( <Layout> <div className="max-w-2xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden"> <div className="bg-primary text-white p-4"> <div className="flex items-center space-x-4"> <Image src={user.photoUrl} alt={user.name} width={80} height={80} className="rounded-full" /> <div> <h1 className="text-2xl font-bold">{user.name}</h1> <p className="text-sm">{user.username}</p> </div> </div> </div> <div className="p-4 space-y-4"> <div className="grid grid-cols-2 gap-4"> <div> <h2 className="font-semibold">User ID</h2> <p>{user.id}</p> </div> <div> <h2 className="font-semibold">Role</h2> <p>{user.role}</p> </div> <div> <h2 className="font-semibold">Verified</h2> <p>{user.verified ? 'Yes' : 'No'}</p> </div> <div> <h2 className="font-semibold">Rating</h2> <p>{user.rating}/5</p> </div> <div> <h2 className="font-semibold">Complaints</h2> <p>{user.complaints}</p> </div> <div> <h2 className="font-semibold">Recommendations</h2> <p>{user.recommendations}</p> </div> <div> <h2 className="font-semibold">Experience</h2> <p>{user.experience}</p> </div> <div> <h2 className="font-semibold">Position</h2> <p>{user.position}</p> </div> </div> <div> <h2 className="font-semibold">Contact Information</h2> <p>Email: {user.contact.email}</p> <p>Phone: {user.contact.phone}</p> </div> <div> <Link href='/menu'>Go to my profile</Link> </div> </div> </div> </Layout> ); }; export default ProfilePage;
```

# app\registration-confirm\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { motion, AnimatePresence } from 'framer-motion'; import { useRouter } from 'next/navigation'; import { Input } from '@/components/ui/input'; import { Button } from '@/components/ui/button'; import AuthService from '@/lib/auth'; import { useUser } from '@/contexts/UserContext'; const RegistrationCompletionPage: React.FC = () => { const [stage, setStage] = useState<'contact-info' | 'confirmation'>( 'contact-info' ); const { userState } = useUser(); const [phone, setPhone] = useState(''); const [whatsapp, setWhatsapp] = useState(''); const [telegram, setTelegram] = useState(''); const router = useRouter(); const handleSubmit = async (e: React.FormEvent) => { e.preventDefault(); try { // if (window.Telegram?.WebApp) { const webApp = window?.Telegram?.WebApp; // Отправляем регистрацию с полными данными const result = await AuthService.registerUser({ telegramData: webApp, userData: { type: userState.type, role: userState.role, preferred_language: userState.language, phone_number: phone, whatsapp_number: whatsapp, }, }); console.log(result, 'result'); // } // await setUserData({ // result, // // role: userState.role, // }); // await setUserRole(userState.role); // await setUserType(userState.type); // await setLanguage(userState.language); // await setUserType({ type: userState.type }) // toast.success('Регистрация успешно завершена'); // router.push('/menu'); } catch (error) { // toast.error('Ошибка при регистрации. Пожалуйста, попробуйте снова.'); console.error('Registration error:', error); } // Здесь должна быть логика отправки данных на сервер setStage('confirmation'); }; const pageVariants = { initial: { opacity: 0, x: '-100%' }, in: { opacity: 1, x: 0 }, out: { opacity: 0, x: '100%' }, }; const pageTransition = { type: 'tween', ease: 'anticipate', duration: 0.5, }; return ( <div className='min-h-screen bg-blue-600 flex items-center justify-center p-4'> <AnimatePresence mode='wait'> {stage === 'contact-info' && ( <motion.div key='contact-info' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full' > <h1 className='text-3xl font-bold mb-6 text-blue-800 text-center'> Поздравляем! </h1> <p className='mb-6 text-gray-600 text-center'> Идентификация прошла успешно. В целях улучшения взаимодействия и связи с нашими логистами, пожалуйста, предоставьте актуальные контактные данные. </p> <form onSubmit={handleSubmit} className='space-y-4'> <Input type='tel' placeholder='Мобильный телефон' value={phone} onChange={(e) => setPhone(e.target.value)} required className='w-full' /> <Input type='tel' placeholder='WhatsApp' value={whatsapp} onChange={(e) => setWhatsapp(e.target.value)} required className='w-full' /> <Input type='text' placeholder='Telegram' value={telegram} onChange={(e) => setTelegram(e.target.value)} required className='w-full' /> <Button type='submit' className='w-full bg-blue-500 hover:bg-blue-600 text-white' > Далее </Button> </form> </motion.div> )} {stage === 'confirmation' && ( <motion.div key='confirmation' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center' > <h1 className='text-3xl font-bold mb-6 text-blue-800'> Поздравляем! </h1> <p className='mb-6 text-gray-600'> Регистрация прошла успешно. Теперь вы можете полностью бесплатно пользоваться нашими услугами. </p> <p className='mb-6 text-gray-600'> Вы можете изменить все свои данные в разделе Меню - Личный кабинет. </p> <Button onClick={() => router.push('/menu')} className='w-full bg-blue-500 hover:bg-blue-600 text-white' > Перейти в личный кабинет </Button> </motion.div> )} </AnimatePresence> </div> ); }; export default RegistrationCompletionPage;
```

# app\registration\page.tsx

```tsx
'use client'; import { useState, useEffect } from 'react'; import { Input } from '@/components/ui/input'; import { Button } from '@/components/ui/button'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { useRouter } from 'next/navigation'; import { useUser } from '@/contexts/UserContext'; // import { useUser } from '@/contexts/UserContext'; import { UserState } from '@/types'; import { toast } from 'sonner'; import AuthService from '@/lib/auth'; export default function RegistrationPage() { const router = useRouter(); const { userState, setUserData, setUserRole, setUserType, setLanguage } = useUser(); const [formData, setFormData] = useState<UserState['userData']>({}); const [isLoading, setIsLoading] = useState(false); useEffect(() => { // if (!userState.role) { // router.push('/select-role'); // return; // } // Pre-fill form with Telegram data if available if (typeof window !== 'undefined' && window.Telegram?.WebApp) { const { user } = window.Telegram.WebApp.initDataUnsafe; setFormData((prev) => ({ ...prev, fullName: user.first_name + (user.last_name ? ` ${user.last_name}` : ''), telegramNumber: user.username ? `@${user.username}` : '', })); } if (userState) { console.log(userState.language, 'userstatelang'); console.log(userState.type, 'userstatetype'); console.log(userState.role, 'userstaterole'); } }, [userState.role, router]); const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => { setFormData({ ...formData, [e.target.name]: e.target.value, }); }; const handleSelectChange = (name: string, value: string) => { setFormData({ ...formData, [name]: value, }); }; const validateForm = () => { const requiredFields = getRequiredFields(); // const missingFields = requiredFields.filter((field) => !formData[field]); const missingFields = requiredFields.filter( (field) => formData && formData[field as keyof typeof formData] === undefined ); if (missingFields.length > 0) { toast.error( `Пожалуйста, заполните обязательные поля: ${missingFields.join(', ')}` ); return false; } return true; }; const getRequiredFields = () => { const commonFields = ['fullName', 'phoneNumber']; switch (userState.role) { case 'logistics-company': case 'cargo-owner': return [...commonFields, 'companyName']; case 'student': return [...commonFields, 'groupName']; //'studentId']; case 'carrier': return [...commonFields, 'licenseNumber']; default: return commonFields; } }; const handleSubmit = async (e: React.FormEvent) => { e.preventDefault(); if (!validateForm()) return; setIsLoading(true); try { // if (window.Telegram?.WebApp) { const webApp = window?.Telegram?.WebApp; // Отправляем регистрацию с полными данными const result = await AuthService.registerUser({ telegramData: webApp, userData: { type: userState.type, role: userState.role, preferred_language: userState.language, ...formData, }, }); console.log(result, 'result'); // } // await setUserData({ // result, // // role: userState.role, // }); await setUserRole(userState.role); await setUserType(userState.type); await setLanguage(userState.language); // await setUserType({ type: userState.type }) toast.success('Регистрация успешно завершена'); if (userState.role === 'carrier') { router.push('/driver-verification'); } else { router.push('/menu'); } } catch (error) { toast.error('Ошибка при регистрации. Пожалуйста, попробуйте снова.'); console.error('Registration error:', error); } finally { setIsLoading(false); } }; const clearForm = () => { setFormData({}); }; const renderExpeditorForm = () => ( <form onSubmit={handleSubmit} className='space-y-4'> <Input name='companyName' placeholder='Название компании' onChange={handleInputChange} value={formData?.companyName || ''} required /> <Input name='fullName' placeholder='ФИО' onChange={handleInputChange} value={formData?.fullName || ''} required /> <Input name='telegramNumber' placeholder='Telegram номер' onChange={handleInputChange} value={formData?.telegramNumber || ''} /> <Input name='whatsappNumber' placeholder='WhatsApp номер' onChange={handleInputChange} value={formData?.whatsappNumber || ''} /> <Input name='phoneNumber' placeholder='Мобильный номер' onChange={handleInputChange} value={formData?.phoneNumber || ''} required /> <Select name='position' onValueChange={(value) => handleSelectChange('position', value)} > <SelectTrigger> <SelectValue placeholder='Кем являетесь' /> </SelectTrigger> <SelectContent> <SelectItem value='director'>Директор</SelectItem> <SelectItem value='manager'>Руководитель</SelectItem> <SelectItem value='dispatcher'>Диспетчер</SelectItem> </SelectContent> </Select> <Input name='registrationCertificate' placeholder='Свидетельство о гос. регистрации юр. лица' onChange={handleInputChange} value={formData?.registrationCertificate || ''} /> <div className='flex justify-between mt-6'> <Button variant='destructive' onClick={clearForm} type='button'> Очистить </Button> <Button type='submit' disabled={isLoading}> {isLoading ? 'Сохранение...' : 'Сохранить'} </Button> </div> </form> ); const renderCargoOwnerForm = () => ( <form onSubmit={handleSubmit} className='space-y-4'> <Input name='fullName' placeholder='ФИО' onChange={handleInputChange} value={formData?.fullName || ''} required /> <Input name='telegramNumber' placeholder='Telegram номер' onChange={handleInputChange} value={formData?.telegramNumber || ''} /> <Input name='whatsappNumber' placeholder='WhatsApp номер' onChange={handleInputChange} value={formData?.whatsappNumber || ''} /> <Input name='phoneNumber' placeholder='Мобильный номер' onChange={handleInputChange} value={formData?.phoneNumber || ''} required /> <Select name='role' onValueChange={(value) => handleSelectChange('role', value)} > <SelectTrigger> <SelectValue placeholder='Кем являетесь' /> </SelectTrigger> <SelectContent> <SelectItem value='shipper'>Грузоотправитель</SelectItem> <SelectItem value='consignee'>Грузополучатель</SelectItem> </SelectContent> </Select> <Input name='registrationCertificate' placeholder='Свидетельство о гос. регистрации юр. лица' onChange={handleInputChange} value={formData?.registrationCertificate || ''} /> <div className='flex justify-between mt-6'> <Button variant='destructive' onClick={clearForm} type='button'> Очистить </Button> <Button type='submit' disabled={isLoading}> {isLoading ? 'Сохранение...' : 'Сохранить'} </Button> </div> </form> ); const renderStudentForm = () => ( <form onSubmit={handleSubmit} className='space-y-4'> <Input name='fullName' placeholder='ФИО' onChange={handleInputChange} value={formData?.fullName || ''} required /> <Input name='telegramNumber' placeholder='Telegram номер' onChange={handleInputChange} value={formData?.telegramNumber || ''} /> <Input name='whatsappNumber' placeholder='WhatsApp номер' onChange={handleInputChange} value={formData?.whatsappNumber || ''} /> <Input name='phoneNumber' placeholder='Мобильный номер' onChange={handleInputChange} value={formData?.phoneNumber || ''} required /> <Select name='studentStatus' onValueChange={(value) => handleSelectChange('studentStatus', value)} > <SelectTrigger> <SelectValue placeholder='Кем являетесь' /> </SelectTrigger> <SelectContent> <SelectItem value='current'>Студент Логит Скул</SelectItem> <SelectItem value='graduate'>Выпускник Логит Скул</SelectItem> </SelectContent> </Select> <Select name='city' onValueChange={(value) => handleSelectChange('city', value)} > <SelectTrigger> <SelectValue placeholder='Город обучения' /> </SelectTrigger> <SelectContent> <SelectItem value='tashkent'>Ташкент</SelectItem> <SelectItem value='samarkand'>Самарканд</SelectItem> </SelectContent> </Select> <Select name='tariff' onValueChange={(value) => handleSelectChange('tariff', value)} > <SelectTrigger> <SelectValue placeholder='Тариф обучения' /> </SelectTrigger> <SelectContent> <SelectItem value='standard'>Стандарт Про</SelectItem> <SelectItem value='vip'>ВИП Про</SelectItem> </SelectContent> </Select> <Input name='groupName' placeholder='Название группы' onChange={handleInputChange} value={formData?.groupName || ''} required /> <Select name='studyLanguage' onValueChange={(value) => handleSelectChange('studyLanguage', value)} > <SelectTrigger> <SelectValue placeholder='Язык обучения' /> </SelectTrigger> <SelectContent> <SelectItem value='russian'>Русский</SelectItem> <SelectItem value='uzbek'>Узбекский</SelectItem> </SelectContent> </Select> <Input name='curatorName' placeholder='Имя куратора' onChange={handleInputChange} value={formData?.curatorName || ''} /> <Input name='endDate' type='date' placeholder='Дата окончания обучения' onChange={handleInputChange} value={formData?.endDate || ''} /> <div className='flex justify-between mt-6'> <Button variant='destructive' onClick={clearForm} type='button'> Очистить </Button> <Button type='submit' disabled={isLoading}> {isLoading ? 'Сохранение...' : 'Сохранить'} </Button> </div> </form> ); // Show only the relevant form based on user role console.log(userState.role, 'userstate'); const renderForm = () => { switch (userState.role) { case 'logistics-company': return renderExpeditorForm(); case 'cargo-owner': return renderCargoOwnerForm(); case 'student': return renderStudentForm(); default: return null; } }; return ( <div className='min-h-screen bg-blue-900 p-4'> <h1 className='text-3xl font-bold text-white text-center mb-6'> Пройти регистрацию </h1> <div className='bg-white rounded-lg p-6 max-w-md mx-auto'> {renderForm()} </div> </div> ); }
```

# app\requests\page.tsx

```tsx
'use client'; import { useState } from 'react'; import { Button } from '@/components/ui/button'; import NavigationMenu from '../components/NavigationMenu'; interface RequestType { title: string; count: number; color: string; } export default function RequestsPage() { const [requestTypes, setRequestTypes] = useState<RequestType[]>([ { title: 'Заявки от грузовладельцев', count: 15, color: 'bg-green-500' }, { title: 'Заявки от экс. компаний', count: 8, color: 'bg-yellow-500' }, { title: 'Заявки от перевозчиков', count: 12, color: 'bg-red-500' }, ]); return ( <div className='min-h-screen bg-blue-900 p-4 pb-20'> <h1 className='text-3xl font-bold text-white text-center mb-6'>Заявки</h1> <div className='grid grid-cols-1 md:grid-cols-3 gap-4 mb-20'> {requestTypes.map((type, index) => ( <div key={index} className='bg-white rounded-lg p-4 shadow-lg'> <div className='flex justify-between items-center mb-2'> <h2 className='text-lg font-semibold'>{type.title}</h2> <span className={`${type.color} text-white rounded-full w-8 h-8 flex items-center justify-center`} > {type.count} </span> </div> <Button className='w-full mt-2' variant='outline'> Просмотреть </Button> </div> ))} </div> <NavigationMenu userRole='other' /> </div> ); }
```

# app\reviews\page.tsx

```tsx
'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, } from '@/components/ui/dialog'; import { Avatar } from '@/components/ui/avatar'; import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'; import { Textarea } from '@/components/ui/textarea'; import { ScrollArea } from '@/components/ui/scroll-area'; import { ArrowLeft, Star, UserPlus, CheckCircle, AlertCircle, Eye, Loader2, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useUser } from '@/contexts/UserContext'; import { useRouter } from 'next/navigation'; import { api } from '@/lib/api'; import { toast } from 'sonner'; interface Rating { id: string; from_user: { telegram_id: string; username?: string; full_name: string; company_name?: string; role: string; }; to_user: { telegram_id: string; username?: string; full_name: string; company_name?: string; role: string; }; score: number; comment?: string; created_at: string; } interface User { telegram_id: string; full_name: string; username?: string; company_name?: string; role?: string; rating?: number; } interface CompletedCargo { id: string; title: string; status: string; loading_point: string; unloading_point: string; completed_at?: string; assigned_to?: User; owner?: User; managed_by?: User; } export default function ReviewsPage() { const [activeTab, setActiveTab] = useState('received'); const [receivedRatings, setReceivedRatings] = useState<Rating[]>([]); const [givenRatings, setGivenRatings] = useState<Rating[]>([]); const [pendingRatings, setPendingRatings] = useState<CompletedCargo[]>([]); const [isLoading, setIsLoading] = useState(true); const [isSubmitting, setIsSubmitting] = useState(false); const [showRatingDialog, setShowRatingDialog] = useState(false); const [selectedUser, setSelectedUser] = useState<User | null>(null); const [selectedCargo, setSelectedCargo] = useState<CompletedCargo | null>( null ); const [ratingScore, setRatingScore] = useState<number>(5); const [ratingComment, setRatingComment] = useState(''); const [userAverageRating, setUserAverageRating] = useState<number | null>( null ); const { userState } = useUser(); const router = useRouter(); useEffect(() => { fetchRatings(); }, []); const tgid = typeof window !== 'undefined' ? localStorage.getItem('telegram_id') : ''; const fetchRatings = async () => { try { setIsLoading(true); // Fetch ratings received by current user const received = await api.get('/core/ratings/', { params: { received: true }, }); const receivedr = received.results.filter( (r: any) => r.from_user.telegram_id !== tgid ); setReceivedRatings(receivedr || []); console.log(receivedr, 'rece'); // Fetch ratings given by current user const given = await api.get('/core/ratings/', { params: { given: true }, }); const givvenr = given.results.filter( (r: any) => r.to_user.telegram_id !== tgid ); console.log(givvenr, 'given'); setGivenRatings(givvenr || []); // Fetch completed cargos that need rating const pendingResponse = await api.get('/cargo/cargos/', { params: { status: 'completed', needs_rating: true }, }); const pendingrating = pendingResponse.results.filter( (r: any) => r.status === 'completed' && !givenRatings.some((gr: any) => gr.id === r.id) ); console.log(pendingrating, 'rrrrr'); console.log(pendingResponse, 'pending'); setPendingRatings(pendingrating || []); // Fetch user's average rating const userProfile = await api.getCurrentUser(); if (userProfile && userProfile.rating) { setUserAverageRating(userProfile.rating); } } catch (error) { console.error('Error fetching ratings:', error); toast.error('Не удалось загрузить отзывы'); } finally { setIsLoading(false); } }; const handleRateUser = (cargo: CompletedCargo) => { // Determine who to rate based on user role let userToRate = null; if (userState.role === 'carrier') { userToRate = cargo.owner; } else if (userState.role === 'cargo-owner') { userToRate = cargo.assigned_to; } else if (userState.role === 'student') { // Students might rate carriers or cargo owners // For simplicity, let's assume they rate the assigned carrier userToRate = cargo.assigned_to; } else if (userState.role === 'logistics-company') { userToRate = cargo.assigned_to; } if (!userToRate) { toast.error('Не удалось определить пользователя для оценки'); return; } setSelectedUser(userToRate); setSelectedCargo(cargo); setShowRatingDialog(true); }; const handleSubmitRating = async () => { if (!selectedUser || !selectedCargo) return; try { setIsSubmitting(true); await api.post('/core/ratings/', { to_user: selectedUser.telegram_id, score: ratingScore, comment: ratingComment, cargo_id: selectedCargo.id, }); toast.success('Отзыв успешно отправлен'); setShowRatingDialog(false); setRatingScore(5); setRatingComment(''); // Refresh ratings fetchRatings(); } catch (error) { console.error('Error submitting rating:', error); toast.error('Не удалось отправить отзыв'); } finally { setIsSubmitting(false); } }; const renderStars = (rating: number, onSelect?: (score: number) => void) => { return ( <div className='flex items-center'> {[1, 2, 3, 4, 5].map((star) => ( <Star key={star} className={`h-6 w-6 ${ star <= rating ? 'text-yellow-400 fill-current' : 'text-gray-300' } ${onSelect ? 'cursor-pointer' : ''}`} onClick={() => onSelect && onSelect(star)} /> ))} </div> ); }; const renderRatingCard = (rating: Rating, isReceived: boolean = true) => ( <Card key={rating.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-4'> <div className='flex items-center'> <Avatar className='h-10 w-10 mr-4'> <div className='flex h-full w-full items-center justify-center bg-primary text-white'> {isReceived ? rating.from_user.full_name.charAt(0) : rating.to_user.full_name.charAt(0)} </div> </Avatar> <div> <h3 className='font-semibold'> {isReceived ? rating.from_user.full_name : rating.to_user.full_name} </h3> <p className='text-sm text-gray-600'> {isReceived ? rating.from_user.role : rating.to_user.role} </p> </div> </div> <div className='flex flex-col items-end'> <div className='flex items-center'> <span className='font-bold mr-2'>{rating.score}</span> {renderStars(rating.score)} </div> <span className='text-sm text-gray-500'> {new Date(rating.created_at).toLocaleDateString()} </span> </div> </div> {rating.comment && ( <div className='bg-gray-50 p-3 rounded-lg'> <p className='text-gray-800'>{rating.comment}</p> </div> )} </CardContent> </Card> ); const renderPendingRatingCard = (cargo: CompletedCargo) => { const userToRate = userState.role === 'carrier' ? cargo.owner : cargo.assigned_to; return ( <Card key={cargo.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-4'> <div className='flex items-center'> <Avatar className='h-10 w-10 mr-4'> <div className='flex h-full w-full items-center justify-center bg-primary text-white'> {userToRate?.full_name.charAt(0)} </div> </Avatar> <div> <h3 className='font-semibold'>{userToRate?.full_name}</h3> <p className='text-sm text-gray-600'>{userToRate?.role}</p> </div> </div> <div className='flex flex-col items-end'> <div className='flex items-center'> <span className='font-bold mr-2'>{userToRate?.rating}</span> {renderStars(Number(userToRate?.rating))} </div> </div> </div> <div className='flex justify-end mt-4'> <Button onClick={() => handleRateUser(cargo)}> <Star className='h-4 w-4 mr-2' /> Оставить отзыв </Button> </div> </CardContent> {/* <CardContent className='p-4'> <div className='flex justify-between items-start mb-2'> <div> <h3 className='font-semibold'>{cargo.title}</h3> <p className='text-sm text-gray-600'> {cargo.loading_point} → {cargo.unloading_point} </p> {userToRate && ( <p className='text-sm mt-1'> <span className='text-gray-600'>Пользователь: </span> <span className='font-medium'>{userToRate.full_name}</span> </p> )} </div> <span className='text-sm text-gray-500'> {cargo.completed_at ? new Date(cargo.completed_at).toLocaleDateString() : 'Завершен'} </span> </div> <div className='flex justify-end mt-4'> <Button onClick={() => handleRateUser(cargo)}> <Star className='h-4 w-4 mr-2' /> Оставить отзыв </Button> </div> </CardContent> */} </Card> ); }; if (isLoading) { return ( <div className='min-h-screen bg-gray-50 flex items-center justify-center'> <Loader2 className='h-8 w-8 animate-spin text-primary' /> </div> ); } return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <div className='max-w-4xl mx-auto'> <div className='flex items-center mb-6'> <Button variant='ghost' onClick={() => router.back()} className='mr-2' > <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-2xl font-bold'>Отзывы и рейтинг</h1> </div> {userAverageRating !== null && ( <Card className='mb-6'> <CardContent className='p-4 flex flex-col items-center'> <h2 className='text-lg font-semibold mb-2'>Ваш рейтинг</h2> <div className='flex items-center'> <span className='text-3xl font-bold mr-3'> {Number(userAverageRating).toFixed(1)} </span> {renderStars(userAverageRating)} </div> <p className='text-sm text-gray-600 mt-2'> На основе {receivedRatings?.length} отзывов </p> </CardContent> </Card> )} <Tabs defaultValue={activeTab} onValueChange={setActiveTab} className='mb-6' > <TabsList className='grid w-full grid-cols-3'> <TabsTrigger value='received'> Полученные{' '} {receivedRatings.length > 0 && `(${receivedRatings.length})`} </TabsTrigger> <TabsTrigger value='given'> Оставленные{' '} {givenRatings.length > 0 && `(${givenRatings.length})`} </TabsTrigger> <TabsTrigger value='pending'> Можете оставить {pendingRatings.length > 0 && `(${pendingRatings.length})`} </TabsTrigger> </TabsList> <TabsContent value='received' className='mt-4'> <ScrollArea className='h-[calc(100vh-350px)]'> {receivedRatings.length > 0 ? ( receivedRatings.map((rating) => renderRatingCard(rating, true)) ) : ( <div className='text-center py-8 text-gray-500'> У вас пока нет полученных отзывов </div> )} </ScrollArea> </TabsContent> <TabsContent value='given' className='mt-4'> <ScrollArea className='h-[calc(100vh-350px)]'> {givenRatings.length > 0 ? ( givenRatings.map((rating) => renderRatingCard(rating, false)) ) : ( <div className='text-center py-8 text-gray-500'> Вы пока не оставили ни одного отзыва </div> )} </ScrollArea> </TabsContent> <TabsContent value='pending' className='mt-4'> <ScrollArea className='h-[calc(100vh-350px)]'> {pendingRatings.length > 0 ? ( pendingRatings.map((cargo) => renderPendingRatingCard(cargo)) ) : ( <div className='text-center py-8 text-gray-500'> Нет заявок, требующих отзыва </div> )} </ScrollArea> </TabsContent> </Tabs> </div> {/* Rating Dialog */} <Dialog open={showRatingDialog} onOpenChange={setShowRatingDialog}> <DialogContent> <DialogHeader> <DialogTitle>Оставить отзыв</DialogTitle> </DialogHeader> <div className='py-4'> {selectedUser && ( <div className='flex items-center mb-4'> <Avatar className='h-12 w-12 mr-4'> <div className='flex h-full w-full items-center justify-center bg-primary text-white'> {selectedUser.full_name.charAt(0)} </div> </Avatar> <div> <h3 className='font-semibold'>{selectedUser.full_name}</h3> <p className='text-sm text-gray-600'>{selectedUser.role}</p> </div> </div> )} {selectedCargo && ( <div className='mb-4 p-3 bg-gray-50 rounded-lg'> <p className='font-medium'>{selectedCargo.title}</p> <p className='text-sm text-gray-600'> {selectedCargo.loading_point} →{' '} {selectedCargo.unloading_point} </p> </div> )} <div className='mb-4'> <label className='block text-sm font-medium mb-2'>Оценка</label> <div className='flex justify-center mb-2'> {renderStars(ratingScore, setRatingScore)} </div> </div> <div className='mb-4'> <label className='block text-sm font-medium mb-2'> Комментарий </label> <Textarea placeholder='Напишите ваш отзыв о сотрудничестве...' value={ratingComment} onChange={(e) => setRatingComment(e.target.value)} rows={4} /> </div> </div> <DialogFooter> <Button variant='outline' onClick={() => setShowRatingDialog(false)} > Отмена </Button> <Button onClick={handleSubmitRating} disabled={isSubmitting}> {isSubmitting ? ( <> <Loader2 className='h-4 w-4 mr-2 animate-spin' /> Отправка... </> ) : ( 'Отправить отзыв' )} </Button> </DialogFooter> </DialogContent> </Dialog> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); }
```

# app\search\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Card, CardContent } from '@/components/ui/card'; import { Avatar } from '@/components/ui/avatar'; import { Search, ArrowLeft } from 'lucide-react'; import { useRouter } from 'next/navigation'; interface SearchResult { id: string; name: string; type: 'participant' | 'firm'; details: string; avatar?: string; } const mockSearchResults: SearchResult[] = [ { id: '1', name: 'Иван Иванов', type: 'participant', details: 'Логист, Москва', avatar: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRIRFWZntgIF7DtKKfdha91qSbJdq65mzTUNQNx2hG2Jc2PpLmjRszXG0DoUoWg6eyq2A&usqp=CAU', }, { id: '2', name: 'ООО "Логистика+"', type: 'firm', details: 'Транспортная компания, Санкт-Петербург', }, { id: '3', name: 'Анна Петрова', type: 'participant', details: 'Менеджер, Казань', avatar: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRIRFWZntgIF7DtKKfdha91qSbJdq65mzTUNQNx2hG2Jc2PpLmjRszXG0DoUoWg6eyq2A&usqp=CAU', }, { id: '4', name: 'ИП Сидоров', type: 'firm', details: 'Грузоперевозки, Новосибирск', }, ]; export default function SearchParticipantsAndFirms() { const [searchTerm, setSearchTerm] = useState<string>(''); const [searchResults, setSearchResults] = useState<SearchResult[]>([]); const [isSearching, setIsSearching] = useState<boolean>(false); const router = useRouter(); const handleSearch = () => { setIsSearching(true); const results = mockSearchResults.filter( (result) => result.name.toLowerCase().includes(searchTerm.toLowerCase()) || result.details.toLowerCase().includes(searchTerm.toLowerCase()) ); setSearchResults(results); }; const renderSearchResults = () => ( <div className='mt-4 space-y-4'> {searchResults.map((result) => ( <Card key={result.id}> <CardContent className='flex items-center p-4'> {result.type === 'participant' && result.avatar && ( <Avatar className='h-10 w-10 mr-4'> <img src={result.avatar} alt={result.name} /> </Avatar> )} {result.type === 'firm' && ( <div className='h-10 w-10 mr-4 bg-blue-100 rounded-full flex items-center justify-center'> <span className='text-blue-600 font-bold'> {result.name[0]} </span> </div> )} <div> <h3 className='font-semibold'>{result.name}</h3> <p className='text-sm text-gray-600'>{result.details}</p> </div> </CardContent> </Card> ))} </div> ); return ( <div className='min-h-screen bg-gray-50 p-4'> <div className='flex items-center mb-6'> <Button variant='ghost' onClick={() => { router.push('/menu'); }} className='mr-2' > <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-2xl font-bold'>Поиск участников и фирм</h1> </div> <div className='flex mb-4'> <Input type='text' placeholder='Поиск по коду или фамилии' value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className='mr-2' /> <Button onClick={handleSearch}> <Search className='h-4 w-4 mr-2' /> Поиск </Button> </div> {isSearching && searchResults.length === 0 && ( <p className='text-center text-gray-600 mt-4'>Ничего не найдено</p> )} {isSearching && searchResults.length > 0 && renderSearchResults()} </div> ); }
```

# app\select-lang\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { useUser } from '@/contexts/UserContext'; import { useRouter } from 'next/navigation'; import { useEffect } from 'react'; export default function LanguageSelection() { const { userState, setLanguage } = useUser(); const router = useRouter(); useEffect(() => { if (userState.isAuthenticated) { router.push('/home'); } }, [userState.isAuthenticated, router]); const handleLanguageSelect = (language: 'ru' | 'uz') => { setLanguage(language); }; return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Выберите язык </h1> <section className='mb-8 text-center text-white'> <p>Пожалуйста, выберите предпочитаемый язык</p> </section> </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0 flex justify-between'> <Link href='/select-person' onClick={() => handleLanguageSelect('ru')} className='w-[48%] bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' > ru РУ </Link> <Link href='/select-person' onClick={() => handleLanguageSelect('uz')} className='w-[48%] bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' > uz УЗ </Link> </footer> </div> ); }
```

# app\select-person\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { User, Building2 } from 'lucide-react'; import { useUser } from '@/contexts/UserContext'; import { useRouter } from 'next/navigation'; import { useEffect } from 'react'; export default function PersonTypeSelection() { const { userState, setUserType } = useUser(); const router = useRouter(); useEffect(() => { if (userState.isAuthenticated) { router.push('/home'); } }, [userState.isAuthenticated, router]); const handleTypeSelect = (type: 'individual' | 'legal') => { setUserType(type); }; return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Выберите тип лица </h1> <section className='mb-8 text-center text-white'> <p>Пожалуйста, выберите тип лица</p> </section> </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0 flex justify-between'> <Link href='/select-role?type=individual' onClick={() => handleTypeSelect('individual')} className='w-[48%] bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center' > <User className='mr-2' size={24} /> Физ. лицо </Link> <Link href='/select-role?type=legal' onClick={() => handleTypeSelect('legal')} className='w-[48%] bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center' > <Building2 className='mr-2' size={24} /> Юр. лицо </Link> </footer> </div> ); }
```

# app\select-role\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { useSearchParams, useRouter } from 'next/navigation'; import { useEffect } from 'react'; import { useUser } from '@/contexts/UserContext'; import { User, Truck, Building2, Package, Briefcase, TrendingUp, ArrowLeft, } from 'lucide-react'; import { Button } from '@/components/ui/button'; import { Card } from '@/components/ui/card'; export default function UserRoleSelection() { const searchParams = useSearchParams(); const router = useRouter(); const { userState, setUserRole } = useUser(); useEffect(() => { if (userState.isAuthenticated) { router.push('/home'); } // if (!userState.type || !userState.language) { // router.push('/select-lang'); // } console.log(userState.language, 'userstatelang') console.log(userState.type, 'userstatetype') }, [userState, router]); const handleRoleSelect = (role: string) => { setUserRole(role as any); if (role === 'student') { router.push('/student-password'); } else if (role === 'carrier') { router.push('/carrier-welcome'); } else { router.push('/start-mini'); } }; const renderIndividualButtons = () => ( <div className='grid grid-cols-2 gap-4 w-full mb-4'> <Button onClick={() => handleRoleSelect('student')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <User size={32} className='mb-2' /> <span>Студент</span> <span className='text-xs mt-1 text-blue-100'> Для учащихся Logit School </span> </Button> <Button onClick={() => handleRoleSelect('carrier')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <Truck size={32} className='mb-2' /> <span>Перевозчик</span> <span className='text-xs mt-1 text-blue-100'> Для владельцев транспорта </span> </Button> </div> ); const renderLegalButtons = () => ( <div className='grid grid-cols-2 gap-4 w-full mb-4'> <Button onClick={() => handleRoleSelect('cargo-owner')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <Package size={32} className='mb-2' /> <span>Грузовладелец</span> <span className='text-xs mt-1 text-blue-100'> Для владельцев грузов </span> </Button> <Button onClick={() => handleRoleSelect('logistics-company')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <Briefcase size={32} className='mb-2' /> <span>Экспедиторская компания</span> <span className='text-xs mt-1 text-blue-100'> Для логистических компаний </span> </Button> <Button onClick={() => handleRoleSelect('transport-company')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <Truck size={32} className='mb-2' /> <span>Транспортная компания</span> <span className='text-xs mt-1 text-blue-100'> Для транспортных компаний </span> </Button> <Button onClick={() => handleRoleSelect('logit-trans')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <TrendingUp size={32} className='mb-2' /> <span>Логит транс</span> <span className='text-xs mt-1 text-blue-100'>Для партнеров Logit</span> </Button> </div> ); const renderContent = () => { const type = searchParams.get('type'); if (type === 'individual') { return renderIndividualButtons(); } if (type === 'legal') { return renderLegalButtons(); } return null; }; return ( <div className='min-h-screen bg-red-700'> <div className='p-4'> <Button variant='ghost' className='text-white mb-4' onClick={() => router.push('/select-person')} > <ArrowLeft className='mr-2' size={24} /> Назад </Button> </div> <main className='flex-grow flex items-center justify-center p-4'> <Card className='bg-red-700 rounded-lg shadow-lg p-6 max-w-2xl w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Выберите вашу роль </h1> <section className='mb-8 text-center text-white'> <p className='mb-4'> Пожалуйста обратите внимание! Сейчас вам необходимо выбрать кем вы являетесь </p> <p>Выберите ваш статус</p> </section> {renderContent()} </Card> </main> </div> ); }
```

# app\settings\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { motion, AnimatePresence } from 'framer-motion'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { ArrowLeft, Bell, Globe, Star } from 'lucide-react'; import { useRouter } from 'next/navigation'; interface Language { code: string; name: string; flag: string; } const languages: Language[] = [ { code: 'en', name: 'English', flag: '🇬🇧' }, { code: 'uz', name: 'Ozbek', flag: '🇺🇿' }, { code: 'ru', name: 'Русский', flag: '🇷🇺' }, ]; const NotificationToggle: React.FC<{ enabled: boolean; toggle: () => void; }> = ({ enabled, toggle }) => { return ( <motion.div className='relative w-64 h-64 bg-gradient-to-br from-purple-600 to-blue-600 rounded-full cursor-pointer overflow-hidden' onClick={toggle} whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} > <motion.div className='absolute inset-0 bg-gradient-to-br from-yellow-400 to-orange-500' initial={{ scale: 0 }} animate={{ scale: enabled ? 1 : 0 }} transition={{ duration: 0.5, type: 'spring' }} /> <motion.div className='absolute inset-0 flex items-center justify-center' animate={{ rotate: enabled ? 360 : 0 }} transition={{ duration: 0.5 }} > <Bell className={`h-24 w-24 ${enabled ? 'text-white' : 'text-gray-300'}`} /> </motion.div> <AnimatePresence> {enabled && ( <motion.div className='absolute inset-0' initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} > {[...Array(12)].map((_, i) => ( <motion.div key={i} className='absolute' initial={{ x: '50%', y: '50%', scale: 0 }} animate={{ x: `${50 + 35 * Math.cos((i * 30 * Math.PI) / 180)}%`, y: `${50 + 35 * Math.sin((i * 30 * Math.PI) / 180)}%`, scale: [0, 1, 0], opacity: [0, 1, 0], }} transition={{ repeat: Infinity, duration: 2, delay: i * 0.1, }} > <Star className='h-4 w-4 text-white' /> </motion.div> ))} </motion.div> )} </AnimatePresence> </motion.div> ); }; const LanguageSelector: React.FC<{ selectedLanguage: string; setSelectedLanguage: (lang: string) => void; }> = ({ selectedLanguage, setSelectedLanguage }) => { const [showLanguages, setShowLanguages] = useState(false); return ( <div className='mt-6 relative'> <Button variant='outline' onClick={() => setShowLanguages(!showLanguages)} className='w-full justify-between' > <span> {languages.find((lang) => lang.code === selectedLanguage)?.name} </span> <Globe className='h-5 w-5' /> </Button> <AnimatePresence> {showLanguages && ( <motion.div initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -10 }} className='absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-xl overflow-hidden z-10' > {languages.map((lang) => ( <Button key={lang.code} variant='ghost' className='w-full justify-start' onClick={() => { setSelectedLanguage(lang.code); setShowLanguages(false); }} > <span className='mr-2'>{lang.flag}</span> {lang.name} </Button> ))} </motion.div> )} </AnimatePresence> </div> ); }; export default function AppSettingsPage() { const [notificationsEnabled, setNotificationsEnabled] = useState<boolean>(false); const [selectedLanguage, setSelectedLanguage] = useState<string>('ru'); const router = useRouter(); return ( <div className='min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 p-6 text-white'> <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className='flex items-center mb-8' > <Button variant='ghost' className='mr-4 text-white' onClick={() => { router.push('/menu'); }} > <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-3xl font-bold'>Настройки</h1> </motion.div> <Card className='bg-gray-800 border-gray-700'> <CardContent className='p-6'> <h2 className='text-xl font-semibold mb-4 text-center'> Уведомления </h2> <div className='flex justify-center mb-4'> <NotificationToggle enabled={notificationsEnabled} toggle={() => setNotificationsEnabled(!notificationsEnabled)} /> </div> <p className='text-center text-lg'> {notificationsEnabled ? 'Уведомления включены' : 'Уведомления выключены'} </p> <LanguageSelector selectedLanguage={selectedLanguage} setSelectedLanguage={setSelectedLanguage} /> </CardContent> </Card> </div> ); }
```

# app\start-mini\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { ArrowRight } from 'lucide-react'; export default function StartMiniWebsite() { return ( <div className="flex flex-col min-h-screen bg-red-700"> <main className="flex-grow flex items-center justify-center p-4"> <div className="bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white"> <h1 className="text-3xl font-bold mb-4 text-center text-white">Уважаемые пользователи!</h1> <section className="mb-8 text-center text-white"> <p> Для удобства работы и получения всей необходимой информации, пожалуйста перейдите на наш мини-вебсайт по следующей кнопке "начать"👇. </p><br/><p> Вся работа будет осуществляться через этот вебсайт. </p> <p className="mt-4 font-semibold"> Спасибо за сотрудничество! </p> </section> </div> </main> <footer className="p-4 fixed bottom-0 left-0 right-0 flex flex-col"> <Link href="/registration" className="w-full bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center" > Начать <ArrowRight className="ml-2" size={24} /> </Link> </footer> </div> ); }
```

# app\student-password\page.tsx

```tsx
'use client'; import { useState } from 'react'; import { useRouter } from 'next/navigation'; import { Phone } from 'lucide-react'; export default function StudentPasswordPage() { const [password, setPassword] = useState(''); const router = useRouter(); const handleSubmit = (e: any) => { e.preventDefault(); // Здесь должна быть логика проверки пароля // Для демонстрации, просто перенаправляем на страницу старта мини-вебсайта router.push('/start-mini'); }; return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Доступ к боту </h1> <section className='mb-8 text-center text-white'> <p> Чтобы получить доступ к боту, введите пароль, который предоставлен вашим куратором, или обратитесь к администратору бота. </p> </section> <form onSubmit={handleSubmit} className='mt-4'> <input type='number' value={password} onChange={(e) => setPassword(e.target.value)} className='w-full px-4 py-2 rounded-lg bg-white text-black text-center text-2xl tracking-widest' placeholder='Введите пароль' required /> <button type='submit' className='w-full mt-4 bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' > Подтвердить </button> </form> </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0'> <button onClick={() => alert('Вызов администратора')} className='w-full bg-green-500 hover:bg-green-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center' > <Phone className='mr-2' size={24} /> Вызвать администратора </button> </footer> </div> ); }
```

# app\student\cargos\page.tsx

```tsx
'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { ScrollArea } from '@/components/ui/scroll-area'; import { Input } from '@/components/ui/input'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Loader2, Search, Filter, ExternalLink, AlertCircle, } from 'lucide-react'; import NavigationMenu from '@/app/components/NavigationMenu'; import { useUser } from '@/contexts/UserContext'; import { api } from '@/lib/api'; import { toast } from 'sonner'; import { string } from 'three/src/nodes/TSL.js'; import Link from 'next/link'; interface CargoResponse { results: Cargo[]; } interface CarrierRequestResponse { results: CarrierRequest[]; } interface Cargo { id: string; title: string; description: string; owner: { id: string; role: string; company_name?: string; full_name: string; telegram_id: any; }; weight: number; volume?: number; loading_point: string; unloading_point: string; loading_date: string; vehicle_type: string; payment_method: string; price?: number; status: string; created_at: string; } interface CarrierRequest { id: string; carrier: { id: string; full_name: string; company_name?: string; rating: number; }; vehicle: { id: string; registration_number: string; body_type: string; }; loading_point: string; unloading_point: string; ready_date: string; status: string; } export default function StudentCargosPage() { const [iscarrier, setiscarrier] = useState(false); const [cargos, setCargos] = useState<CargoResponse>({ results: [] }); const [matchingRequests, setMatchingRequests] = useState<CarrierRequest[]>( [] ); const [allRequests, setAllRequests] = useState<CarrierRequestResponse>({ results: [], }); const [selectedCargo, setSelectedCargo] = useState<Cargo | null>(null); const [isLoading, setIsLoading] = useState(true); const [isLoadingRequests, setIsLoadingRequests] = useState(false); const [showCargoDetails, setShowCargoDetails] = useState(false); const [showMatchingRequests, setShowMatchingRequests] = useState(false); const [searchTerm, setSearchTerm] = useState(''); const [filters, setFilters] = useState({ vehicle_type: '', loading_point: '', unloading_point: '', }); const [mycargos, setmycargos] = useState<string[] | null>(null); const { userState } = useUser(); useEffect(() => { fetchCargos(); if (userState.role !== 'student') { setiscarrier(true); } }, []); const fetchCargos = async () => { try { setIsLoading(true); const response = await api.get('/cargo/cargos', { params: { status: 'pending', assigned_to: null, ...filters, search: searchTerm, }, }); setCargos(response); if (typeof window !== 'undefined') { const id = localStorage.getItem('telegram_id'); if (id && cargos) { const resalllt = await response.results.filter( (res: any) => res.owner?.telegram_id === id ); console.log(resalllt, 'resaalt'); setmycargos(resalllt.map((c: any) => c.id)); console.log(mycargos, 'mycargos'); console.log(id, 'id'); console.log(cargos, 'cargos'); console.log(response, 'res'); } } } catch (error) { toast.error('Ошибка при загрузке грузов'); console.error('Fetch cargos error:', error); } finally { setIsLoading(false); } }; const fetchCarrierRequests = async (cargoId: string) => { try { setIsLoadingRequests(true); // Get matching carriers const matchingResponse = await api.get( `/cargo/cargos/${cargoId}/matching_carriers/` ); setMatchingRequests(matchingResponse.data); console.log(matchingRequests, 'mareq'); // Get all available carriers const allResponse = await api.get('/cargo/carrier-requests/', { params: { status: 'pending', assigned_cargo: null }, }); console.log(allResponse, 'allres'); setAllRequests(allResponse); } catch (error) { toast.error('Ошибка при загрузке заявок перевозчиков'); console.error('Fetch carrier requests error:', error); } finally { setIsLoadingRequests(false); } }; const handleAssignCarrier = async (cargoId: string, requestId: string) => { try { await api.post(`/cargo/cargos/${cargoId}/assign_carrier/`, { carrier_request: requestId, }); toast.success('Груз успешно перенаправлен перевозчику'); setShowMatchingRequests(false); fetchCargos(); } catch (error) { toast.error('Ошибка при назначении перевозчика'); console.error('Assign carrier error:', error); } }; const handleCargoClick = async (cargo: Cargo) => { setSelectedCargo(cargo); setShowCargoDetails(true); await fetchCarrierRequests(cargo.id); }; const renderCargoCard = (cargo: Cargo) => ( <Card key={cargo.id} className='mb-4 hover:shadow-lg transition-shadow cursor-pointer' onClick={() => handleCargoClick(cargo)} > <CardContent className='p-4'> <div className='flex justify-between items-start mb-2'> <div> <h3 className='font-bold text-lg'>{cargo.title}</h3> {cargo?.owner && ( <p className='text-sm text-gray-600'> {cargo?.owner?.role === 'cargo-owner' ? 'Грузовладелец' : 'Экспедитор'} : {cargo?.owner?.company_name || cargo?.owner?.full_name} </p> )} </div> {mycargos?.includes(cargo.id) && <Badge>ЭТО ВАШ ГРУЗ</Badge>} <Badge>{cargo.status}</Badge> <Badge>Новый</Badge> </div> <div className='grid grid-cols-2 gap-2 mb-2 text-sm'> <p> Груз: {cargo.weight} т{cargo.volume ? `, ${cargo.volume} м³` : ''} </p> <p>Тип: {cargo.vehicle_type}</p> <p> Маршрут: {cargo.loading_point} → {cargo.unloading_point} </p> <p> Дата загрузки: {new Date(cargo.loading_date).toLocaleDateString()} </p> </div> <div className='flex justify-between items-center mt-2'> <span className='font-semibold'> {cargo.price ? `${cargo.price} ₽` : 'Цена договорная'} </span> <span className='text-sm text-gray-500'> {new Date(cargo.created_at).toLocaleString()} </span> </div> </CardContent> </Card> ); console.log(selectedCargo, 'selectedcargo'); const renderCargoDetails = () => { if (!selectedCargo) return null; return ( <Dialog open={showCargoDetails} onOpenChange={setShowCargoDetails}> <DialogContent className='max-w-3xl'> <DialogHeader> <DialogTitle>Детали груза</DialogTitle> </DialogHeader> <div className='space-y-4'> <div className='grid grid-cols-2 gap-4'> <div> <h3 className='font-semibold'>Основная информация</h3> <p>Название: {selectedCargo.title}</p> <p>Описание: {selectedCargo.description}</p> <p>Вес: {selectedCargo.weight} т</p> {selectedCargo.volume && ( <p>Объем: {selectedCargo.volume} м³</p> )} </div> <div> <h3 className='font-semibold'>Маршрут</h3> <p>Погрузка: {selectedCargo.loading_point}</p> <p>Выгрузка: {selectedCargo.unloading_point}</p> <p> Дата погрузки:{' '} {new Date(selectedCargo.loading_date).toLocaleDateString()} </p> </div> </div> <div> <h3 className='font-semibold'>Требования</h3> <p>Тип транспорта: {selectedCargo.vehicle_type}</p> <p>Способ оплаты: {selectedCargo.payment_method}</p> {selectedCargo.price && <p>Цена: {selectedCargo.price} ₽</p>} </div> {(selectedCargo.status === 'pending' || selectedCargo.status === 'manager_approved') && ( <div className='flex justify-end space-x-2 mt-4'> <Button onClick={() => setShowMatchingRequests(true)}> Найти перевозчика </Button> </div> )} </div> </DialogContent> </Dialog> ); }; const renderMatchingRequests = () => { return ( <Dialog open={showMatchingRequests} onOpenChange={setShowMatchingRequests} > <DialogContent className='max-w-4xl'> <DialogHeader> <DialogTitle>Подходящие перевозчики</DialogTitle> </DialogHeader> {isLoadingRequests ? ( <div className='flex justify-center py-8'> <Loader2 className='h-8 w-8 animate-spin' /> </div> ) : ( <div className='space-y-4'> {matchingRequests?.length > 0 && ( <div> <h3 className='font-semibold mb-2'>Подходящие заявки</h3> <div className='space-y-2'> {matchingRequests?.map((request: any) => ( <Card key={request.id}> <CardContent className='p-4'> <div className='flex justify-between items-start'> <div> <h4 className='font-semibold'> {request.carrier.company_name || request.carrier.full_name} </h4> <p className='text-sm'> {request.vehicle.registration_number} -{' '} {request.vehicle.body_type} </p> <p className='text-sm'> {request.loading_point} →{' '} {request.unloading_point} </p> </div> <Button onClick={() => selectedCargo && handleAssignCarrier( selectedCargo.id, request.id ) } > Выбрать </Button> </div> </CardContent> </Card> ))} </div> </div> )} <div> <h3 className='font-semibold mb-2'>Все доступные заявки</h3> <div className='space-y-2'> {allRequests?.results?.map((request) => ( <Card key={request.id}> <CardContent className='p-4'> <div className='flex justify-between items-start'> <div> <h4 className='font-semibold'> {request.carrier.company_name || request.carrier.full_name} </h4> <p className='text-sm'> {request.vehicle.registration_number} -{' '} {request.vehicle.body_type} </p> <p className='text-sm'> {request.loading_point} →{' '} {request.unloading_point} </p> </div> <Button variant='outline' onClick={() => selectedCargo && handleAssignCarrier( selectedCargo?.id, request?.id ) } > Выбрать </Button> </div> </CardContent> </Card> ))} </div> </div> </div> )} </DialogContent> </Dialog> ); }; if (isLoading) { return ( <div className='flex justify-center items-center min-h-screen'> <Loader2 className='h-8 w-8 animate-spin' /> </div> ); } if (iscarrier === true) { return ( <div className='min-h-screen bg-gray-100 p-4 flex items-center justify-center'> <Loader2 className='h-8 w-8 animate-spin text-blue-600' /> You don't have enough permissions to access this page <Link href={'/'}>go to home page</Link> </div> ); } return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <div className='max-w-6xl mx-auto'> <h1 className='text-2xl font-bold mb-6'>Доступные грузы</h1> <div className='mb-6 space-y-4'> <div className='flex gap-4'> <Input placeholder='Поиск грузов...' value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className='max-w-sm' /> <Button onClick={fetchCargos}> <Search className='h-4 w-4 mr-2' /> Поиск </Button> </div> <div className='flex gap-4'> <Select value={filters.vehicle_type} onValueChange={(value) => setFilters((f) => ({ ...f, vehicle_type: value })) } > <SelectTrigger className='w-[200px]'> <SelectValue placeholder='Тип транспорта' /> </SelectTrigger> <SelectContent>{/* Add vehicle types */}</SelectContent> </Select> <Button variant='outline' onClick={() => setFilters({ vehicle_type: '', loading_point: '', unloading_point: '', }) } > Сбросить фильтры </Button> </div> </div> <div className='space-y-4'> {cargos?.results?.length === 0 ? ( <div className='text-center py-8 text-gray-500'> Нет доступных грузов </div> ) : ( cargos?.results?.map(renderCargoCard) )} </div> {renderCargoDetails()} {renderMatchingRequests()} </div> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> {/* <NavigationMenu userRole={userState.role} /> */} </div> ); }
```

# components.json

```json
{ "$schema": "https://ui.shadcn.com/schema.json", "style": "default", "rsc": true, "tsx": true, "tailwind": { "config": "tailwind.config.ts", "css": "app/globals.css", "baseColor": "neutral", "cssVariables": false, "prefix": "" }, "aliases": { "components": "@/components", "utils": "@/lib/utils", "ui": "@/components/ui", "lib": "@/lib", "hooks": "@/hooks" } }
```

# components\ErrorBoundary.tsx

```tsx
'use client'; import React from 'react'; import { Button } from '@/components/ui/button'; import { AlertTriangle } from 'lucide-react'; interface Props { children: React.ReactNode; } interface State { hasError: boolean; error?: Error; } export class ErrorBoundary extends React.Component<Props, State> { public state: State = { hasError: false, }; static getDerivedStateFromError(error: Error): State { return { hasError: true, error }; } componentDidCatch(error: Error, errorInfo: React.ErrorInfo) { console.error('ErrorBoundary caught an error:', error, errorInfo); } render() { if (this.state.hasError) { return ( <div className='min-h-screen bg-gray-100 flex items-center justify-center p-4'> <div className='bg-white rounded-lg shadow-xl p-6 max-w-md w-full text-center'> <AlertTriangle className='h-12 w-12 text-red-500 mx-auto mb-4' /> <h2 className='text-2xl font-bold text-gray-800 mb-2'> Что-то пошло не так </h2> <p className='text-gray-600 mb-4'> Произошла ошибка при загрузке страницы. Пожалуйста, попробуйте обновить страницу. </p> <Button onClick={() => window.location.reload()} className='w-full'> Обновить страницу </Button> </div> </div> ); } return this.props.children; } }
```

# components\FileUpload.tsx

```tsx
'use client'; import React, { useRef, useState } from 'react'; import { Button } from '@/components/ui/button'; import { Progress } from '@/components/ui/progress'; import { FileService } from '@/lib/files'; import { X, Upload, FileIcon } from 'lucide-react'; import { toast } from 'sonner'; interface FileUploadProps { onUpload: (file: any) => void; // type: string; maxSize?: number; label?: string; } export function FileUpload({ onUpload, // type, maxSize = 5 * 1024 * 1024, label = 'Загрузить файл', }: FileUploadProps) { const [file, setFile] = useState<File | null>(null); const [progress, setProgress] = useState<number>(0); const [isUploading, setIsUploading] = useState<boolean>(false); const fileInputRef = useRef<HTMLInputElement>(null); const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => { const selectedFile = event.target.files?.[0]; if (!selectedFile) return; const error = FileService.validateFile(selectedFile, { maxSize, }); if (error) { toast.error(error); return; } setFile(selectedFile); }; const handleUpload = async () => { if (!file) return; setIsUploading(true); try { // const result = await FileService.upload(file, type, setProgress); onUpload(file); // onUpload(result); toast.success('Файл успешно загружен'); setFile(null); setProgress(0); } catch (error) { toast.error('Ошибка при загрузке файла'); console.error('Upload error:', error); } finally { setIsUploading(false); } }; const handleClear = () => { setFile(null); setProgress(0); if (fileInputRef.current) { fileInputRef.current.value = ''; } }; return ( <div className='space-y-4'> <div className='flex items-center gap-4'> <input type='file' onChange={handleFileSelect} // accept={allowedTypes.join(',')} className='hidden' ref={fileInputRef} /> <Button variant='outline' onClick={() => fileInputRef.current?.click()} disabled={isUploading} > <Upload className='h-4 w-4 mr-2' /> {label} </Button> {file && ( <Button variant='destructive' size='sm' onClick={handleClear} disabled={isUploading} > <X className='h-4 w-4' /> </Button> )} </div> {file && ( <div className='bg-muted p-4 rounded-lg'> <div className='flex items-center justify-between mb-2'> <div className='flex items-center gap-2'> <FileIcon className='h-5 w-5' /> <span className='font-medium truncate'>{file.name}</span> </div> <span className='text-sm text-muted-foreground'> {FileService.formatFileSize(file.size)} </span> </div> {isUploading ? ( <div className='space-y-2'> <Progress value={progress} className='h-2' /> <p className='text-sm text-center text-muted-foreground'> {progress}% </p> </div> ) : ( <Button className='w-full mt-2' onClick={handleUpload}> Загрузить </Button> )} </div> )} <div className='text-sm text-muted-foreground'> {/* <p>Поддерживаемые форматы: {allowedTypes.join(', ')}</p> */} <p>Максимальный размер: {FileService.formatFileSize(maxSize)}</p> </div> </div> ); }
```

# components\LoadingProvider.tsx

```tsx
// components/LoadingProvider.tsx 'use client'; import React, { createContext, useContext, useState, useEffect } from 'react'; import { usePathname, useSearchParams } from 'next/navigation'; import { motion } from 'framer-motion'; interface LoadingContextType { isLoading: boolean; setIsLoading: (loading: boolean) => void; } const LoadingContext = createContext<LoadingContextType | undefined>(undefined); export function LoadingProvider({ children }: { children: React.ReactNode }) { const [isLoading, setIsLoading] = useState(false); const pathname = usePathname(); const searchParams = useSearchParams(); useEffect(() => { setIsLoading(true); const timer = setTimeout(() => { setIsLoading(false); }, 300); return () => clearTimeout(timer); }, [pathname, searchParams]); return ( <LoadingContext.Provider value={{ isLoading, setIsLoading }}> {isLoading && ( <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className='fixed top-0 left-0 w-full h-1 bg-primary/80 z-50' > <motion.div className='h-full bg-primary' initial={{ width: '0%' }} animate={{ width: '100%' }} transition={{ duration: 0.3, ease: 'easeInOut' }} /> </motion.div> )} {children} </LoadingContext.Provider> ); } export const useLoading = () => { const context = useContext(LoadingContext); if (context === undefined) { throw new Error('useLoading must be used within a LoadingProvider'); } return context; };
```

# components\LoadingSpinner.tsx

```tsx
'use client'; import { Loader2 } from 'lucide-react'; interface LoadingSpinnerProps { size?: number; className?: string; } export default function LoadingSpinner({ size = 24, className = '', }: LoadingSpinnerProps) { return ( <div className={`flex items-center justify-center ${className}`}> <Loader2 className='animate-spin' size={size} /> </div> ); }
```

# components\location-search-demo.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { LocationCombobox, LocationItem, } from '@/components/ui/location-combobox'; import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { MapPin, Search } from 'lucide-react'; import { api } from '@/lib/api'; export function LocationSearchDemo() { const [selectedLocation, setSelectedLocation] = useState< LocationItem | undefined >(); const [nearbyLocations, setNearbyLocations] = useState<LocationItem[]>([]); const [radius, setRadius] = useState<number>(100); const [loading, setLoading] = useState(false); const handleLocationSelect = ( id: number | undefined, location?: LocationItem ) => { setSelectedLocation(location); setNearbyLocations([]); }; const searchNearby = async () => { if (!selectedLocation?.latitude || !selectedLocation?.longitude) { return; } setLoading(true); try { const response = await api.getNearestLocations( selectedLocation.latitude, selectedLocation.longitude, radius ); setNearbyLocations(response); } catch (error) { console.error('Error fetching nearby locations:', error); } finally { setLoading(false); } }; return ( <Card className='w-full'> <CardHeader> <CardTitle>Поиск локаций</CardTitle> </CardHeader> <CardContent> <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'> Найти город </label> <LocationCombobox onChange={handleLocationSelect} placeholder='Введите название города' /> </div> {selectedLocation && ( <div className='border-t pt-4 space-y-4'> <div className='flex items-center'> <MapPin className='h-5 w-5 mr-2 text-blue-500' /> <div> <p className='font-medium'>{selectedLocation.name}</p> {selectedLocation.full_name && ( <p className='text-sm text-gray-500'> {selectedLocation.full_name} </p> )} {selectedLocation.latitude && selectedLocation.longitude && ( <p className='text-xs text-gray-400'> Координаты: {selectedLocation.latitude.toFixed(6)},{' '} {selectedLocation.longitude.toFixed(6)} </p> )} </div> </div> <div className='flex space-x-2'> <div className='flex-grow'> <Input type='number' value={radius} onChange={(e) => setRadius(Number(e.target.value))} placeholder='Радиус (км)' min='1' max='500' /> </div> <Button onClick={searchNearby} disabled={ loading || !selectedLocation.latitude || !selectedLocation.longitude } > <Search className='h-4 w-4 mr-2' /> Искать рядом </Button> </div> {nearbyLocations.length > 0 && ( <div className='border rounded-md p-3 mt-4'> <h3 className='font-medium mb-2'> Города в радиусе {radius} км: </h3> <ul className='space-y-2 max-h-60 overflow-y-auto'> {nearbyLocations.map((location) => ( <li key={location.id} className='text-sm flex items-start' > <MapPin className='h-4 w-4 mr-2 mt-0.5 text-gray-400' /> <div> <p>{location.name}</p> {location.distance && ( <p className='text-xs text-gray-500'> {location.distance.toFixed(1)} км </p> )} </div> </li> ))} </ul> </div> )} </div> )} </div> </CardContent> </Card> ); }
```

# components\RatingStars.tsx

```tsx
'use client'; import { useState } from 'react'; import { Star } from 'lucide-react'; import { cn } from '@/lib/utils'; interface RatingStarsProps { value: number; onChange: (value: number) => void; size?: number; readonly?: boolean; className?: string; } const RatingStars = ({ value, onChange, size = 24, readonly = false, className, }: RatingStarsProps) => { const [hoverValue, setHoverValue] = useState<number | null>(null); const handleMouseEnter = (index: number) => { if (readonly) return; setHoverValue(index); }; const handleMouseLeave = () => { if (readonly) return; setHoverValue(null); }; const handleClick = (index: number) => { if (readonly) return; // If clicking the same star twice, clear the selection if (value === index) { onChange(0); } else { onChange(index); } }; return ( <div className={cn('flex items-center', className)}> {[1, 2, 3, 4, 5].map((index) => { const isFilled = hoverValue !== null ? index <= hoverValue : index <= value; return ( <Star key={index} className={cn( 'transition-all duration-100', isFilled ? 'text-yellow-500 fill-yellow-500' : 'text-gray-300', !readonly && 'cursor-pointer' )} size={size} onMouseEnter={() => handleMouseEnter(index)} onMouseLeave={handleMouseLeave} onClick={() => handleClick(index)} /> ); })} </div> ); }; export default RatingStars;
```

# components\RouteGuard.tsx

```tsx
'use client'; import { useUser } from '@/contexts/UserContext'; import { useRouter, usePathname } from 'next/navigation'; import { useEffect } from 'react'; const publicPaths = ['/select-lang', '/select-person', '/select-role']; export default function RouteGuard({ children, }: { children: React.ReactNode; }) { const { userState } = useUser(); const router = useRouter(); const pathname = usePathname(); useEffect(() => { if (!userState.isAuthenticated && !publicPaths.includes(pathname)) { if (!userState.language) { router.push('/select-lang'); } else if (!userState.type) { router.push('/select-person'); } else if (!userState.role) { router.push('/select-role'); } } }, [userState, router, pathname]); return <>{children}</>; }
```

# components\ToastProvider.tsx

```tsx
'use client'; import { Toaster } from 'sonner'; export function ToastProvider() { return ( <Toaster position='top-center' toastOptions={{ style: { background: 'white', color: 'black', border: '1px solid #E2E8F0', }, className: 'shadow-lg', }} /> ); }
```

# components\UserSwitcher.tsx

```tsx
import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, } from '@/components/ui/dialog'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { useUser } from '@/contexts/UserContext'; import { Label } from '@/components/ui/label'; import { AuthService } from '@/lib/auth'; import { toast } from 'sonner'; import { Loader2 } from 'lucide-react'; // Define test users with different roles const TEST_USERS = [ { id: '1919191', name: 'Test Carrier', role: 'carrier', type: 'individual', telegram_data: { user: { id: 1919191, first_name: 'Test', last_name: 'Carrier', username: 'test_carrier', }, auth_date: Math.floor(Date.now() / 1000), hash: 'mock_hash', }, }, { id: '2222222', name: 'Test Cargo Owner', role: 'cargo-owner', type: 'legal', telegram_data: { user: { id: 2222222, first_name: 'Test', last_name: 'Owner', username: 'test_owner', }, auth_date: Math.floor(Date.now() / 1000), hash: 'mock_hash', }, }, { id: '3333333', name: 'Test Logistics Company', role: 'logistics-company', type: 'legal', telegram_data: { user: { id: 3333333, first_name: 'Test', last_name: 'LogisticsCompany', username: 'test_logistics', }, auth_date: Math.floor(Date.now() / 1000), hash: 'mock_hash', }, }, { id: '1111111', name: 'Test Manager', role: 'manager', type: 'individual', telegram_data: { user: { id: 1111111, first_name: 'testmanager', last_name: 'testmanager', username: 'testmanager', }, auth_date: Math.floor(Date.now() / 1000), hash: 'mock_hash', }, }, ]; // Store selected test user ID const SELECTED_TEST_USER_KEY = 'selectedTestUser'; // Mock the Telegram WebApp data for testing const mockTelegramWebApp = (userData: any) => { const webAppData = { initData: JSON.stringify({ query_id: 'query123', user: userData.user, auth_date: userData.auth_date, hash: userData.hash, }), initDataUnsafe: { query_id: 'query123', user: userData.user, auth_date: userData.auth_date, hash: userData.hash, }, }; // Create a backup of the real Telegram WebApp if it exists const realTelegramWebApp = window.Telegram?.WebApp; // Set the mock WebApp window.Telegram = { WebApp: { ...webAppData, ready: () => console.log('Mock WebApp ready'), close: () => console.log('Mock WebApp close'), expand: () => console.log('Mock WebApp expand'), enableClosingConfirmation: () => console.log('Mock closing confirmation enabled'), }, } as any; return () => { // Restore the real Telegram WebApp if it existed if (realTelegramWebApp) { window.Telegram = { WebApp: realTelegramWebApp } as any; } else { delete window.Telegram; } }; }; // Function to set up persistent test user on page load const setupPersistentTestUser = async () => { const selectedUserId = localStorage.getItem(SELECTED_TEST_USER_KEY); if (!selectedUserId) return false; const testUser = TEST_USERS.find((user) => user.id === selectedUserId); if (!testUser) return false; try { // Mock Telegram WebApp data const restoreTelegramWebApp = mockTelegramWebApp(testUser.telegram_data); // Authenticate with the mock data const response = await AuthService.checkTelegramAuth( window?.Telegram?.WebApp ); // If user doesn't exist, create it if (response === false) { // Register new user await AuthService.registerUser({ telegramData: window?.Telegram?.WebApp, userData: { type: testUser.type, role: testUser.role, preferred_language: 'ru', }, }); } // Restore original Telegram WebApp restoreTelegramWebApp(); return true; } catch (error) { console.error('Error setting up persistent test user:', error); return false; } }; const UserSwitcher: React.FC = () => { const [isOpen, setIsOpen] = useState(false); const [selectedUser, setSelectedUser] = useState<string>(''); const { userState, logout } = useUser(); const [isSwitching, setIsSwitching] = useState(false); const [isInitializing, setIsInitializing] = useState(true); // Initialize with the stored test user on mount useEffect(() => { const initTestUser = async () => { setIsInitializing(true); const storedUserId = localStorage.getItem(SELECTED_TEST_USER_KEY); if (storedUserId) { setSelectedUser(storedUserId); await setupPersistentTestUser(); } setIsInitializing(false); }; initTestUser(); }, []); // Show user switcher only in development or when manually enabled useEffect(() => { // You can add a localStorage flag to manually enable in production const isEnabled = process.env.NODE_ENV === 'development' || localStorage.getItem('enableUserSwitcher') === 'true'; if (!isEnabled || isInitializing) { return; } // Show user switcher button const button = document.createElement('button'); button.innerText = '👤 Switch User'; button.style.position = 'fixed'; button.style.bottom = '80px'; button.style.right = '10px'; button.style.zIndex = '9999'; button.style.backgroundColor = '#0066ff'; button.style.color = 'white'; button.style.padding = '8px 12px'; button.style.borderRadius = '4px'; button.style.border = 'none'; button.style.fontSize = '12px'; button.onclick = () => setIsOpen(true); document.body.appendChild(button); return () => { document.body.removeChild(button); }; }, [isInitializing]); const handleUserSwitch = async () => { if (!selectedUser) { toast.error('Please select a user'); return; } setIsSwitching(true); try { // Find the selected test user const testUser = TEST_USERS.find((user) => user.id === selectedUser); if (!testUser) { throw new Error('User not found'); } // First logout current user logout(); // Persist the selected user ID localStorage.setItem(SELECTED_TEST_USER_KEY, selectedUser); // Mock Telegram WebApp data const restoreTelegramWebApp = mockTelegramWebApp(testUser.telegram_data); // Now authenticate with the mock data const response = await AuthService.checkTelegramAuth( window?.Telegram?.WebApp ); // If user doesn't exist, create it if (response === false) { // Register new user await AuthService.registerUser({ telegramData: window?.Telegram?.WebApp, userData: { type: testUser.type, role: testUser.role, preferred_language: 'ru', }, }); toast.success(`Created and logged in as ${testUser.name}`); } else { toast.success(`Logged in as ${testUser.name}`); } // Restore original Telegram WebApp restoreTelegramWebApp(); // Close dialog setIsOpen(false); // Redirect to home page window.location.href = '/menu'; } catch (error) { console.error('Error switching user:', error); toast.error('Failed to switch user'); localStorage.removeItem(SELECTED_TEST_USER_KEY); } finally { setIsSwitching(false); } }; if (isInitializing) { return null; // Don't render anything while initializing } return ( <Dialog open={isOpen} onOpenChange={setIsOpen}> <DialogContent className='sm:max-w-[425px]'> <DialogHeader> <DialogTitle>Switch Test User</DialogTitle> </DialogHeader> <div className='py-4 space-y-4'> <div className='space-y-2'> <Label htmlFor='user'>Select User</Label> <Select value={selectedUser} onValueChange={setSelectedUser}> <SelectTrigger> <SelectValue placeholder='Select a test user' /> </SelectTrigger> <SelectContent> {TEST_USERS.map((user) => ( <SelectItem key={user.id} value={user.id}> {user.name} ({user.role}) </SelectItem> ))} </SelectContent> </Select> </div> {userState.isAuthenticated && ( <div className='text-sm text-amber-600'> <p> Currently logged in as:{' '} {userState.userData?.fullName || 'Unknown'} </p> <p>Role: {userState.role || 'None'}</p> </div> )} <div className='text-sm text-gray-500'> <p> This is a development tool to test the application with different user roles. </p> </div> </div> <DialogFooter> <Button variant='outline' onClick={() => setIsOpen(false)}> Cancel </Button> <Button onClick={handleUserSwitch} disabled={isSwitching}> {isSwitching ? ( <> <Loader2 className='mr-2 h-4 w-4 animate-spin' /> Switching... </> ) : ( 'Switch User' )} </Button> </DialogFooter> </DialogContent> </Dialog> ); }; export default UserSwitcher;
```

# contexts\AppContext.tsx

```tsx
'use client'; import React, { createContext, useContext, useEffect, useState } from 'react'; import { useNotifications, Notification } from '@/hooks/useNotifications'; import { FavoriteItem, useFavorites } from '@/hooks/useFavorites'; interface AppContextType { notifications: Notification[]; notificationsCount: number; favoritesCount: number; favorites: FavoriteItem[]; addNotification: (notification: any) => void; markNotificationAsRead: (id: string) => void; markAllNotificationsAsRead: () => void; deleteNotification: (id: string) => void; clearAllNotifications: () => void; addToFavorites: (item: any) => void; removeFromFavorites: (id: number) => void; clearAllFavorites: () => void; isFavorite: (id: number) => boolean; } const AppContext = createContext<AppContextType | undefined>(undefined); export function AppProvider({ children }: { children: React.ReactNode }) { const { notifications: originalNotifications, unreadCount, addNotification: originalAddNotification, markAsRead: originalMarkAsRead, markAllAsRead: originalMarkAllAsRead, deleteNotification: originalDeleteNotification, clearAllNotifications: originalClearAllNotifications, } = useNotifications(); const { favorites: originalFavorites, addToFavorites: originalAddToFavorites, removeFromFavorites: originalRemoveFromFavorites, isFavorite: originalIsFavorite, clearAllFavorites: originalClearAllFavorites, } = useFavorites(); const [notifications, setNotifications] = useState(originalNotifications); const [favorites, setFavorites] = useState(originalFavorites); const [notificationsCount, setNotificationsCount] = useState(unreadCount); const [favoritesCount, setFavoritesCount] = useState( originalFavorites.length ); useEffect(() => { setNotifications(originalNotifications); setNotificationsCount(unreadCount); }, [originalNotifications, unreadCount]); useEffect(() => { setFavorites(originalFavorites); setFavoritesCount(originalFavorites.length); }, [originalFavorites]); // const hasNotification = (type: string, itemId: string): boolean => { // return notifications.some( // notification => notification.type === type && notification.orderId === itemId // ); // }; // const isFavorite = (type: string, itemId: string): boolean => { // return favorites.some( // favorite => favorite.type === type && favorite.orderId === itemId // ); // }; const addNotification = (notification: any) => { originalAddNotification(notification); // После добавления уведомления обновляем состояние setNotifications((prev) => [...prev, notification]); setNotificationsCount((prev) => prev + 1); }; const markNotificationAsRead = (id: string) => { originalMarkAsRead(id); setNotifications((prev) => prev.map((notif) => notif.id === id ? { ...notif, isRead: true } : notif ) ); setNotificationsCount((prev) => Math.max(0, prev - 1)); }; const markAllNotificationsAsRead = () => { originalMarkAllAsRead(); setNotifications((prev) => prev.map((notif) => ({ ...notif, isRead: true })) ); setNotificationsCount(0); }; const deleteNotification = (id: string) => { const notification = notifications.find((n) => n.id === id); originalDeleteNotification(id); setNotifications((prev) => prev.filter((notif) => notif.id !== id)); if (notification && !notification.isRead) { setNotificationsCount((prev) => Math.max(0, prev - 1)); } }; const clearAllNotifications = () => { originalClearAllNotifications(); setNotifications([]); setNotificationsCount(0); }; const addToFavorites = (item: any) => { originalAddToFavorites(item); setFavorites((prev) => [...prev, item]); setFavoritesCount((prev) => prev + 1); }; const removeFromFavorites = (id: number) => { originalRemoveFromFavorites(id); setFavorites((prev) => prev.filter((item) => item.orderId !== id)); setFavoritesCount((prev) => Math.max(0, prev - 1)); }; const clearAllFavorites = () => { originalClearAllFavorites(); setFavorites([]); setFavoritesCount(0); }; const value = { notifications, notificationsCount, favoritesCount, favorites, addNotification, markNotificationAsRead, markAllNotificationsAsRead, deleteNotification, clearAllNotifications, addToFavorites, removeFromFavorites, clearAllFavorites, isFavorite: originalIsFavorite, }; return <AppContext.Provider value={value}>{children}</AppContext.Provider>; } export function useApp() { const context = useContext(AppContext); if (context === undefined) { throw new Error('useApp must be used within an AppProvider'); } return context; }
```

# contexts\AuthContext.tsx

```tsx
// contexts/AuthContext.tsx 'use client'; import React, { createContext, useContext, useEffect, useState } from 'react'; import { api } from '@/lib/api'; import { useRouter } from 'next/navigation'; import { toast } from 'sonner'; interface User { id: string; telegram_id: string; username?: string; full_name: string; type?: 'individual' | 'legal'; role?: 'student' | 'carrier' | 'cargo-owner' | 'logistics-company'; is_verified: boolean; preferred_language?: string; [key: string]: any; } interface AuthContextType { user: User | null; isAuthenticated: boolean; isLoading: boolean; login: (telegramData: any) => Promise<void>; logout: () => void; updateUser: (data: Partial<User>) => Promise<void>; handleTelegramWebAppInit: () => Promise<void>; } const AuthContext = createContext<AuthContextType | undefined>(undefined); interface TelegramWebAppData { initData: string; initDataUnsafe: { query_id: string; user: { id: number; first_name: string; last_name?: string; username?: string; language_code?: string; }; auth_date: string; hash: string; }; } export function AuthProvider({ children }: { children: React.ReactNode }) { const [user, setUser] = useState<User | null>(null); const [isLoading, setIsLoading] = useState(true); const router = useRouter(); useEffect(() => { checkAuth(); }, []); const handleTelegramWebAppInit = async () => { try { if (typeof window !== 'undefined' && window.Telegram?.WebApp) { const webApp = window.Telegram.WebApp; if (webApp.initData) { const webAppData = { initData: webApp.initData, user: webApp.initDataUnsafe.user, auth_date: webApp.initDataUnsafe.auth_date, hash: webApp.initDataUnsafe.hash, }; await login(webAppData); } } } catch (error) { console.error('Telegram WebApp init error:', error); toast.error('Failed to initialize Telegram WebApp'); } }; const checkAuth = async () => { try { const token = localStorage.getItem('access_token'); if (!token) { setIsLoading(false); return; } const userData = await api.getCurrentUser(); setUser(userData); } catch (error) { console.error('Auth check error:', error); logout(); } finally { setIsLoading(false); } }; const login = async (telegramData: any) => { try { setIsLoading(true); const userData = await api.telegramAuth(telegramData); setUser(userData); // Redirect based on user type and verification status if (!userData.type || !userData.role) { router.push('/select-lang'); } else if (userData.role === 'carrier' && !userData.is_verified) { router.push('/driver-verification'); } else { router.push('/home'); } } catch (error) { console.error('Login error:', error); toast.error('Authentication failed. Please try again.'); } finally { setIsLoading(false); } }; const logout = () => { localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); setUser(null); router.push('/select-lang'); }; const updateUser = async (data: Partial<User>) => { try { const updatedUser = await api.updateProfile(data); setUser(updatedUser); return updatedUser; } catch (error) { console.error('Update user error:', error); toast.error('Failed to update profile'); throw error; } }; const value = { user, isAuthenticated: !!user, isLoading, login, logout, updateUser, handleTelegramWebAppInit, }; return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>; } export function useAuth() { const context = useContext(AuthContext); if (context === undefined) { throw new Error('useAuth must be used within an AuthProvider'); } return context; }
```

# contexts\ThemeContext.tsx

```tsx
// contexts/ThemeContext.tsx 'use client'; import React, { createContext, useContext, useEffect, useState } from 'react'; import { Sun, Moon } from 'lucide-react'; import { Button } from '@/components/ui/button'; type Theme = 'light' | 'dark'; interface ThemeContextType { theme: Theme; toggleTheme: () => void; } const ThemeContext = createContext<ThemeContextType | undefined>(undefined); export function ThemeProvider({ children }: { children: React.ReactNode }) { const [theme, setTheme] = useState<Theme>('light'); useEffect(() => { const savedTheme = localStorage.getItem('theme') as Theme; if (savedTheme) { setTheme(savedTheme); document.documentElement.className = savedTheme; } }, []); const toggleTheme = () => { const newTheme = theme === 'light' ? 'dark' : 'light'; setTheme(newTheme); localStorage.setItem('theme', newTheme); document.documentElement.className = newTheme; }; return ( <ThemeContext.Provider value={{ theme, toggleTheme }}> <div className={theme}> {children} <Button variant='ghost' size='icon' className='fixed top-4 right-4 z-50 rounded-full bg-background/80 backdrop-blur-sm' onClick={toggleTheme} > {theme === 'light' ? ( <Sun className='h-5 w-5' /> ) : ( <Moon className='h-5 w-5' /> )} </Button> </div> </ThemeContext.Provider> ); } export const useTheme = () => { const context = useContext(ThemeContext); if (context === undefined) { throw new Error('useTheme must be used within a ThemeProvider'); } return context; };
```

# contexts\UserContext.tsx

```tsx
import React, { createContext, useContext, useEffect, useState } from 'react'; import { useRouter } from 'next/navigation'; import { AuthService } from '@/lib/auth'; import { UserState } from '@/types'; interface UserContextType { userState: UserState; setUserType: (type: UserState['type']) => void; setUserRole: (role: UserState['role']) => void; setLanguage: (language: UserState['language']) => void; setUserData: (data: any) => void; logout: () => void; isAuthenticated: boolean; } const USER_STORAGE_KEY = 'logit_user_state'; const SELECTED_TEST_USER_KEY = 'selectedTestUser'; const UserContext = createContext<UserContextType | undefined>(undefined); export function UserProvider({ children }: { children: React.ReactNode }) { const [userState, setUserState] = useState<UserState>({}); const [isInitialized, setIsInitialized] = useState(false); const router = useRouter(); // Initialize user state useEffect(() => { const initUser = async () => { try { // Check if we have a stored user state const storedUserState = localStorage.getItem(USER_STORAGE_KEY); if (storedUserState) { setUserState(JSON.parse(storedUserState)); } // Check if we're in Telegram WebApp if (typeof window !== 'undefined' && window.Telegram?.WebApp) { const webApp = window.Telegram.WebApp; if (webApp.initData && webApp.initDataUnsafe) { // Check if we have a selected test user const hasSelectedTestUser = localStorage.getItem( SELECTED_TEST_USER_KEY ); // Proceed with auth check const userExists = await AuthService.checkTelegramAuth( webApp ).catch((err) => { console.error('Auth check error:', err); return false; }); if (userExists) { // If user exists, try to retrieve their profile try { const userData = await AuthService.getProfile(); if (userData) { updateUserState({ type: userData.type, role: userData.role, language: userData.preferred_language, isAuthenticated: true, }); // If we're on the select-lang page but already authenticated, redirect to home if ( window.location.pathname === '/select-lang' || window.location.pathname === '/' ) { router.push('/menu'); } } } catch (profileError) { console.error('Error fetching profile:', profileError); } } else if (!hasSelectedTestUser) { // If user doesn't exist and we don't have a selected test user, // start registration process router.push('/select-lang'); } } } } catch (error) { console.error('Init user error:', error); } finally { setIsInitialized(true); } }; initUser(); }, [router]); const updateUserState = (newState: Partial<UserState>) => { const updatedState = { ...userState, ...newState }; setUserState((prev) => ({ ...prev, ...newState })); localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(updatedState)); }; const setUserType = (type: UserState['type']) => { updateUserState({ type }); }; const setUserRole = (role: UserState['role']) => { updateUserState({ role }); }; const setLanguage = (language: UserState['language']) => { updateUserState({ language }); }; const setUserData = async (data: any) => { try { updateUserState({ type: data.type, role: data.role, language: data.preferred_language, isAuthenticated: true, }); } catch (error) { console.error('Update user data error:', error); } }; const logout = () => { // Use the modified logout that preserves selectedTestUser AuthService.logout(); // Remove user state from local storage but keep the test user selection localStorage.removeItem(USER_STORAGE_KEY); // Reset context state setUserState({}); // Redirect to login router.push('/select-lang'); }; return ( <UserContext.Provider value={{ userState, setUserType, setUserRole, setLanguage, setUserData, logout, isAuthenticated: Boolean(userState.isAuthenticated), }} > {children} </UserContext.Provider> ); } export function useUser() { const context = useContext(UserContext); if (context === undefined) { throw new Error('useUser must be used within a UserProvider'); } return context; }
```

# hooks\useFavorites.ts

```ts
import { useState, useEffect } from 'react'; export interface FavoriteItem { id: string; type: 'cargo' | 'route' | 'carrier'; title: string; description: string; createdAt: Date; details: Record<string, any>; orderId?: number; } const FAVORITES_STORAGE_KEY = 'logit_favorites'; export const useFavorites = () => { const [favorites, setFavorites] = useState<FavoriteItem[]>([]); useEffect(() => { const storedFavorites = localStorage.getItem(FAVORITES_STORAGE_KEY); if (storedFavorites) { setFavorites(JSON.parse(storedFavorites)); } }, []); const saveFavorites = (newFavorites: FavoriteItem[]) => { localStorage.setItem(FAVORITES_STORAGE_KEY, JSON.stringify(newFavorites)); setFavorites(newFavorites); }; const addToFavorites = (item: Omit<FavoriteItem, 'id' | 'createdAt'>) => { const newItem: FavoriteItem = { ...item, id: Date.now().toString(), createdAt: new Date(), }; // Проверяем, нет ли уже такого элемента const exists = favorites.some( (favorite) => favorite.type === item.type && favorite.title === item.title ); if (!exists) { const updatedFavorites = [...favorites, newItem]; saveFavorites(updatedFavorites); return true; } return false; }; const removeFromFavorites = (itemId: number) => { const updatedFavorites = favorites.filter( (item) => item.orderId !== itemId ); saveFavorites(updatedFavorites); }; const isFavorite = (itemId: number) => { return favorites.some((item) => item.orderId === itemId); }; const getFavoritesByType = (type: FavoriteItem['type']) => { return favorites.filter((item) => item.type === type); }; const clearAllFavorites = () => { saveFavorites([]); }; const updateFavoriteDetails = ( itemId: string, details: Record<string, any> ) => { const updatedFavorites = favorites.map((item) => item.id === itemId ? { ...item, details: { ...item.details, ...details } } : item ); saveFavorites(updatedFavorites); }; return { favorites, addToFavorites, removeFromFavorites, isFavorite, getFavoritesByType, clearAllFavorites, updateFavoriteDetails, }; };
```

# hooks\useNotifications.ts

```ts
import { useState, useEffect } from 'react'; export interface Notification { id: string; type: 'cargo' | 'route' | 'system'; message: string; createdAt: Date; isRead: boolean; orderId?: number; } const NOTIFICATIONS_STORAGE_KEY = 'logit_notifications'; export const useNotifications = () => { const [notifications, setNotifications] = useState<Notification[]>([]); useEffect(() => { const storedNotifications = localStorage.getItem(NOTIFICATIONS_STORAGE_KEY); if (storedNotifications) { setNotifications(JSON.parse(storedNotifications)); } }, []); const saveNotifications = (newNotifications: Notification[]) => { localStorage.setItem( NOTIFICATIONS_STORAGE_KEY, JSON.stringify(newNotifications) ); setNotifications(newNotifications); }; const addNotification = ( notification: Omit<Notification, 'id' | 'createdAt' | 'isRead'> ) => { const newNotification: Notification = { ...notification, id: Date.now().toString(), createdAt: new Date(), isRead: false, }; const updatedNotifications = [...notifications, newNotification]; saveNotifications(updatedNotifications); }; const markAsRead = (notificationId: string) => { const updatedNotifications = notifications.map((notification) => notification.id === notificationId ? { ...notification, isRead: true } : notification ); saveNotifications(updatedNotifications); }; const markAllAsRead = () => { const updatedNotifications = notifications.map((notification) => ({ ...notification, isRead: true, })); saveNotifications(updatedNotifications); }; const deleteNotification = (notificationId: string) => { const updatedNotifications = notifications.filter( (notification) => notification.id !== notificationId ); saveNotifications(updatedNotifications); }; const clearAllNotifications = () => { saveNotifications([]); }; const unreadCount = notifications.filter((n) => !n.isRead).length; return { notifications, unreadCount, addNotification, markAsRead, markAllAsRead, deleteNotification, clearAllNotifications, }; };
```

# lib\api.ts

```ts
import axios, { AxiosInstance } from 'axios'; const BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api'; export interface Location { id: number; name: string; level: number; code?: string; latitude?: number; longitude?: number; parent_name?: string; country_name?: string; full_name?: string; additional_data?: Record<string, any>; } export class ApiClient { private static instance: ApiClient; private api: AxiosInstance; private constructor() { this.api = axios.create({ baseURL: BASE_URL, headers: { 'Content-Type': 'application/json', 'ngrok-skip-browser-warning': '69420', }, }); // Request interceptor for adding auth token this.api.interceptors.request.use( (config) => { const token = localStorage.getItem('access_token'); if (token) { config.headers.Authorization = `Bearer ${token}`; } return config; }, (error) => Promise.reject(error) ); // Response interceptor for token refresh this.api.interceptors.response.use( (response) => response, async (error) => { const originalRequest = error.config; if (error.response?.status === 401 && !originalRequest._retry) { originalRequest._retry = true; try { const refreshToken = localStorage.getItem('refresh_token'); const response = await this.api.post('/auth/token/refresh/', { refresh: refreshToken, }); const { access } = response.data; localStorage.setItem('access_token', access); originalRequest.headers.Authorization = `Bearer ${access}`; return this.api(originalRequest); } catch (refreshError) { localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); window.location.href = '/select-lang'; return Promise.reject(refreshError); } } return Promise.reject(error); } ); } public static getInstance(): ApiClient { if (!ApiClient.instance) { ApiClient.instance = new ApiClient(); } return ApiClient.instance; } // Generic request methods public async get(url: string, params?: any) { try { const response = await this.api.get(url, { params }); return response.data; } catch (error) { console.error('GET request error:', error); throw error; } } public async post(url: string, data?: any) { try { const response = await this.api.post(url, data); return response.data; } catch (error) { console.error('POST request error:', error); throw error; } } public async put(url: string, data: any) { try { const response = await this.api.put(url, data); return response.data; } catch (error) { console.error('PUT request error:', error); throw error; } } public async patch(url: string, data: any) { try { const response = await this.api.patch(url, data); return response.data; } catch (error) { console.error('PATCH request error:', error); throw error; } } public async delete(url: string) { try { const response = await this.api.delete(url); return response.data; } catch (error) { console.error('DELETE request error:', error); throw error; } } // Authentication public async telegramAuth(telegramData: any) { try { const response = await this.api.post( '/users/telegram_auth/', telegramData ); const { access, refresh, user } = response.data; localStorage.setItem('access_token', access); localStorage.setItem('refresh_token', refresh); return user; } catch (error) { console.error('Telegram auth error:', error); throw error; } } // User Profile public async getCurrentUser() { try { const response = await this.api.get('/users/me/'); return response.data; } catch (error) { console.error('Get profile error:', error); throw error; } } public async updateProfile(data: any) { try { const response = await this.api.put('/users/update_profile/', data); return response.data; } catch (error) { console.error('Update profile error:', error); throw error; } } // Cargo public async getCargos(params?: any) { try { const response = await this.api.get('/cargo/cargos/', { params }); return response.data; } catch (error) { console.error('Get cargos error:', error); throw error; } } public async createCargo(data: any) { try { console.log(data, 'createcargodata'); const payload = { ...data }; console.log('sending cargo data:', payload); const response = await this.api.post('/cargo/cargos/', payload); return response.data; } catch (error) { console.error('Create cargo error:', error); throw error; } } public async updateCargo(id: string, data: any) { try { const response = await this.api.patch(`/cargo/${id}/`, data); return response.data; } catch (error) { console.error('Update cargo error:', error); throw error; } } // Vehicles public async getVehicles(params?: any) { try { const response = await this.api.get('/vehicles/', { params }); return response.data; } catch (error) { console.error('Get vehicles error:', error); throw error; } } public async createVehicle(data: any) { try { const response = await this.api.post('/vehicles/', data); return response.data; } catch (error) { console.error('Create vehicle error:', error); throw error; } } public async updateVehicle(id: string, data: any) { try { const response = await this.api.patch(`/vehicles/${id}/`, data); return response.data; } catch (error) { console.error('Update vehicle error:', error); throw error; } } public async deleteVehicle(id: string) { try { const response = await this.api.delete(`/vehicles/${id}/`); return response.data; } catch (error) { console.error('Delete vehicle error:', error); throw error; } } // Vehicle Documents public async addVehicleDocument( vehicleId: string, data: { file: File; type: | 'tech_passport' | 'license' | 'insurance' | 'adr_cert' | 'dozvol' | 'tir' | 'other'; title: string; expiry_date?: string; } ) { try { const formData = new FormData(); formData.append('file', data.file); formData.append('type', data.type); formData.append('title', data.title); if (data.expiry_date) { formData.append('expiry_date', data.expiry_date); } const response = await this.api.post( `/vehicles/${vehicleId}/add_document/`, formData, { headers: { 'Content-Type': 'multipart/form-data', }, } ); return response.data; } catch (error) { console.error('Add vehicle document error:', error); throw error; } } // Carrier Requests public async getCarrierRequests(params?: any) { try { const response = await this.api.get('/carrier-requests/', { params }); return response.data; } catch (error) { console.error('Get carrier requests error:', error); throw error; } } public async createCarrierRequest(data: any) { try { const response = await this.api.post('/carrier-requests/', data); return response.data; } catch (error) { console.error('Create carrier request error:', error); throw error; } } public async updateCarrierRequest(id: string, data: any) { try { const response = await this.api.patch(`/carrier-requests/${id}/`, data); return response.data; } catch (error) { console.error('Update carrier request error:', error); throw error; } } public async deleteCarrierRequest(id: string) { try { const response = await this.api.delete(`/carrier-requests/${id}/`); return response.data; } catch (error) { console.error('Delete carrier request error:', error); throw error; } } // Notifications public async getNotifications() { try { const response = await this.api.get('/core/notifications/'); return response.data; } catch (error) { console.error('Get notifications error:', error); throw error; } } public async markNotificationAsRead(id: string) { try { const response = await this.api.post( `/core/notifications/${id}/mark-read/` ); return response.data; } catch (error) { console.error('Mark notification error:', error); throw error; } } // Favorites public async getFavorites() { try { const response = await this.api.get('/core/favorites/'); return response.data; } catch (error) { console.error('Get favorites error:', error); throw error; } } public async addToFavorites(data: any) { try { const response = await this.api.post('/core/favorites/', data); return response.data; } catch (error) { console.error('Add to favorites error:', error); throw error; } } // Search public async searchCargo(filters: any) { try { const response = await this.api.post('/cargo/search/', filters); return response.data; } catch (error) { console.error('Search cargo error:', error); throw error; } } public async addUserDocument(data: { file: File; type: 'driver_license' | 'passport' | 'company_certificate' | 'other'; title: string; }) { try { const formData = new FormData(); formData.append('file', data.file); formData.append('type', data.type); formData.append('title', data.title); const response = await this.api.post( '/users/upload_document/', formData, { headers: { 'Content-Type': 'multipart/form-data', }, } ); return response.data; } catch (error) { console.error('Add user document error:', error); throw error; } } public async getUserDocuments() { try { const response = await this.api.get('/users/documents/'); return response.data; } catch (error) { console.error('Get user documents error:', error); throw error; } } public async deleteUserDocument(id: string) { try { const response = await this.api.delete(`/users/documents/${id}/`); return response.data; } catch (error) { console.error('Delete user document error:', error); throw error; } } public async searchLocations(query: string) { try { const response = await this.api.get<Location>('/core/locations/search/', { params: { q: query }, }); return response.data; } catch (error) { console.error('search locations error:', error); throw error; } } // Получение локации по ID public async getLocation(id: number) { try { const response = await this.api.get<Location>(`/core/locations/${id}/`); return response.data; } catch (error) { console.error('get location error:', error); throw error; } } // Get states/regions for a country public async getStates(countryId: number) { try { const response = await this.api.get(`/core/locations/states/`, { params: { country_id: countryId }, }); return response.data; } catch (error) { console.error('Error fetching states:', error); throw error; } } // Get cities for a state or country public async getCities(params: { state_id?: number; country_id?: number }) { try { const response = await this.api.get(`/core/locations/cities/`, { params, }); return response.data; } catch (error) { console.error('Error fetching cities:', error); throw error; } } // Find nearby location public async getNearbyLocations( lat: number, lon: number, radius: number = 100 ) { try { const response = await this.api.get(`/core/locations/nearest/`, { params: { lat, lon, radius }, }); return response.data; } catch (error) { console.error('Error fetching nearby locations:', error); throw error; } } // Получение ближайших локаций public async getNearestLocations( lat: number, lon: number, radius: number = 100 ) { try { const response = await this.api.get<Location[]>( '/core/locations/nearest/', { params: { lat, lon, radius }, } ); return response.data; } catch (error) { console.error('nearest location error:', error); throw error; } } // Получение стран public async getCountries() { try { const response = await this.api.get<Location[]>( '/core/locations/countries/' ); return response.data; } catch (error) { console.error('get countries error:', error); throw error; } } // Получение регионов/штатов по стране public async getStatesByCountry(countryId: number) { try { const response = await this.api.get<Location[]>( '/core/locations/states/', { params: { country_id: countryId }, } ); return response.data; } catch (error) { console.error('get states error:', error); throw error; } } // Получение городов по региону/штату public async getCitiesByState(stateId: number) { try { const response = await this.api.get<Location[]>( '/core/locations/cities/', { params: { state_id: stateId }, } ); return response.data; } catch (error) { console.error('get cities by state error:', error); throw error; } } // Получение городов по стране public async getCitiesByCountry(countryId: number) { try { const response = await this.api.get<Location[]>( '/core/locations/cities/', { params: { country_id: countryId }, } ); return response.data; } catch (error) { console.error('get cities by country error:', error); throw error; } } public async getRatings(params?: any) { try { const response = await this.api.get('/core/ratings/', { params }); return response.data; } catch (error) { console.error('Get ratings error:', error); throw error; } } public async createRating(data: { to_user: string; score: number; comment?: string; cargo_id?: string; }) { try { const response = await this.api.post('/core/ratings/', data); return response.data; } catch (error) { console.error('Create rating error:', error); throw error; } } public async updateRating( id: string, data: { score?: number; comment?: string; } ) { try { const response = await this.api.patch(`/core/ratings/${id}/`, data); return response.data; } catch (error) { console.error('Update rating error:', error); throw error; } } public async deleteRating(id: string) { try { const response = await this.api.delete(`/core/ratings/${id}/`); return response.data; } catch (error) { console.error('Delete rating error:', error); throw error; } } } // Reinitialize the API client to apply our interceptors export const initApiClient = () => { return ApiClient.getInstance(); }; export const api = ApiClient.getInstance();
```

# lib\auth.ts

```ts
import axios, { AxiosError } from 'axios'; import { toast } from 'sonner'; interface TelegramUser { id: number; first_name: string; last_name?: string; username?: string; language_code?: string; } interface TelegramAuthResponse { access: string; refresh: string; user: any; } interface RegistrationData { telegramData: any; userData: any; } const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api'; // Create axios instance with default config const api = axios.create({ baseURL: API_URL, headers: { 'Content-Type': 'application/json', 'ngrok-skip-browser-warning': '69420', }, withCredentials: true, // Important for CORS }); export class AuthService { private static async prepareAuthPayload(telegramData: any) { return { init_data: telegramData?.initData, user: telegramData?.initDataUnsafe.user, auth_date: Number(telegramData?.initDataUnsafe.auth_date), hash: telegramData?.initDataUnsafe.hash, }; } private static async handleAuthResponse(response: any) { const { access, refresh, user } = response.data; // Save tokens and user info localStorage.setItem('access_token', access); localStorage.setItem('refresh_token', refresh); // Save telegram ID for future reference if (user?.telegram_id) { localStorage.setItem('telegram_id', user.telegram_id); } return response.data; } static async checkTelegramAuth(telegramData: any): Promise<boolean> { try { const authPayload = await this.prepareAuthPayload(telegramData); console.log('Checking auth payload:', authPayload); const response = await api.post('/users/telegram_auth/', authPayload); // If user is found, save tokens and return true await this.handleAuthResponse(response); return true; } catch (error) { if (error instanceof AxiosError) { if (error.response?.status === 404) { // User not found - this is an expected result return false; } // Other errors const message = error.response?.data?.detail || 'Authentication check failed'; toast.error(message); console.error('Auth check error:', error.response?.data); } throw error; } } private static delay(ms: number): Promise<void> { return new Promise((resolve) => setTimeout(resolve, ms)); } static async registerUser( data: RegistrationData ): Promise<TelegramAuthResponse> { try { // Step 1: Register with Telegram data const authPayload = await this.prepareAuthPayload(data.telegramData); const registrationResponse = await api.post('/users/register/', { ...authPayload, userData: data.userData, }); console.log(registrationResponse, 'regres'); // Save tokens after registration await this.handleAuthResponse(registrationResponse); return { ...registrationResponse.data, }; } catch (error) { if (error instanceof AxiosError) { const message = error.response?.data?.detail || 'Registration failed'; toast.error(message); console.error('Registration error:', error.response?.data); } throw error; } } static async refreshToken(): Promise<string> { try { const refresh = localStorage.getItem('refresh_token'); if (!refresh) throw new Error('No refresh token'); const response = await api.post<{ access: string }>( '/auth/token/refresh/', { refresh } ); const { access } = response.data; localStorage.setItem('access_token', access); return access; } catch (error) { // On refresh failure, clean up tokens localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); throw error; } } static async updateProfile(data: any) { try { const token = localStorage.getItem('access_token'); const response = await api.put('/users/update_profile/', data, { headers: { Authorization: `Bearer ${token}`, }, }); return response.data; } catch (error) { if (error instanceof AxiosError) { const message = error.response?.data?.detail || 'Failed to update profile'; toast.error(message); } throw error; } } static async getProfile() { try { const token = localStorage.getItem('access_token'); if (!token) throw new Error('No auth token'); const response = await api.get('/users/me/', { headers: { Authorization: `Bearer ${token}`, }, }); return response.data; } catch (error) { if (error instanceof AxiosError) { const message = error.response?.data?.detail || 'Failed to get profile'; toast.error(message); } throw error; } } static logout() { // Don't remove telegram_id to maintain user selection in user switcher localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); } static clearAllAuthData() { // Use this when you want to completely clear all auth data localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); localStorage.removeItem('telegram_id'); localStorage.removeItem('selectedTestUser'); } } // Add axios interceptor for token refresh api.interceptors.response.use( (response) => response, async (error) => { const originalRequest = error.config; if (error.response?.status === 401 && !originalRequest._retry) { originalRequest._retry = true; try { const access = await AuthService.refreshToken(); originalRequest.headers.Authorization = `Bearer ${access}`; return api(originalRequest); } catch (refreshError) { AuthService.logout(); window.location.href = '/select-lang'; return Promise.reject(refreshError); } } return Promise.reject(error); } ); export default AuthService;
```

# lib\errors.ts

```ts
export class ApiError extends Error { constructor( public statusCode: number, message: string, public code?: string ) { super(message); this.name = 'ApiError'; } } export class ValidationError extends ApiError { constructor(message: string) { super(400, message, 'VALIDATION_ERROR'); this.name = 'ValidationError'; } } export class AuthenticationError extends ApiError { constructor(message: string = 'Authentication required') { super(401, message, 'AUTHENTICATION_ERROR'); this.name = 'AuthenticationError'; } } export class AuthorizationError extends ApiError { constructor(message: string = 'Not authorized') { super(403, message, 'AUTHORIZATION_ERROR'); this.name = 'AuthorizationError'; } } export class NotFoundError extends ApiError { constructor(resource: string) { super(404, `${resource} not found`, 'NOT_FOUND'); this.name = 'NotFoundError'; } }
```

# lib\files.ts

```ts
import axios from 'axios'; const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api'; export interface FileUploadResponse { id: string; url: string; filename: string; mimetype: string; size: number; } export class FileService { static async upload( file: File, type: string, onProgress?: (progress: number) => void ): Promise<FileUploadResponse> { const formData = new FormData(); formData.append('file', file); formData.append('type', type); const response = await axios.post(`${API_URL}/upload/`, formData, { headers: { 'ngrok-skip-browser-warning': '69420', 'Content-Type': 'multipart/form-data', }, onUploadProgress: (progressEvent) => { if (onProgress && progressEvent.total) { const progress = Math.round( (progressEvent.loaded * 100) / progressEvent.total ); onProgress(progress); } }, }); return response.data; } static async delete(fileId: string): Promise<void> { await axios.delete(`${API_URL}/upload/${fileId}/`, { headers: { 'ngrok-skip-browser-warning': '69420', }, }); } static getFileType(file: File): string { if (file.type.startsWith('image/')) { return 'image'; } if (file.type === 'application/pdf') { return 'pdf'; } return 'document'; } static validateFile( file: File, options: { maxSize?: number; // allowedTypes?: string[]; } = {} ): string | null { const { maxSize = 5 * 1024 * 1024, // 5MB default // allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'], } = options; // if (!allowedTypes.includes(file.type)) { // return 'Неподдерживаемый тип файла'; // } if (file.size > maxSize) { return `Размер файла не должен превышать ${maxSize / (1024 * 1024)}MB`; } return null; } static formatFileSize(bytes: number): string { if (bytes === 0) return '0 Bytes'; const k = 1024; const sizes = ['Bytes', 'KB', 'MB', 'GB']; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]; } static getFileExtension(filename: string): string { return filename.split('.').pop()?.toLowerCase() || ''; } static getFileIcon(file: File): string { const type = file.type; if (type.startsWith('image/')) return '🖼️'; if (type === 'application/pdf') return '📄'; if (type.includes('spreadsheet') || type.includes('excel')) return '📊'; if (type.includes('document') || type.includes('word')) return '📝'; return '📎'; } }
```

# lib\geocoding.ts

```ts
interface Coordinates { lat: number; lng: number; } interface GeocodingCache { [key: string]: Coordinates; } // Простой кэш для координат const coordinatesCache: GeocodingCache = { москва: { lat: 55.7558, lng: 37.6173 }, 'санкт-петербург': { lat: 59.9343, lng: 30.3351 }, ташкент: { lat: 41.2995, lng: 69.2401 }, самарканд: { lat: 39.627, lng: 66.975 }, бухара: { lat: 39.768, lng: 64.421 }, }; export async function getCoordinates( city: string ): Promise<Coordinates | null> { const normalizedCity = city.toLowerCase().trim(); // Проверяем кэш if (coordinatesCache[normalizedCity]) { return coordinatesCache[normalizedCity]; } // В реальном приложении здесь был бы запрос к геокодинг сервису // например, Google Maps Geocoding API или OpenStreetMap Nominatim return null; } export function calculateDistance(from: Coordinates, to: Coordinates): number { const R = 6371; // Радиус Земли в километрах const dLat = toRad(to.lat - from.lat); const dLon = toRad(to.lng - from.lng); const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(toRad(from.lat)) * Math.cos(toRad(to.lat)) * Math.sin(dLon / 2) * Math.sin(dLon / 2); const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); const distance = R * c; return Math.round(distance); } function toRad(degrees: number): number { return (degrees * Math.PI) / 180; } export function isWithinRadius( point: Coordinates, center: Coordinates, radius: number ): boolean { const distance = calculateDistance(point, center); return distance <= radius; } export function findNearestCities( city: string, radius: number = 100 ): string[] { const coordinates = coordinatesCache[city.toLowerCase()]; if (!coordinates) return []; return Object.entries(coordinatesCache) .filter(([name, coords]) => { if (name === city.toLowerCase()) return false; return isWithinRadius(coords, coordinates, radius); }) .map(([name]) => name); } export function getRegionForCity(city: string): string { // В реальном приложении здесь был бы более полный справочник регионов const regions: Record<string, string> = { москва: 'Московская область', 'санкт-петербург': 'Ленинградская область', ташкент: 'Ташкентская область', самарканд: 'Самаркандская область', бухара: 'Бухарская область', }; return regions[city.toLowerCase()] || 'Неизвестный регион'; }
```

# lib\jwt.ts

```ts
import jwt from 'jsonwebtoken'; const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key'; export interface JWTPayload { userId: string; role: string; } export function signToken(payload: JWTPayload): string { return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' }); } export function verifyToken(token: string): JWTPayload { try { return jwt.verify(token, JWT_SECRET) as JWTPayload; } catch (error) { throw new Error('Invalid token'); } } export function extractToken(authHeader: string | null): string { if (!authHeader || !authHeader.startsWith('Bearer ')) { throw new Error('No token provided'); } return authHeader.split(' ')[1]; }
```

# lib\telegram-bot.ts

```ts
import TelegramBot from 'node-telegram-bot-api'; // Singleton pattern for the Telegram bot instance class TelegramBotService { private static instance: TelegramBotService; private bot: TelegramBot | null = null; private webAppUrl: string; private token: string; private isInitialized = false; private constructor() { // Initialize with environment variables this.token = process.env.TELEGRAM_BOT_TOKEN || ''; this.webAppUrl = process.env.NEXT_PUBLIC_WEB_APP_URL || ''; // Log configuration status without exposing sensitive data if (!this.token) { console.error( 'TELEGRAM_BOT_TOKEN is not defined in environment variables' ); } if (!this.webAppUrl) { console.error( 'NEXT_PUBLIC_WEB_APP_URL is not defined in environment variables' ); } } public static getInstance(): TelegramBotService { if (!TelegramBotService.instance) { TelegramBotService.instance = new TelegramBotService(); } return TelegramBotService.instance; } public startBot(): TelegramBot | null { // Only initialize if not already initialized if (this.isInitialized) { return this.bot; } // Only start the bot in server environment with valid configuration if (typeof window === 'undefined' && this.token && this.webAppUrl) { try { // Create a new bot instance with polling this.bot = new TelegramBot(this.token, { polling: true }); // Setup message handlers this.setupMessageHandlers(); this.isInitialized = true; console.log('Telegram bot started successfully'); return this.bot; } catch (error) { console.error('Failed to start Telegram bot:', error); return null; } } else { // Log specific reason for not starting the bot if (typeof window !== 'undefined') { console.log('Bot not started: Running in browser environment'); } else if (!this.token) { console.error('Bot not started: Missing TELEGRAM_BOT_TOKEN'); } else if (!this.webAppUrl) { console.error('Bot not started: Missing NEXT_PUBLIC_WEB_APP_URL'); } return null; } } public getBot(): TelegramBot | null { return this.bot; } private setupMessageHandlers(): void { if (!this.bot) return; this.bot.on('message', async (msg) => { const chatId = msg.chat.id; const text = msg.text; if (text === '/start') { try { await this.bot?.sendMessage(chatId, 'Заходите в наш Logit Smartbot', { reply_markup: { inline_keyboard: [ [{ text: 'Logit Smartbot', web_app: { url: this.webAppUrl } }], ], }, }); console.log(`Start message sent to ${chatId}`); } catch (error: any) { if (error.response && error.response.statusCode === 403) { console.log(`User ${chatId} has blocked the bot`); // Handle the blocked user case (e.g., remove from active users list) } else { console.error('Error sending message:', error); } } } }); // Set up error handler for the bot this.bot.on('polling_error', (error) => { console.error('Telegram polling error:', error); }); } // Method to send a message to a specific chat public async sendMessage( chatId: number | string, text: string, options?: any ): Promise<any> { if (!this.bot) { console.error('Bot is not initialized'); return null; } try { return await this.bot.sendMessage(chatId, text, options); } catch (error) { console.error('Error sending message:', error); return null; } } // Method to stop the bot (useful for graceful shutdown) public stopBot(): void { if (this.bot) { this.bot.stopPolling(); this.isInitialized = false; console.log('Telegram bot stopped'); } } } // Export the singleton instance export const telegramBotService = TelegramBotService.getInstance(); // Export the bot directly for convenience export default telegramBotService;
```

# lib\userswitcherutils.ts

```ts
/** * Utility functions for the user switcher */ export const SELECTED_TEST_USER_KEY = 'selectedTestUser'; /** * Enable the user switcher in any environment */ export const enableUserSwitcher = () => { localStorage.setItem('enableUserSwitcher', 'true'); window.location.reload(); }; /** * Disable the user switcher */ export const disableUserSwitcher = () => { localStorage.removeItem('enableUserSwitcher'); localStorage.removeItem(SELECTED_TEST_USER_KEY); window.location.reload(); }; /** * Check if user switcher is enabled */ export const isUserSwitcherEnabled = () => { return localStorage.getItem('enableUserSwitcher') === 'true'; }; /** * Get the selected test user ID */ export const getSelectedTestUser = () => { return localStorage.getItem(SELECTED_TEST_USER_KEY); }; /** * Set the selected test user ID */ export const setSelectedTestUser = (userId: string) => { localStorage.setItem(SELECTED_TEST_USER_KEY, userId); }; /** * Clear the selected test user (but keep user switcher enabled) */ export const clearSelectedTestUser = () => { localStorage.removeItem(SELECTED_TEST_USER_KEY); }; /** * Completely reset the user switcher and all related data */ export const resetUserSwitcher = () => { localStorage.removeItem('enableUserSwitcher'); localStorage.removeItem(SELECTED_TEST_USER_KEY); localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); localStorage.removeItem('telegram_id'); localStorage.removeItem('logit_user_state'); };
```

# lib\utils.ts

```ts
import { clsx, type ClassValue } from 'clsx'; import { twMerge } from 'tailwind-merge'; export function cn(...inputs: ClassValue[]) { return twMerge(clsx(inputs)); } export const formatDate = (date: Date | string): string => { const d = new Date(date); return d.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', }); }; export const formatCurrency = ( amount: number, currency: string = 'USD' ): string => { return new Intl.NumberFormat('ru-RU', { style: 'currency', currency, minimumFractionDigits: 0, maximumFractionDigits: 0, }).format(amount); }; export const generateId = (): string => { return Math.random().toString(36).substr(2, 9); }; export const formatPhoneNumber = (phone: string): string => { const cleaned = phone.replace(/\D/g, ''); if (cleaned.length === 0) return ''; let formatted = cleaned; if (cleaned.length >= 11) { formatted = `+${cleaned.slice(0, 1)} (${cleaned.slice( 1, 4 )}) ${cleaned.slice(4, 7)}-${cleaned.slice(7, 9)}-${cleaned.slice(9, 11)}`; } return formatted; }; export const isValidEmail = (email: string): boolean => { const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; return re.test(email); }; export const truncateText = (text: string, maxLength: number): string => { if (text.length <= maxLength) return text; return text.slice(0, maxLength) + '...'; }; export const debounce = <T extends (...args: any[]) => any>( func: T, wait: number ): ((...args: Parameters<T>) => void) => { let timeout: NodeJS.Timeout; return (...args: Parameters<T>) => { clearTimeout(timeout); timeout = setTimeout(() => func(...args), wait); }; }; export const getDistanceInKm = ( lat1: number, lon1: number, lat2: number, lon2: number ): number => { const R = 6371; // Earth's radius in km const dLat = ((lat2 - lat1) * Math.PI) / 180; const dLon = ((lon2 - lon1) * Math.PI) / 180; const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos((lat1 * Math.PI) / 180) * Math.cos((lat2 * Math.PI) / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2); const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); return Math.round(R * c); }; export const validatePassword = (password: string): boolean => { const minLength = 8; const hasUpperCase = /[A-Z]/.test(password); const hasLowerCase = /[a-z]/.test(password); const hasNumbers = /\d/.test(password); return ( password.length >= minLength && hasUpperCase && hasLowerCase && hasNumbers ); }; export const getCityTimezone = (city: string): string => { const timezones: Record<string, string> = { Москва: 'Europe/Moscow', 'Санкт-Петербург': 'Europe/Moscow', Ташкент: 'Asia/Tashkent', Самарканд: 'Asia/Samarkand', Бухара: 'Asia/Bukhara', }; return timezones[city] || 'UTC'; }; export const formatFileSize = (bytes: number): string => { if (bytes === 0) return '0 Bytes'; const k = 1024; const sizes = ['Bytes', 'KB', 'MB', 'GB']; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]; };
```

# next-env.d.ts

```ts
/// <reference types="next" /> /// <reference types="next/image-types/global" /> // NOTE: This file should not be edited // see https://nextjs.org/docs/app/building-your-application/configuring/typescript for more information.
```

# next.config.mjs

```mjs
/** @type {import('next').NextConfig} */ const nextConfig = {}; export default nextConfig;
```

# package.json

```json
{ "name": "logit", "version": "0.1.0", "private": true, "scripts": { "dev": "ts-node -r dotenv/config -r tsconfig-paths/register --project tsconfig.server.json server.ts", "build": "next build", "start": "NODE_ENV=production ts-node -r dotenv/config -r tsconfig-paths/register --project tsconfig.server.json server.ts", "lint": "next lint" }, "dependencies": { "@hookform/resolvers": "^4.1.2", "@radix-ui/react-accordion": "^1.2.0", "@radix-ui/react-alert-dialog": "^1.1.5", "@radix-ui/react-avatar": "^1.1.1", "@radix-ui/react-checkbox": "^1.1.2", "@radix-ui/react-dialog": "^1.1.6", "@radix-ui/react-label": "^2.1.2", "@radix-ui/react-popover": "^1.1.6", "@radix-ui/react-progress": "^1.1.1", "@radix-ui/react-radio-group": "^1.2.3", "@radix-ui/react-scroll-area": "^1.2.0", "@radix-ui/react-select": "^2.1.1", "@radix-ui/react-separator": "^1.1.1", "@radix-ui/react-slider": "^1.2.3", "@radix-ui/react-slot": "^1.1.2", "@radix-ui/react-switch": "^1.1.3", "@radix-ui/react-tabs": "^1.1.3", "@react-three/cannon": "^6.6.0", "@react-three/drei": "^9.121.4", "@react-three/fiber": "^8.17.14", "@types/bcryptjs": "^2.4.6", "@types/cors": "^2.8.17", "@types/express": "^5.0.0", "@types/jsonwebtoken": "^9.0.8", "@types/node-telegram-bot-api": "^0.64.7", "@types/react-date-range": "^1.4.9", "axios": "^1.7.9", "bcryptjs": "^2.4.3", "cannon-es": "^0.20.0", "class-variance-authority": "^0.7.0", "clsx": "^2.1.1", "cmdk": "^1.0.0", "cors": "^2.8.5", "date-fns": "^4.1.0", "dotenv": "^16.4.7", "draco3dgltf": "^1.2.7", "express": "^4.21.2", "framer-motion": "^11.11.1", "guify": "^0.15.1", "jsonwebtoken": "^9.0.2", "leva": "^0.10.0", "lucide-react": "^0.446.0", "mongoose": "^8.9.5", "next": "14.2.13", "node-telegram-bot-api": "^0.66.0", "react": "^18", "react-date-range": "^2.0.1", "react-day-picker": "^8.10.1", "react-dom": "^18", "react-hook-form": "^7.54.2", "sonner": "^1.7.2", "tailwind-merge": "^2.5.2", "tailwindcss-animate": "^1.0.7", "three": "^0.172.0", "ts-node": "^10.9.2", "tsconfig-paths": "^4.2.0", "zod": "^3.24.2" }, "devDependencies": { "@types/node": "^20", "@types/react": "^18", "@types/react-dom": "^18", "@types/three": "^0.173.0", "postcss": "^8", "tailwindcss": "^3.4.1", "typescript": "^5" } }
```

# postcss.config.mjs

```mjs
/** @type {import('postcss-load-config').Config} */ const config = { plugins: { tailwindcss: {}, }, }; export default config;
```

# README.md

```md
# Logit Platform - Logistics Management System ![Logit Platform](logit\app\blue.png) ## Overview Logit Platform is a comprehensive logistics management system designed to streamline cargo transportation and logistics operations. The platform connects cargo owners, carriers, logistics companies, and logistics students in a unified ecosystem. ## 🌟 Key Features ### Authentication & User Management - Telegram WebApp authentication integration - Multi-role user system (Carriers, Cargo Owners, Logistics Companies, Students) - Profile management with document verification - Role-based access control - Language selection (Russian/Uzbek) ### Cargo Management - Create and manage cargo listings - Advanced cargo search with filtering - Real-time cargo status tracking - Multi-point route support - Automatic cargo matching with carriers - Price negotiation system - Document management for cargo ### Vehicle Management - Detailed vehicle registration and management - Vehicle document verification - Technical specifications tracking - Vehicle availability management - ADR/TIR/DOZVOL certification support - Vehicle inspection history ### Carrier Features - Vehicle fleet management - Cargo acceptance/rejection system - Real-time cargo notifications - Document upload and verification - Route planning and tracking - Availability management ### Student Features - Access to logistics training - Supervised cargo management - Learning progression tracking - Practice with real cargo listings - Mentor assignment system ### Platform Features - Real-time notifications - Favorites system - Rating and review system - Distance calculation - Advanced search filters - Document verification system - Multi-language support - Telegram group integration ## 🔧 Technology Stack ### Frontend - Next.js 14 (App Router) - TypeScript - TailwindCSS - Shadcn/ui Components - Telegram WebApp SDK - React Query - Axios - Framer Motion ### Backend - Django - Django REST Framework - PostgreSQL - Redis - Celery - JWT Authentication - Swagger/OpenAPI ## 📦 Installation ### Prerequisites - Node.js 18+ - Python 3.10+ - PostgreSQL - Redis - Telegram Bot Token ### Frontend Setup 1. Clone the repository: \`\`\`bash git clone https://github.com/HumoyunXujaev/logit-fronttt cd logit \`\`\` 2. Install dependencies: \`\`\`bash npm install \`\`\` 3. Create .env.local: \`\`\`env NEXT_PUBLIC_API_URL=http://localhost:8000/api NEXT_PUBLIC_TELEGRAM_BOT_TOKEN=your_telegram_bot_token \`\`\` 4. Run development server: \`\`\`bash npm run dev \`\`\` 5. setup ngrok (telegram web app doesn't work with localhost): \`\`\`bash ngrok http 3000 \`\`\` ### Backend Setup 1. Clone the repository: \`\`\`bash git clone https://github.com/HumoyunXujaev/logit-backend/ cd logit_backend \`\`\` 2. Create virtual environment: \`\`\`bash python -m venv venv source venv/bin/activate # Linux/Mac venv\Scripts\activate # Windows \`\`\` 3. Install dependencies: \`\`\`bash pip install -r requirements.txt \`\`\` 4. Create .env: \`\`\`env DJANGO_SECRET_KEY=your_secret_key DJANGO_DEBUG=True TELEGRAM_BOT_TOKEN=your_telegram_bot_token POSTGRES_DB=logit_db POSTGRES_USER=postgres POSTGRES_PASSWORD=postgres POSTGRES_HOST=localhost POSTGRES_PORT=5432 \`\`\` 5. Run migrations: \`\`\`bash python manage.py makemigrations \`\`\` \`\`\`bash python manage.py migrate \`\`\` 6. Start development server: \`\`\`bash python manage.py runserver \`\`\` ## 🏗 Project Structure ### Backend Structure \`\`\` ├── cargo/ # Cargo management ├── vehicles/ # Vehicle management ├── users/ # User management ├── core/ # Core functionality └── logit_backend/ # Project settings \`\`\` ## 🚀 Features In Detail ### User Registration Flow 1. User opens Telegram bot 2. Selects language preference 3. Chooses user type (Individual/Legal Entity) 4. Selects role (Carrier/Cargo Owner/etc.) 5. Fills profile information 6. Uploads required documents 7. Awaits verification (if required) ### Cargo Management Flow 1. Cargo owner creates cargo listing 2. System processes and validates cargo information 3. Students can view and manage cargo listings 4. Students can match cargo with carriers 5. Carriers receive notification and can accept/reject 6. System tracks cargo status throughout delivery ### Vehicle Management Flow 1. Carrier registers vehicles 2. Uploads required documentation 3. System verifies vehicle information 4. Carrier can update vehicle availability 5. System matches vehicles with compatible cargo 6. Tracks vehicle status and documents expiry ### Student Learning Flow 1. Student registers with group information 2. Gets assigned to mentor 3. Can view and practice with real cargo listings 4. Manages cargo-carrier matching 5. Receives feedback from mentors 6. Tracks learning progress ## 🔐 Security - JWT-based authentication - Role-based access control - Document verification system - Secure file uploads - HTTPS encryption - Input validation - Rate limiting - Session management ## 📱 Mobile Responsiveness The platform is fully responsive and optimized for: - Desktop browsers - Mobile devices - Telegram WebApp - Tablets ## 🌐 API Documentation API documentation is available at: - Swagger UI: `/api/docs/` - ReDoc: `/api/redoc/` ## 🤝 Contributing Please read [CONTRIBUTING.md](CONTRIBUTING.md) for details on our code of conduct and the process for submitting pull requests. ## 📄 License This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details ## 👥 Team - Product Owner: [Name] - Lead Developer: [Name] - Backend Developer: [Name] - Frontend Developer: [Name] - UI/UX Designer: [Name] ## 📞 Support For support, please contact: - Email: support@logit.com - Telegram: @logit_support - Website: https://logit.com/support ## 🌟 Acknowledgments - Telegram for WebApp SDK - Shadcn for UI components - All contributors and testers ## 🗺 Roadmap ### Phase 1 (Current) - Core platform functionality - Basic cargo management - Vehicle registration - User authentication ### Phase 2 (Planned) - Advanced analytics - Mobile applications - Real-time tracking - Payment integration - AI-powered matching ### Phase 3 (Future) - International expansion - Blockchain integration - IoT device support - Advanced automation ## ⚙ Configuration ### Environment Variables #### Frontend \`\`\`env NEXT_PUBLIC_API_URL= NEXT_PUBLIC_TELEGRAM_BOT_TOKEN= \`\`\` #### Backend \`\`\`env DJANGO_SECRET_KEY= DJANGO_DEBUG= TELEGRAM_BOT_TOKEN= POSTGRES_DB= POSTGRES_USER= POSTGRES_PASSWORD= POSTGRES_HOST= POSTGRES_PORT= \`\`\` --- **Note**: This project is actively maintained and regularly updated. For the latest features and changes, please check the CHANGELOG.md file.
```

# server.ts

```ts
// Load environment variables first before importing other modules import * as dotenv from 'dotenv'; // Load from .env.local and fallback to .env dotenv.config({ path: '.env.local' }); dotenv.config({ path: '.env' }); import { createServer } from 'http'; import { parse } from 'url'; import next from 'next'; import telegramBotService from './lib/telegram-bot'; const dev = process.env.NODE_ENV !== 'production'; const hostname = 'localhost'; const port = process.env.PORT ? parseInt(process.env.PORT, 10) : 3000; // Validate critical environment variables if (!process.env.TELEGRAM_BOT_TOKEN) { console.error( 'ERROR: TELEGRAM_BOT_TOKEN is required. Please set it in .env.local or .env file.' ); } if (!process.env.NEXT_PUBLIC_WEB_APP_URL) { console.error( 'ERROR: NEXT_PUBLIC_WEB_APP_URL is required. Please set it in .env.local or .env file.' ); } // Initialize the Next.js app const app = next({ dev, hostname, port }); const handle = app.getRequestHandler(); app.prepare().then(() => { // Start the Telegram bot only if we're not in development or if explicitly enabled const shouldStartBot = process.env.NODE_ENV !== 'development' || process.env.ENABLE_TELEGRAM_BOT === 'true'; if (shouldStartBot) { console.log('Starting Telegram bot...'); const bot = telegramBotService.startBot(); if (bot) { console.log('Telegram bot started successfully'); } else { console.error('Failed to start Telegram bot'); } } else { console.log('Telegram bot not started (development mode)'); } // Create the HTTP server createServer(async (req: any, res: any) => { try { const parsedUrl = parse(req.url!, true); await handle(req, res, parsedUrl); } catch (err) { console.error('Error occurred handling', req.url, err); res.statusCode = 500; res.end('Internal server error'); } }) .once('error', (err: any) => { console.error('Server error:', err); process.exit(1); }) .listen(port, () => { console.log(`> Ready on http://${hostname}:${port}`); }); // Set up graceful shutdown const shutdownGracefully = () => { console.log('Shutting down gracefully...'); telegramBotService.stopBot(); process.exit(0); }; // Handle termination signals process.on('SIGTERM', shutdownGracefully); process.on('SIGINT', shutdownGracefully); });
```

# tailwind.config.ts

```ts
// tailwind.config.ts import type { Config } from 'tailwindcss'; const config: Config = { darkMode: 'class', content: [ './pages/**/*.{js,ts,jsx,tsx,mdx}', './components/**/*.{js,ts,jsx,tsx,mdx}', './app/**/*.{js,ts,jsx,tsx,mdx}', ], theme: { extend: { colors: { background: { DEFAULT: 'var(--background)', secondary: 'var(--background-secondary)', }, foreground: { DEFAULT: 'var(--foreground)', secondary: 'var(--foreground-secondary)', }, primary: { DEFAULT: 'var(--primary)', foreground: 'var(--primary-foreground)', }, secondary: { DEFAULT: 'var(--secondary)', foreground: 'var(--secondary-foreground)', }, muted: { DEFAULT: 'var(--muted)', foreground: 'var(--muted-foreground)', }, accent: { DEFAULT: 'var(--accent)', foreground: 'var(--accent-foreground)', }, destructive: { DEFAULT: 'var(--destructive)', foreground: 'var(--destructive-foreground)', }, border: 'var(--border)', input: 'var(--input)', ring: 'var(--ring)', }, animation: { 'accordion-down': 'accordion-down 0.2s ease-out', 'accordion-up': 'accordion-up 0.2s ease-out', 'fade-in': 'fade-in 0.3s ease-out', 'fade-out': 'fade-out 0.2s ease-in', 'slide-in': 'slide-in 0.3s ease-out', 'slide-out': 'slide-out 0.2s ease-in', }, keyframes: { 'accordion-down': { from: { height: '0' }, to: { height: 'var(--radix-accordion-content-height)' }, }, 'accordion-up': { from: { height: 'var(--radix-accordion-content-height)' }, to: { height: '0' }, }, 'fade-in': { '0%': { opacity: '0' }, '100%': { opacity: '1' }, }, 'fade-out': { '0%': { opacity: '1' }, '100%': { opacity: '0' }, }, 'slide-in': { '0%': { transform: 'translateY(10px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' }, }, 'slide-out': { '0%': { transform: 'translateY(0)', opacity: '1' }, '100%': { transform: 'translateY(-10px)', opacity: '0' }, }, }, }, }, plugins: [require('tailwindcss-animate')], }; export default config;
```

# tsconfig.json

```json
{ "compilerOptions": { "lib": ["dom", "dom.iterable", "esnext"], "allowJs": true, "skipLibCheck": true, "strict": true, "noEmit": true, "esModuleInterop": true, "module": "esnext", "moduleResolution": "bundler", "resolveJsonModule": true, "isolatedModules": true, "jsx": "preserve", "incremental": true, // "typeRoots": ["node_modules/@types", "types"], "plugins": [ { "name": "next" } ], "paths": { "@/*": ["./*"] } }, "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"], "exclude": ["node_modules"] }
```

# tsconfig.server.json

```json
{ "extends": "./tsconfig.json", "compilerOptions": { "module": "commonjs", "outDir": "dist", "noEmit": false, "isolatedModules": false, "paths": { "@/*": ["./*"] } }, "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"], }
```

# types\index.ts

```ts
export type UserType = 'individual' | 'legal'; export type UserRole = | 'student' | 'carrier' | 'cargo-owner' | 'logistics-company' | 'transport-company' | 'logit-trans'; export type Language = 'ru' | 'uz'; export interface UserState { type?: UserType; role?: UserRole; language?: Language; isAuthenticated?: boolean; userData?: { photo?: string; companyName?: string; fullName?: string; telegramNumber?: string; whatsappNumber?: string; phoneNumber?: string; position?: string; registrationCertificate?: string; studentStatus?: string; city?: string; tariff?: string; groupName?: string; studyLanguage?: string; curatorName?: string; endDate?: string; }; }
```