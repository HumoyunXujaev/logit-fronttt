# app\api\upload\route.ts

```ts
import { NextRequest, NextResponse } from 'next/server'; import { writeFile } from 'fs/promises'; import { join } from 'path'; import { ValidationError } from '@/lib/errors'; import { withAuth } from '@/middleware/auth'; import { JWTPayload } from '@/lib/jwt'; // Поддерживаемые типы файлов const ALLOWED_TYPES = [ 'image/jpeg', 'image/png', 'image/webp', 'application/pdf', ]; // Максимальный размер файла (5MB) const MAX_FILE_SIZE = 5 * 1024 * 1024; async function handler(request: NextRequest, payload: JWTPayload) { try { const formData = await request.formData(); const file = formData.get('file') as File; const type = formData.get('type') as string; if (!file) { throw new ValidationError('No file provided'); } if (!type) { throw new ValidationError('File type is required'); } // Проверка типа файла if (!ALLOWED_TYPES.includes(file.type)) { throw new ValidationError('File type not allowed'); } // Проверка размера файла if (file.size > MAX_FILE_SIZE) { throw new ValidationError('File size exceeds limit'); } // Создаем уникальное имя файла const timestamp = Date.now(); const filename = `${payload.userId}_${timestamp}_${file.name}`; // Определяем путь для сохранения const uploadDir = join(process.cwd(), 'public', 'uploads'); const filePath = join(uploadDir, filename); // Читаем содержимое файла const bytes = await file.arrayBuffer(); const buffer = Buffer.from(bytes); // Сохраняем файл await writeFile(filePath, buffer); // URL для доступа к файлу const fileUrl = `/uploads/${filename}`; return NextResponse.json( { url: fileUrl, type: file.type, size: file.size, }, { status: 201 } ); } catch (error) { if (error instanceof ValidationError) { return NextResponse.json( { error: error.message }, { status: error.statusCode } ); } console.error('File upload error:', error); return NextResponse.json( { error: 'Internal server error' }, { status: 500 } ); } } // Export with auth middleware export const POST = withAuth(handler);
```

# app\cargos\page.tsx

```tsx
// 'use client'; // import React, { useState, useEffect } from 'react'; // import { Button } from '@/components/ui/button'; // import { Input } from '@/components/ui/input'; // import { // Select, // SelectContent, // SelectItem, // SelectTrigger, // SelectValue, // } from '@/components/ui/select'; // import { Textarea } from '@/components/ui/textarea'; // import { // Dialog, // DialogContent, // DialogHeader, // DialogTitle, // } from '@/components/ui/dialog'; // import { Checkbox } from '@/components/ui/checkbox'; // import { Card, CardContent } from '@/components/ui/card'; // import { Badge } from '@/components/ui/badge'; // import { ScrollArea } from '@/components/ui/scroll-area'; // import { // X, // Plus, // TruckIcon, // MapPinIcon, // CalendarIcon, // CreditCardIcon, // BellIcon, // } from 'lucide-react'; // import NavigationMenu from '../components/NavigationMenu'; // import { Router } from 'next/router'; // import { useRouter } from 'next/navigation'; // import Link from 'next/link'; // import { useUser } from '@/contexts/UserContext'; // interface CargoFormData { // cargo: { // name: string; // weight: string; // volume: string; // length: string; // width: string; // height: string; // diameter: string; // packaging: string; // notes: string; // }; // route: { // loading: string; // unloading: string; // }; // transport: { // bodyType: string; // loadingType: string; // }; // when: { // loadingDates: string; // isConstant: boolean; // isReady: boolean; // }; // payment: { // method: string; // options: string[]; // }; // notifications: { // enabled: boolean; // }; // } // const initialFormData: CargoFormData = { // cargo: { // name: '', // weight: '', // volume: '', // length: '', // width: '', // height: '', // diameter: '', // packaging: '', // notes: '', // }, // route: { loading: '', unloading: '' }, // transport: { bodyType: '', loadingType: '' }, // when: { loadingDates: '', isConstant: false, isReady: false }, // payment: { method: '', options: [] }, // notifications: { enabled: false }, // }; // const sections = [ // { id: 'cargo', title: 'Груз', icon: TruckIcon }, // { id: 'route', title: 'Маршрут', icon: MapPinIcon }, // { id: 'transport', title: 'Транспорт', icon: TruckIcon }, // { id: 'when', title: 'Когда', icon: CalendarIcon }, // { id: 'payment', title: 'Оплата', icon: CreditCardIcon }, // { id: 'notifications', title: 'Уведомления', icon: BellIcon }, // ]; // type CargoSection = { // name: string; // weight: string; // volume: string; // length: string; // width: string; // height: string; // diameter: string; // packaging: string; // notes: string; // }; // type RouteSection = { // loading: string; // unloading: string; // }; // type TransportSection = { // bodyType: string; // loadingType: string; // }; // type WhenSection = { // loadingDates: string; // isConstant: boolean; // isReady: boolean; // }; // type PaymentSection = { // method: string; // options: string[]; // }; // type NotificationsSection = { // enabled: boolean; // }; // // Обновленный интерфейс CargoFormData // interface CargoFormData { // cargo: CargoSection; // route: RouteSection; // transport: TransportSection; // when: WhenSection; // payment: PaymentSection; // notifications: NotificationsSection; // } // export default function MyCargoPage() { // const [isAddingCargo, setIsAddingCargo] = useState<boolean>(false); // const [cargoCount, setCargoCount] = useState<number>(1); // const { userState } = useUser(); // const [formData, setFormData] = useState<CargoFormData>(initialFormData); // const [activeSection, setActiveSection] = useState<string>('cargo'); // const [isDialogOpen, setIsDialogOpen] = useState<boolean>(false); // const [isAllFilled, setIsAllFilled] = useState<boolean>(false); // const router = useRouter(); // useEffect(() => { // checkAllFilled(); // }, [formData]); // const checkAllFilled = () => { // const isFilled = Object.values(formData).every((section) => // Object.values(section).every((value) => // typeof value === 'boolean' // ? true // : Array.isArray(value) // ? value.length > 0 // : value !== '' // ) // ); // setIsAllFilled(isFilled); // }; // const handleInputChange = ( // section: keyof CargoFormData, // field: string, // value: string | boolean | string[] // ) => { // setFormData((prev) => ({ // ...prev, // [section]: { // ...prev[section], // [field]: value, // }, // })); // }; // const clearSection = (section: keyof CargoFormData) => { // setFormData((prev) => ({ // ...prev, // [section]: initialFormData[section], // })); // }; // const goToNextSection = () => { // const currentIndex = sections.findIndex( // (section) => section.id === activeSection // ); // if (currentIndex < sections.length - 1) { // setActiveSection(sections[currentIndex + 1].id); // } else { // setIsDialogOpen(false); // } // }; // // Типы-защитники // function isCargo(section: any): section is CargoSection { // return 'name' in section && 'weight' in section && 'volume' in section; // } // function isRoute(section: any): section is RouteSection { // return 'loading' in section && 'unloading' in section; // } // function isTransport(section: any): section is TransportSection { // return 'bodyType' in section && 'loadingType' in section; // } // function isWhen(section: any): section is WhenSection { // return ( // 'loadingDates' in section && // 'isConstant' in section && // 'isReady' in section // ); // } // function isPayment(section: any): section is PaymentSection { // return ( // 'method' in section && // 'options' in section && // Array.isArray(section.options) // ); // } // function isNotifications(section: any): section is NotificationsSection { // return 'enabled' in section; // } // // Обновленная функция getSectionSummary // const getSectionSummary = (sectionId: keyof CargoFormData): string => { // const sectionData = formData[sectionId]; // if (isCargo(sectionData)) { // return sectionData.name // ? `${sectionData.name}, ${sectionData.weight} ${sectionData.volume}` // : ''; // } // if (isRoute(sectionData)) { // return sectionData.loading && sectionData.unloading // ? `${sectionData.loading} - ${sectionData.unloading}` // : ''; // } // if (isTransport(sectionData)) { // return sectionData.bodyType || sectionData.loadingType // ? `${sectionData.bodyType || ''}, ${sectionData.loadingType || ''}` // .trim() // .replace(/^,\s|,\s$/g, '') // : ''; // } // if (isWhen(sectionData)) { // return sectionData.loadingDates // ? `${sectionData.loadingDates}${ // sectionData.isConstant ? ', постоянно' : '' // }` // : ''; // } // if (isPayment(sectionData)) { // return sectionData.method // ? `${sectionData.method}, ${sectionData.options.join(', ')}` // : ''; // } // if (isNotifications(sectionData)) { // return sectionData.enabled ? 'Включены' : 'Выключены'; // } // return ''; // }; // const renderSectionButton = (section: { // id: string; // title: string; // icon: React.ElementType; // }) => { // const Icon = section.icon; // const summary = getSectionSummary(section.id as keyof CargoFormData); // return ( // <Button // key={section.id} // variant='outline' // className='w-full text-left justify-start items-center flex p-4 h-auto' // onClick={() => { // setActiveSection(section.id); // setIsDialogOpen(true); // }} // > // <Icon className='mr-2 h-5 w-5' /> // <div className='flex flex-col items-start'> // <span className='font-semibold'>{section.title}</span> // {summary && ( // <span className='text-sm text-gray-500 mt-1 truncate w-full'> // {summary} // </span> // )} // </div> // </Button> // ); // }; // const renderCargoContent = () => ( // <div className='space-y-4'> // <Input // placeholder='Название груза*' // value={formData.cargo.name} // onChange={(e) => handleInputChange('cargo', 'name', e.target.value)} // /> // <div className='grid grid-cols-2 gap-2'> // <Input // placeholder='Вес (тонн/кг)*' // value={formData.cargo.weight} // onChange={(e) => handleInputChange('cargo', 'weight', e.target.value)} // /> // <Input // placeholder='Объем (м³)*' // value={formData.cargo.volume} // onChange={(e) => handleInputChange('cargo', 'volume', e.target.value)} // /> // </div> // <div className='grid grid-cols-2 gap-2'> // <Input // placeholder='Длина' // value={formData.cargo.length} // onChange={(e) => handleInputChange('cargo', 'length', e.target.value)} // /> // <Input // placeholder='Ширина' // value={formData.cargo.width} // onChange={(e) => handleInputChange('cargo', 'width', e.target.value)} // /> // <Input // placeholder='Высота' // value={formData.cargo.height} // onChange={(e) => handleInputChange('cargo', 'height', e.target.value)} // /> // <Input // placeholder='Диаметр' // value={formData.cargo.diameter} // onChange={(e) => // handleInputChange('cargo', 'diameter', e.target.value) // } // /> // </div> // <Input // placeholder='Упаковка' // value={formData.cargo.packaging} // onChange={(e) => // handleInputChange('cargo', 'packaging', e.target.value) // } // /> // <Textarea // placeholder='Примечание' // value={formData.cargo.notes} // onChange={(e) => handleInputChange('cargo', 'notes', e.target.value)} // /> // </div> // ); // const renderRouteContent = () => ( // <div className='space-y-4'> // <Input // placeholder='Погрузка*' // value={formData.route.loading} // onChange={(e) => handleInputChange('route', 'loading', e.target.value)} // /> // <Input // placeholder='Выгрузка*' // value={formData.route.unloading} // onChange={(e) => // handleInputChange('route', 'unloading', e.target.value) // } // /> // </div> // ); // const renderTransportContent = () => ( // <div className='space-y-4'> // <Select // onValueChange={(value) => // handleInputChange('transport', 'bodyType', value) // } // > // <SelectTrigger> // <SelectValue placeholder='Тип кузова' /> // </SelectTrigger> // <SelectContent> // <SelectItem value='isothermal'>Изотермический</SelectItem> // <SelectItem value='tented'>Тентованный</SelectItem> // <SelectItem value='container'>Контейнер</SelectItem> // <SelectItem value='van'>Фургон</SelectItem> // </SelectContent> // </Select> // <Select // onValueChange={(value) => // handleInputChange('transport', 'loadingType', value) // } // > // <SelectTrigger> // <SelectValue placeholder='Тип погрузки' /> // </SelectTrigger> // <SelectContent> // <SelectItem value='ramps'>Аппарели</SelectItem> // <SelectItem value='no-doors'>Без ворот</SelectItem> // <SelectItem value='side'>Боковая</SelectItem> // <SelectItem value='top'>Верхняя</SelectItem> // <SelectItem value='hydroboard'>Гидроборт</SelectItem> // </SelectContent> // </Select> // </div> // ); // const renderWhenContent = () => ( // <div className='space-y-4'> // <Input // type='date' // placeholder='Дата погрузки*' // value={formData.when.loadingDates} // onChange={(e) => // handleInputChange('when', 'loadingDates', e.target.value) // } // /> // <div className='flex items-center space-x-2'> // <Checkbox // id='constant' // checked={formData.when.isConstant} // onCheckedChange={(checked) => // handleInputChange('when', 'isConstant', Boolean(checked)) // } // /> // <label htmlFor='constant'>Постоянно</label> // </div> // <div className='flex items-center space-x-2'> // <Checkbox // id='ready' // checked={formData.when.isReady} // onCheckedChange={(checked) => // handleInputChange('when', 'isReady', Boolean(checked)) // } // /> // <label htmlFor='ready'>Груз готов</label> // </div> // </div> // ); // const renderPaymentContent = () => ( // <div className='space-y-4'> // <Select // onValueChange={(value) => handleInputChange('payment', 'method', value)} // > // <SelectTrigger> // <SelectValue placeholder='Метод оплаты' /> // </SelectTrigger> // <SelectContent> // <SelectItem value='cash'>Наличные</SelectItem> // <SelectItem value='card'>Карта</SelectItem> // <SelectItem value='transfer'>Перечисление</SelectItem> // <SelectItem value='advance'>Аванс</SelectItem> // </SelectContent> // </Select> // <div className='space-y-2'> // {[ // 'Возможен торг', // 'Оплата на выгрузке', // 'Оплата после выгрузки', // 'Через несколько банковских дней', // 'Запрос ставки', // ].map((option) => ( // <div key={option} className='flex items-center space-x-2'> // <Checkbox // id={option} // checked={formData.payment.options.includes(option)} // onCheckedChange={(checked) => { // const newOptions = checked // ? [...formData.payment.options, option] // : formData.payment.options.filter((item) => item !== option); // handleInputChange('payment', 'options', newOptions); // }} // /> // <label htmlFor={option}>{option}</label> // </div> // ))} // </div> // </div> // ); // const renderNotificationsContent = () => ( // <div className='space-y-4'> // <div className='flex items-center space-x-2'> // <Checkbox // id='notifications' // checked={formData.notifications.enabled} // onCheckedChange={(checked) => // handleInputChange('notifications', 'enabled', Boolean(checked)) // } // /> // <label htmlFor='notifications'>Включить уведомления</label> // </div> // </div> // ); // const renderContent = () => { // switch (activeSection) { // case 'cargo': // return renderCargoContent(); // case 'route': // return renderRouteContent(); // case 'transport': // return renderTransportContent(); // case 'when': // return renderWhenContent(); // case 'payment': // return renderPaymentContent(); // case 'notifications': // return renderNotificationsContent(); // default: // return null; // } // }; // return ( // <div className='min-h-screen bg-gray-50 p-4 pb-20'> // <h1 className='text-3xl font-bold text-center mb-6 text-gray-800'> // Мои грузы // </h1> // <div className='space-y-4 mb-8'> // <Button // onClick={() => setIsAddingCargo(true)} // className='w-full bg-blue-600 hover:bg-blue-700 text-white' // > // <Plus className='mr-2 h-4 w-4' /> Добавить груз // </Button> // <Button // variant='outline' // className='w-full' // onClick={() => { // router.push('/my-cargo'); // }} // > // <TruckIcon className='mr-2 h-4 w-4' /> Мои грузы{' '} // <Badge variant='secondary' className='ml-2'> // {cargoCount} // </Badge> // </Button> // </div> // {isAddingCargo && ( // <Card className='mb-8 shadow-lg'> // <CardContent className='p-6'> // <h2 className='text-2xl font-semibold mb-4 text-gray-800'> // Добавить груз // </h2> // <ScrollArea className='h-[60vh]'> // <div className='space-y-4'> // {sections.map(renderSectionButton)} // </div> // </ScrollArea> // {isAllFilled && ( // <Button // onClick={() => { // router.push('/my-cargo'); // /* Логика публикации */ // }} // className='w-full mt-6 bg-green-600 hover:bg-green-700 text-white' // > // Опубликовать // </Button> // )} // </CardContent> // </Card> // )} // <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}> // <DialogContent className='sm:max-w-[425px]'> // <DialogHeader> // <DialogTitle> // {sections.find((s) => s.id === activeSection)?.title} // </DialogTitle> // </DialogHeader> // <ScrollArea className='max-h-[60vh] pr-4'> // {renderContent()} // </ScrollArea> // <div className='flex justify-between mt-6'> // <Button // variant='outline' // onClick={() => clearSection(activeSection as keyof CargoFormData)} // > // <X className='mr-2 h-4 w-4' /> Очистить // </Button> // <Button onClick={goToNextSection}> // Далее <Plus className='ml-2 h-4 w-4' /> // </Button> // </div> // </DialogContent> // </Dialog> // <NavigationMenu // userRole={userState.role === 'carrier' ? 'carrier' : 'other'} // /> // {/* <NavigationMenu userRole={'carrier'} /> */} // </div> // ); // } // app/cargos/page.tsx 'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Textarea } from '@/components/ui/textarea'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Checkbox } from '@/components/ui/checkbox'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { ScrollArea } from '@/components/ui/scroll-area'; import { X, Plus, TruckIcon, MapPinIcon, CalendarIcon, CreditCardIcon, BellIcon, AlertCircle, Loader2, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { useUser } from '@/contexts/UserContext'; import { api } from '@/lib/api'; import { toast } from 'sonner'; import Link from 'next/link'; interface CargoFormData { title: string; description: string; weight: number; volume?: number; length?: number; width?: number; height?: number; loading_point: string; unloading_point: string; additional_points?: { point: string; type: 'loading' | 'unloading' }[]; loading_date: string; is_constant: boolean; is_ready: boolean; vehicle_type: string; loading_type: string; payment_method: string; price?: number; payment_details?: { advance_payment?: number; payment_terms?: string; payment_location?: string; }; } const initialFormData: CargoFormData = { title: '', description: '', weight: 0, loading_point: '', unloading_point: '', loading_date: '', is_constant: false, is_ready: false, vehicle_type: '', loading_type: '', payment_method: '', }; const vehicleTypes = [ { value: 'tent', label: 'Тентованный' }, { value: 'refrigerator', label: 'Рефрижератор' }, { value: 'isothermal', label: 'Изотермический' }, { value: 'container', label: 'Контейнер' }, { value: 'car_carrier', label: 'Автовоз' }, { value: 'board', label: 'Бортовой' }, ]; const loadingTypes = [ { value: 'ramps', label: 'Аппарели' }, { value: 'no_doors', label: 'Без ворот' }, { value: 'side', label: 'Боковая' }, { value: 'top', label: 'Верхняя' }, { value: 'hydro_board', label: 'Гидроборт' }, ]; const paymentMethods = [ { value: 'cash', label: 'Наличные' }, { value: 'card', label: 'Карта' }, { value: 'transfer', label: 'Банковский перевод' }, { value: 'advance', label: 'Аванс' }, ]; const sections = [ { id: 'cargo', title: 'Груз', icon: TruckIcon }, { id: 'route', title: 'Маршрут', icon: MapPinIcon }, { id: 'transport', title: 'Транспорт', icon: TruckIcon }, { id: 'when', title: 'Когда', icon: CalendarIcon }, { id: 'payment', title: 'Оплата', icon: CreditCardIcon }, ]; export default function CargoPage() { const [isAddingCargo, setIsAddingCargo] = useState<boolean>(false); const [formData, setFormData] = useState<CargoFormData>(initialFormData); const [activeSection, setActiveSection] = useState<string>('cargo'); const [isDialogOpen, setIsDialogOpen] = useState<boolean>(false); const [isAllFilled, setIsAllFilled] = useState<boolean>(false); const [isSubmitting, setIsSubmitting] = useState<boolean>(false); const [errors, setErrors] = useState<Record<string, string>>({}); // const [cargoCount, setCargoCount] = useState<number>(0); const { userState } = useUser(); const router = useRouter(); useEffect(() => { validateForm(); }, [formData]); const validateForm = () => { const newErrors: Record<string, string> = {}; const requiredFields = [ 'title', 'weight', 'loading_point', 'unloading_point', 'loading_date', 'vehicle_type', 'loading_type', 'payment_method', ]; requiredFields.forEach((field) => { if (!formData[field as keyof CargoFormData]) { newErrors[field] = 'Это поле обязательно'; } }); if (formData.weight <= 0) { newErrors.weight = 'Вес должен быть больше 0'; } if ( formData.payment_method === 'advance' && !formData.payment_details?.advance_payment ) { newErrors.advance_payment = 'Укажите сумму аванса'; } setErrors(newErrors); setIsAllFilled(Object.keys(newErrors).length === 0); }; const handleInputChange = (name: string, value: any) => { setFormData((prev) => { const updated = { ...prev, [name]: value }; // Calculate volume if dimensions are provided if ( ['length', 'width', 'height'].includes(name) && updated.length && updated.width && updated.height ) { updated.volume = updated.length * updated.width * updated.height; } return updated; }); }; const handlePaymentDetailsChange = (field: string, value: any) => { setFormData((prev) => ({ ...prev, payment_details: { ...prev.payment_details, [field]: value, }, })); }; const handleSubmit = async () => { try { setIsSubmitting(true); validateForm(); if (!isAllFilled) { toast.error('Пожалуйста, заполните все обязательные поля'); return; } const response = await api.createCargo(formData); toast.success('Груз успешно создан'); setIsAddingCargo(false); setFormData(initialFormData); router.push('/my-cargo'); } catch (error: any) { toast.error(error.response?.data?.detail || 'Ошибка при создании груза'); console.error('Create cargo error:', error); } finally { setIsSubmitting(false); } }; const renderCargoContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'> Название груза* </label> <Input placeholder='Название груза' value={formData.title} onChange={(e) => handleInputChange('title', e.target.value)} // error={errors.title} /> {errors.title && ( <p className='text-sm text-red-500 mt-1'>{errors.title}</p> )} </div> <div className='grid grid-cols-2 gap-4'> <div> <label className='block text-sm font-medium mb-2'>Вес (тонн)*</label> <Input type='number' placeholder='Вес' value={formData.weight || ''} onChange={(e) => handleInputChange('weight', parseFloat(e.target.value)) } // error={errors.weight} /> {errors.weight && ( <p className='text-sm text-red-500 mt-1'>{errors.weight}</p> )} </div> <div> <label className='block text-sm font-medium mb-2'>Объем (м³)</label> <Input type='number' placeholder='Объем' value={formData.volume || ''} onChange={(e) => handleInputChange('volume', parseFloat(e.target.value)) } /> </div> </div> <div className='grid grid-cols-3 gap-4'> <div> <label className='block text-sm font-medium mb-2'>Длина (м)</label> <Input type='number' placeholder='Длина' value={formData.length || ''} onChange={(e) => handleInputChange('length', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Ширина (м)</label> <Input type='number' placeholder='Ширина' value={formData.width || ''} onChange={(e) => handleInputChange('width', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Высота (м)</label> <Input type='number' placeholder='Высота' value={formData.height || ''} onChange={(e) => handleInputChange('height', parseFloat(e.target.value)) } /> </div> </div> <div> <label className='block text-sm font-medium mb-2'>Описание</label> <Textarea placeholder='Описание груза' value={formData.description} onChange={(e) => handleInputChange('description', e.target.value)} /> </div> </div> ); const renderRouteContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'> Пункт погрузки* </label> <Input placeholder='Откуда' value={formData.loading_point} onChange={(e) => handleInputChange('loading_point', e.target.value)} // error={errors.loading_point} /> {errors.loading_point && ( <p className='text-sm text-red-500 mt-1'>{errors.loading_point}</p> )} </div> <div> <label className='block text-sm font-medium mb-2'> Пункт выгрузки* </label> <Input placeholder='Куда' value={formData.unloading_point} onChange={(e) => handleInputChange('unloading_point', e.target.value)} // error={errors.unloading_point} /> {errors.unloading_point && ( <p className='text-sm text-red-500 mt-1'>{errors.unloading_point}</p> )} </div> {formData.additional_points?.map((point, index) => ( <div key={index} className='flex items-center gap-2'> <Input placeholder={ point.type === 'loading' ? 'Пункт погрузки' : 'Пункт выгрузки' } value={point.point} onChange={(e) => { const newPoints = [...(formData.additional_points || [])]; newPoints[index].point = e.target.value; handleInputChange('additional_points', newPoints); }} /> <Button variant='outline' size='icon' onClick={() => { const newPoints = formData.additional_points?.filter( (_, i) => i !== index ); handleInputChange('additional_points', newPoints); }} > <X className='h-4 w-4' /> </Button> </div> ))} <Button variant='outline' onClick={() => { const newPoints = [...(formData.additional_points || [])]; newPoints.push({ point: '', type: 'loading' }); handleInputChange('additional_points', newPoints); }} > <Plus className='h-4 w-4 mr-2' /> Добавить точку маршрута </Button> </div> ); const renderTransportContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'> Тип транспорта* </label> <Select value={formData.vehicle_type} onValueChange={(value) => handleInputChange('vehicle_type', value)} > <SelectTrigger className={errors.vehicle_type ? 'border-red-500' : ''} > <SelectValue placeholder='Выберите тип транспорта' /> </SelectTrigger> <SelectContent> {vehicleTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} </SelectItem> ))} </SelectContent> </Select> {errors.vehicle_type && ( <p className='text-sm text-red-500 mt-1'>{errors.vehicle_type}</p> )} </div> <div> <label className='block text-sm font-medium mb-2'>Тип погрузки*</label> <Select value={formData.loading_type} onValueChange={(value) => handleInputChange('loading_type', value)} > <SelectTrigger className={errors.loading_type ? 'border-red-500' : ''} > <SelectValue placeholder='Выберите тип погрузки' /> </SelectTrigger> <SelectContent> {loadingTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} </SelectItem> ))} </SelectContent> </Select> {errors.loading_type && ( <p className='text-sm text-red-500 mt-1'>{errors.loading_type}</p> )} </div> </div> ); const renderWhenContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'>Дата погрузки*</label> <Input type='date' value={formData.loading_date} onChange={(e) => handleInputChange('loading_date', e.target.value)} min={new Date().toISOString().split('T')[0]} // error={errors.loading_date} /> {errors.loading_date && ( <p className='text-sm text-red-500 mt-1'>{errors.loading_date}</p> )} </div> <div className='flex items-center space-x-2'> <Checkbox id='constant' checked={formData.is_constant} onCheckedChange={(checked) => handleInputChange('is_constant', checked) } /> <label htmlFor='constant'>Постоян</label> {/* </div> */} </div> <div className='flex items-center space-x-2'> <Checkbox id='ready' checked={formData.is_ready} onCheckedChange={(checked) => handleInputChange('is_ready', checked)} /> <label htmlFor='ready'>Груз готов к отправке</label> </div> </div> ); const renderPaymentContent = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'>Способ оплаты*</label> <Select value={formData.payment_method} onValueChange={(value) => handleInputChange('payment_method', value)} > <SelectTrigger className={errors.payment_method ? 'border-red-500' : ''} > <SelectValue placeholder='Выберите способ оплаты' /> </SelectTrigger> <SelectContent> {paymentMethods.map((method) => ( <SelectItem key={method.value} value={method.value}> {method.label} </SelectItem> ))} </SelectContent> </Select> {errors.payment_method && ( <p className='text-sm text-red-500 mt-1'>{errors.payment_method}</p> )} </div> <div> <label className='block text-sm font-medium mb-2'>Цена</label> <Input type='number' placeholder='Введите сумму' value={formData.price || ''} onChange={(e) => handleInputChange('price', parseFloat(e.target.value)) } /> </div> {formData.payment_method === 'advance' && ( <div> <label className='block text-sm font-medium mb-2'> Сумма аванса* </label> <div> <Input type='number' placeholder='Введите сумму аванса' value={formData.payment_details?.advance_payment || ''} onChange={(e) => handlePaymentDetailsChange( 'advance_payment', parseFloat(e.target.value) ) } className={errors.advance_payment ? 'border-red-500' : ''} /> {errors.advance_payment && ( <p className='text-sm text-red-500 mt-1'> {errors.advance_payment} </p> )} </div> </div> )} <div> <label className='block text-sm font-medium mb-2'>Условия оплаты</label> <Select value={formData.payment_details?.payment_terms || ''} onValueChange={(value) => handlePaymentDetailsChange('payment_terms', value) } > <SelectTrigger> <SelectValue placeholder='Выберите условия оплаты' /> </SelectTrigger> <SelectContent> <SelectItem value='on_loading'>При погрузке</SelectItem> <SelectItem value='on_unloading'>При выгрузке</SelectItem> <SelectItem value='after_unloading'>После выгрузки</SelectItem> <SelectItem value='delayed'>Отсрочка платежа</SelectItem> </SelectContent> </Select> </div> <div> <label className='block text-sm font-medium mb-2'>Место оплаты</label> <Select value={formData.payment_details?.payment_location || ''} onValueChange={(value) => handlePaymentDetailsChange('payment_location', value) } > <SelectTrigger> <SelectValue placeholder='Выберите место оплаты' /> </SelectTrigger> <SelectContent> <SelectItem value='loading_point'>В пункте погрузки</SelectItem> <SelectItem value='unloading_point'>В пункте выгрузки</SelectItem> <SelectItem value='office'>В офисе</SelectItem> </SelectContent> </Select> </div> </div> ); const renderContent = () => { switch (activeSection) { case 'cargo': return renderCargoContent(); case 'route': return renderRouteContent(); case 'transport': return renderTransportContent(); case 'when': return renderWhenContent(); case 'payment': return renderPaymentContent(); default: return null; } }; const getSectionSummary = (sectionId: string) => { switch (sectionId) { case 'cargo': return formData.title ? `${formData.title}, ${formData.weight} т${ formData.volume ? `, ${formData.volume} м³` : '' }` : ''; case 'route': return formData.loading_point && formData.unloading_point ? `${formData.loading_point} - ${formData.unloading_point}` : ''; case 'transport': return formData.vehicle_type ? `${ vehicleTypes.find((t) => t.value === formData.vehicle_type) ?.label || '' }, ${ loadingTypes.find((t) => t.value === formData.loading_type) ?.label || '' }` : ''; case 'when': return formData.loading_date ? `${new Date(formData.loading_date).toLocaleDateString()}${ formData.is_constant ? ', постоянный' : '' }${formData.is_ready ? ', готов' : ''}` : ''; case 'payment': return formData.payment_method ? `${ paymentMethods.find((m) => m.value === formData.payment_method) ?.label || '' }${formData.price ? `, ${formData.price} ₽` : ''}` : ''; default: return ''; } }; return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <h1 className='text-3xl font-bold text-center mb-6 text-gray-800'> Мои грузы </h1> <div className='space-y-4 mb-8'> <Button onClick={() => setIsAddingCargo(true)} className='w-full bg-blue-600 hover:bg-blue-700 text-white' > <Plus className='mr-2 h-4 w-4' /> Добавить груз </Button> <Button variant='outline' className='w-full' onClick={() => { router.push('/my-cargo'); }} > <TruckIcon className='mr-2 h-4 w-4' /> Мои грузы{' '} </Button> </div> {isAddingCargo && ( <Card className='mb-8 shadow-lg'> <CardContent className='p-6'> <h2 className='text-2xl font-semibold mb-4 text-gray-800'> Добавить груз </h2> <ScrollArea className='h-[60vh]'> <div className='space-y-4'> {sections.map((section) => { const Icon = section.icon; const summary = getSectionSummary(section.id); return ( <Button key={section.id} variant='outline' className='w-full text-left justify-start items-center flex p-4 h-auto' onClick={() => { setActiveSection(section.id); setIsDialogOpen(true); }} > <Icon className='mr-2 h-5 w-5' /> <div className='flex flex-col items-start'> <span className='font-semibold'>{section.title}</span> {summary && ( <span className='text-sm text-gray-500 mt-1 truncate w-full'> {summary} </span> )} </div> {errors[section.id] && ( <AlertCircle className='ml-auto h-5 w-5 text-red-500' /> )} </Button> ); })} </div> </ScrollArea> {isAllFilled && ( <Button onClick={handleSubmit} className='w-full mt-6 bg-green-600 hover:bg-green-700 text-white' disabled={isSubmitting} > {isSubmitting ? ( <> <Loader2 className='mr-2 h-4 w-4 animate-spin' /> Создание... </> ) : ( 'Опубликовать' )} </Button> )} </CardContent> </Card> )} <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}> <DialogContent className='sm:max-w-[425px]'> <DialogHeader> <DialogTitle> {sections.find((s) => s.id === activeSection)?.title} </DialogTitle> </DialogHeader> <ScrollArea className='max-h-[60vh] pr-4'> {renderContent()} </ScrollArea> <div className='flex justify-between mt-6'> <Button variant='outline' onClick={() => { const sectionData = formData[activeSection as keyof CargoFormData]; if (typeof sectionData === 'object') { handleInputChange(activeSection, {}); } else { handleInputChange(activeSection, ''); } }} > <X className='mr-2 h-4 w-4' /> Очистить </Button> <Button onClick={() => { const currentIndex = sections.findIndex( (s) => s.id === activeSection ); if (currentIndex < sections.length - 1) { setActiveSection(sections[currentIndex + 1].id); } else { setIsDialogOpen(false); } }} > Далее <Plus className='ml-2 h-4 w-4' /> </Button> </div> </DialogContent> </Dialog> <Link href={'/student/cargos/'}>go to cargos nigga</Link> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); }
```

# app\carrier-animation\page.tsx

```tsx
'use client'; import { useState, useEffect } from 'react'; import { motion, AnimatePresence } from 'framer-motion'; import Image from 'next/image'; import { useRouter } from 'next/navigation'; import img from '../blue.png'; export default function CarrierAnimationPage() { const [animationStage, setAnimationStage] = useState(0); const router = useRouter(); useEffect(() => { const timers = [ setTimeout(() => setAnimationStage(1), 4000), setTimeout(() => setAnimationStage(2), 8000), setTimeout(() => setAnimationStage(3), 10000), setTimeout(() => router.push('/registration-confirm'), 13000), // Перенаправление после показа статистики ]; return () => timers.forEach(clearTimeout); }, [router]); const logoVariants = { hidden: { x: '120%', opacity: 0, scale: 0.8 }, visible: { x: '0%', opacity: 1, scale: 1, transition: { type: 'spring', stiffness: 100, damping: 20, duration: 3 }, }, exit: { x: '-120%', opacity: 0, scale: 0.8, transition: { type: 'spring', stiffness: 100, damping: 20, duration: 3 }, }, }; const textVariants = { hidden: { opacity: 0, y: 20 }, visible: { opacity: 1, y: 0, transition: { type: 'spring', stiffness: 100, damping: 10, delay: 0.5 }, }, exit: { opacity: 0, y: -20, transition: { duration: 0.5 }, }, }; const statsVariants = { hidden: { opacity: 0, scale: 0.9 }, visible: { opacity: 1, scale: 1, transition: { type: 'spring', stiffness: 100, damping: 10, delayChildren: 0.3, staggerChildren: 0.2, }, }, exit: { opacity: 0, scale: 0.9, transition: { duration: 0.5 }, }, }; const statItemVariants = { hidden: { y: 20, opacity: 0 }, visible: { y: 0, opacity: 1, transition: { type: 'spring', stiffness: 100, damping: 10 }, }, }; return ( <div className='flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-blue-600 via-purple-500 to-pink-500 overflow-hidden p-4'> <AnimatePresence mode='wait'> {animationStage < 3 && ( <motion.div key='logo' variants={logoVariants} initial='hidden' animate={animationStage < 2 ? 'visible' : 'exit'} exit='exit' className='relative w-64 h-64 mb-8' > <Image src={img} alt='Company Logo' layout='fill' objectFit='contain' /> </motion.div> )} {animationStage === 1 && ( <motion.div key='text' variants={textVariants} initial='hidden' animate='visible' exit='exit' className='text-center mb-8' > <motion.h1 className='text-4xl font-bold text-white mb-4' style={{ textShadow: '2px 2px 4px rgba(0,0,0,0.3)' }} > Следуй за мечтой </motion.h1> <motion.p className='text-xl text-white'> Вместе мы достигнем новых высот </motion.p> </motion.div> )} {animationStage === 3 && ( <motion.div key='stats' variants={statsVariants} initial='hidden' animate='visible' exit='exit' className='w-full max-w-4xl' > <div className='grid grid-cols-1 md:grid-cols-3 gap-6'> {[ { label: 'Пользователи', value: '+48,437', icon: '👥' }, { label: 'Перевозчики', value: '+43,743', icon: '🚚' }, { label: 'Заявки', value: '+4,343', icon: '📦' }, ].map((stat, index) => ( <motion.div key={index} variants={statItemVariants} className='bg-white bg-opacity-20 backdrop-filter backdrop-blur-lg rounded-2xl p-6 shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col items-center justify-center text-center' > <span className='text-5xl mb-4'>{stat.icon}</span> <h3 className='text-2xl font-semibold text-white mb-2'> {stat.label} </h3> <p className='text-4xl font-bold text-yellow-300'> {stat.value} </p> </motion.div> ))} </div> </motion.div> )} </AnimatePresence> </div> ); }
```

# app\carrier-welcome\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { ArrowRight } from 'lucide-react'; export default function CarrierWelcomePage() { return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Уважаемые перевозчики! </h1> <section className='mb-8 text-center text-white'> <p> Для удобства работы и получения всей необходимой информации, пожалуйста перейдите на наш мини-вебсайт по следующей кнопке "начать"👇. </p> <br /> <p>Вся работа будет осуществляться через этот вебсайт.</p> <p className='mt-4 font-semibold'>Спасибо за сотрудничество!</p> </section> </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0 flex flex-col'> <Link href='/carrier-animation' className='w-full bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center' > Начать <ArrowRight className='ml-2' size={24} /> </Link> </footer> </div> ); }
```

# app\components\Button.tsx

```tsx
'use client'; import React from 'react'; interface ButtonProps { children: React.ReactNode; onClick?: () => void; className?: string; } const Button: React.FC<ButtonProps> = ({ children, onClick, className }) => { return ( <button className={`px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors ${className}`} onClick={onClick} > {children} </button> ); }; export default Button;
```

# app\components\Form.tsx

```tsx
'use client'; import React, { ReactNode } from 'react'; interface FormProps { onSubmit: (e: React.FormEvent<HTMLFormElement>) => void; children: ReactNode; className?: string; } const Form: React.FC<FormProps> = ({ onSubmit, children, className }) => { return ( <form onSubmit={onSubmit} className={className}> {children} </form> ); }; export default Form;
```

# app\components\Input.tsx

```tsx
'use client'; import React, { ChangeEvent } from 'react'; interface InputProps { type: string; placeholder: string; value: string; onChange: (e: ChangeEvent<HTMLInputElement>) => void; className?: string; name: string; } const Input: React.FC<InputProps> = ({ type, placeholder, value, onChange, className, name }) => { return ( <input type={type} placeholder={placeholder} value={value} onChange={onChange} name={name} className={`px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary ${className}`} /> ); }; export default Input;
```

# app\components\Layout.tsx

```tsx
import React from 'react'; interface LayoutProps { children: React.ReactNode; } const Layout: React.FC<LayoutProps> = ({ children }) => { return ( <div className="min-h-screen bg-gray-100 flex flex-col"> <main className="flex-grow container mx-auto px-4 py-8">{children}</main> </div> ); }; export default Layout;
```

# app\components\NavigationMenu.tsx

```tsx
'use client'; import Link from 'next/link'; import { usePathname } from 'next/navigation'; import { Button } from '@/components/ui/button'; import { Badge } from '@/components/ui/badge'; import { Home, Truck, Package, Bell, Menu, Heart, Car } from 'lucide-react'; import { useNotifications } from '@/hooks/useNotifications'; import { useFavorites } from '@/hooks/useFavorites'; import { memo, useEffect } from 'react'; import { useApp } from '@/contexts/AppContext'; interface NavigationMenuProps { userRole: 'carrier' | 'other'; } // export default function NavigationMenu({ userRole }: NavigationMenuProps) { // const pathname = usePathname(); // const { unreadCount } = useNotifications(); // const { favorites } = useFavorites(); const NavigationMenu = memo(function NavigationMenu({ userRole, }: NavigationMenuProps) { const pathname = usePathname(); const { notificationsCount, favoritesCount } = useApp(); const isActive = (path: string) => { return pathname === path ? 'text-blue-600' : ''; }; const menuItems = userRole === 'carrier' ? [ { href: '/home', icon: Home, label: 'Главная' }, { href: '/favorites', icon: Heart, label: 'Избр.', count: favoritesCount, }, { href: '/my-cars', icon: Car, label: 'Машины' }, { href: '/notifications', icon: Bell, label: 'Уведомл.', count: notificationsCount, }, { href: '/menu', icon: Menu, label: 'Меню' }, ] : [ { href: '/home', icon: Home, label: 'Главная' }, { href: '/requests', icon: Truck, label: 'Заявки' }, { href: '/cargos', icon: Package, label: 'Грузы' }, { href: '/notifications', icon: Bell, label: 'Уведомл.', count: notificationsCount, }, { href: '/menu', icon: Menu, label: 'Меню' }, ]; useEffect(() => {}, [ notificationsCount, favoritesCount, menuItems, pathname, ]); return ( <div className='fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 py-2 px-4 flex justify-between items-center'> {menuItems.map((item) => ( <Link key={item.href} href={item.href} passHref> <Button variant='ghost' size='sm' className={`flex flex-col items-center relative ${isActive( item.href )}`} > <item.icon className='h-5 w-5' /> <span className='text-xs'>{item.label}</span> {item.count && item.count > 0 && ( <Badge variant='destructive' className='absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs' > {item.count > 99 ? '99+' : item.count} </Badge> )} </Button> </Link> ))} </div> ); }); export default NavigationMenu;
```

# app\driver-verification\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { motion, AnimatePresence } from 'framer-motion'; import { FileUpload } from '@/components/FileUpload'; import { Button } from '@/components/ui/button'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Loader2 } from 'lucide-react'; import { useRouter } from 'next/navigation'; import { AuthService } from '@/lib/auth'; import { toast } from 'sonner'; type VerificationStage = 'initial' | 'uploading' | 'verifying' | 'result'; interface VerificationResult { isApproved: boolean; message: string; } interface Document { id: string; type: string; url: string; } const DriverVerificationPage: React.FC = () => { const router = useRouter(); const [stage, setStage] = useState<VerificationStage>('initial'); const [isModalOpen, setIsModalOpen] = useState<boolean>(false); const [documents, setDocuments] = useState<Document[]>([]); const [verificationResult, setVerificationResult] = useState<VerificationResult | null>(null); const [isLoading, setIsLoading] = useState(false); // const handleDocumentUpload = async (documentData: any, type: string) => { // try { // const response = await AuthService.uploadDocument( // documentData.file, // type // ); // setDocuments((prev) => [...prev, response]); // toast.success('Документ успешно загружен'); // } catch (error) { // toast.error('Ошибка при загрузке документа'); // console.error('Document upload error:', error); // } // }; const handleVerification = async () => { if (documents.length < 2) { toast.error('Необходимо загрузить обе стороны водительских прав'); return; } setStage('verifying'); setIsModalOpen(false); setIsLoading(true); try { // Имитация процесса проверки await new Promise((resolve) => setTimeout(resolve, 2000)); const isApproved = Math.random() > 0.1; setVerificationResult({ isApproved, message: isApproved ? 'Ваша категория водительского права соответствует нашим требованиям. Теперь можете пройти идентификацию через платформу MyID.' : "К сожалению, ваша категория водительского права не соответствует нашим требованиям.\n Чтобы получить разрешение на прохождение идентификации, категория водительских прав должна быть как минимум 'C'. ", }); setStage('result'); } catch (error) { toast.error('Ошибка при проверке документов'); console.error('Verification error:', error); setStage('initial'); } finally { setIsLoading(false); } }; const pageVariants = { initial: { opacity: 0, y: 20 }, in: { opacity: 1, y: 0 }, out: { opacity: 0, y: -20 }, }; const pageTransition = { type: 'tween', ease: 'anticipate', duration: 0.5, }; return ( <div className='min-h-screen bg-blue-600 flex items-center justify-center p-4'> <AnimatePresence mode='wait'> {stage === 'initial' && ( <motion.div key='initial' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center' > <h1 className='text-2xl font-bold mb-6 text-blue-800'> Уважаемый перевозчик </h1> <p className='mb-8 text-gray-600'> Чтобы пользоваться нашим сервисом бесплатно, просим вас подтвердить вашу личность. Для этого сначала загрузите ваши водительские права. </p> <Button onClick={() => setIsModalOpen(true)} className='bg-blue-500 hover:bg-blue-600 text-white' > Загрузить водительские права </Button> </motion.div> )} {stage === 'verifying' && ( <motion.div key='verifying' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center' > <Loader2 className='animate-spin h-16 w-16 text-blue-500 mx-auto mb-4' /> <h2 className='text-xl font-semibold text-blue-800'> Проверка документов </h2> <p className='text-gray-600 mt-2'> Пожалуйста, подождите. Мы проверяем ваши документы. </p> </motion.div> )} {stage === 'result' && verificationResult && ( <motion.div key='result' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center' > <h1 className='text-2xl font-bold mb-6 text-blue-800'> Результат проверки </h1> <p className={`mb-8 ${ verificationResult.isApproved ? 'text-green-600' : 'text-red-600' }`} > {verificationResult.message} </p> {verificationResult.isApproved && ( <Button className='bg-green-500 hover:bg-green-600 text-white' onClick={() => { router.push('/registration-confirm'); }} > Перейти к MyID </Button> )} </motion.div> )} </AnimatePresence> <Dialog open={isModalOpen} onOpenChange={setIsModalOpen}> <DialogContent className='sm:max-w-md'> <DialogHeader> <DialogTitle className='text-center text-xl font-semibold text-blue-800'> Загрузка водительских прав </DialogTitle> </DialogHeader> <div className='space-y-6'> <div> <label className='block text-sm font-medium mb-2 text-gray-700'> Передняя сторона </label> {/* <FileUpload type='driver_license_front' onUpload={(data) => handleDocumentUpload(data, 'driver_license_front') } allowedTypes={['image/jpeg', 'image/png']} maxSize={5 * 1024 * 1024} label='Загрузить переднюю сторону' /> */} </div> <div> <label className='block text-sm font-medium mb-2 text-gray-700'> Задняя сторона </label> {/* <FileUpload type='driver_license_back' onUpload={(data) => handleDocumentUpload(data, 'driver_license_back') } allowedTypes={['image/jpeg', 'image/png']} maxSize={5 * 1024 * 1024} label='Загрузить заднюю сторону' /> */} </div> <Button onClick={handleVerification} disabled={documents.length < 2 || isLoading} className='w-full bg-blue-500 hover:bg-blue-600 text-white' > {isLoading ? ( <> <Loader2 className='animate-spin h-4 w-4 mr-2' /> Проверка... </> ) : ( 'Отправить на проверку' )} </Button> </div> </DialogContent> </Dialog> </div> ); }; export default DriverVerificationPage;
```

# app\favorites\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Heart, ArrowLeft, Trash2, ChevronDown, ChevronUp } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { useApp } from '@/contexts/AppContext'; import { formatDate } from '@/lib/utils'; import { motion, AnimatePresence } from 'framer-motion'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { useUser } from '@/contexts/UserContext'; export default function FavoritesPage() { const router = useRouter(); const { favorites, removeFromFavorites, clearAllFavorites } = useApp(); const [expandedItems, setExpandedItems] = useState<string[]>([]); const [showDeleteConfirm, setShowDeleteConfirm] = useState(false); const [itemToDelete, setItemToDelete] = useState<number | null>(null); const { userState } = useUser(); const toggleExpand = (id: string) => { setExpandedItems((prev) => prev.includes(id) ? prev.filter((item) => item !== id) : [...prev, id] ); }; const getFavoriteIcon = (type: string) => { switch (type) { case 'cargo': return '📦'; case 'route': return '🚚'; case 'carrier': return '🚛'; default: return '❤️'; } }; const handleDelete = (id: number) => { setItemToDelete(id); setShowDeleteConfirm(true); }; const confirmDelete = () => { if (itemToDelete) { removeFromFavorites(itemToDelete); } setShowDeleteConfirm(false); setItemToDelete(null); }; const groupedFavorites = favorites.reduce( (acc: Record<string, any[]>, item) => { // const groupedFavorites = favorites.reduce((acc, item) => { if (!acc[item.type]) { acc[item.type] = []; } acc[item.type].push(item); return acc; }, {} as Record<string, any[]> ); return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <div className='flex items-center mb-6'> <Button variant='ghost' onClick={() => router.back()} className='mr-2'> <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-2xl font-bold'>Избранное</h1> </div> <div className='flex justify-between items-center mb-4'> <div className='flex items-center'> <Heart className='h-5 w-5 mr-2 text-red-500' /> <span className='font-semibold'>Всего: {favorites.length}</span> </div> {favorites.length > 0 && ( <Button variant='outline' size='sm' onClick={clearAllFavorites}> <Trash2 className='h-4 w-4 mr-2' /> Очистить все </Button> )} </div> <AnimatePresence mode='popLayout'> {Object.entries(groupedFavorites).length === 0 ? ( <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }} className='text-center py-8 text-gray-500' > У вас пока нет избранных элементов </motion.div> ) : ( Object.entries(groupedFavorites).map(([type, items]) => ( <motion.div key={type} layout initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className='mb-6' > <h2 className='text-lg font-semibold mb-3 flex items-center'> {getFavoriteIcon(type)} <span className='ml-2'> {type === 'cargo' && 'Грузы'} {type === 'route' && 'Маршруты'} {type === 'carrier' && 'Перевозчики'} </span> <Badge variant='secondary' className='ml-2'> {items.length} </Badge> </h2> <AnimatePresence mode='popLayout'> {items.map((item) => ( <motion.div key={item.id} layout initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: 20 }} transition={{ duration: 0.2 }} > <Card className='mb-3'> <CardContent className='p-4'> <div className='flex justify-between items-start'> <div className='flex-1'> <div className='flex items-center justify-between'> <h3 className='font-medium'>{item.title}</h3> <Button variant='ghost' size='sm' onClick={() => handleDelete(item.orderId)} > <Trash2 className='h-4 w-4 text-red-500' /> </Button> </div> <p className='text-sm text-gray-500 mb-2'> {formatDate(item.createdAt)} </p> <p className='text-sm'>{item.description}</p> <AnimatePresence> {expandedItems.includes(item.id) && ( <motion.div initial={{ height: 0, opacity: 0 }} animate={{ height: 'auto', opacity: 1 }} exit={{ height: 0, opacity: 0 }} className='mt-4 space-y-2 text-sm' > {Object.entries(item.details).map( ([key, value]) => ( <p key={key}> <span className='font-medium'> {key}: </span>{' '} {value as React.ReactNode} </p> ) )} </motion.div> )} </AnimatePresence> </div> </div> <Button variant='ghost' size='sm' onClick={() => toggleExpand(item.id)} className='mt-2 w-full' > {expandedItems.includes(item.id) ? ( <> <ChevronUp className='h-4 w-4 mr-2' /> Скрыть детали </> ) : ( <> <ChevronDown className='h-4 w-4 mr-2' /> Показать детали </> )} </Button> </CardContent> </Card> </motion.div> ))} </AnimatePresence> </motion.div> )) )} </AnimatePresence> <Dialog open={showDeleteConfirm} onOpenChange={setShowDeleteConfirm}> <DialogContent> <DialogHeader> <DialogTitle>Подтверждение удаления</DialogTitle> </DialogHeader> <p>Вы уверены, что хотите удалить этот элемент из избранного?</p> <div className='flex justify-end space-x-2 mt-4'> <Button variant='outline' onClick={() => setShowDeleteConfirm(false)} > Отмена </Button> <Button variant='destructive' onClick={confirmDelete}> Удалить </Button> </div> </DialogContent> </Dialog> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> {/* <NavigationMenu userRole='carrier' /> */} </div> ); }
```

# app\game\page.tsx

```tsx
'use client'; import React, { useRef, useState, useEffect } from 'react'; import * as THREE from 'three'; import { Canvas, useFrame, useLoader } from '@react-three/fiber'; import { Sky, OrbitControls, Environment, useTexture } from '@react-three/drei'; import { usePlane } from '@react-three/cannon'; // Компонент здания с текстурами const Building = ({ position, size, }: { position: [number, number, number]; size: [number, number, number]; }) => { const texture = useTexture({ map: '/building_texture.jpg', // Замените на реальный путь к текстуре }); return ( <mesh position={position}> <boxGeometry args={size} /> <meshStandardMaterial map={texture.map} roughness={0.7} metalness={0.3} /> </mesh> ); }; // Компонент земли с текстурой // Компонент земли const Ground = () => { const [ref] = usePlane(() => ({ rotation: [-Math.PI / 2, 0, 0], position: [0, -0.5, 0], })); return ( <mesh ref={ref as any} rotation={[-Math.PI / 2, 0, 0]} position={[0, -0.5, 0]} > <planeGeometry args={[1000, 1000]} /> <meshStandardMaterial color='#3a7e3d' /> </mesh> ); }; // Компонент дрона const Drone = () => { const droneRef = useRef<THREE.Group>(null); const [movement, setMovement] = useState({ forward: false, backward: false, left: false, right: false, up: false, down: false, }); const speed = 0.5; const [position, setPosition] = useState<[number, number, number]>([0, 5, 0]); useEffect(() => { const handleKeyDown = (e: KeyboardEvent) => { switch (e.code) { case 'KeyW': setMovement((prev) => ({ ...prev, forward: true })); break; case 'KeyS': setMovement((prev) => ({ ...prev, backward: true })); break; case 'KeyA': setMovement((prev) => ({ ...prev, left: true })); break; case 'KeyD': setMovement((prev) => ({ ...prev, right: true })); break; case 'Space': setMovement((prev) => ({ ...prev, up: true })); break; case 'ShiftLeft': setMovement((prev) => ({ ...prev, down: true })); break; } }; const handleKeyUp = (e: KeyboardEvent) => { switch (e.code) { case 'KeyW': setMovement((prev) => ({ ...prev, forward: false })); break; case 'KeyS': setMovement((prev) => ({ ...prev, backward: false })); break; case 'KeyA': setMovement((prev) => ({ ...prev, left: false })); break; case 'KeyD': setMovement((prev) => ({ ...prev, right: false })); break; case 'Space': setMovement((prev) => ({ ...prev, up: false })); break; case 'ShiftLeft': setMovement((prev) => ({ ...prev, down: false })); break; } }; window.addEventListener('keydown', handleKeyDown); window.addEventListener('keyup', handleKeyUp); return () => { window.removeEventListener('keydown', handleKeyDown); window.removeEventListener('keyup', handleKeyUp); }; }, []); useFrame((state) => { if (!droneRef.current) return; const moveDirection = new THREE.Vector3(); const camera = state.camera; // Получаем направление движения на основе поворота камеры if (movement.forward) moveDirection.z -= 1; if (movement.backward) moveDirection.z += 1; if (movement.left) moveDirection.x -= 1; if (movement.right) moveDirection.x += 1; if (movement.up) moveDirection.y += 1; if (movement.down) moveDirection.y -= 1; moveDirection.normalize(); moveDirection.applyEuler(new THREE.Euler(0, camera.rotation.y, 0)); moveDirection.multiplyScalar(speed); // Обновляем позицию setPosition((prev) => [ prev[0] + moveDirection.x, prev[1] + moveDirection.y, prev[2] + moveDirection.z, ]); // Обновляем позицию камеры camera.position.set(position[0], position[1], position[2]); }); return ( <group ref={droneRef} position={position}> <mesh> <boxGeometry args={[0.5, 0.2, 0.5]} /> <meshStandardMaterial color='red' metalness={0.8} roughness={0.2} /> </mesh> </group> ); }; // Компонент города const City = () => { const buildingData = [ { pos: [-20, 15, -20], size: [10, 30, 10] }, { pos: [20, 20, -20], size: [10, 40, 10] }, { pos: [-20, 25, 20], size: [10, 50, 10] }, { pos: [20, 15, 20], size: [10, 30, 10] }, { pos: [0, 20, -30], size: [15, 40, 15] }, { pos: [-30, 18, 0], size: [12, 36, 12] }, { pos: [30, 22, 0], size: [14, 44, 14] }, { pos: [0, 25, 30], size: [16, 50, 16] }, ]; return ( <> {buildingData.map((building, index) => ( <Building key={index} position={building.pos as [number, number, number]} size={building.size as [number, number, number]} /> ))} </> ); }; // Основной компонент приложения const DroneSimulator = () => { const [started, setStarted] = useState(false); const handleStart = () => { setStarted(true); // Запрашиваем полноэкранный режим для Telegram Web App // if (window.Telegram?.WebApp) { // window.Telegram.WebApp.requestFullScreen(); // } }; if (!started) { return ( <div style={{ position: 'fixed', top: 0, left: 0, width: '100vw', height: '100vh', display: 'flex', justifyContent: 'center', alignItems: 'center', backgroundColor: '#000', }} > <button onClick={handleStart} style={{ padding: '20px 40px', fontSize: '20px', borderRadius: '10px', border: 'none', backgroundColor: '#4CAF50', color: 'white', cursor: 'pointer', }} > Начать полёт </button> </div> ); } return ( <div style={{ width: '100vw', height: '100vh' }}> <Canvas shadows camera={{ fov: 75 }}> <ambientLight intensity={0.5} /> <pointLight position={[10, 10, 10]} intensity={1} castShadow /> <Sky sunPosition={[100, 20, 100]} /> <Environment preset='city' /> <Drone /> <City /> <Ground /> <OrbitControls makeDefault /> </Canvas> <div style={{ position: 'absolute', top: 20, left: 20, color: 'white', backgroundColor: 'rgba(0,0,0,0.5)', padding: '10px', borderRadius: '5px', fontFamily: 'Arial', }} > <h3 style={{ margin: '0 0 10px 0' }}>Управление:</h3> <p style={{ margin: '5px 0' }}>WASD - движение</p> <p style={{ margin: '5px 0' }}>Мышь - поворот камеры</p> <p style={{ margin: '5px 0' }}>Пробел - подъём</p> <p style={{ margin: '5px 0' }}>Shift - снижение</p> </div> </div> ); }; export default DroneSimulator;
```

# app\globals.css

```css
@tailwind base; @tailwind components; @tailwind utilities; @layer base { :root { --background: #ffffff; --background-secondary: #f3f4f6; --foreground: #020817; --foreground-secondary: #4b5563; --primary: #0066ff; --primary-foreground: #ffffff; --secondary: #ff6b00; --secondary-foreground: #ffffff; --muted: #f3f4f6; --muted-foreground: #6b7280; --accent: #f3f4f6; --accent-foreground: #0066ff; --destructive: #ef4444; --destructive-foreground: #ffffff; --border: #e5e7eb; --input: #e5e7eb; --ring: #0066ff; --radius: 0.5rem; } .dark { --background: #020817; --background-secondary: #1f2937; --foreground: #ffffff; --foreground-secondary: #9ca3af; --primary: #3b82f6; --primary-foreground: #ffffff; --secondary: #ff8533; --secondary-foreground: #ffffff; --muted: #1f2937; --muted-foreground: #9ca3af; --accent: #1f2937; --accent-foreground: #3b82f6; --destructive: #ef4444; --destructive-foreground: #ffffff; --border: #374151; --input: #374151; --ring: #3b82f6; } } @layer base { * { @apply border-border; } body { @apply bg-background text-foreground; font-feature-settings: 'rlig' 1, 'calt' 1; } } .text-balance { text-wrap: balance; }
```

# app\home\page.tsx

```tsx
'use client'; import React, { useState, useEffect } from 'react'; import { Input } from '@/components/ui/input'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Checkbox } from '@/components/ui/checkbox'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { DateRange, Range, RangeKeyDict } from 'react-date-range'; import 'react-date-range/dist/styles.css'; import 'react-date-range/dist/theme/default.css'; import { Filter, Star, CheckCircle, Clock, Bell, Heart, ChevronDown, ChevronUp, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useUser } from '@/contexts/UserContext'; import { useRouter } from 'next/navigation'; import { useFavorites } from '@/hooks/useFavorites'; import { useNotifications } from '@/hooks/useNotifications'; import { useApp } from '@/contexts/AppContext'; type UserRole = 'carrier' | 'other'; interface Order { id: number; cargo: string; weight: number; date: string; payment: string; price: string; from: string; to: string; vehicleType: string; description: string; isTop: boolean; isVerified: boolean; experience: number; rating: number; dimensions: string; loadingType: string; unloadingType: string; additionalRequirements: string; } interface FilterState { category: string; from: string; to: string; dateRange: Range; notifications: boolean; } const mockOrders: Order[] = [ { id: 1, cargo: 'Металл', weight: 22, date: '12.12.2023 14:34', payment: 'Комбо', price: 'Договорная', from: 'Ташкент', to: 'Москва', vehicleType: 'Тент', description: 'Ташкент-Москва, нужен-тент, груз-металл, вес:22т, оплата:комбо, дата сообщения: 12.12.2023', isTop: true, isVerified: true, experience: 2, rating: 4, dimensions: '5x2x2 м', loadingType: 'Боковая', unloadingType: 'Задняя', additionalRequirements: 'Требуется крепление груза', }, { id: 2, cargo: 'Текстиль', weight: 15, date: '10.12.2023 11:00', payment: 'Безналичный расчет', price: '2500$', from: 'Бухара', to: 'Алматы', vehicleType: 'Рефрижератор', description: 'Бухара-Алматы, требуется рефрижератор, текстильные изделия, вес: 15т, оплата: безналичный расчет, дата сообщения: 10.12.2023', isTop: false, isVerified: true, experience: 3, rating: 5, dimensions: '6x2.5x2.5 м', loadingType: 'Задняя', unloadingType: 'Задняя', additionalRequirements: 'Температурный контроль -5°C', }, { id: 3, cargo: 'Автозапчасти', weight: 8, date: '08.12.2023 09:30', payment: 'Наличные', price: '1200$', from: 'Самарканд', to: 'Киев', vehicleType: 'Тент', description: 'Самарканд-Киев, тент, автозапчасти, вес: 8т, оплата: наличные, дата сообщения: 08.12.2023', isTop: false, isVerified: true, experience: 1, rating: 3.5, dimensions: '4x2x2 м', loadingType: 'Боковая', unloadingType: 'Задняя', additionalRequirements: 'Нет дополнительных требований', }, { id: 4, cargo: 'Строительные материалы', weight: 30, date: '05.12.2023 07:45', payment: 'Договорная', price: 'По запросу', from: 'Ташкент', to: 'Санкт-Петербург', vehicleType: 'Тент', description: 'Ташкент-Санкт-Петербург, тент, строительные материалы, вес: 30т, оплата: договорная, дата сообщения: 05.12.2023', isTop: true, isVerified: false, experience: 5, rating: 4.5, dimensions: '10x3x3 м', loadingType: 'Задняя', unloadingType: 'Задняя', additionalRequirements: 'Требуются сертификаты соответствия материалов', }, // Добавьте больше заказов с дополнительными полями ]; const cargoCategories = [ 'Металл', 'Текстиль', 'Продукты', 'Техника', 'Стройматериалы', ]; const cities = [ 'Ташкент', 'Москва', 'Бухара', 'Андижан', 'Самарканд', 'Санкт-Петербург', ]; const RoleConfirmationDialog: React.FC<{ onConfirm: (role: 'carrier' | 'other') => void; }> = ({ onConfirm }) => { return ( <Dialog open={true}> <DialogContent> <DialogHeader> <DialogTitle>Подтвердите вашу роль</DialogTitle> </DialogHeader> <div className='space-y-4'> <Button onClick={() => onConfirm('carrier')} className='w-full'> Я перевозчик </Button> <Button onClick={() => onConfirm('other')} className='w-full'> Я другой пользователь </Button> </div> </DialogContent> </Dialog> ); }; const FilterModal: React.FC<{ isOpen: boolean; onClose: () => void; onApply: (filters: FilterState) => void; }> = ({ isOpen, onClose, onApply }) => { const [filters, setFilters] = useState<FilterState>({ category: '', from: '', to: '', dateRange: { startDate: undefined, endDate: undefined, key: 'selection', }, notifications: false, }); const handleSelectChange = (name: keyof FilterState, value: string) => { setFilters((prev) => ({ ...prev, [name]: value })); }; const handleDateRangeChange = (ranges: RangeKeyDict) => { setFilters((prev) => ({ ...prev, dateRange: ranges.selection })); }; const handleCheckboxChange = (checked: boolean) => { setFilters((prev) => ({ ...prev, notifications: checked })); }; const handleApply = () => { onApply(filters); onClose(); }; return ( <Dialog open={isOpen} onOpenChange={onClose}> <DialogContent className='bg-blue-600 text-white'> <DialogHeader> <DialogTitle className='text-white text-center'> Поиск грузов </DialogTitle> </DialogHeader> <div className='space-y-4 max-w-[100vw] overflow-y-auto'> <Select onValueChange={(value) => handleSelectChange('category', value)} > <SelectTrigger className='bg-blue-500 text-white border-blue-400'> <SelectValue placeholder='Категория грузов' /> </SelectTrigger> <SelectContent> {cargoCategories.map((category) => ( <SelectItem key={category} value={category}> {category} </SelectItem> ))} </SelectContent> </Select> <Select onValueChange={(value) => handleSelectChange('from', value)}> <SelectTrigger className='bg-blue-500 text-white border-blue-400'> <SelectValue placeholder='Откуда' /> </SelectTrigger> <SelectContent> {cities.map((city) => ( <SelectItem key={city} value={city}> {city} </SelectItem> ))} </SelectContent> </Select> <Select onValueChange={(value) => handleSelectChange('to', value)}> <SelectTrigger className='bg-blue-500 text-white border-blue-400'> <SelectValue placeholder='Куда' /> </SelectTrigger> <SelectContent> {cities.map((city) => ( <SelectItem key={city} value={city}> {city} </SelectItem> ))} </SelectContent> </Select> <div className='bg-white rounded-md p-2'> <DateRange ranges={[filters.dateRange]} onChange={handleDateRangeChange} months={1} direction='vertical' className='w-full' /> </div> <div className='flex items-center space-x-2'> <Checkbox id='notifications' checked={filters.notifications} onCheckedChange={handleCheckboxChange} /> <label htmlFor='notifications' className='text-white'> Включить уведомления </label> </div> <Button onClick={handleApply} className='w-full bg-yellow-400 text-blue-800 hover:bg-yellow-500' > Найти грузы </Button> </div> </DialogContent> </Dialog> ); }; export default function OrdersPage() { const [searchTerm, setSearchTerm] = useState(''); const [orders, setOrders] = useState<Order[]>(mockOrders); const [isFilterModalOpen, setIsFilterModalOpen] = useState(false); const [showNotificationDialog, setShowNotificationDialog] = useState(false); const [expandedOrder, setExpandedOrder] = useState<number | null>(null); const { userState, setUserRole } = useUser(); // const router = useRouter(); const [currentOrder, setCurrentOrder] = useState<Order | null>(null); // const { userState } = useUser(); const router = useRouter(); const { addNotification, addToFavorites, removeFromFavorites, isFavorite, notifications, favorites, } = useApp(); // const { addNotification } = useNotifications(); // const { addToFavorites, removeFromFavorites, isFavorite } = useFavorites(); const [showErrorDialog, setShowErrorDialog] = useState(false); const [errorMessage, setErrorMessage] = useState(''); useEffect(() => { // if (!userState.isAuthenticated && !userState.role) { // router.push('/select-lang'); // } // const savedRole = localStorage.getItem('userRole') as UserRole | null; // if (savedRole) { // setUserRole(savedRole); // } setOrders(mockOrders); const handleBeforeUnload = () => { localStorage.clear(); }; window.addEventListener('beforeunload', handleBeforeUnload); return () => { window.removeEventListener('beforeunload', handleBeforeUnload); }; }, [ userState, router, addNotification, addToFavorites, removeFromFavorites, isFavorite, orders, ]); const handleRoleConfirm = (role: 'carrier' | 'other') => { setUserRole(role === 'carrier' ? 'carrier' : 'cargo-owner'); }; const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => { setSearchTerm(e.target.value); // Здесь должна быть логика фильтрации заказов }; const handleApplyFilters = (filters: FilterState) => { console.log('Applied filters:', filters); // Здесь должна быть логика применения фильтров к заказам }; const handleNotificationToggle = (order: Order) => { if ( notifications.some( (notification) => notification.orderId === order.id && !notification.isRead ) ) { setErrorMessage('Для этого груза уже включены нотификации'); setShowErrorDialog(true); } else { setCurrentOrder(order); setShowNotificationDialog(true); } }; const handleEnableNotification = () => { if (currentOrder) { addNotification({ orderId: currentOrder.id, type: 'cargo', message: `Включены уведомления для груза: ${currentOrder.cargo} (${currentOrder.from} - ${currentOrder.to})`, }); setShowNotificationDialog(false); } }; const handleFavoriteToggle = (order: Order) => { // const favoriteId = `cargo-${order.id}`; if (isFavorite(order.id)) { setErrorMessage('Этот груз уже находится в избранном'); setShowErrorDialog(true); } else { addToFavorites({ orderId: order.id, type: order.cargo, title: `${order.cargo}: ${order.from} - ${order.to}`, description: order.description, details: { Вес: `${order.weight} т`, Габариты: order.dimensions, 'Тип погрузки': order.loadingType, 'Тип разгрузки': order.unloadingType, Оплата: order.payment, Цена: order.price, }, }); } }; const renderStars = (rating: number) => { return Array(5) .fill(0) .map((_, i) => ( <Star key={i} className={`h-4 w-4 ${ i < rating ? 'text-yellow-400 fill-current' : 'text-gray-300' }`} /> )); }; const toggleOrderExpansion = (orderId: number) => { setExpandedOrder(expandedOrder === orderId ? null : orderId); }; if (!userState.role && !userState.isAuthenticated) { return <RoleConfirmationDialog onConfirm={handleRoleConfirm} />; } return ( <div className='min-h-screen bg-blue-600 p-4 pb-20'> <div className='flex items-center mb-4 bg-white rounded-lg p-2'> <Input type='text' placeholder='Поиск заказов...' value={searchTerm} onChange={handleSearch} className='mr-2 flex-grow' /> <Button variant='default' size='sm' className='bg-yellow-400 text-black hover:bg-yellow-500 whitespace-nowrap' onClick={() => setIsFilterModalOpen(true)} > <Filter className='h-4 w-4 mr-2' /> Фильтры </Button> </div> <FilterModal isOpen={isFilterModalOpen} onClose={() => setIsFilterModalOpen(false)} onApply={handleApplyFilters} /> <div className='space-y-4 mb-20'> {orders.map((order) => ( <Card key={order.id} className='bg-white overflow-hidden'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-2'> <div className='flex space-x-1'> {order.isTop && ( <Badge variant='secondary' className='bg-yellow-100 text-yellow-800' title='Топ заявки от наших студентов' > <Star className='h-4 w-4' /> </Badge> )} {order.isVerified && ( <Badge variant='secondary' className='bg-green-100 text-green-800' title='Профиль подтвержден' > <CheckCircle className='h-4 w-4' /> </Badge> )} {order.experience > 1 && ( <Badge variant='secondary' className='bg-blue-100 text-blue-800' title='Опыт логиста' > <Clock className='h-4 w-4' /> {order.experience}г </Badge> )} </div> <div className='flex items-center'> <span className='font-bold mr-1'>{order.rating}</span> <div className='flex'>{renderStars(order.rating)}</div> </div> </div> <div className='flex justify-between items-center mb-2'> <span className='font-bold text-lg'> {order.from} - {order.to} </span> <span className='text-sm text-gray-500'>{order.date}</span> </div> <div className='grid grid-cols-2 gap-2 mb-2 text-sm'> <span>Груз: {order.cargo}</span> <span>Вес: {order.weight} т</span> <span>Тип: {order.vehicleType}</span> <span>Оплата: {order.payment}</span> </div> <div className='mb-2'> <span className='font-semibold'>Цена: {order.price}</span> </div> {expandedOrder === order.id && ( <div className='mt-4 text-sm'> <p>Размеры: {order.dimensions}</p> <p>Тип погрузки: {order.loadingType}</p> <p>Тип разгрузки: {order.unloadingType}</p> <p>Доп. требования: {order.additionalRequirements}</p> <p className='mt-2'>Описание: {order.description}</p> </div> )} <div className='flex justify-between mt-4'> <Button variant='outline' size='sm' className='flex-1 mr-1' onClick={() => toggleOrderExpansion(order.id)} > {expandedOrder === order.id ? ( <ChevronUp className='h-4 w-4 mr-1' /> ) : ( <ChevronDown className='h-4 w-4 mr-1' /> )} {expandedOrder === order.id ? 'Скрыть' : 'Подробнее'} </Button> <Button variant='outline' size='sm' className='flex-1 ml-1 mr-1' onClick={() => handleNotificationToggle(order)} > <Bell className='h-4 w-4 mr-1' /> </Button> {/* <Button variant='outline' size='sm' className='flex-1 ml-1 mr-1' onClick={() => setShowNotificationDialog(true)} > <Bell className='h-4 w-4 mr-1' /> </Button> */} <Button variant='outline' size='sm' className={`flex-1 ${ isFavorite(order.id) ? 'text-red-500 hover:text-red-600' : '' }`} onClick={() => handleFavoriteToggle(order)} > <Heart className='h-4 w-4 mr-1' /> </Button> {/* <Button variant='outline' size='sm' className='flex-1'> <Heart className='h-4 w-4 mr-1' /> </Button> */} </div> </CardContent> </Card> ))} </div> <Dialog open={showNotificationDialog} onOpenChange={setShowNotificationDialog} > <DialogContent> <DialogHeader> <DialogTitle>Включить уведомления?</DialogTitle> </DialogHeader> <p> Вы будете получать уведомления о новых предложениях по этому направлению и типу груза. </p> <div className='flex justify-end space-x-2 mt-4'> <Button variant='outline' onClick={() => setShowNotificationDialog(false)} > Отмена </Button> <Button onClick={handleEnableNotification}>Включить</Button> </div> </DialogContent> </Dialog> {/* <Dialog open={showNotificationDialog} onOpenChange={setShowNotificationDialog} > <DialogContent> <DialogHeader> <DialogTitle>Включить уведомления?</DialogTitle> </DialogHeader> <p> Хотите включить уведомления по выбранным типам груза и направлениям? </p> <div className='flex justify-end space-x-2 mt-4'> <Button variant='outline' onClick={() => setShowNotificationDialog(false)} > Отмена </Button> <Button onClick={() => { // Логика включения уведомлений setShowNotificationDialog(false); }} > Включить </Button> </div> </DialogContent> </Dialog> */} <Dialog open={showErrorDialog} onOpenChange={setShowErrorDialog}> <DialogContent> <DialogHeader> <DialogTitle>Внимание</DialogTitle> </DialogHeader> <p>{errorMessage}</p> <div className='flex justify-end space-x-2 mt-4'> <Button onClick={() => setShowErrorDialog(false)}>Понятно</Button> </div> </DialogContent> </Dialog> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); // <NavigationMenu // userRole={userState.role === 'carrier' ? 'carrier' : 'other'} // /> // {/* <NavigationMenu userRole={userRole} /> */} // </div> // ); }
```

# app\layout.tsx

```tsx
'use client'; import './globals.css'; import { Inter } from 'next/font/google'; import { ErrorBoundary } from '@/components/ErrorBoundary'; import { AppProvider } from '@/contexts/AppContext'; import { ThemeProvider } from '@/contexts/ThemeContext'; import { LoadingProvider } from '@/components/LoadingProvider'; import { ToastProvider } from '@/components/ToastProvider'; import Script from 'next/script'; import { UserProvider } from '@/contexts/UserContext'; const inter = Inter({ subsets: ['latin'] }); export default function RootLayout({ children, }: { children: React.ReactNode; }) { return ( <html lang='en' suppressHydrationWarning> <head> <Script src='https://telegram.org/js/telegram-web-app.js' strategy='beforeInteractive' /> </head> <body className={inter.className}> <ErrorBoundary> <AppProvider> <UserProvider> {/* <ThemeProvider> */} <LoadingProvider> <ToastProvider /> {children} </LoadingProvider> </UserProvider> {/* </ThemeProvider> */} </AppProvider> </ErrorBoundary> </body> </html> ); }
```

# app\menu\page.tsx

```tsx
// 'use client'; // import React, { useState } from 'react'; // import { Button } from '@/components/ui/button'; // import { Card, CardContent } from '@/components/ui/card'; // import { Avatar } from '@/components/ui/avatar'; // import { Input } from '@/components/ui/input'; // import { // Dialog, // DialogContent, // DialogHeader, // DialogTitle, // } from '@/components/ui/dialog'; // import { // Star, // Search, // MapPin, // Heart, // FileText, // HelpCircle, // Settings, // MessageSquare, // LogOut, // ChevronRight, // Camera, // Trash2, // ArrowLeft, // } from 'lucide-react'; // import NavigationMenu from '../components/NavigationMenu'; // import { useRouter } from 'next/navigation'; // import { useUser } from '@/contexts/UserContext'; // interface UserProfile { // name: string; // photo: string; // contactInfo: string; // rating: number; // experience: string; // recommendations: number; // complaints: number; // id: string; // position: string; // telegram: string; // whatsapp: string; // mobile: string; // role: string; // studyCity: string; // group: string; // studyLanguage: string; // curator: string; // graduationDate: string; // } // export default function MenuPage() { // const [showProfile, setShowProfile] = useState<boolean>(false); // const [isEditModalOpen, setIsEditModalOpen] = useState<boolean>(false); // const [showLogoutConfirm, setShowLogoutConfirm] = useState<boolean>(false); // const [userProfile, setUserProfile] = useState<UserProfile>({ // name: '', // photo: // 'https://i.pinimg.com/736x/24/00/1e/24001e0c9918570fae6645f683a515a8.jpg', // contactInfo: '', // rating: 0, // experience: '', // recommendations: 0, // complaints: 0, // id: '', // position: '', // telegram: '', // whatsapp: '', // mobile: '', // role: '', // studyCity: '', // group: '', // studyLanguage: '', // curator: '', // graduationDate: '', // }); // const router = useRouter(); // const { userState, logout, setUserData } = useUser(); // React.useEffect(() => { // if (userState.userData) { // setUserProfile({ // name: userState.userData.fullName || '', // photo: // 'https://i.pinimg.com/736x/24/00/1e/24001e0c9918570fae6645f683a515a8.jpg', // contactInfo: userState.userData.phoneNumber || '', // rating: 5, // experience: '1 год', // recommendations: 0, // complaints: 0, // id: Math.random().toString(36).substr(2, 9), // position: userState.userData.position || '', // telegram: userState.userData.telegramNumber || '', // whatsapp: userState.userData.whatsappNumber || '', // mobile: userState.userData.phoneNumber || '', // role: userState.role || '', // studyCity: userState.userData.city || '', // group: userState.userData.groupName || '', // studyLanguage: userState.userData.studyLanguage || '', // curator: userState.userData.curatorName || '', // graduationDate: userState.userData.endDate || '', // }); // } // }, [userState]); // const handleLogout = () => { // logout(); // router.push('/'); // }; // // const handleLogout = () => { // // // Очищаем localStorage // // localStorage.removeItem('logit_token'); // // localStorage.removeItem('logit_user_state'); // // // Удаляем куки // // document.cookie = 'logit_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;'; // // document.cookie = 'bot_access=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;'; // // // Перенаправляем на страницу логина // // router.push('/login'); // // }; // const renderStars = (rating: number) => { // return Array(5) // .fill(0) // .map((_, i) => ( // <Star // key={i} // className={`h-5 w-5 ${ // i < rating ? 'text-yellow-400 fill-current' : 'text-gray-300' // }`} // /> // )); // }; // const renderProfile = () => ( // <Card className='mt-4'> // <CardContent className='p-6'> // <div className='flex items-center justify-between mb-4'> // <div className='flex items-center'> // <Avatar className='h-16 w-16 mr-4'> // <img src={userProfile.photo} alt={userProfile.name} /> // </Avatar> // <div> // <h2 className='text-2xl font-bold'>{userProfile.name}</h2> // <p className='text-gray-600'>{userProfile.id}</p> // </div> // </div> // <Button // variant='outline' // size='sm' // onClick={() => setIsEditModalOpen(true)} // > // <Camera className='h-4 w-4 mr-2' /> // Изменить // </Button> // </div> // <div className='mb-4'> // <p className='text-green-600 font-semibold mb-2'> // Профиль подтвержден // </p> // <div className='flex mb-2'>{renderStars(userProfile.rating)}</div> // <p className='mb-2'>Стаж: {userProfile.experience}</p> // <p className='mb-2'>Рекомендации: {userProfile.recommendations}</p> // <p className='mb-2'>Жалобы: {userProfile.complaints}</p> // </div> // <div className='space-y-2'> // <h3 className='text-xl font-semibold mb-3'>Контактная информация</h3> // <p>Telegram: {userProfile.telegram}</p> // <p>WhatsApp: {userProfile.whatsapp}</p> // <p>Телефон: {userProfile.mobile}</p> // </div> // <div className='mt-4 space-y-2'> // <h3 className='text-xl font-semibold mb-3'>Информация об обучении</h3> // <p>Должность: {userProfile.position}</p> // <p>Роль: {userProfile.role}</p> // <p>Город обучения: {userProfile.studyCity}</p> // <p>Группа: {userProfile.group}</p> // <p>Язык обучения: {userProfile.studyLanguage}</p> // <p>Куратор: {userProfile.curator}</p> // <p>Дата окончания: {userProfile.graduationDate}</p> // </div> // <Button // variant='destructive' // className='w-full mt-6' // onClick={() => setShowLogoutConfirm(true)} // > // <LogOut className='h-5 w-5 mr-2' /> // Выйти // </Button> // </CardContent> // </Card> // ); // const EditProfileModal = () => ( // <Dialog open={isEditModalOpen} onOpenChange={setIsEditModalOpen}> // <DialogContent className='sm:max-w-[425px]'> // <DialogHeader> // <DialogTitle>Редактировать профиль</DialogTitle> // </DialogHeader> // <div className='grid gap-4 py-4'> // <div className='flex items-center justify-center mb-4'> // <Avatar className='h-24 w-24'> // <img src={userProfile.photo} alt={userProfile.name} /> // </Avatar> // <div className='ml-4 space-y-2'> // <Button variant='outline' size='sm'> // <Camera className='h-4 w-4 mr-2' /> // Изменить фото // </Button> // <Button variant='outline' size='sm'> // <Trash2 className='h-4 w-4 mr-2' /> // Удалить фото // </Button> // </div> // </div> // <Input // placeholder='ФИО' // value={userProfile.name} // onChange={(e) => { // setUserProfile({ ...userProfile, name: e.target.value }); // setUserData({ ...userState.userData!, fullName: e.target.value }); // }} // /> // <Input // placeholder='Мобильный телефон' // value={userProfile.mobile} // onChange={(e) => { // setUserProfile({ ...userProfile, mobile: e.target.value }); // setUserData({ // ...userState.userData!, // phoneNumber: e.target.value, // }); // }} // /> // <Input // placeholder='Telegram' // value={userProfile.telegram} // onChange={(e) => { // setUserProfile({ ...userProfile, telegram: e.target.value }); // setUserData({ // ...userState.userData!, // telegramNumber: e.target.value, // }); // }} // /> // <Input // placeholder='WhatsApp' // value={userProfile.whatsapp} // onChange={(e) => { // setUserProfile({ ...userProfile, whatsapp: e.target.value }); // setUserData({ // ...userState.userData!, // whatsappNumber: e.target.value, // }); // }} // /> // <Input // placeholder='Должность' // value={userProfile.position} // onChange={(e) => { // setUserProfile({ ...userProfile, position: e.target.value }); // setUserData({ ...userState.userData!, position: e.target.value }); // }} // /> // <Input // placeholder='Город' // value={userProfile.studyCity} // onChange={(e) => { // setUserProfile({ ...userProfile, studyCity: e.target.value }); // setUserData({ ...userState.userData!, city: e.target.value }); // }} // /> // </div> // <div className='flex justify-end space-x-2'> // <Button variant='outline' onClick={() => setIsEditModalOpen(false)}> // Отмена // </Button> // <Button onClick={() => setIsEditModalOpen(false)}>Сохранить</Button> // </div> // </DialogContent> // </Dialog> // ); // const menuItems = [ // { // icon: <Search className='h-5 w-5 mr-2' />, // text: 'Поиск участников и список фирм', // action: () => router.push('/search'), // }, // { // icon: <MapPin className='h-5 w-5 mr-2' />, // text: 'Расчет расстояний', // action: () => {}, // }, // { // icon: <Heart className='h-5 w-5 mr-2' />, // text: 'Избранное', // action: () => router.push('/favorites'), // }, // { // icon: <FileText className='h-5 w-5 mr-2' />, // text: 'Инструкции', // action: () => {}, // }, // { // icon: <HelpCircle className='h-5 w-5 mr-2' />, // text: 'Поддержка', // action: () => {}, // }, // { // icon: <Settings className='h-5 w-5 mr-2' />, // text: 'Настройки приложения', // action: () => router.push('/settings'), // }, // { // icon: <MessageSquare className='h-5 w-5 mr-2' />, // text: 'Отзывы', // action: () => {}, // }, // ]; // return ( // <div className='min-h-screen bg-gray-50 p-4 pb-20'> // <div className='flex items-center mb-6'> // <Button variant='ghost' onClick={() => router.back()}> // <ArrowLeft className='h-6 w-6' /> // </Button> // <h1 className='text-2xl font-bold ml-2'>Меню</h1> // </div> // <div className='flex items-center justify-between mb-4'> // <div className='flex items-center'> // <Avatar className='h-12 w-12 mr-4'> // <img src={userProfile.photo} alt={userProfile.name} /> // </Avatar> // <div> // <p className='font-semibold'>{userProfile.name}</p> // <Button // variant='link' // className='p-0' // onClick={() => setShowProfile(!showProfile)} // > // Личный кабинет // </Button> // </div> // </div> // <Button // variant='ghost' // size='sm' // onClick={() => setIsEditModalOpen(true)} // > // <ChevronRight className='h-5 w-5' /> // </Button> // </div> // {showProfile ? ( // renderProfile() // ) : ( // <> // <Input className='mb-4' placeholder='Поиск...' /> // {menuItems.map((item, index) => ( // <Button // key={index} // variant='ghost' // className='w-full justify-start mb-2' // onClick={item.action} // > // {item.icon} // {item.text} // </Button> // ))} // </> // )} // <EditProfileModal /> // <Dialog open={showLogoutConfirm} onOpenChange={setShowLogoutConfirm}> // <DialogContent> // <DialogHeader> // <DialogTitle>Подтверждение выхода</DialogTitle> // </DialogHeader> // <p>Вы уверены, что хотите выйти?</p> // <div className='flex justify-end space-x-2 mt-4'> // <Button // variant='outline' // onClick={() => setShowLogoutConfirm(false)} // > // Отмена // </Button> // <Button variant='destructive' onClick={handleLogout}> // Выйти // </Button> // </div> // </DialogContent> // </Dialog> // <NavigationMenu // userRole={userState.role === 'carrier' ? 'carrier' : 'other'} // /> // </div> // ); // } 'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Avatar } from '@/components/ui/avatar'; import { Input } from '@/components/ui/input'; import { ScrollArea } from '@/components/ui/scroll-area'; import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, } from '@/components/ui/dialog'; import { Separator } from '@/components/ui/separator'; import { toast } from 'sonner'; import { Search, MapPin, Heart, FileText, HelpCircle, Settings, MessageSquare, LogOut, ChevronRight, Camera, Trash2, ArrowLeft, User, Building2, Truck, GraduationCap, Loader2, Gamepad, FileIcon, Plus, Trash2Icon, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { useUser } from '@/contexts/UserContext'; import { api } from '@/lib/api'; import { Language, UserRole, UserType } from '@/types'; import { Badge } from '@/components/ui/badge'; import { FileUpload } from '@/components/FileUpload'; import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem, } from '@radix-ui/react-select'; interface ProfileField { key: string; label: string; type: 'text' | 'tel' | 'email' | 'date'; required?: boolean; } const defaultProfiles: Record<string, ProfileField[]> = { student: [ { key: 'full_name', label: 'ФИО', type: 'text', required: true }, { key: 'student_id', label: 'Студенческий ID', type: 'text', required: true, }, { key: 'username', label: 'Telegram', type: 'text' }, { key: 'whatsapp_number', label: 'WhatsApp', type: 'tel' }, { key: 'phone_number', label: 'Телефон', type: 'tel', required: true }, { key: 'group_name', label: 'Группа', type: 'text', required: true }, { key: 'end_date', label: 'Дата окончания', type: 'date' }, ], carrier: [ { key: 'full_name', label: 'ФИО', type: 'text', required: true }, { key: 'company_name', label: 'Название компании', type: 'text' }, // { key: 'telegramNumber', label: 'Telegram', type: 'text' }, { key: 'whatsapp_number', label: 'WhatsApp', type: 'tel' }, { key: 'phone_number', label: 'Телефон', type: 'tel', required: true }, // { // key: 'licenseNumber', // label: 'Номер лицензии', // type: 'text', // required: true, // }, ], 'cargo-owner': [ { key: 'full_name', label: 'ФИО', type: 'text', required: true }, { key: 'company_name', label: 'Название компании', type: 'text', required: true, }, // { key: 'telegramNumber', label: 'Telegram', type: 'text' }, { key: 'whatsapp_number', label: 'WhatsApp', type: 'tel' }, { key: 'phone_number', label: 'Телефон', type: 'tel', required: true }, // { // key: 'registration_certificate', // label: 'Рег. номер', // type: 'file', // required: true, // }, ], }; const getRoleIcon = (role: string) => { switch (role) { case 'student': return GraduationCap; case 'carrier': return Truck; case 'cargo-owner': return Building2; default: return User; } }; const documentTypes = [ { value: 'driver_license', label: 'Водительские права', required: true }, { value: 'passport', label: 'Паспорт', required: true }, { value: 'company_certificate', label: 'Свидетельство о регистрации компании', required: false, }, { value: 'other', label: 'Другое', required: false }, ] as const; interface DocumentFormData { file: File; type: 'driver_license' | 'passport' | 'company_certificate' | 'other'; title: string; } export interface Document { id: string; type: string; title: string; file_url: string; uploaded_at: string; verified: boolean; verified_at?: string; notes?: string; } export interface VehicleDocument extends Document { vehicle_id: string; expiry_date?: string; } export interface UserDocument extends Document { user_id: string; } const DocumentsSection = () => { const [documents, setDocuments] = useState<UserDocument[]>([]); const [isAddingDocument, setIsAddingDocument] = useState(false); const [isLoading, setIsLoading] = useState(true); const [selectedDocument, setSelectedDocument] = useState<DocumentFormData | null>(null); useEffect(() => { fetchDocuments(); }, []); const fetchDocuments = async () => { try { setIsLoading(true); const response = await api.getUserDocuments(); setDocuments(response); console.log(response, 'document users'); } catch (error) { toast.error('Ошибка при загрузке документов'); } finally { setIsLoading(false); } }; const handleDocumentUpload = async (document: DocumentFormData) => { try { await api.addUserDocument(document); toast.success('Документ успешно загружен'); fetchDocuments(); setIsAddingDocument(false); } catch (error) { toast.error('Ошибка при загрузке документа'); } }; const handleDeleteDocument = async (id: string) => { try { await api.deleteUserDocument(id); toast.success('Документ удален'); fetchDocuments(); } catch (error) { toast.error('Ошибка при удалении документа'); } }; const renderDocumentCard = (document: UserDocument) => ( <Card key={document.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start'> <div> <h3 className='font-semibold'>{document.title}</h3> <p className='text-sm text-gray-600'> {documentTypes.find((t) => t.value === document.type)?.label} </p> </div> <div className='flex space-x-2'> <Badge variant={document.verified ? 'outline' : 'secondary'}> {document.verified ? 'Проверен' : 'На проверке'} </Badge> <Button variant='ghost' size='sm' onClick={() => window.open(document.file_url, '_blank')} > <FileIcon className='h-4 w-4 mr-1' /> Просмотр </Button> <Button variant='ghost' size='sm' className='text-red-600' onClick={() => handleDeleteDocument(document.id)} > <Trash2Icon className='h-4 w-4' /> </Button> </div> </div> </CardContent> </Card> ); const renderAddDocumentDialog = () => ( <Dialog open={isAddingDocument} onOpenChange={setIsAddingDocument}> <DialogContent> <DialogHeader> <DialogTitle>Добавить документ</DialogTitle> </DialogHeader> <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'>type*</label> <Select value={selectedDocument?.type} onValueChange={(value: any) => setSelectedDocument( (prev) => ({ ...prev, type: value } as DocumentFormData) ) } > <SelectTrigger> <SelectValue placeholder='Выберите тип документа' /> </SelectTrigger> <SelectContent> {documentTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} {type.required && ' *'} </SelectItem> ))} </SelectContent> </Select> </div> {/* <Select value={selectedDocument?.type} onValueChange={(value: any) => setSelectedDocument( (prev) => ({ ...prev, type: value } as DocumentFormData) ) } > <SelectTrigger> <SelectValue placeholder='Выберите тип документа' /> </SelectTrigger> <SelectContent> {documentTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} {type.required && ' *'} </SelectItem> ))} </SelectContent> </Select> */} <Input placeholder='Название документа' value={selectedDocument?.title || ''} onChange={(e) => setSelectedDocument( (prev) => ({ ...prev, title: e.target.value } as DocumentFormData) ) } /> <FileUpload onUpload={(file) => { if (selectedDocument?.type) { handleDocumentUpload({ file, type: selectedDocument.type, title: selectedDocument.title || file.name, }); } else { toast.error('Выберите тип документа'); } }} allowedTypes={['image/jpeg', 'image/png', 'application/pdf']} maxSize={5 * 1024 * 1024} label='Загрузить документ' /> </div> </DialogContent> </Dialog> ); if (isLoading) { return <Loader2 className='h-8 w-8 animate-spin text-blue-600' />; } return ( <div className='space-y-4'> <div className='flex justify-between items-center'> <h2 className='text-xl font-semibold'>Мои документы</h2> <Button onClick={() => setIsAddingDocument(true)}> <Plus className='h-4 w-4 mr-2' /> Добавить документ </Button> </div> {documents.length === 0 ? ( <div className='text-center text-gray-500 py-8'> У вас пока нет загруженных документов </div> ) : ( documents.map(renderDocumentCard) )} {renderAddDocumentDialog()} </div> ); }; // Add DocumentsSection to your menu page layout where appropriate export default function MenuPage() { const [showProfile, setShowProfile] = useState<boolean>(false); const [isEditModalOpen, setIsEditModalOpen] = useState<boolean>(false); const [showLogoutConfirm, setShowLogoutConfirm] = useState<boolean>(false); const [formData, setFormData] = useState<Record<string, string>>({}); const [isUploading, setIsUploading] = useState<boolean>(false); const [isMobile, setIsMobile] = useState<boolean>(false); const [isLoading, setIsLoading] = useState<boolean>(true); const [isSaving, setIsSaving] = useState<boolean>(false); const router = useRouter(); const { userState, setUserRole, setLanguage, setUserType, logout } = useUser(); useEffect(() => { fetchUserProfile(); // Check if running in Telegram WebApp const isTelegramWebApp = window.Telegram?.WebApp; // Check viewport width for mobile const checkMobile = () => { setIsMobile(window.innerWidth < 768 || !!isTelegramWebApp); }; checkMobile(); window.addEventListener('resize', checkMobile); return () => window.removeEventListener('resize', checkMobile); }, []); const fetchUserProfile = async () => { try { setIsLoading(true); const userData = await api.getCurrentUser(); console.log(userData); setUserRole(userData.role); // if (userData.role === 'carrier' && userData.is_verified === false) { // router.push('driver-verification/'); // } setFormData(userData); console.log(formData); } catch (error) { toast.error('Ошибка при загрузке профиля'); console.error('Error fetching profile:', error); } finally { setIsLoading(false); } }; const handleInputChange = (key: string, value: string) => { setFormData((prev) => ({ ...prev, [key]: value })); }; const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => { const file = e.target.files?.[0]; if (!file) return; if (!file.type.startsWith('image/')) { toast.error('Пожалуйста, загрузите изображение'); return; } if (file.size > 5 * 1024 * 1024) { toast.error('Размер файла не должен превышать 5MB'); return; } try { setIsUploading(true); // Here you would normally upload the file to your server // const formData = new FormData(); // formData.append('photo', file); // const response = await api.uploadProfilePhoto(formData); // For now, just create a local preview const previewUrl = URL.createObjectURL(file); setFormData((prev) => ({ ...prev, photo: previewUrl })); toast.success('Фото профиля успешно обновлено'); } catch (error) { toast.error('Ошибка при загрузке фото'); console.error('Error uploading photo:', error); } finally { setIsUploading(false); } }; const handleRemovePhoto = async () => { try { // Here you would normally call an API endpoint to remove the photo // await api.removeProfilePhoto(); setFormData((prev) => { const newData = { ...prev }; delete newData.photo; return newData; }); toast.success('Фото профиля удалено'); } catch (error) { toast.error('Ошибка при удалении фото'); console.error('Error removing photo:', error); } }; const handleSaveProfile = async () => { try { setIsSaving(true); const data = { student_id: formData.telegram_id, ...formData }; console.log(data, 'data'); await api.updateProfile(data); setUserRole(formData?.role as UserRole); setUserType(formData.type as UserType); setLanguage(formData.preferred_language as Language); setIsEditModalOpen(false); toast.success('Профиль успешно обновлен'); fetchUserProfile(); // Refresh profile data } catch (error) { toast.error('Ошибка при обновлении профиля'); console.error('Error updating profile:', error); } finally { setIsSaving(false); } }; const handleLogout = () => { logout(); router.push('/'); toast.success('Вы успешно вышли из системы'); }; const getProfileFields = () => { return ( defaultProfiles[formData.role || 'carrier'] || defaultProfiles.carrier ); }; console.log(formData, 'formdataa'); const RoleIcon = getRoleIcon(userState.role || 'carrier'); const menuItems = [ { icon: Search, text: 'Поиск участников и список фирм', action: () => router.push('/search'), }, { icon: MapPin, text: 'Расчет расстояний', action: () => router.push('/calculate-distance'), }, { icon: Heart, text: 'Избранное', action: () => router.push('/favorites') }, { icon: FileText, text: 'Инструкции', action: () => router.push('/instructions'), }, { icon: HelpCircle, text: 'Поддержка', action: () => router.push('/support'), }, { icon: Settings, text: 'Настройки приложения', action: () => router.push('/settings'), }, { icon: MessageSquare, text: 'Отзывы', action: () => router.push('/reviews'), }, { icon: Gamepad, text: 'Игра', action: () => router.push('/game'), }, ]; if (isLoading) { return ( <div className='min-h-screen flex items-center justify-center'> <Loader2 className='h-8 w-8 animate-spin text-primary' /> </div> ); } const renderProfileContent = () => ( <Card className='mt-4'> <CardContent className='p-4'> <div className='flex flex-col sm:flex-row items-center justify-between mb-6'> <div className='flex flex-col sm:flex-row items-center text-center sm:text-left'> <Avatar className='h-20 w-20 sm:h-16 sm:w-16 mb-4 sm:mb-0 sm:mr-4'> <img src={formData.photo || 'https://i.pravatar.cc/150'} alt={formData.full_name || 'Профиль'} className='object-cover' /> </Avatar> <div> <h2 className='text-xl sm:text-2xl font-bold mb-2 sm:mb-1'> {formData.full_name || 'Пользователь'} </h2> <div className='flex items-center justify-center sm:justify-start text-gray-600'> <RoleIcon className='h-4 w-4 mr-1' /> <span className='text-sm'> {formData.role || 'Пользователь'} </span> </div> <div className='flex items-center justify-center sm:justify-start text-gray-600'> <span className='text-sm'> {formData.is_verified ? 'Пользователь Верифицирован' : 'Пользователь Не Верифицирован'}{' '} </span> </div> </div> </div> <Button variant='outline' size='sm' onClick={() => setIsEditModalOpen(true)} className='mt-4 sm:mt-0' > <Camera className='h-4 w-4 mr-2' /> Изменить </Button> </div> <Separator className='my-4' /> <ScrollArea className='h-[calc(100vh-400px)] sm:h-auto pr-4'> <div className='space-y-4'> {getProfileFields().map((field) => ( <div key={field.key} className='space-y-1'> <label className='text-sm font-medium text-gray-500'> {field.label} </label> <p className='text-base break-words'> {formData[field.key] || '—'} </p> </div> ))} </div> </ScrollArea> <Button variant='destructive' className='w-full mt-6' onClick={() => setShowLogoutConfirm(true)} > <LogOut className='h-5 w-5 mr-2' /> Выйти </Button> </CardContent> </Card> ); return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <div className='flex items-center mb-6'> <Button variant='ghost' onClick={() => router.back()} className='p-2'> <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-xl sm:text-2xl font-bold ml-2'>Меню</h1> </div> <div className='flex items-center justify-between mb-4'> <div className='flex items-center'> <Avatar className='h-12 w-12 mr-4'> <img src={formData.photo || 'https://i.pravatar.cc/150'} alt={formData.full_name || 'Профиль'} className='object-cover' /> </Avatar> <div> <p className='font-semibold'> {formData.full_name || 'Пользователь'} </p> <Button variant='link' className='p-0 h-auto text-sm' onClick={() => setShowProfile(!showProfile)} > Личный кабинет </Button> </div> </div> <Button variant='ghost' size='sm' onClick={() => setIsEditModalOpen(true)} className='p-2' > <ChevronRight className='h-5 w-5' /> </Button> </div> {showProfile ? ( renderProfileContent() ) : ( <div className='space-y-2'> {menuItems.map((item, index) => ( <Button key={index} variant='ghost' className='w-full justify-start p-4 h-auto text-left' onClick={item.action} > <item.icon className='h-5 w-5 mr-3 flex-shrink-0' /> <span className='line-clamp-1'>{item.text}</span> </Button> ))} </div> )} <Dialog open={isEditModalOpen} onOpenChange={setIsEditModalOpen}> <DialogContent className={`${ isMobile ? 'w-full h-[100vh] max-w-none m-0 rounded-none' : 'sm:max-w-[425px]' } overflow-hidden flex flex-col`} > <DialogHeader className='px-4 py-3'> <DialogTitle>Редактировать профиль</DialogTitle> </DialogHeader> <ScrollArea className='flex-grow px-4'> <div className='space-y-4 py-4'> <div className='flex flex-col items-center justify-center mb-6'> <Avatar className='h-24 w-24 mb-4'> <img src={formData.photo || 'https://i.pravatar.cc/150'} alt={formData.full_name || 'Профиль'} className='object-cover' /> </Avatar> <div className='space-y-2 w-full flex flex-col items-center'> <div className='relative w-full'> <Input type='file' accept='image/*' onChange={handleImageUpload} className='hidden' id='photo-upload' /> <Button variant='outline' size='sm' disabled={isUploading} onClick={() => document.getElementById('photo-upload')?.click() } className='w-full' > <Camera className='h-4 w-4 mr-2' /> {isUploading ? 'Загрузка...' : 'Изменить фото'} </Button> </div> <Button variant='outline' size='sm' onClick={handleRemovePhoto} disabled={!formData.photo} className='w-full' > <Trash2 className='h-4 w-4 mr-2' /> Удалить фото </Button> </div> </div> {getProfileFields().map((field) => ( <div key={field.key} className='space-y-2'> <label className='text-sm font-medium'> {field.label} {field.required && ( <span className='text-red-500 ml-1'>*</span> )} </label> <Input type={field.type} value={formData[field.key] || ''} onChange={(e) => handleInputChange(field.key, e.target.value) } required={field.required} className='w-full' placeholder={`Введите ${field.label.toLowerCase()}`} /> </div> ))} </div> </ScrollArea> <DialogFooter className='px-4 py-3 mt-2 border-t'> <div className={`flex ${ isMobile ? 'flex-col w-full gap-2' : 'flex-row gap-4' }`} > <Button variant='outline' onClick={() => setIsEditModalOpen(false)} className={isMobile ? 'w-full' : ''} disabled={isSaving} > Отмена </Button> <Button onClick={handleSaveProfile} className={isMobile ? 'w-full' : ''} disabled={isSaving} > {isSaving ? ( <> <Loader2 className='h-4 w-4 mr-2 animate-spin' /> Сохранение... </> ) : ( 'Сохранить' )} </Button> </div> </DialogFooter> </DialogContent> </Dialog> <DocumentsSection /> <Dialog open={showLogoutConfirm} onOpenChange={setShowLogoutConfirm}> <DialogContent className={`${ isMobile ? 'w-[95%] max-w-[95%] mx-auto' : 'sm:max-w-[425px]' }`} > <DialogHeader> <DialogTitle>Подтверждение выхода</DialogTitle> </DialogHeader> <p className='py-4'>Вы уверены, что хотите выйти?</p> <DialogFooter className={`${isMobile ? 'flex-col gap-2' : ''}`}> <Button variant='outline' onClick={() => setShowLogoutConfirm(false)} className={isMobile ? 'w-full' : ''} > Отмена </Button> <Button variant='destructive' onClick={handleLogout} className={isMobile ? 'w-full' : ''} > Выйти </Button> </DialogFooter> </DialogContent> </Dialog> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); }
```

# app\my-cargo\page.tsx

```tsx
// 'use client'; // import React, { useState } from 'react'; // import { Button } from '@/components/ui/button'; // import { Card, CardContent } from '@/components/ui/card'; // import { Badge } from '@/components/ui/badge'; // import { // TruckIcon, // EyeIcon, // PencilIcon, // PowerIcon, // PlusIcon, // } from 'lucide-react'; // import NavigationMenu from '../components/NavigationMenu'; // import { ScrollArea } from '@/components/ui/scroll-area'; // interface Cargo { // id: string; // name: string; // route: string; // weight: string; // volume: string; // isActive: boolean; // } // export default function MyCargoPage() { // const [activeTab, setActiveTab] = useState<'active' | 'inactive'>('active'); // const [cargos, setCargos] = useState<Cargo[]>([ // { // id: '1', // name: 'Металл', // route: 'Москва - Санкт-Петербург', // weight: '20 тонн', // volume: '40 м³', // isActive: true, // }, // // Добавьте больше грузов по необходимости // ]); // const activeCargos = cargos.filter((cargo) => cargo.isActive); // const inactiveCargos = cargos.filter((cargo) => !cargo.isActive); // const handleDeactivate = (id: string) => { // setCargos( // cargos.map((cargo) => // cargo.id === id ? { ...cargo, isActive: false } : cargo // ) // ); // }; // const renderCargoCard = (cargo: Cargo) => ( // <Card key={cargo.id} className='mb-4'> // <CardContent className='p-4'> // <div className='flex justify-between items-start mb-2'> // <h3 className='font-semibold'>{cargo.name}</h3> // <Badge variant={cargo.isActive ? 'default' : 'secondary'}> // {cargo.isActive ? 'Активный' : 'Неактивный'} // </Badge> // </div> // <p className='text-sm text-gray-600 mb-2'>{cargo.route}</p> // <p className='text-sm text-gray-600 mb-4'> // {cargo.weight}, {cargo.volume} // </p> // <div className='flex justify-between'> // <Button variant='outline' size='sm'> // <EyeIcon className='h-4 w-4 mr-2' /> // Показать // </Button> // <Button variant='outline' size='sm'> // <PencilIcon className='h-4 w-4 mr-2' /> // Редактировать // </Button> // {cargo.isActive && ( // <Button // variant='outline' // size='sm' // onClick={() => handleDeactivate(cargo.id)} // > // <PowerIcon className='h-4 w-4 mr-2' /> // Деактивировать // </Button> // )} // </div> // </CardContent> // </Card> // ); // return ( // <div className='min-h-screen bg-gray-100 p-4 pb-24'> // <h1 className='text-3xl font-bold text-center mb-6'>Мои грузы</h1> // <div className='flex mb-4'> // <Button // variant={activeTab === 'active' ? 'default' : 'outline'} // className='flex-1 mr-2' // onClick={() => setActiveTab('active')} // > // Активные{' '} // <Badge variant='secondary' className='ml-2'> // {activeCargos.length} // </Badge> // </Button> // <Button // variant={activeTab === 'inactive' ? 'default' : 'outline'} // className='flex-1' // onClick={() => setActiveTab('inactive')} // > // Неактивные{' '} // <Badge variant='secondary' className='ml-2'> // {inactiveCargos.length} // </Badge> // </Button> // </div> // <ScrollArea className='h-[calc(100vh-250px)]'> // {cargos.length === 1 && cargos[0].isActive && ( // <div // className='bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-4' // role='alert' // > // <p className='font-bold'>Успех!</p> // <p>Ваш груз успешно создан и опубликован.</p> // </div> // )} // {activeTab === 'active' // ? activeCargos.map(renderCargoCard) // : inactiveCargos.map(renderCargoCard)} // </ScrollArea> // <div className='fixed bottom-20 left-4 right-4'> // <Button // className='w-full' // onClick={() => { // /* Navigate to add cargo page */ // }} // > // <PlusIcon className='h-4 w-4 mr-2' /> // Добавить еще груз // </Button> // </div> // <p className='text-sm text-gray-600 italic mt-4 mb-16 text-center'> // Хотим напомнить, что необходимо деактивировать заявку после успешной // сделки. // </p> // <NavigationMenu userRole={'carrier'} /> // </div> // ); // } // app/my-cargo/page.tsx 'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { ScrollArea } from '@/components/ui/scroll-area'; import { EyeIcon, PencilIcon, PowerIcon, PlusIcon, Loader2, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useUser } from '@/contexts/UserContext'; import { api } from '@/lib/api'; import { toast } from 'sonner'; import { useRouter } from 'next/navigation'; interface CargoResponse { results: Cargo[]; } interface Cargo { id: string; title: string; status: string; loading_point: string; unloading_point: string; weight: number; vehicle_type: string; payment_method: string; price?: number; loading_date: string; created_at: string; } export default function MyCargoPage() { const [activeTab, setActiveTab] = useState<'active' | 'inactive'>('active'); const [cargos, setCargos] = useState<CargoResponse>({ results: [] }); const [isLoading, setIsLoading] = useState(true); const [actionInProgress, setActionInProgress] = useState<string | null>(null); const { userState } = useUser(); const router = useRouter(); useEffect(() => { fetchCargos(); }, []); const fetchCargos = async () => { try { setIsLoading(true); const response = await api.getCargos(); setCargos(response); console.log(response, 'cargos'); } catch (error) { toast.error('Ошибка при загрузке грузов'); console.error('Fetch cargos error:', error); } finally { setIsLoading(false); } }; const handleStatusChange = async (id: string, status: string) => { try { setActionInProgress(id); await api.updateCargo(id, { status }); toast.success('Статус груза обновлен'); await fetchCargos(); } catch (error) { toast.error('Ошибка при обновлении статуса'); console.error('Update status error:', error); } finally { setActionInProgress(null); } }; const getStatusBadgeVariant = (status: string) => { switch (status) { case 'active': case 'pending': return 'default'; case 'completed': return 'secondary'; case 'cancelled': return 'destructive'; default: return 'secondary'; } }; const getStatusLabel = (status: string) => { const labels: Record<string, string> = { active: 'Активный', pending: 'Ожидает', completed: 'Завершен', cancelled: 'Отменен', draft: 'Черновик', inactive: 'Неактивный', }; return labels[status] || status; }; const activeCargos = cargos?.results?.filter((cargo) => ['active', 'pending', 'draft'].includes(cargo.status) ); const inactiveCargos = cargos?.results?.filter((cargo) => ['completed', 'cancelled', 'inactive'].includes(cargo.status) ); const handleView = (id: string) => { router.push(`/cargo/${id}`); }; const handleEdit = (id: string) => { router.push(`/cargo/${id}/edit`); }; const renderCargoCard = (cargo: Cargo) => ( <Card key={cargo.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-2'> <h3 className='font-semibold'>{cargo.title}</h3> <Badge variant={getStatusBadgeVariant(cargo.status)}> {getStatusLabel(cargo.status)} </Badge> </div> <p className='text-sm text-gray-600 mb-2'> {cargo.loading_point} - {cargo.unloading_point} </p> <p className='text-sm text-gray-600 mb-4'> {cargo.weight} т, {cargo.vehicle_type} {cargo.price && `, ${cargo.price} ₽`} </p> <div className='flex justify-between'> <Button variant='outline' size='sm' onClick={() => handleView(cargo.id)} > <EyeIcon className='h-4 w-4 mr-2' /> Показать </Button> <Button variant='outline' size='sm' onClick={() => handleEdit(cargo.id)} > <PencilIcon className='h-4 w-4 mr-2' /> Редактировать </Button> {cargo.status === 'active' && ( <Button variant='outline' size='sm' onClick={() => handleStatusChange(cargo.id, 'inactive')} disabled={actionInProgress === cargo.id} > {actionInProgress === cargo.id ? ( <Loader2 className='h-4 w-4 mr-2 animate-spin' /> ) : ( <PowerIcon className='h-4 w-4 mr-2' /> )} Деактивировать </Button> )} </div> </CardContent> </Card> ); if (isLoading) { return ( <div className='min-h-screen bg-gray-100 p-4 flex items-center justify-center'> <Loader2 className='h-8 w-8 animate-spin text-blue-600' /> </div> ); } return ( <div className='min-h-screen bg-gray-100 p-4 pb-24'> <h1 className='text-3xl font-bold text-center mb-6'>Мои грузы</h1> <div className='flex mb-4'> <Button variant={activeTab === 'active' ? 'default' : 'outline'} className='flex-1 mr-2' onClick={() => setActiveTab('active')} > Активные <Badge variant='secondary' className='ml-2'> {activeCargos?.length} </Badge> </Button> <Button variant={activeTab === 'inactive' ? 'default' : 'outline'} className='flex-1' onClick={() => setActiveTab('inactive')} > Неактивные <Badge variant='secondary' className='ml-2'> {inactiveCargos?.length} </Badge> </Button> </div> <ScrollArea className='h-[calc(100vh-250px)]'> {activeTab === 'active' ? activeCargos?.map(renderCargoCard) : inactiveCargos?.map(renderCargoCard)} {((activeTab === 'active' && activeCargos?.length === 0) || (activeTab === 'inactive' && inactiveCargos?.length === 0)) && ( <div className='text-center text-gray-500 mt-8'> Нет {activeTab === 'active' ? 'активных' : 'неактивных'} грузов </div> )} </ScrollArea> <div className='fixed bottom-20 left-4 right-4'> <Button className='w-full' onClick={() => router.push('/cargos')}> <PlusIcon className='h-4 w-4 mr-2' /> Добавить еще груз </Button> </div> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> </div> ); }
```

# app\my-cars\page.tsx

```tsx
// 'use client'; // import React, { useState } from 'react'; // import { Button } from "@/components/ui/button"; // import { Input } from "@/components/ui/input"; // import { Card, CardContent } from "@/components/ui/card"; // import { Badge } from "@/components/ui/badge"; // import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"; // import { PlusIcon, FileIcon, Edit2Icon, TrashIcon, ChevronDown, ChevronUp } from 'lucide-react'; // import NavigationMenu from '../components/NavigationMenu'; // interface Vehicle { // id: string; // techPassport1: string; // techPassport2: string; // techPassport1Image: string | null; // techPassport2Image: string | null; // bodyType: string; // capacity: string; // volume: string; // cmr: boolean; // license: string; // dimensions: { // length: string; // width: string; // height: string; // }; // adr: boolean; // dozvol: boolean; // tir: boolean; // licenseFile?: File; // } // type PartialVehicle = { // id?: string; // techPassport1?: string; // techPassport2?: string; // techPassport1Image?: string | null; // techPassport2Image?: string | null; // bodyType?: string; // capacity?: string; // volume?: string; // cmr?: boolean; // license?: string; // dimensions: { // length: string; // width: string; // height: string; // }; // adr?: boolean; // dozvol?: boolean; // tir?: boolean; // licenseFile?: File; // }; // const bodyTypes = [ // 'Тент', // 'Рефрижератор', // 'Изотерм', // 'Контейнер', // 'Автовоз', // 'Бортовой', // ]; // const AddVehicleForm: React.FC<{ onSave: (vehicle: Vehicle) => void; onCancel: () => void }> = ({ onSave, onCancel }) => { // const [formData, setFormData] = useState<PartialVehicle>({ // dimensions: { length: '', width: '', height: '' }, // techPassport1Image: null, // techPassport2Image: null // }); // const handleInputChange = (name: string, value: string | boolean) => { // if (name.startsWith('dimensions.')) { // const dimension = name.split('.')[1] as keyof typeof formData.dimensions; // setFormData(prev => ({ // ...prev, // dimensions: { // ...prev.dimensions, // [dimension]: value as string // } // })); // } else { // setFormData(prev => ({ // ...prev, // [name]: value // })); // } // }; // const handleImageUpload = (e: React.ChangeEvent<HTMLInputElement>, side: 'techPassport1Image' | 'techPassport2Image') => { // const file = e.target.files?.[0]; // if (file) { // const reader = new FileReader(); // reader.onloadend = () => { // if (typeof reader.result === 'string') { // setFormData(prev => ({ // ...prev, // [side]: reader.result // })); // } // }; // reader.readAsDataURL(file); // } // }; // const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>, fieldName: string) => { // const file = e.target.files?.[0]; // if (file) { // setFormData(prev => ({ ...prev, [fieldName]: file })); // } // }; // const handleSubmit = (e: React.FormEvent) => { // e.preventDefault(); // onSave(formData as Vehicle); // }; // return ( // <form onSubmit={handleSubmit} className="space-y-4 bg-white p-6 rounded-lg shadow"> // <h2 className="text-2xl font-bold mb-6">Добавление машины</h2> // <div className="grid grid-cols-1 md:grid-cols-2 gap-4"> // <div> // <label className="block text-sm font-medium mb-2 text-gray-700">Тех. паспорт (стр. 1)</label> // <Input // type="file" // accept="image/*" // onChange={(e) => handleImageUpload(e, 'techPassport1Image')} // className="file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" // /> // {formData.techPassport1Image && ( // <img // src={formData.techPassport1Image} // alt="Tech Passport Front" // className="mt-2 max-h-40 rounded-lg shadow" // /> // )} // </div> // <div> // <label className="block text-sm font-medium mb-2 text-gray-700">Тех. паспорт (стр. 2)</label> // <Input // type="file" // accept="image/*" // onChange={(e) => handleImageUpload(e, 'techPassport2Image')} // className="file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" // /> // {formData.techPassport2Image && ( // <img // src={formData.techPassport2Image} // alt="Tech Passport Back" // className="mt-2 max-h-40 rounded-lg shadow" // /> // )} // </div> // </div> // <div> // <label className="block text-sm font-medium mb-1">Тип кузова</label> // <Select onValueChange={(value) => handleInputChange('bodyType', value)}> // <SelectTrigger> // <SelectValue placeholder="Выберите тип кузова" /> // </SelectTrigger> // <SelectContent> // {bodyTypes.map(type => ( // <SelectItem key={type} value={type}>{type}</SelectItem> // ))} // </SelectContent> // </Select> // </div> // <div className="grid grid-cols-2 gap-4"> // <div> // <label className="block text-sm font-medium mb-1">Грузоподъемность (тонн)</label> // <Input // type="number" // required // onChange={(e) => handleInputChange('capacity', e.target.value)} // /> // </div> // <div> // <label className="block text-sm font-medium mb-1">Объем (м³)</label> // <Input // type="number" // required // onChange={(e) => handleInputChange('volume', e.target.value)} // /> // </div> // </div> // <div> // <label className="block text-sm font-medium mb-1">Лицензия</label> // <Input // type="file" // accept=".pdf,.doc,.docx" // onChange={(e) => handleFileUpload(e, 'licenseFile')} // className="file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" // /> // </div> // <div> // <label className="block text-sm font-medium mb-2">Внутренние габариты кузова (м)</label> // <div className="grid grid-cols-3 gap-4"> // <Input // placeholder="Длина" // type="number" // step="0.1" // required // onChange={(e) => handleInputChange('dimensions.length', e.target.value)} // /> // <Input // placeholder="Ширина" // type="number" // step="0.1" // required // onChange={(e) => handleInputChange('dimensions.width', e.target.value)} // /> // <Input // placeholder="Высота" // type="number" // step="0.1" // required // onChange={(e) => handleInputChange('dimensions.height', e.target.value)} // /> // </div> // </div> // <div className="grid grid-cols-3 gap-4"> // <div className="flex items-center"> // <input // type="checkbox" // id="adr" // className="mr-2" // onChange={(e) => handleInputChange('adr', e.target.checked)} // /> // <label htmlFor="adr">АДР</label> // </div> // <div className="flex items-center"> // <input // type="checkbox" // id="dozvol" // className="mr-2" // onChange={(e) => handleInputChange('dozvol', e.target.checked)} // /> // <label htmlFor="dozvol">Дозвол</label> // </div> // <div className="flex items-center"> // <input // type="checkbox" // id="tir" // className="mr-2" // onChange={(e) => handleInputChange('tir', e.target.checked)} // /> // <label htmlFor="tir">ТИР</label> // </div> // </div> // <div className="flex justify-end space-x-4 mt-6"> // <Button variant="outline" onClick={onCancel}> // Отмена // </Button> // <Button type="submit"> // Сохранить // </Button> // </div> // </form> // ); // }; // const VehicleCard: React.FC<{ vehicle: Vehicle }> = ({ vehicle }) => { // const [isExpanded, setIsExpanded] = useState(false); // return ( // <Card className="bg-white"> // <CardContent className="p-4"> // <div className="flex justify-between items-start mb-4"> // <div> // <h3 className="font-bold text-lg">{vehicle.bodyType}</h3> // <p className="text-sm text-gray-600">{vehicle.capacity} т / {vehicle.volume} м³</p> // </div> // <div className="flex space-x-2"> // {vehicle.adr && <Badge>АДР</Badge>} // {vehicle.dozvol && <Badge>Дозвол</Badge>} // {vehicle.tir && <Badge>ТИР</Badge>} // </div> // </div> // {isExpanded && ( // <div className="space-y-2 text-sm"> // <div className="grid grid-cols-1 md:grid-cols-2 gap-4"> // {vehicle.techPassport1Image && ( // <img src={vehicle.techPassport1Image} alt="Tech Passport Front" className="max-h-40 rounded-lg shadow" /> // )} // {vehicle.techPassport2Image && ( // <img src={vehicle.techPassport2Image} alt="Tech Passport Back" className="max-h-40 rounded-lg shadow" /> // )} // </div> // <p>Размеры: {vehicle.dimensions.length}x{vehicle.dimensions.width}x{vehicle.dimensions.height} м</p> // {vehicle.licenseFile && ( // <p className="flex items-center"> // <FileIcon className="h-4 w-4 mr-2" /> // Лицензия // </p> // )} // </div> // )} // <div className="flex justify-between mt-4"> // <Button // variant="ghost" // size="sm" // onClick={() => setIsExpanded(!isExpanded)} // > // {isExpanded ? <ChevronUp className="h-4 w-4 mr-1" /> : <ChevronDown className="h-4 w-4 mr-1" />} // {isExpanded ? 'Скрыть' : 'Подробнее'} // </Button> // <div className="space-x-2"> // <Button variant="outline" size="sm"> // <Edit2Icon className="h-4 w-4 mr-1" /> // Изменить // </Button> // <Button variant="outline" size="sm" className="text-red-600"> // <TrashIcon className="h-4 w-4 mr-1" /> // Удалить // </Button> // </div> // </div> // </CardContent> // </Card> // ); // }; // export default function MyVehiclesPage() { // const [isAddingVehicle, setIsAddingVehicle] = useState(false); // const [vehicles, setVehicles] = useState<Vehicle[]>([]); // const handleSaveVehicle = (vehicle: Vehicle) => { // setVehicles([...vehicles, { ...vehicle, id: Date.now().toString() }]); // setIsAddingVehicle(false); // }; // return ( // <div className="min-h-screen bg-blue-600 p-4 pb-20"> // <h1 className="text-2xl font-bold text-white text-center mb-6"> // Мои машины и заявки // </h1> // {!isAddingVehicle && vehicles.length === 0 && ( // <div className="flex flex-col items-center justify-center space-y-4 mt-10"> // <Button // className="w-64 h-12" // onClick={() => setIsAddingVehicle(true)} // > // <PlusIcon className="h-5 w-5 mr-2" /> // Добавить машину // </Button> // <Button className="w-64 h-12"> // <PlusIcon className="h-5 w-5 mr-2" /> // Добавить заявку // </Button> // </div> // )} // {isAddingVehicle && ( // <AddVehicleForm // onSave={handleSaveVehicle} // onCancel={() => setIsAddingVehicle(false)} // /> // )} // {vehicles.length > 0 && ( // <div className="space-y-4 mb-20"> // {vehicles.map(vehicle => ( // <VehicleCard key={vehicle.id} vehicle={vehicle} /> // ))} // <div className="flex justify-center space-x-4 mt-6"> // <Button onClick={() => setIsAddingVehicle(true)}> // Добавить ещё // </Button> // <Button> // Добавить заявку // </Button> // </div> // </div> // )} // <NavigationMenu userRole="carrier" /> // </div> // ); // } // app/my-cars/page.tsx 'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Card, CardContent } from '@/components/ui/card'; import { Avatar } from '@/components/ui/avatar'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Checkbox } from '@/components/ui/checkbox'; import { ScrollArea } from '@/components/ui/scroll-area'; import { Badge } from '@/components/ui/badge'; import { FileUpload } from '@/components/FileUpload'; import { Camera, FileIcon, Edit2Icon, Trash2Icon, Plus, Loader2, ChevronDown, ChevronUp, } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { api } from '@/lib/api'; import { ApiClient } from '@/lib/api'; import { toast } from 'sonner'; import { useUser } from '@/contexts/UserContext'; interface VehicleResponse { results: Vehicle[]; } interface CarrierRequestResponse { results: CarrierRequest[]; } interface Vehicle { id: string; registration_number: string; body_type: string; loading_type: string; capacity: number; volume: number; length: number; width: number; height: number; registration_country: string; adr: boolean; dozvol: boolean; tir: boolean; license_number?: string; is_active: boolean; is_verified: boolean; documents: VehicleDocument[]; } interface VehicleDocument { id: string; type: string; title: string; file: string; expiry_date?: string; verified: boolean; } interface CarrierRequest { id: string; loading_point: string; unloading_point: string; ready_date: string; vehicle: any; vehicle_count: number; price_expectation?: number; payment_terms?: string; notes?: string; status: | 'pending' | 'assigned' | 'accepted' | 'rejected' | 'completed' | 'cancelled'; } const bodyTypes = [ { value: 'tent', label: 'Тентованный' }, { value: 'refrigerator', label: 'Рефрижератор' }, { value: 'isothermal', label: 'Изотермический' }, { value: 'container', label: 'Контейнер' }, { value: 'car_carrier', label: 'Автовоз' }, { value: 'board', label: 'Бортовой' }, ]; const loadingTypes = [ { value: 'ramps', label: 'Аппарели' }, { value: 'no_doors', label: 'Без ворот' }, { value: 'side', label: 'Боковая' }, { value: 'top', label: 'Верхняя' }, { value: 'hydro_board', label: 'Гидроборт' }, ]; const countries = [ { value: 'UZ', label: 'Узбекистан' }, { value: 'RU', label: 'Россия' }, { value: 'KZ', label: 'Казахстан' }, ]; const initialVehicleForm = { id: '', registration_number: '', body_type: '', loading_type: '', capacity: 0, volume: 0, length: 0, width: 0, height: 0, registration_country: '', adr: false, dozvol: false, tir: false, license_number: '', }; const initialCarrierRequestForm = { loading_point: '', unloading_point: '', ready_date: '', vehicle: '', vehicle_count: 1, price_expectation: undefined, payment_terms: '', notes: '', }; interface DocumentFormData { file: File; type: | 'tech_passport' | 'license' | 'insurance' | 'adr_cert' | 'dozvol' | 'tir' | 'other'; title: string; expiry_date?: string; } const documentTypes = [ { value: 'tech_passport', label: 'Технический паспорт', required: true }, { value: 'license', label: 'Водительские права', required: false }, { value: 'insurance', label: 'Страховка', required: true }, { value: 'adr_cert', label: 'ADR сертификат', required: false }, { value: 'dozvol', label: 'DOZVOL', required: false }, { value: 'tir', label: 'TIR', required: false }, { value: 'other', label: 'Другое', required: false }, ] as const; // const documentTypes = [ // { value: 'tech_passport', label: 'Технический паспорт' }, // { value: 'driver_license', label: 'Водительские права' }, // { value: 'insurance', label: 'Страховка' }, // { value: 'adr_cert', label: 'ADR сертификат' }, // { value: 'dozvol', label: 'DOZVOL' }, // { value: 'tir', label: 'TIR' }, // ]; export default function MyVehiclesPage() { const [vehicles, setVehicles] = useState<VehicleResponse>({ results: [] }); // const [vehicles, setVehicles] = useState<Vehicle[]>([]); const [carrierRequests, setCarrierRequests] = useState<CarrierRequestResponse>({ results: [] }); const [isLoading, setIsLoading] = useState(true); const [isAddingVehicle, setIsAddingVehicle] = useState(false); const [isAddingRequest, setIsAddingRequest] = useState(false); const [selectedVehicle, setSelectedVehicle] = useState<Vehicle | null>(null); const [expandedVehicle, setExpandedVehicle] = useState<string | null>(null); const [isSubmitting, setIsSubmitting] = useState(false); const [vehicleForm, setVehicleForm] = useState(initialVehicleForm); const [requestForm, setRequestForm] = useState(initialCarrierRequestForm); const [documents, setDocuments] = useState<DocumentFormData[]>([]); // const [documents, setDocuments] = useState<{ type: string; file: File }[]>( // [] // ); const { userState } = useUser(); const router = useRouter(); useEffect(() => { fetchVehicles(); fetchCarrierRequests(); }, []); const fetchVehicles = async () => { try { setIsLoading(true); const response = await api.getVehicles(); setVehicles(response); console.log(response, 'res'); } catch (error) { toast.error('Ошибка при загрузке транспорта'); console.error('Fetch vehicles error:', error); } finally { setIsLoading(false); } }; const fetchCarrierRequests = async () => { try { const response = await api.get('/cargo/carrier-requests/'); setCarrierRequests(response); console.log(response, 'res'); } catch (error) { toast.error('Ошибка при загрузке заявок'); console.error('Fetch carrier requests error:', error); } }; const handleVehicleSubmit = async () => { try { setIsSubmitting(true); if (selectedVehicle) { // Check required documents const requiredDocs = documentTypes.filter((dt) => dt.required); const missingDocs = requiredDocs.filter( (dt) => !documents.some((d) => d.type === dt.value) ); if (missingDocs.length > 0) { toast.error( `Необходимо загрузить следующие документы: ${missingDocs .map((d) => d.label) .join(', ')}` ); return; } const vehicleResponse = await api.updateVehicle( vehicleForm.id, vehicleForm ); console.log(vehicleResponse, 'vehres'); const vehicleId = vehicleResponse?.id; console.log(vehicleResponse, 'vehres'); console.log(vehicleId, 'id'); // Upload documents const documentsUploaded = await handleDocumentUpload( vehicleForm.id, documents ); if (!documentsUploaded) { throw new Error('Failed to upload documents'); } // Upload documents // for (const doc of documents) { // const formData = new FormData(); // formData.append('file', doc.file); // formData.append('type', doc.type); // formData.append('vehicle', vehicleId); // const documents = await api.post( // `/vehicles/${vehicleForm.id}/documents/`, // formData // ); // console.log(documents, 'documents'); // } } else { const vehicleResponse = await api.createVehicle(vehicleForm); // Create vehicle console.log(vehicleResponse, 'vehres'); // const vehicleId = vehicleResponse?.id; // console.log(vehicleResponse, 'vehres'); // console.log(vehicleId, 'id'); // Upload documents // const documentsUploaded = await handleDocumentUpload( // vehicleId, // documents // ); // if (!documentsUploaded) { // throw new Error('Failed to upload documents'); // } // // Upload documents // for (const doc of documents) { // const formData = new FormData(); // formData.append('file', doc.file); // formData.append('type', doc.type); // formData.append('vehicle', vehicleId); // const documents = await api.post( // `/vehicles/${vehicleId}/documents/`, // formData // ); // console.log(documents, 'documents'); // } // .then((res) => console.log(res)) // .catch((err) => console.log(err, 'document errror')); } toast.success('Транспорт успешно добавлен'); setIsAddingVehicle(false); setVehicleForm(initialVehicleForm); setDocuments([]); fetchVehicles(); } catch (error) { toast.error('Ошибка при добавлении транспорта'); console.error('Add vehicle error:', error); } finally { setIsSubmitting(false); } }; const handleRequestSubmit = async () => { try { setIsSubmitting(true); await api.post('/cargo/carrier-requests/', requestForm); toast.success('Заявка успешно создана'); setIsAddingRequest(false); setRequestForm(initialCarrierRequestForm); fetchCarrierRequests(); } catch (error) { toast.error('Ошибка при создании заявки'); console.error('Add request error:', error); } finally { setIsSubmitting(false); } }; // Update document upload handler const handleDocumentUpload = async ( vehicleId: string, documents: DocumentFormData[] ) => { try { for (const doc of documents) { await api.addVehicleDocument(vehicleId, { file: doc.file, type: doc.type, title: doc.title, expiry_date: doc.expiry_date, }); } return true; } catch (error) { console.error('Upload documents error:', error); return false; } }; // const handleDocumentUpload = (file: File, type: string) => { // setDocuments((prev) => [...prev, { file, type }]); // }; const handleVehicleInputChange = (name: string, value: any) => { setVehicleForm((prev) => { const updated = { ...prev, [name]: value }; // Calculate volume if dimensions are provided if (['length', 'width', 'height'].includes(name)) { if (updated.length && updated.width && updated.height) { updated.volume = updated.length * updated.width * updated.height; } } return updated; }); }; const handleRequestInputChange = (name: string, value: any) => { setRequestForm((prev) => ({ ...prev, [name]: value, })); }; const renderVehicleForm = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'>Гос. номер*</label> <Input value={vehicleForm.registration_number} onChange={(e) => handleVehicleInputChange('registration_number', e.target.value) } placeholder='Введите гос. номер' /> </div> <div> <label className='block text-sm font-medium mb-2'> Страна регистрации* </label> <Select value={vehicleForm.registration_country} onValueChange={(value) => handleVehicleInputChange('registration_country', value) } > <SelectTrigger> <SelectValue placeholder='Выберите страну' /> </SelectTrigger> <SelectContent> {countries.map((country) => ( <SelectItem key={country.value} value={country.value}> {country.label} </SelectItem> ))} </SelectContent> </Select> </div> <div> <label className='block text-sm font-medium mb-2'>Тип кузова*</label> <Select value={vehicleForm.body_type} onValueChange={(value) => handleVehicleInputChange('body_type', value) } > <SelectTrigger> <SelectValue placeholder='Выберите тип кузова' /> </SelectTrigger> <SelectContent> {bodyTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} </SelectItem> ))} </SelectContent> </Select> </div> <div> <label className='block text-sm font-medium mb-2'>Тип погрузки*</label> <Select value={vehicleForm.loading_type} onValueChange={(value) => handleVehicleInputChange('loading_type', value) } > <SelectTrigger> <SelectValue placeholder='Выберите тип погрузки' /> </SelectTrigger> <SelectContent> {loadingTypes.map((type) => ( <SelectItem key={type.value} value={type.value}> {type.label} </SelectItem> ))} </SelectContent> </Select> </div> <div className='grid grid-cols-2 gap-4'> <div> <label className='block text-sm font-medium mb-2'> Грузоподъемность (тонн)* </label> <Input type='number' value={vehicleForm.capacity || ''} onChange={(e) => handleVehicleInputChange('capacity', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Объем (м³)</label> <Input type='number' value={vehicleForm.volume || ''} onChange={(e) => handleVehicleInputChange('volume', parseFloat(e.target.value)) } /> </div> </div> <div className='grid grid-cols-3 gap-4'> <div> <label className='block text-sm font-medium mb-2'>Длина (м)</label> <Input type='number' value={vehicleForm.length || ''} onChange={(e) => handleVehicleInputChange('length', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Ширина (м)</label> <Input type='number' value={vehicleForm.width || ''} onChange={(e) => handleVehicleInputChange('width', parseFloat(e.target.value)) } /> </div> <div> <label className='block text-sm font-medium mb-2'>Высота (м)</label> <Input type='number' value={vehicleForm.height || ''} onChange={(e) => handleVehicleInputChange('height', parseFloat(e.target.value)) } /> </div> </div> <div className='grid grid-cols-3 gap-4'> <div className='flex items-center'> <Checkbox id='adr' checked={vehicleForm.adr} onCheckedChange={(checked) => handleVehicleInputChange('adr', checked) } /> <label htmlFor='adr' className='ml-2'> ADR </label> </div> <div className='flex items-center'> <Checkbox id='dozvol' checked={vehicleForm.dozvol} onCheckedChange={(checked) => handleVehicleInputChange('dozvol', checked) } /> <label htmlFor='dozvol' className='ml-2'> DOZVOL </label> </div> <div className='flex items-center'> <Checkbox id='tir' checked={vehicleForm.tir} onCheckedChange={(checked) => handleVehicleInputChange('tir', checked) } /> <label htmlFor='tir' className='ml-2'> TIR </label> </div> </div> {selectedVehicle ? ( <div> <label className='block text-sm font-medium mb-2'>Документы</label> {documentTypes.map((docType) => ( <div key={docType.value} className='border rounded-lg p-4 space-y-4' > <div className='flex items-center justify-between'> <span className='font-medium'> {docType.label} {docType.required && ( <span className='text-red-500 ml-1'>*</span> )} </span> </div> <Input type='text' placeholder='Название документа' className='mb-2' onChange={(e) => { const existingDoc = documents.find( (d) => d.type === docType.value ); if (existingDoc) { setDocuments((docs) => docs.map((d) => d.type === docType.value ? { ...d, title: e.target.value } : d ) ); } }} /> <div className='grid grid-cols-2 gap-4'> <Input type='date' placeholder='Срок действия' onChange={(e) => { const existingDoc = documents.find( (d) => d.type === docType.value ); if (existingDoc) { setDocuments((docs) => docs.map((d) => d.type === docType.value ? { ...d, expiry_date: e.target.value } : d ) ); } }} /> <FileUpload onUpload={(file: any) => { const existingDocIndex = documents.findIndex( (d) => d.type === docType.value ); const newDoc: DocumentFormData = { file, type: docType.value, title: `${docType.label} - ${file.name}`, }; if (existingDocIndex !== -1) { setDocuments((docs) => docs.map((d, i) => i === existingDocIndex ? newDoc : d ) ); } else { setDocuments((docs) => [...docs, newDoc]); } }} allowedTypes={['image/jpeg', 'image/png', 'application/pdf']} maxSize={5 * 1024 * 1024} label={`Загрузить ${docType.label}`} /> </div> </div> ))} </div> ) : ( // </div> <p>u will add the documents later nigga</p> )} </div> ); const renderCarrierRequestForm = () => ( <div className='space-y-4'> <div> <label className='block text-sm font-medium mb-2'> Пункт погрузки* </label> <Input placeholder='Откуда' value={requestForm.loading_point} onChange={(e) => handleRequestInputChange('loading_point', e.target.value) } /> </div> <div> <label className='block text-sm font-medium mb-2'> Пункт выгрузки* </label> <Input placeholder='Куда' value={requestForm.unloading_point} onChange={(e) => handleRequestInputChange('unloading_point', e.target.value) } /> </div> <div> <label className='block text-sm font-medium mb-2'> Дата готовности* </label> <Input type='date' value={requestForm.ready_date} onChange={(e) => handleRequestInputChange('ready_date', e.target.value) } min={new Date().toISOString().split('T')[0]} /> </div> <div> <label className='block text-sm font-medium mb-2'>Транспорт*</label> <Select value={requestForm.vehicle} onValueChange={(value) => handleRequestInputChange('vehicle', value)} > <SelectTrigger> <SelectValue placeholder='Выберите транспорт' /> </SelectTrigger> <SelectContent> {vehicles?.results?.map((vehicle: any) => ( <SelectItem key={vehicle.id} value={vehicle.id}> {vehicle.registration_number} -{' '} {bodyTypes.find((t) => t.value === vehicle.body_type)?.label} </SelectItem> ))} </SelectContent> </Select> </div> <div className='grid grid-cols-2 gap-4'> <div> <label className='block text-sm font-medium mb-2'> Количество машин </label> <Input type='number' min={1} value={requestForm.vehicle_count} onChange={(e) => handleRequestInputChange( 'vehicle_count', parseInt(e.target.value) ) } /> </div> <div> <label className='block text-sm font-medium mb-2'> Ожидаемая цена </label> <Input type='number' placeholder='Цена' value={requestForm.price_expectation || ''} onChange={(e) => handleRequestInputChange( 'price_expectation', parseFloat(e.target.value) ) } /> </div> </div> <div> <label className='block text-sm font-medium mb-2'>Условия оплаты</label> <Select value={requestForm.payment_terms || ''} onValueChange={(value) => handleRequestInputChange('payment_terms', value) } > <SelectTrigger> <SelectValue placeholder='Выберите условия оплаты' /> </SelectTrigger> <SelectContent> <SelectItem value='on_loading'>При погрузке</SelectItem> <SelectItem value='on_unloading'>При выгрузке</SelectItem> <SelectItem value='after_unloading'>После выгрузки</SelectItem> <SelectItem value='delayed'>Отсрочка платежа</SelectItem> </SelectContent> </Select> </div> <div> <label className='block text-sm font-medium mb-2'>Примечания</label> <Input placeholder='Дополнительная информация' value={requestForm.notes} onChange={(e) => handleRequestInputChange('notes', e.target.value)} /> </div> </div> ); const renderVehicleCard = (vehicle: Vehicle) => { const isExpanded = expandedVehicle === vehicle.id; // console.log(vehicle, 'vehicelrender'); return ( <Card key={vehicle.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-4'> <div> <h3 className='font-bold text-lg'> {vehicle.registration_number} </h3> <p className='text-sm text-gray-600'> {bodyTypes.find((t) => t.value === vehicle.body_type)?.label} </p> </div> <div className='flex space-x-2'> {vehicle.adr && <Badge>ADR</Badge>} {vehicle.dozvol && <Badge>DOZVOL</Badge>} {vehicle.tir && <Badge>TIR</Badge>} <Badge variant={vehicle.is_verified ? 'default' : 'secondary'}> {/* <Badge variant={vehicle.is_verified ? 'success' : 'secondary'}> */} {vehicle.is_verified ? 'Проверен' : 'На проверке'} </Badge> </div> </div> <div className='space-y-2 text-sm'> <p> {vehicle.capacity} т / {vehicle.volume} м³ </p> <p> Габариты: {vehicle.length}x{vehicle.width}x{vehicle.height} м </p> </div> {isExpanded && ( <div className='mt-4 space-y-4'> <div className='grid grid-cols-1 md:grid-cols-2 gap-4'> {vehicle?.documents?.map((doc) => ( <div key={doc.id} className='flex items-center space-x-2'> <FileIcon className='h-4 w-4' /> <span> {documentTypes.find((t) => t.value === doc.type)?.label} </span> <Badge variant={doc.verified ? 'default' : 'secondary'}> {doc.verified ? 'Проверен' : 'На проверке'} </Badge> </div> ))} </div> <div className='space-y-2'> <p> Тип погрузки:{' '} { loadingTypes.find((t) => t.value === vehicle.loading_type) ?.label } </p> <p> Страна регистрации:{' '} { countries.find( (c) => c.value === vehicle.registration_country )?.label } </p> {vehicle.license_number && ( <p>Номер лицензии: {vehicle.license_number}</p> )} </div> </div> )} <div className='flex justify-between mt-4'> <Button variant='ghost' size='sm' onClick={() => setExpandedVehicle(isExpanded ? null : vehicle.id)} > {isExpanded ? ( <ChevronUp className='h-4 w-4 mr-1' /> ) : ( <ChevronDown className='h-4 w-4 mr-1' /> )} {isExpanded ? 'Скрыть' : 'Подробнее'} </Button> <div className='space-x-2'> <Button variant='outline' size='sm' onClick={() => { setSelectedVehicle(vehicle); setVehicleForm({ ...vehicle, id: vehicle.id || '', license_number: vehicle.license_number || '', }); setIsAddingVehicle(true); }} > <Edit2Icon className='h-4 w-4 mr-1' /> Изменить </Button> <Button variant='outline' size='sm' className='text-red-600' onClick={async () => { try { await api.delete(`/vehicles/${vehicle.id}/`); toast.success('Транспорт удален'); fetchVehicles(); } catch (error) { toast.error('Ошибка при удалении транспорта'); } }} > <Trash2Icon className='h-4 w-4 mr-1' /> Удалить </Button> </div> </div> </CardContent> </Card> ); }; const renderCarrierRequestCard = (request: CarrierRequest) => { console.log(request, 'carriererquest'); return ( <Card key={request.id} className='mb-4'> <CardContent className='p-4'> <div className='flex justify-between items-start mb-4'> <div> <h3 className='font-bold'> {request.loading_point} - {request.unloading_point} </h3> <p className='text-sm text-gray-600'> {request?.vehicle?.registration_number} -{' '} {request.vehicle.body_type} </p> </div> <Badge variant={request.status === 'pending' ? 'secondary' : 'outline'} > {request.status === 'pending' ? 'В ожидании' : 'В работе'} </Badge> </div> <div className='space-y-2 text-sm'> <p> Дата готовности:{' '} {new Date(request.ready_date).toLocaleDateString()} </p> <p>Количество машин: {request.vehicle_count}</p> {request.price_expectation && ( <p>Ожидаемая цена: {request.price_expectation} ₽</p> )} {request.payment_terms && ( <p>Условия оплаты: {request.payment_terms}</p> )} {request.notes && <p>Примечания: {request.notes}</p>} </div> <div className='flex justify-end mt-4 space-x-2'> <Button variant='outline' size='sm' onClick={async () => { try { await api.delete(`/cargo/carrier-requests/${request.id}/`); toast.success('Заявка удалена'); fetchCarrierRequests(); } catch (error) { toast.error('Ошибка при удалении заявки'); } }} > <Trash2Icon className='h-4 w-4 mr-1' /> Удалить </Button> </div> </CardContent> </Card> ); }; if (isLoading) { return ( <div className='min-h-screen bg-gray-100 flex items-center justify-center'> <Loader2 className='h-8 w-8 animate-spin text-blue-600' /> </div> ); } return ( <div className='min-h-screen bg-blue-600 p-4 pb-20'> <h1 className='text-2xl font-bold text-white text-center mb-6'> Мои машины и заявки </h1> {!isAddingVehicle && !isAddingRequest && ( <div className='flex flex-col items-center justify-center space-y-4 mt-10'> <Button className='w-64 h-12' onClick={() => setIsAddingVehicle(true)} > <Plus className='h-5 w-5 mr-2' /> Добавить машину </Button> <Button className='w-64 h-12' onClick={() => setIsAddingRequest(true)} > <Plus className='h-5 w-5 mr-2' /> Добавить заявку </Button> </div> )} {isAddingVehicle && ( <Card className='mb-8 shadow-lg'> <CardContent className='p-6'> <h2 className='text-xl font-semibold mb-4'> {selectedVehicle ? 'Редактировать машину' : 'Добавить машину'} </h2> {renderVehicleForm()} <div className='flex justify-end space-x-4 mt-6'> <Button variant='outline' onClick={() => { setIsAddingVehicle(false); setSelectedVehicle(null); setVehicleForm(initialVehicleForm); }} > Отмена </Button> <Button onClick={handleVehicleSubmit} disabled={isSubmitting}> {isSubmitting ? ( <> <Loader2 className='h-4 w-4 mr-2 animate-spin' /> Сохранение... </> ) : ( 'Сохранить' )} </Button> </div> </CardContent> </Card> )} {isAddingRequest && ( <Card className='mb-8 shadow-lg'> <CardContent className='p-6'> <h2 className='text-xl font-semibold mb-4'>Добавить заявку</h2> {renderCarrierRequestForm()} <div className='flex justify-end space-x-4 mt-6'> <Button variant='outline' onClick={() => { setIsAddingRequest(false); setRequestForm(initialCarrierRequestForm); }} > Отмена </Button> <Button onClick={handleRequestSubmit} disabled={isSubmitting}> {isSubmitting ? ( <> <Loader2 className='h-4 w-4 mr-2 animate-spin' /> Создание... </> ) : ( 'Создать' )} </Button> </div> </CardContent> </Card> )} {vehicles?.results?.length > 0 && ( <div className='mb-8'> <h2 className='text-xl font-semibold text-white mb-4'>Мои машины</h2> {vehicles?.results?.map(renderVehicleCard)} </div> )} {carrierRequests?.results?.length > 0 && ( <div className='mb-20'> <h2 className='text-xl font-semibold text-white mb-4'>Мои заявки</h2> {carrierRequests?.results?.map(renderCarrierRequestCard)} </div> )} <NavigationMenu userRole='carrier' /> </div> ); }
```

# app\notifications\page.tsx

```tsx
'use client'; import React, { useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { Bell, CheckCircle, Trash2, ArrowLeft } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; import { useRouter } from 'next/navigation'; import { useApp } from '@/contexts/AppContext'; import { useNotifications } from '@/hooks/useNotifications'; import { formatDate } from '@/lib/utils'; import { motion, AnimatePresence } from 'framer-motion'; import { useUser } from '@/contexts/UserContext'; export default function NotificationsPage() { const router = useRouter(); const { notifications, notificationsCount, markNotificationAsRead, markAllNotificationsAsRead, deleteNotification, clearAllNotifications, } = useApp(); const { userState } = useUser(); const getNotificationIcon = (type: string) => { switch (type) { case 'cargo': return '📦'; case 'route': return '🚚'; default: return '🔔'; } }; return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <div className='flex items-center mb-6'> <Button variant='ghost' onClick={() => router.back()} className='mr-2'> <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-2xl font-bold'>Уведомления</h1> </div> <div className='flex justify-between items-center mb-4'> <div className='flex items-center'> <Bell className='h-5 w-5 mr-2' /> <span className='font-semibold'> Всего: {notifications.length} {notificationsCount > 0 && ( <Badge variant='secondary' className='ml-2'> Новых: {notificationsCount} </Badge> )} </span> </div> <div className='space-x-2'> <Button variant='outline' size='sm' onClick={markAllNotificationsAsRead} disabled={notificationsCount === 0} > <CheckCircle className='h-4 w-4 mr-2' /> Прочитать все </Button> <Button variant='outline' size='sm' onClick={clearAllNotifications} disabled={notifications.length === 0} > <Trash2 className='h-4 w-4 mr-2' /> Очистить все </Button> </div> </div> <AnimatePresence mode='popLayout'> {notifications.length === 0 ? ( <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }} className='text-center py-8 text-gray-500' > Нет уведомлений </motion.div> ) : ( <div className='space-y-3'> {notifications.map((notification) => ( <motion.div key={notification.id} layout initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: 20 }} transition={{ duration: 0.2 }} > <Card className={`transition-colors ${ !notification.isRead ? 'bg-blue-50' : '' }`} > <CardContent className='p-4'> <div className='flex items-start justify-between'> <div className='flex items-start space-x-3'> <div className='text-2xl'> {getNotificationIcon(notification.type)} </div> <div> <p className='font-medium'>{notification.message}</p> <p className='text-sm text-gray-500'> {formatDate(notification.createdAt)} </p> </div> </div> <div className='flex space-x-2'> {!notification.isRead && ( <Button variant='ghost' size='sm' onClick={() => markNotificationAsRead(notification.id) } > <CheckCircle className='h-4 w-4' /> </Button> )} <Button variant='ghost' size='sm' onClick={() => deleteNotification(notification.id)} > <Trash2 className='h-4 w-4' /> </Button> </div> </div> </CardContent> </Card> </motion.div> ))} </div> )} </AnimatePresence> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> {/* <NavigationMenu userRole='carrier' /> */} </div> ); }
```

# app\page.tsx

```tsx
// import Link from 'next/link'; // export default function Home() { // return ( // <div className='flex flex-col min-h-screen bg-red-700'> // <main className='flex-grow flex items-center justify-center p-4'> // <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white-500 text-white'> // <h1 className='text-3xl font-bold mb-4 text-center text-white'> // Что Умеет Бот? // </h1> // <section className='mb-8 text-center text-white'> // <p> // Logit-Smartbot - №1 Крупнейшая ассоциация логистики в Узбекистане // </p> // </section> // </div> // </main> // <footer className='p-4 fixed bottom-0 left-0 right-0'> // <Link // href='/select-lang' // className='block w-full bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' // > // START // </Link> // </footer> // </div> // ); // } 'use client'; import { useEffect, useState } from 'react'; import Link from 'next/link'; declare global { interface Window { Telegram?: { WebApp: { colorScheme: any; themeParams: any; isExpanded: any; isFullscreen: any; viewportHeight: any; viewportStableHeight: any; enableClosingConfirmation(): unknown; ready(): unknown; expand(): unknown; close(): unknown; onEvent(eventType: any, eventHandler: any): unknown; requestFullscreen(): unknown; exitFullscreen(): unknown; offEvent(eventType: any, eventHandler: any): unknown; initData: string; initDataUnsafe: { query_id: string; user: { id: number; first_name: string; last_name?: string; username?: string; language_code: string; }; auth_date: string; hash: string; }; }; }; } } export default function Home() { const [webAppData, setWebAppData] = useState<any>(null); useEffect(() => { // Check if running in Telegram WebApp environment if (window.Telegram?.WebApp) { const tg = window.Telegram.WebApp; // Get all available WebApp data const webAppInitData = { initDataRaw: tg.initData, initDataParsed: tg.initDataUnsafe, // You can add more WebApp properties here as needed colorScheme: tg.colorScheme, themeParams: tg.themeParams, isExpanded: tg.isExpanded, viewportHeight: tg.viewportHeight, viewportStableHeight: tg.viewportStableHeight, }; // setWebAppData(webAppInitData); // Enable closing confirmation if needed tg.enableClosingConfirmation(); // Ready event to Telegram tg.ready(); setWebAppData(tg); } }, []); return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white-500 text-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Что Умеет Бот? </h1> <section className='mb-8 text-center text-white'> <p> Logit-Smartbot - №1 Крупнейшая ассоциация логистики в Узбекистане </p> </section> {/* Display WebApp Data */} {/* {webAppData && ( <div className='mt-4 p-4 bg-white/10 rounded-lg'> <h2 className='text-xl font-bold mb-2'>Telegram WebApp Data:</h2> <pre className='whitespace-pre-wrap text-sm'> {JSON.stringify(webAppData, null, 2)} </pre> </div> )} */} </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0'> <Link href='/select-lang' className='block w-full bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' > START </Link> </footer> </div> ); }
```

# app\profile\page.tsx

```tsx
// app/profile/page.tsx import React from 'react'; import Layout from '../components/Layout'; import Image from 'next/image'; import Link from 'next/link'; const ProfilePage: React.FC = () => { // Dummy data const user = { id: '12345', name: 'John Doe', username: 'johndoe', role: 'Logistics Manager', verified: true, rating: 4.8, complaints: 1, recommendations: 15, experience: '5 years', position: 'Senior Logistics Coordinator', contact: { email: 'john.doe@example.com', phone: '+1 234 567 8900', }, photoUrl: '/api/placeholder/150/150', }; return ( <Layout> <div className="max-w-2xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden"> <div className="bg-primary text-white p-4"> <div className="flex items-center space-x-4"> <Image src={user.photoUrl} alt={user.name} width={80} height={80} className="rounded-full" /> <div> <h1 className="text-2xl font-bold">{user.name}</h1> <p className="text-sm">{user.username}</p> </div> </div> </div> <div className="p-4 space-y-4"> <div className="grid grid-cols-2 gap-4"> <div> <h2 className="font-semibold">User ID</h2> <p>{user.id}</p> </div> <div> <h2 className="font-semibold">Role</h2> <p>{user.role}</p> </div> <div> <h2 className="font-semibold">Verified</h2> <p>{user.verified ? 'Yes' : 'No'}</p> </div> <div> <h2 className="font-semibold">Rating</h2> <p>{user.rating}/5</p> </div> <div> <h2 className="font-semibold">Complaints</h2> <p>{user.complaints}</p> </div> <div> <h2 className="font-semibold">Recommendations</h2> <p>{user.recommendations}</p> </div> <div> <h2 className="font-semibold">Experience</h2> <p>{user.experience}</p> </div> <div> <h2 className="font-semibold">Position</h2> <p>{user.position}</p> </div> </div> <div> <h2 className="font-semibold">Contact Information</h2> <p>Email: {user.contact.email}</p> <p>Phone: {user.contact.phone}</p> </div> <div> <Link href='/menu'>Go to my profile</Link> </div> </div> </div> </Layout> ); }; export default ProfilePage;
```

# app\registration-confirm\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { motion, AnimatePresence } from 'framer-motion'; import { useRouter } from 'next/navigation'; import { Input } from '@/components/ui/input'; import { Button } from '@/components/ui/button'; import AuthService from '@/lib/auth'; import { useUser } from '@/contexts/UserContext'; const RegistrationCompletionPage: React.FC = () => { const [stage, setStage] = useState<'contact-info' | 'confirmation'>( 'contact-info' ); const { userState } = useUser(); const [phone, setPhone] = useState(''); const [whatsapp, setWhatsapp] = useState(''); const [telegram, setTelegram] = useState(''); const router = useRouter(); const handleSubmit = async (e: React.FormEvent) => { e.preventDefault(); try { // if (window.Telegram?.WebApp) { const webApp = window?.Telegram?.WebApp; // Отправляем регистрацию с полными данными const result = await AuthService.registerUser({ telegramData: webApp, userData: { type: userState.type, role: userState.role, preferred_language: userState.language, phone_number: phone, whatsapp_number: whatsapp, }, }); console.log(result, 'result'); // } // await setUserData({ // result, // // role: userState.role, // }); // await setUserRole(userState.role); // await setUserType(userState.type); // await setLanguage(userState.language); // await setUserType({ type: userState.type }) // toast.success('Регистрация успешно завершена'); // router.push('/menu'); } catch (error) { // toast.error('Ошибка при регистрации. Пожалуйста, попробуйте снова.'); console.error('Registration error:', error); } // Здесь должна быть логика отправки данных на сервер setStage('confirmation'); }; const pageVariants = { initial: { opacity: 0, x: '-100%' }, in: { opacity: 1, x: 0 }, out: { opacity: 0, x: '100%' }, }; const pageTransition = { type: 'tween', ease: 'anticipate', duration: 0.5, }; return ( <div className='min-h-screen bg-blue-600 flex items-center justify-center p-4'> <AnimatePresence mode='wait'> {stage === 'contact-info' && ( <motion.div key='contact-info' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full' > <h1 className='text-3xl font-bold mb-6 text-blue-800 text-center'> Поздравляем! </h1> <p className='mb-6 text-gray-600 text-center'> Идентификация прошла успешно. В целях улучшения взаимодействия и связи с нашими логистами, пожалуйста, предоставьте актуальные контактные данные. </p> <form onSubmit={handleSubmit} className='space-y-4'> <Input type='tel' placeholder='Мобильный телефон' value={phone} onChange={(e) => setPhone(e.target.value)} required className='w-full' /> <Input type='tel' placeholder='WhatsApp' value={whatsapp} onChange={(e) => setWhatsapp(e.target.value)} required className='w-full' /> <Input type='text' placeholder='Telegram' value={telegram} onChange={(e) => setTelegram(e.target.value)} required className='w-full' /> <Button type='submit' className='w-full bg-blue-500 hover:bg-blue-600 text-white' > Далее </Button> </form> </motion.div> )} {stage === 'confirmation' && ( <motion.div key='confirmation' initial='initial' animate='in' exit='out' variants={pageVariants} transition={pageTransition} className='bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center' > <h1 className='text-3xl font-bold mb-6 text-blue-800'> Поздравляем! </h1> <p className='mb-6 text-gray-600'> Регистрация прошла успешно. Теперь вы можете полностью бесплатно пользоваться нашими услугами. </p> <p className='mb-6 text-gray-600'> Вы можете изменить все свои данные в разделе Меню - Личный кабинет. </p> <Button onClick={() => router.push('/menu')} className='w-full bg-blue-500 hover:bg-blue-600 text-white' > Перейти в личный кабинет </Button> </motion.div> )} </AnimatePresence> </div> ); }; export default RegistrationCompletionPage;
```

# app\registration\page.tsx

```tsx
'use client'; import { useState, useEffect } from 'react'; import { Input } from '@/components/ui/input'; import { Button } from '@/components/ui/button'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { useRouter } from 'next/navigation'; import { useUser } from '@/contexts/UserContext'; // import { useUser } from '@/contexts/UserContext'; import { UserState } from '@/types'; import { toast } from 'sonner'; import AuthService from '@/lib/auth'; export default function RegistrationPage() { const router = useRouter(); const { userState, setUserData, setUserRole, setUserType, setLanguage } = useUser(); const [formData, setFormData] = useState<UserState['userData']>({}); const [isLoading, setIsLoading] = useState(false); useEffect(() => { // if (!userState.role) { // router.push('/select-role'); // return; // } // Pre-fill form with Telegram data if available if (typeof window !== 'undefined' && window.Telegram?.WebApp) { const { user } = window.Telegram.WebApp.initDataUnsafe; setFormData((prev) => ({ ...prev, fullName: user.first_name + (user.last_name ? ` ${user.last_name}` : ''), telegramNumber: user.username ? `@${user.username}` : '', })); } if (userState) { console.log(userState.language, 'userstatelang'); console.log(userState.type, 'userstatetype'); console.log(userState.role, 'userstaterole'); } }, [userState.role, router]); const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => { setFormData({ ...formData, [e.target.name]: e.target.value, }); }; const handleSelectChange = (name: string, value: string) => { setFormData({ ...formData, [name]: value, }); }; const validateForm = () => { const requiredFields = getRequiredFields(); // const missingFields = requiredFields.filter((field) => !formData[field]); const missingFields = requiredFields.filter( (field) => formData && formData[field as keyof typeof formData] === undefined ); if (missingFields.length > 0) { toast.error( `Пожалуйста, заполните обязательные поля: ${missingFields.join(', ')}` ); return false; } return true; }; const getRequiredFields = () => { const commonFields = ['fullName', 'phoneNumber']; switch (userState.role) { case 'logistics-company': case 'cargo-owner': return [...commonFields, 'companyName']; case 'student': return [...commonFields, 'groupName']; //'studentId']; case 'carrier': return [...commonFields, 'licenseNumber']; default: return commonFields; } }; const handleSubmit = async (e: React.FormEvent) => { e.preventDefault(); if (!validateForm()) return; setIsLoading(true); try { // if (window.Telegram?.WebApp) { const webApp = window?.Telegram?.WebApp; // Отправляем регистрацию с полными данными const result = await AuthService.registerUser({ telegramData: webApp, userData: { type: userState.type, role: userState.role, preferred_language: userState.language, ...formData, }, }); console.log(result, 'result'); // } // await setUserData({ // result, // // role: userState.role, // }); await setUserRole(userState.role); await setUserType(userState.type); await setLanguage(userState.language); // await setUserType({ type: userState.type }) toast.success('Регистрация успешно завершена'); if (userState.role === 'carrier') { router.push('/driver-verification'); } else { router.push('/menu'); } } catch (error) { toast.error('Ошибка при регистрации. Пожалуйста, попробуйте снова.'); console.error('Registration error:', error); } finally { setIsLoading(false); } }; const clearForm = () => { setFormData({}); }; const renderExpeditorForm = () => ( <form onSubmit={handleSubmit} className='space-y-4'> <Input name='companyName' placeholder='Название компании' onChange={handleInputChange} value={formData?.companyName || ''} required /> <Input name='fullName' placeholder='ФИО' onChange={handleInputChange} value={formData?.fullName || ''} required /> <Input name='telegramNumber' placeholder='Telegram номер' onChange={handleInputChange} value={formData?.telegramNumber || ''} /> <Input name='whatsappNumber' placeholder='WhatsApp номер' onChange={handleInputChange} value={formData?.whatsappNumber || ''} /> <Input name='phoneNumber' placeholder='Мобильный номер' onChange={handleInputChange} value={formData?.phoneNumber || ''} required /> <Select name='position' onValueChange={(value) => handleSelectChange('position', value)} > <SelectTrigger> <SelectValue placeholder='Кем являетесь' /> </SelectTrigger> <SelectContent> <SelectItem value='director'>Директор</SelectItem> <SelectItem value='manager'>Руководитель</SelectItem> <SelectItem value='dispatcher'>Диспетчер</SelectItem> </SelectContent> </Select> <Input name='registrationCertificate' placeholder='Свидетельство о гос. регистрации юр. лица' onChange={handleInputChange} value={formData?.registrationCertificate || ''} /> <div className='flex justify-between mt-6'> <Button variant='destructive' onClick={clearForm} type='button'> Очистить </Button> <Button type='submit' disabled={isLoading}> {isLoading ? 'Сохранение...' : 'Сохранить'} </Button> </div> </form> ); const renderCargoOwnerForm = () => ( <form onSubmit={handleSubmit} className='space-y-4'> <Input name='fullName' placeholder='ФИО' onChange={handleInputChange} value={formData?.fullName || ''} required /> <Input name='telegramNumber' placeholder='Telegram номер' onChange={handleInputChange} value={formData?.telegramNumber || ''} /> <Input name='whatsappNumber' placeholder='WhatsApp номер' onChange={handleInputChange} value={formData?.whatsappNumber || ''} /> <Input name='phoneNumber' placeholder='Мобильный номер' onChange={handleInputChange} value={formData?.phoneNumber || ''} required /> <Select name='role' onValueChange={(value) => handleSelectChange('role', value)} > <SelectTrigger> <SelectValue placeholder='Кем являетесь' /> </SelectTrigger> <SelectContent> <SelectItem value='shipper'>Грузоотправитель</SelectItem> <SelectItem value='consignee'>Грузополучатель</SelectItem> </SelectContent> </Select> <Input name='registrationCertificate' placeholder='Свидетельство о гос. регистрации юр. лица' onChange={handleInputChange} value={formData?.registrationCertificate || ''} /> <div className='flex justify-between mt-6'> <Button variant='destructive' onClick={clearForm} type='button'> Очистить </Button> <Button type='submit' disabled={isLoading}> {isLoading ? 'Сохранение...' : 'Сохранить'} </Button> </div> </form> ); const renderStudentForm = () => ( <form onSubmit={handleSubmit} className='space-y-4'> <Input name='fullName' placeholder='ФИО' onChange={handleInputChange} value={formData?.fullName || ''} required /> <Input name='telegramNumber' placeholder='Telegram номер' onChange={handleInputChange} value={formData?.telegramNumber || ''} /> <Input name='whatsappNumber' placeholder='WhatsApp номер' onChange={handleInputChange} value={formData?.whatsappNumber || ''} /> <Input name='phoneNumber' placeholder='Мобильный номер' onChange={handleInputChange} value={formData?.phoneNumber || ''} required /> <Select name='studentStatus' onValueChange={(value) => handleSelectChange('studentStatus', value)} > <SelectTrigger> <SelectValue placeholder='Кем являетесь' /> </SelectTrigger> <SelectContent> <SelectItem value='current'>Студент Логит Скул</SelectItem> <SelectItem value='graduate'>Выпускник Логит Скул</SelectItem> </SelectContent> </Select> <Select name='city' onValueChange={(value) => handleSelectChange('city', value)} > <SelectTrigger> <SelectValue placeholder='Город обучения' /> </SelectTrigger> <SelectContent> <SelectItem value='tashkent'>Ташкент</SelectItem> <SelectItem value='samarkand'>Самарканд</SelectItem> </SelectContent> </Select> <Select name='tariff' onValueChange={(value) => handleSelectChange('tariff', value)} > <SelectTrigger> <SelectValue placeholder='Тариф обучения' /> </SelectTrigger> <SelectContent> <SelectItem value='standard'>Стандарт Про</SelectItem> <SelectItem value='vip'>ВИП Про</SelectItem> </SelectContent> </Select> <Input name='groupName' placeholder='Название группы' onChange={handleInputChange} value={formData?.groupName || ''} required /> <Select name='studyLanguage' onValueChange={(value) => handleSelectChange('studyLanguage', value)} > <SelectTrigger> <SelectValue placeholder='Язык обучения' /> </SelectTrigger> <SelectContent> <SelectItem value='russian'>Русский</SelectItem> <SelectItem value='uzbek'>Узбекский</SelectItem> </SelectContent> </Select> <Input name='curatorName' placeholder='Имя куратора' onChange={handleInputChange} value={formData?.curatorName || ''} /> <Input name='endDate' type='date' placeholder='Дата окончания обучения' onChange={handleInputChange} value={formData?.endDate || ''} /> <div className='flex justify-between mt-6'> <Button variant='destructive' onClick={clearForm} type='button'> Очистить </Button> <Button type='submit' disabled={isLoading}> {isLoading ? 'Сохранение...' : 'Сохранить'} </Button> </div> </form> ); // Show only the relevant form based on user role console.log(userState.role, 'userstate'); const renderForm = () => { switch (userState.role) { case 'logistics-company': return renderExpeditorForm(); case 'cargo-owner': return renderCargoOwnerForm(); case 'student': return renderStudentForm(); default: return null; } }; return ( <div className='min-h-screen bg-blue-900 p-4'> <h1 className='text-3xl font-bold text-white text-center mb-6'> Пройти регистрацию </h1> <div className='bg-white rounded-lg p-6 max-w-md mx-auto'> {renderForm()} </div> </div> ); }
```

# app\requests\page.tsx

```tsx
'use client'; import { useState } from 'react'; import { Button } from '@/components/ui/button'; import { Home, Truck, Package, Bell, Menu } from 'lucide-react'; import NavigationMenu from '../components/NavigationMenu'; interface RequestType { title: string; count: number; color: string; } export default function RequestsPage() { const [requestTypes, setRequestTypes] = useState<RequestType[]>([ { title: 'Заявки от грузовладельцев', count: 15, color: 'bg-green-500' }, { title: 'Заявки от экс. компаний', count: 8, color: 'bg-yellow-500' }, { title: 'Заявки от перевозчиков', count: 12, color: 'bg-red-500' }, ]); return ( <div className='min-h-screen bg-blue-900 p-4 pb-20'> <h1 className='text-3xl font-bold text-white text-center mb-6'>Заявки</h1> <div className='grid grid-cols-1 md:grid-cols-3 gap-4 mb-20'> {requestTypes.map((type, index) => ( <div key={index} className='bg-white rounded-lg p-4 shadow-lg'> <div className='flex justify-between items-center mb-2'> <h2 className='text-lg font-semibold'>{type.title}</h2> <span className={`${type.color} text-white rounded-full w-8 h-8 flex items-center justify-center`} > {type.count} </span> </div> <Button className='w-full mt-2' variant='outline'> Просмотреть </Button> </div> ))} </div> <NavigationMenu userRole='other' /> </div> ); } // 'use client'; // import React, { useState, useEffect } from 'react'; // import { Input } from '@/components/ui/input'; // import { Button } from '@/components/ui/button'; // import { Card, CardContent } from '@/components/ui/card'; // import { Badge } from '@/components/ui/badge'; // import { // Dialog, // DialogContent, // DialogHeader, // DialogTitle, // } from '@/components/ui/dialog'; // import { Checkbox } from '@/components/ui/checkbox'; // import { // Select, // SelectContent, // SelectItem, // SelectTrigger, // SelectValue, // } from '@/components/ui/select'; // import { DateRange, Range, RangeKeyDict } from 'react-date-range'; // import 'react-date-range/dist/styles.css'; // import 'react-date-range/dist/theme/default.css'; // import { // Filter, // Star, // CheckCircle, // Clock, // Bell, // Heart, // ChevronDown, // ChevronUp, // } from 'lucide-react'; // import NavigationMenu from '../components/NavigationMenu'; // type UserRole = 'carrier' | 'other'; // interface Order { // id: number; // cargo: string; // weight: number; // date: string; // payment: string; // price: string; // from: string; // to: string; // vehicleType: string; // description: string; // isTop: boolean; // isVerified: boolean; // experience: number; // rating: number; // dimensions: string; // loadingType: string; // unloadingType: string; // additionalRequirements: string; // } // interface FilterState { // category: string; // from: string; // to: string; // dateRange: Range; // notifications: boolean; // } // const mockOrders: Order[] = [ // { // id: 1, // cargo: 'Металл', // weight: 22, // date: '12.12.2023 14:34', // payment: 'Комбо', // price: 'Договорная', // from: 'Ташкент', // to: 'Москва', // vehicleType: 'Тент', // description: // 'Ташкент-Москва, нужен-тент, груз-металл, вес:22т, оплата:комбо, дата сообщения: 12.12.2023', // isTop: true, // isVerified: true, // experience: 2, // rating: 4, // dimensions: '5x2x2 м', // loadingType: 'Боковая', // unloadingType: 'Задняя', // additionalRequirements: 'Требуется крепление груза', // }, // // Добавьте больше заказов с дополнительными полями // ]; // const cargoCategories = [ // 'Металл', // 'Текстиль', // 'Продукты', // 'Техника', // 'Стройматериалы', // ]; // const cities = [ // 'Ташкент', // 'Москва', // 'Бухара', // 'Андижан', // 'Самарканд', // 'Санкт-Петербург', // ]; // const RoleConfirmationDialog: React.FC<{ // onConfirm: (role: UserRole) => void; // }> = ({ onConfirm }) => { // return ( // <Dialog open={true}> // <DialogContent> // <DialogHeader> // <DialogTitle>Подтвердите вашу роль</DialogTitle> // </DialogHeader> // <div className='space-y-4'> // <Button onClick={() => onConfirm('carrier')} className='w-full'> // Я перевозчик // </Button> // <Button onClick={() => onConfirm('other')} className='w-full'> // Я другой пользователь // </Button> // </div> // </DialogContent> // </Dialog> // ); // }; // const FilterModal: React.FC<{ // isOpen: boolean; // onClose: () => void; // onApply: (filters: FilterState) => void; // }> = ({ isOpen, onClose, onApply }) => { // const [filters, setFilters] = useState<FilterState>({ // category: '', // from: '', // to: '', // dateRange: { // startDate: undefined, // endDate: undefined, // key: 'selection', // }, // notifications: false, // }); // const handleSelectChange = (name: keyof FilterState, value: string) => { // setFilters((prev) => ({ ...prev, [name]: value })); // }; // const handleDateRangeChange = (ranges: RangeKeyDict) => { // setFilters((prev) => ({ ...prev, dateRange: ranges.selection })); // }; // const handleCheckboxChange = (checked: boolean) => { // setFilters((prev) => ({ ...prev, notifications: checked })); // }; // const handleApply = () => { // onApply(filters); // onClose(); // }; // return ( // <Dialog open={isOpen} onOpenChange={onClose}> // <DialogContent className='bg-blue-600 text-white max-w-[90vw] h-[80vh] overflow-y-auto'> // <DialogHeader> // <DialogTitle className='text-white'>Поиск грузов</DialogTitle> // </DialogHeader> // <div className='space-y-4'> // <Select // onValueChange={(value) => handleSelectChange('category', value)} // > // <SelectTrigger className='bg-blue-500 text-white border-blue-400'> // <SelectValue placeholder='Категория грузов' /> // </SelectTrigger> // <SelectContent> // {cargoCategories.map((category) => ( // <SelectItem key={category} value={category}> // {category} // </SelectItem> // ))} // </SelectContent> // </Select> // <Select onValueChange={(value) => handleSelectChange('from', value)}> // <SelectTrigger className='bg-blue-500 text-white border-blue-400'> // <SelectValue placeholder='Откуда' /> // </SelectTrigger> // <SelectContent> // {cities.map((city) => ( // <SelectItem key={city} value={city}> // {city} // </SelectItem> // ))} // </SelectContent> // </Select> // <Select onValueChange={(value) => handleSelectChange('to', value)}> // <SelectTrigger className='bg-blue-500 text-white border-blue-400'> // <SelectValue placeholder='Куда' /> // </SelectTrigger> // <SelectContent> // {cities.map((city) => ( // <SelectItem key={city} value={city}> // {city} // </SelectItem> // ))} // </SelectContent> // </Select> // <div className='bg-white rounded-md p-2'> // <DateRange // ranges={[filters.dateRange]} // onChange={handleDateRangeChange} // months={1} // direction='vertical' // className='w-full' // /> // </div> // <div className='flex items-center space-x-2'> // <Checkbox // id='notifications' // checked={filters.notifications} // onCheckedChange={handleCheckboxChange} // /> // <label htmlFor='notifications' className='text-white'> // Включить уведомления // </label> // </div> // <Button // onClick={handleApply} // className='w-full bg-yellow-400 text-blue-800 hover:bg-yellow-500' // > // Найти грузы // </Button> // </div> // </DialogContent> // </Dialog> // ); // }; // export default function OrdersPage() { // const [searchTerm, setSearchTerm] = useState(''); // const [orders, setOrders] = useState<Order[]>(mockOrders); // const [isFilterModalOpen, setIsFilterModalOpen] = useState(false); // const [showNotificationDialog, setShowNotificationDialog] = useState(false); // const [userRole, setUserRole] = useState<UserRole | null>(null); // const [expandedOrder, setExpandedOrder] = useState<number | null>(null); // useEffect(() => { // const savedRole = localStorage.getItem('userRole') as UserRole | null; // if (savedRole) { // setUserRole(savedRole); // } // const handleBeforeUnload = () => { // localStorage.clear(); // }; // window.addEventListener('beforeunload', handleBeforeUnload); // return () => { // window.removeEventListener('beforeunload', handleBeforeUnload); // }; // }, []); // const handleRoleConfirm = (role: UserRole) => { // setUserRole(role); // localStorage.setItem('userRole', role); // }; // const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => { // setSearchTerm(e.target.value); // // Здесь должна быть логика фильтрации заказов // }; // const handleApplyFilters = (filters: FilterState) => { // console.log('Applied filters:', filters); // // Здесь должна быть логика применения фильтров к заказам // }; // const renderStars = (rating: number) => { // return Array(5) // .fill(0) // .map((_, i) => ( // <Star // key={i} // className={`h-4 w-4 ${ // i < rating ? 'text-yellow-400 fill-current' : 'text-gray-300' // }`} // /> // )); // }; // const toggleOrderExpansion = (orderId: number) => { // setExpandedOrder(expandedOrder === orderId ? null : orderId); // }; // if (userRole === null) { // return <RoleConfirmationDialog onConfirm={handleRoleConfirm} />; // } // return ( // <div className='min-h-screen bg-blue-600 p-4 pb-20'> // <div className='flex items-center mb-4 bg-white rounded-lg p-2'> // <Input // type='text' // placeholder='Поиск заказов...' // value={searchTerm} // onChange={handleSearch} // className='mr-2 flex-grow' // /> // <Button // variant='default' // size='sm' // className='bg-yellow-400 text-black hover:bg-yellow-500 whitespace-nowrap' // onClick={() => setIsFilterModalOpen(true)} // > // <Filter className='h-4 w-4 mr-2' /> // Фильтры // </Button> // </div> // <FilterModal // isOpen={isFilterModalOpen} // onClose={() => setIsFilterModalOpen(false)} // onApply={handleApplyFilters} // /> // <div className='space-y-4 mb-20'> // {orders.map((order) => ( // <Card key={order.id} className='bg-white overflow-hidden'> // <CardContent className='p-4'> // <div className='flex justify-between items-start mb-2'> // <div className='flex space-x-1'> // {order.isTop && ( // <Badge // variant='secondary' // className='bg-yellow-100 text-yellow-800' // > // <Star className='h-4 w-4' /> // </Badge> // )} // {order.isVerified && ( // <Badge // variant='secondary' // className='bg-green-100 text-green-800' // > // <CheckCircle className='h-4 w-4' /> // </Badge> // )} // {order.experience > 1 && ( // <Badge // variant='secondary' // className='bg-blue-100 text-blue-800' // > // <Clock className='h-4 w-4' /> {order.experience}г // </Badge> // )} // </div> // <div className='flex items-center'> // <span className='font-bold mr-1'>{order.rating}</span> // <div className='flex'>{renderStars(order.rating)}</div> // </div> // </div> // <div className='flex justify-between items-center mb-2'> // <span className='font-bold text-lg'> // {order.from} - {order.to} // </span> // <span className='text-sm text-gray-500'>{order.date}</span> // </div> // <div className='grid grid-cols-2 gap-2 mb-2 text-sm'> // <span>Груз: {order.cargo}</span> // <span>Вес: {order.weight} т</span> // <span>Тип: {order.vehicleType}</span> // <span>Оплата: {order.payment}</span> // </div> // <div className='mb-2'> // <span className='font-semibold'>Цена: {order.price}</span> // </div> // {expandedOrder === order.id && ( // <div className='mt-4 text-sm'> // <p>Размеры: {order.dimensions}</p> // <p>Тип погрузки: {order.loadingType}</p> // <p>Тип разгрузки: {order.unloadingType}</p> // <p>Доп. требования: {order.additionalRequirements}</p> // <p className='mt-2'>Описание: {order.description}</p> // </div> // )} // <div className='flex justify-between mt-4'> // <Button // variant='outline' // size='sm' // className='flex-1 mr-1' // onClick={() => toggleOrderExpansion(order.id)} // > // {expandedOrder === order.id ? ( // <ChevronUp className='h-4 w-4 mr-1' /> // ) : ( // <ChevronDown className='h-4 w-4 mr-1' /> // )} // {expandedOrder === order.id ? 'Скрыть' : 'Подробнее'} // </Button> // <Button // variant='outline' // size='sm' // className='flex-1 ml-1 mr-1' // onClick={() => setShowNotificationDialog(true)} // > // <Bell className='h-4 w-4 mr-1' /> // </Button> // <Button variant='outline' size='sm' className='flex-1'> // <Heart className='h-4 w-4 mr-1' /> // </Button> // </div> // </CardContent> // </Card> // ))} // </div> // <Dialog // open={showNotificationDialog} // onOpenChange={setShowNotificationDialog} // > // <DialogContent> // <DialogHeader> // <DialogTitle>Включить уведомления?</DialogTitle> // </DialogHeader> // <p> // Хотите включить уведомления по выбранным типам груза и направлениям? // </p> // <div className='flex justify-end space-x-2 mt-4'> // <Button // variant='outline' // onClick={() => setShowNotificationDialog(false)} // > // Отмена // </Button> // <Button // onClick={() => { // // Логика включения уведомлений // setShowNotificationDialog(false); // }} // > // Включить // </Button> // </div> // </DialogContent> // </Dialog> // <NavigationMenu userRole={userRole} /> // </div> // ); // }
```

# app\search\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { Button } from '@/components/ui/button'; import { Input } from '@/components/ui/input'; import { Card, CardContent } from '@/components/ui/card'; import { Avatar } from '@/components/ui/avatar'; import { Search, ArrowLeft } from 'lucide-react'; import { useRouter } from 'next/navigation'; interface SearchResult { id: string; name: string; type: 'participant' | 'firm'; details: string; avatar?: string; } const mockSearchResults: SearchResult[] = [ { id: '1', name: 'Иван Иванов', type: 'participant', details: 'Логист, Москва', avatar: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRIRFWZntgIF7DtKKfdha91qSbJdq65mzTUNQNx2hG2Jc2PpLmjRszXG0DoUoWg6eyq2A&usqp=CAU', }, { id: '2', name: 'ООО "Логистика+"', type: 'firm', details: 'Транспортная компания, Санкт-Петербург', }, { id: '3', name: 'Анна Петрова', type: 'participant', details: 'Менеджер, Казань', avatar: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSRIRFWZntgIF7DtKKfdha91qSbJdq65mzTUNQNx2hG2Jc2PpLmjRszXG0DoUoWg6eyq2A&usqp=CAU', }, { id: '4', name: 'ИП Сидоров', type: 'firm', details: 'Грузоперевозки, Новосибирск', }, ]; export default function SearchParticipantsAndFirms() { const [searchTerm, setSearchTerm] = useState<string>(''); const [searchResults, setSearchResults] = useState<SearchResult[]>([]); const [isSearching, setIsSearching] = useState<boolean>(false); const router = useRouter(); const handleSearch = () => { setIsSearching(true); const results = mockSearchResults.filter( (result) => result.name.toLowerCase().includes(searchTerm.toLowerCase()) || result.details.toLowerCase().includes(searchTerm.toLowerCase()) ); setSearchResults(results); }; const renderSearchResults = () => ( <div className='mt-4 space-y-4'> {searchResults.map((result) => ( <Card key={result.id}> <CardContent className='flex items-center p-4'> {result.type === 'participant' && result.avatar && ( <Avatar className='h-10 w-10 mr-4'> <img src={result.avatar} alt={result.name} /> </Avatar> )} {result.type === 'firm' && ( <div className='h-10 w-10 mr-4 bg-blue-100 rounded-full flex items-center justify-center'> <span className='text-blue-600 font-bold'> {result.name[0]} </span> </div> )} <div> <h3 className='font-semibold'>{result.name}</h3> <p className='text-sm text-gray-600'>{result.details}</p> </div> </CardContent> </Card> ))} </div> ); return ( <div className='min-h-screen bg-gray-50 p-4'> <div className='flex items-center mb-6'> <Button variant='ghost' onClick={() => { router.push('/menu'); }} className='mr-2' > <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-2xl font-bold'>Поиск участников и фирм</h1> </div> <div className='flex mb-4'> <Input type='text' placeholder='Поиск по коду или фамилии' value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className='mr-2' /> <Button onClick={handleSearch}> <Search className='h-4 w-4 mr-2' /> Поиск </Button> </div> {isSearching && searchResults.length === 0 && ( <p className='text-center text-gray-600 mt-4'>Ничего не найдено</p> )} {isSearching && searchResults.length > 0 && renderSearchResults()} </div> ); }
```

# app\select-lang\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { useUser } from '@/contexts/UserContext'; import { useRouter } from 'next/navigation'; import { useEffect } from 'react'; export default function LanguageSelection() { const { userState, setLanguage } = useUser(); const router = useRouter(); useEffect(() => { if (userState.isAuthenticated) { router.push('/home'); } }, [userState.isAuthenticated, router]); const handleLanguageSelect = (language: 'ru' | 'uz') => { setLanguage(language); }; return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Выберите язык </h1> <section className='mb-8 text-center text-white'> <p>Пожалуйста, выберите предпочитаемый язык</p> </section> </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0 flex justify-between'> <Link href='/select-person' onClick={() => handleLanguageSelect('ru')} className='w-[48%] bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' > ru РУ </Link> <Link href='/select-person' onClick={() => handleLanguageSelect('uz')} className='w-[48%] bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' > uz УЗ </Link> </footer> </div> ); }
```

# app\select-person\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { User, Building2 } from 'lucide-react'; import { useUser } from '@/contexts/UserContext'; import { useRouter } from 'next/navigation'; import { useEffect } from 'react'; export default function PersonTypeSelection() { const { userState, setUserType } = useUser(); const router = useRouter(); useEffect(() => { if (userState.isAuthenticated) { router.push('/home'); } }, [userState.isAuthenticated, router]); const handleTypeSelect = (type: 'individual' | 'legal') => { setUserType(type); }; return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Выберите тип лица </h1> <section className='mb-8 text-center text-white'> <p>Пожалуйста, выберите тип лица</p> </section> </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0 flex justify-between'> <Link href='/select-role?type=individual' onClick={() => handleTypeSelect('individual')} className='w-[48%] bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center' > <User className='mr-2' size={24} /> Физ. лицо </Link> <Link href='/select-role?type=legal' onClick={() => handleTypeSelect('legal')} className='w-[48%] bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center' > <Building2 className='mr-2' size={24} /> Юр. лицо </Link> </footer> </div> ); }
```

# app\select-role\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { useSearchParams, useRouter } from 'next/navigation'; import { useEffect } from 'react'; import { useUser } from '@/contexts/UserContext'; import { User, Truck, Building2, Package, Briefcase, TrendingUp, ArrowLeft, } from 'lucide-react'; import { Button } from '@/components/ui/button'; import { Card } from '@/components/ui/card'; export default function UserRoleSelection() { const searchParams = useSearchParams(); const router = useRouter(); const { userState, setUserRole } = useUser(); useEffect(() => { if (userState.isAuthenticated) { router.push('/home'); } // if (!userState.type || !userState.language) { // router.push('/select-lang'); // } console.log(userState.language, 'userstatelang') console.log(userState.type, 'userstatetype') }, [userState, router]); const handleRoleSelect = (role: string) => { setUserRole(role as any); if (role === 'student') { router.push('/student-password'); } else if (role === 'carrier') { router.push('/carrier-welcome'); } else { router.push('/start-mini'); } }; const renderIndividualButtons = () => ( <div className='grid grid-cols-2 gap-4 w-full mb-4'> <Button onClick={() => handleRoleSelect('student')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <User size={32} className='mb-2' /> <span>Студент</span> <span className='text-xs mt-1 text-blue-100'> Для учащихся Logit School </span> </Button> <Button onClick={() => handleRoleSelect('carrier')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <Truck size={32} className='mb-2' /> <span>Перевозчик</span> <span className='text-xs mt-1 text-blue-100'> Для владельцев транспорта </span> </Button> </div> ); const renderLegalButtons = () => ( <div className='grid grid-cols-2 gap-4 w-full mb-4'> <Button onClick={() => handleRoleSelect('cargo-owner')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <Package size={32} className='mb-2' /> <span>Грузовладелец</span> <span className='text-xs mt-1 text-blue-100'> Для владельцев грузов </span> </Button> <Button onClick={() => handleRoleSelect('logistics-company')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <Briefcase size={32} className='mb-2' /> <span>Экспедиторская компания</span> <span className='text-xs mt-1 text-blue-100'> Для логистических компаний </span> </Button> <Button onClick={() => handleRoleSelect('transport-company')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <Truck size={32} className='mb-2' /> <span>Транспортная компания</span> <span className='text-xs mt-1 text-blue-100'> Для транспортных компаний </span> </Button> <Button onClick={() => handleRoleSelect('logit-trans')} className='bg-blue-500 hover:bg-blue-600 text-white text-center py-6 px-4 rounded-lg text-sm font-semibold transition duration-300 flex flex-col items-center justify-center h-32' > <TrendingUp size={32} className='mb-2' /> <span>Логит транс</span> <span className='text-xs mt-1 text-blue-100'>Для партнеров Logit</span> </Button> </div> ); const renderContent = () => { const type = searchParams.get('type'); if (type === 'individual') { return renderIndividualButtons(); } if (type === 'legal') { return renderLegalButtons(); } return null; }; return ( <div className='min-h-screen bg-red-700'> <div className='p-4'> <Button variant='ghost' className='text-white mb-4' onClick={() => router.push('/select-person')} > <ArrowLeft className='mr-2' size={24} /> Назад </Button> </div> <main className='flex-grow flex items-center justify-center p-4'> <Card className='bg-red-700 rounded-lg shadow-lg p-6 max-w-2xl w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Выберите вашу роль </h1> <section className='mb-8 text-center text-white'> <p className='mb-4'> Пожалуйста обратите внимание! Сейчас вам необходимо выбрать кем вы являетесь </p> <p>Выберите ваш статус</p> </section> {renderContent()} </Card> </main> </div> ); }
```

# app\settings\page.tsx

```tsx
'use client'; import React, { useState } from 'react'; import { motion, AnimatePresence } from 'framer-motion'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { ArrowLeft, Bell, Globe, Star } from 'lucide-react'; import { useRouter } from 'next/navigation'; interface Language { code: string; name: string; flag: string; } const languages: Language[] = [ { code: 'en', name: 'English', flag: '🇬🇧' }, { code: 'uz', name: 'Ozbek', flag: '🇺🇿' }, { code: 'ru', name: 'Русский', flag: '🇷🇺' }, ]; const NotificationToggle: React.FC<{ enabled: boolean; toggle: () => void; }> = ({ enabled, toggle }) => { return ( <motion.div className='relative w-64 h-64 bg-gradient-to-br from-purple-600 to-blue-600 rounded-full cursor-pointer overflow-hidden' onClick={toggle} whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} > <motion.div className='absolute inset-0 bg-gradient-to-br from-yellow-400 to-orange-500' initial={{ scale: 0 }} animate={{ scale: enabled ? 1 : 0 }} transition={{ duration: 0.5, type: 'spring' }} /> <motion.div className='absolute inset-0 flex items-center justify-center' animate={{ rotate: enabled ? 360 : 0 }} transition={{ duration: 0.5 }} > <Bell className={`h-24 w-24 ${enabled ? 'text-white' : 'text-gray-300'}`} /> </motion.div> <AnimatePresence> {enabled && ( <motion.div className='absolute inset-0' initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} > {[...Array(12)].map((_, i) => ( <motion.div key={i} className='absolute' initial={{ x: '50%', y: '50%', scale: 0 }} animate={{ x: `${50 + 35 * Math.cos((i * 30 * Math.PI) / 180)}%`, y: `${50 + 35 * Math.sin((i * 30 * Math.PI) / 180)}%`, scale: [0, 1, 0], opacity: [0, 1, 0], }} transition={{ repeat: Infinity, duration: 2, delay: i * 0.1, }} > <Star className='h-4 w-4 text-white' /> </motion.div> ))} </motion.div> )} </AnimatePresence> </motion.div> ); }; const LanguageSelector: React.FC<{ selectedLanguage: string; setSelectedLanguage: (lang: string) => void; }> = ({ selectedLanguage, setSelectedLanguage }) => { const [showLanguages, setShowLanguages] = useState(false); return ( <div className='mt-6 relative'> <Button variant='outline' onClick={() => setShowLanguages(!showLanguages)} className='w-full justify-between' > <span> {languages.find((lang) => lang.code === selectedLanguage)?.name} </span> <Globe className='h-5 w-5' /> </Button> <AnimatePresence> {showLanguages && ( <motion.div initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -10 }} className='absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-xl overflow-hidden z-10' > {languages.map((lang) => ( <Button key={lang.code} variant='ghost' className='w-full justify-start' onClick={() => { setSelectedLanguage(lang.code); setShowLanguages(false); }} > <span className='mr-2'>{lang.flag}</span> {lang.name} </Button> ))} </motion.div> )} </AnimatePresence> </div> ); }; export default function AppSettingsPage() { const [notificationsEnabled, setNotificationsEnabled] = useState<boolean>(false); const [selectedLanguage, setSelectedLanguage] = useState<string>('ru'); const router = useRouter(); return ( <div className='min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 p-6 text-white'> <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className='flex items-center mb-8' > <Button variant='ghost' className='mr-4 text-white' onClick={() => { router.push('/menu'); }} > <ArrowLeft className='h-6 w-6' /> </Button> <h1 className='text-3xl font-bold'>Настройки</h1> </motion.div> <Card className='bg-gray-800 border-gray-700'> <CardContent className='p-6'> <h2 className='text-xl font-semibold mb-4 text-center'> Уведомления </h2> <div className='flex justify-center mb-4'> <NotificationToggle enabled={notificationsEnabled} toggle={() => setNotificationsEnabled(!notificationsEnabled)} /> </div> <p className='text-center text-lg'> {notificationsEnabled ? 'Уведомления включены' : 'Уведомления выключены'} </p> <LanguageSelector selectedLanguage={selectedLanguage} setSelectedLanguage={setSelectedLanguage} /> </CardContent> </Card> </div> ); }
```

# app\start-mini\page.tsx

```tsx
'use client'; import Link from 'next/link'; import { ArrowRight } from 'lucide-react'; export default function StartMiniWebsite() { return ( <div className="flex flex-col min-h-screen bg-red-700"> <main className="flex-grow flex items-center justify-center p-4"> <div className="bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white"> <h1 className="text-3xl font-bold mb-4 text-center text-white">Уважаемые пользователи!</h1> <section className="mb-8 text-center text-white"> <p> Для удобства работы и получения всей необходимой информации, пожалуйста перейдите на наш мини-вебсайт по следующей кнопке "начать"👇. </p><br/><p> Вся работа будет осуществляться через этот вебсайт. </p> <p className="mt-4 font-semibold"> Спасибо за сотрудничество! </p> </section> </div> </main> <footer className="p-4 fixed bottom-0 left-0 right-0 flex flex-col"> <Link href="/registration" className="w-full bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center" > Начать <ArrowRight className="ml-2" size={24} /> </Link> </footer> </div> ); }
```

# app\student-password\page.tsx

```tsx
'use client'; import { useState } from 'react'; import { useRouter } from 'next/navigation'; import { Phone } from 'lucide-react'; export default function StudentPasswordPage() { const [password, setPassword] = useState(''); const router = useRouter(); const handleSubmit = (e: any) => { e.preventDefault(); // Здесь должна быть логика проверки пароля // Для демонстрации, просто перенаправляем на страницу старта мини-вебсайта router.push('/start-mini'); }; return ( <div className='flex flex-col min-h-screen bg-red-700'> <main className='flex-grow flex items-center justify-center p-4'> <div className='bg-red-700 rounded-lg shadow-lg p-6 max-w-sm w-full border-2 border-white'> <h1 className='text-3xl font-bold mb-4 text-center text-white'> Доступ к боту </h1> <section className='mb-8 text-center text-white'> <p> Чтобы получить доступ к боту, введите пароль, который предоставлен вашим куратором, или обратитесь к администратору бота. </p> </section> <form onSubmit={handleSubmit} className='mt-4'> <input type='number' value={password} onChange={(e) => setPassword(e.target.value)} className='w-full px-4 py-2 rounded-lg bg-white text-black text-center text-2xl tracking-widest' placeholder='Введите пароль' required /> <button type='submit' className='w-full mt-4 bg-blue-500 hover:bg-blue-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300' > Подтвердить </button> </form> </div> </main> <footer className='p-4 fixed bottom-0 left-0 right-0'> <button onClick={() => alert('Вызов администратора')} className='w-full bg-green-500 hover:bg-green-600 text-white text-center py-3 rounded-lg text-lg font-semibold transition duration-300 flex items-center justify-center' > <Phone className='mr-2' size={24} /> Вызвать администратора </button> </footer> </div> ); }
```

# app\student\cargos\page.tsx

```tsx
'use client'; import React, { useState, useEffect } from 'react'; import { Button } from '@/components/ui/button'; import { Card, CardContent } from '@/components/ui/card'; import { Badge } from '@/components/ui/badge'; import { ScrollArea } from '@/components/ui/scroll-area'; import { Input } from '@/components/ui/input'; import { Dialog, DialogContent, DialogHeader, DialogTitle, } from '@/components/ui/dialog'; import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue, } from '@/components/ui/select'; import { Loader2, Search, Filter, ExternalLink, AlertCircle, } from 'lucide-react'; import NavigationMenu from '@/app/components/NavigationMenu'; import { useUser } from '@/contexts/UserContext'; import { api } from '@/lib/api'; import { toast } from 'sonner'; interface CargoResponse { results: Cargo[]; } interface CarrierRequestResponse { results: CarrierRequest[]; } interface Cargo { id: string; title: string; description: string; owner: { id: string; role: string; company_name?: string; full_name: string; }; weight: number; volume?: number; loading_point: string; unloading_point: string; loading_date: string; vehicle_type: string; payment_method: string; price?: number; status: string; created_at: string; } interface CarrierRequest { id: string; carrier: { id: string; full_name: string; company_name?: string; rating: number; }; vehicle: { id: string; registration_number: string; body_type: string; }; loading_point: string; unloading_point: string; ready_date: string; status: string; } export default function StudentCargosPage() { const [cargos, setCargos] = useState<CargoResponse>({ results: [] }); const [matchingRequests, setMatchingRequests] = useState<CarrierRequest[]>( [] ); const [allRequests, setAllRequests] = useState<CarrierRequestResponse>({ results: [], }); const [selectedCargo, setSelectedCargo] = useState<Cargo | null>(null); const [isLoading, setIsLoading] = useState(true); const [isLoadingRequests, setIsLoadingRequests] = useState(false); const [showCargoDetails, setShowCargoDetails] = useState(false); const [showMatchingRequests, setShowMatchingRequests] = useState(false); const [searchTerm, setSearchTerm] = useState(''); const [filters, setFilters] = useState({ vehicle_type: '', loading_point: '', unloading_point: '', }); const { userState } = useUser(); useEffect(() => { fetchCargos(); }, []); const fetchCargos = async () => { try { setIsLoading(true); const response = await api.get('/cargo/cargos', { params: { status: 'pending', assigned_to: null, ...filters, search: searchTerm, }, }); setCargos(response); console.log(response, 'res'); } catch (error) { toast.error('Ошибка при загрузке грузов'); console.error('Fetch cargos error:', error); } finally { setIsLoading(false); } }; const fetchCarrierRequests = async (cargoId: string) => { try { setIsLoadingRequests(true); // Get matching carriers const matchingResponse = await api.get( `/cargo/cargos/${cargoId}/matching_carriers/` ); setMatchingRequests(matchingResponse.data); console.log(matchingRequests, 'mareq'); // Get all available carriers const allResponse = await api.get('/cargo/carrier-requests/', { params: { status: 'pending', assigned_cargo: null }, }); console.log(allResponse, 'allres'); setAllRequests(allResponse); } catch (error) { toast.error('Ошибка при загрузке заявок перевозчиков'); console.error('Fetch carrier requests error:', error); } finally { setIsLoadingRequests(false); } }; const handleAssignCarrier = async (cargoId: string, requestId: string) => { try { await api.post(`/cargo/cargos/${cargoId}/assign_carrier/`, { carrier_request: requestId, }); toast.success('Груз успешно перенаправлен перевозчику'); setShowMatchingRequests(false); fetchCargos(); } catch (error) { toast.error('Ошибка при назначении перевозчика'); console.error('Assign carrier error:', error); } }; const handleCargoClick = async (cargo: Cargo) => { setSelectedCargo(cargo); setShowCargoDetails(true); await fetchCarrierRequests(cargo.id); }; const renderCargoCard = (cargo: Cargo) => ( <Card key={cargo.id} className='mb-4 hover:shadow-lg transition-shadow cursor-pointer' onClick={() => handleCargoClick(cargo)} > <CardContent className='p-4'> <div className='flex justify-between items-start mb-2'> <div> <h3 className='font-bold text-lg'>{cargo.title}</h3> <p className='text-sm text-gray-600'> {cargo.owner.role === 'cargo-owner' ? 'Грузовладелец' : 'Экспедитор'} : {cargo.owner.company_name || cargo.owner.full_name} </p> </div> <Badge>Новый</Badge> </div> <div className='grid grid-cols-2 gap-2 mb-2 text-sm'> <p> Груз: {cargo.weight} т{cargo.volume ? `, ${cargo.volume} м³` : ''} </p> <p>Тип: {cargo.vehicle_type}</p> <p> Маршрут: {cargo.loading_point} → {cargo.unloading_point} </p> <p> Дата загрузки: {new Date(cargo.loading_date).toLocaleDateString()} </p> </div> <div className='flex justify-between items-center mt-2'> <span className='font-semibold'> {cargo.price ? `${cargo.price} ₽` : 'Цена договорная'} </span> <span className='text-sm text-gray-500'> {new Date(cargo.created_at).toLocaleString()} </span> </div> </CardContent> </Card> ); const renderCargoDetails = () => { if (!selectedCargo) return null; return ( <Dialog open={showCargoDetails} onOpenChange={setShowCargoDetails}> <DialogContent className='max-w-3xl'> <DialogHeader> <DialogTitle>Детали груза</DialogTitle> </DialogHeader> <div className='space-y-4'> <div className='grid grid-cols-2 gap-4'> <div> <h3 className='font-semibold'>Основная информация</h3> <p>Название: {selectedCargo.title}</p> <p>Описание: {selectedCargo.description}</p> <p>Вес: {selectedCargo.weight} т</p> {selectedCargo.volume && ( <p>Объем: {selectedCargo.volume} м³</p> )} </div> <div> <h3 className='font-semibold'>Маршрут</h3> <p>Погрузка: {selectedCargo.loading_point}</p> <p>Выгрузка: {selectedCargo.unloading_point}</p> <p> Дата погрузки:{' '} {new Date(selectedCargo.loading_date).toLocaleDateString()} </p> </div> </div> <div> <h3 className='font-semibold'>Требования</h3> <p>Тип транспорта: {selectedCargo.vehicle_type}</p> <p>Способ оплаты: {selectedCargo.payment_method}</p> {selectedCargo.price && <p>Цена: {selectedCargo.price} ₽</p>} </div> <div className='flex justify-end space-x-2 mt-4'> <Button onClick={() => setShowMatchingRequests(true)}> Найти перевозчика </Button> </div> </div> </DialogContent> </Dialog> ); }; const renderMatchingRequests = () => { return ( <Dialog open={showMatchingRequests} onOpenChange={setShowMatchingRequests} > <DialogContent className='max-w-4xl'> <DialogHeader> <DialogTitle>Подходящие перевозчики</DialogTitle> </DialogHeader> {isLoadingRequests ? ( <div className='flex justify-center py-8'> <Loader2 className='h-8 w-8 animate-spin' /> </div> ) : ( <div className='space-y-4'> {matchingRequests?.length > 0 && ( <div> <h3 className='font-semibold mb-2'>Подходящие заявки</h3> <div className='space-y-2'> {matchingRequests?.map((request) => ( <Card key={request.id}> <CardContent className='p-4'> <div className='flex justify-between items-start'> <div> <h4 className='font-semibold'> {request.carrier.company_name || request.carrier.full_name} </h4> <p className='text-sm'> {request.vehicle.registration_number} -{' '} {request.vehicle.body_type} </p> <p className='text-sm'> {request.loading_point} →{' '} {request.unloading_point} </p> </div> <Button onClick={() => selectedCargo && handleAssignCarrier( selectedCargo.id, request.id ) } > Выбрать </Button> </div> </CardContent> </Card> ))} </div> </div> )} <div> <h3 className='font-semibold mb-2'>Все доступные заявки</h3> <div className='space-y-2'> {allRequests?.results?.map((request) => ( <Card key={request.id}> <CardContent className='p-4'> <div className='flex justify-between items-start'> <div> <h4 className='font-semibold'> {request.carrier.company_name || request.carrier.full_name} </h4> <p className='text-sm'> {request.vehicle.registration_number} -{' '} {request.vehicle.body_type} </p> <p className='text-sm'> {request.loading_point} →{' '} {request.unloading_point} </p> </div> <Button variant='outline' onClick={() => selectedCargo && handleAssignCarrier( selectedCargo?.id, request?.id ) } > Выбрать </Button> </div> </CardContent> </Card> ))} </div> </div> </div> )} </DialogContent> </Dialog> ); }; if (isLoading) { return ( <div className='flex justify-center items-center min-h-screen'> <Loader2 className='h-8 w-8 animate-spin' /> </div> ); } return ( <div className='min-h-screen bg-gray-50 p-4 pb-20'> <div className='max-w-6xl mx-auto'> <h1 className='text-2xl font-bold mb-6'>Доступные грузы</h1> <div className='mb-6 space-y-4'> <div className='flex gap-4'> <Input placeholder='Поиск грузов...' value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className='max-w-sm' /> <Button onClick={fetchCargos}> <Search className='h-4 w-4 mr-2' /> Поиск </Button> </div> <div className='flex gap-4'> <Select value={filters.vehicle_type} onValueChange={(value) => setFilters((f) => ({ ...f, vehicle_type: value })) } > <SelectTrigger className='w-[200px]'> <SelectValue placeholder='Тип транспорта' /> </SelectTrigger> <SelectContent>{/* Add vehicle types */}</SelectContent> </Select> <Button variant='outline' onClick={() => setFilters({ vehicle_type: '', loading_point: '', unloading_point: '', }) } > Сбросить фильтры </Button> </div> </div> <div className='space-y-4'> {cargos?.results?.length === 0 ? ( <div className='text-center py-8 text-gray-500'> Нет доступных грузов </div> ) : ( cargos?.results?.map(renderCargoCard) )} </div> {renderCargoDetails()} {renderMatchingRequests()} </div> <NavigationMenu userRole={userState.role === 'carrier' ? 'carrier' : 'other'} /> {/* <NavigationMenu userRole={userState.role} /> */} </div> ); }
```

# components.json

```json
{ "$schema": "https://ui.shadcn.com/schema.json", "style": "default", "rsc": true, "tsx": true, "tailwind": { "config": "tailwind.config.ts", "css": "app/globals.css", "baseColor": "neutral", "cssVariables": false, "prefix": "" }, "aliases": { "components": "@/components", "utils": "@/lib/utils", "ui": "@/components/ui", "lib": "@/lib", "hooks": "@/hooks" } }
```

# components\ErrorBoundary.tsx

```tsx
'use client'; import React from 'react'; import { Button } from '@/components/ui/button'; import { AlertTriangle } from 'lucide-react'; interface Props { children: React.ReactNode; } interface State { hasError: boolean; error?: Error; } export class ErrorBoundary extends React.Component<Props, State> { public state: State = { hasError: false, }; static getDerivedStateFromError(error: Error): State { return { hasError: true, error }; } componentDidCatch(error: Error, errorInfo: React.ErrorInfo) { console.error('ErrorBoundary caught an error:', error, errorInfo); } render() { if (this.state.hasError) { return ( <div className='min-h-screen bg-gray-100 flex items-center justify-center p-4'> <div className='bg-white rounded-lg shadow-xl p-6 max-w-md w-full text-center'> <AlertTriangle className='h-12 w-12 text-red-500 mx-auto mb-4' /> <h2 className='text-2xl font-bold text-gray-800 mb-2'> Что-то пошло не так </h2> <p className='text-gray-600 mb-4'> Произошла ошибка при загрузке страницы. Пожалуйста, попробуйте обновить страницу. </p> <Button onClick={() => window.location.reload()} className='w-full'> Обновить страницу </Button> </div> </div> ); } return this.props.children; } }
```

# components\FileUpload.tsx

```tsx
'use client'; import React, { useRef, useState } from 'react'; import { Button } from '@/components/ui/button'; import { Progress } from '@/components/ui/progress'; import { FileService } from '@/lib/files'; import { X, Upload, FileIcon } from 'lucide-react'; import { toast } from 'sonner'; interface FileUploadProps { onUpload: (file: any) => void; // type: string; maxSize?: number; allowedTypes?: string[]; label?: string; } export function FileUpload({ onUpload, // type, maxSize = 5 * 1024 * 1024, allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'], label = 'Загрузить файл', }: FileUploadProps) { const [file, setFile] = useState<File | null>(null); const [progress, setProgress] = useState<number>(0); const [isUploading, setIsUploading] = useState<boolean>(false); const fileInputRef = useRef<HTMLInputElement>(null); const handleFileSelect = (event: React.ChangeEvent<HTMLInputElement>) => { const selectedFile = event.target.files?.[0]; if (!selectedFile) return; const error = FileService.validateFile(selectedFile, { maxSize, allowedTypes, }); if (error) { toast.error(error); return; } setFile(selectedFile); }; const handleUpload = async () => { if (!file) return; setIsUploading(true); try { // const result = await FileService.upload(file, type, setProgress); onUpload(file); // onUpload(result); toast.success('Файл успешно загружен'); setFile(null); setProgress(0); } catch (error) { toast.error('Ошибка при загрузке файла'); console.error('Upload error:', error); } finally { setIsUploading(false); } }; const handleClear = () => { setFile(null); setProgress(0); if (fileInputRef.current) { fileInputRef.current.value = ''; } }; return ( <div className='space-y-4'> <div className='flex items-center gap-4'> <input type='file' onChange={handleFileSelect} accept={allowedTypes.join(',')} className='hidden' ref={fileInputRef} /> <Button variant='outline' onClick={() => fileInputRef.current?.click()} disabled={isUploading} > <Upload className='h-4 w-4 mr-2' /> {label} </Button> {file && ( <Button variant='destructive' size='sm' onClick={handleClear} disabled={isUploading} > <X className='h-4 w-4' /> </Button> )} </div> {file && ( <div className='bg-muted p-4 rounded-lg'> <div className='flex items-center justify-between mb-2'> <div className='flex items-center gap-2'> <FileIcon className='h-5 w-5' /> <span className='font-medium truncate'>{file.name}</span> </div> <span className='text-sm text-muted-foreground'> {FileService.formatFileSize(file.size)} </span> </div> {isUploading ? ( <div className='space-y-2'> <Progress value={progress} className='h-2' /> <p className='text-sm text-center text-muted-foreground'> {progress}% </p> </div> ) : ( <Button className='w-full mt-2' onClick={handleUpload}> Загрузить </Button> )} </div> )} <div className='text-sm text-muted-foreground'> <p>Поддерживаемые форматы: {allowedTypes.join(', ')}</p> <p>Максимальный размер: {FileService.formatFileSize(maxSize)}</p> </div> </div> ); }
```

# components\LoadingProvider.tsx

```tsx
// components/LoadingProvider.tsx 'use client'; import React, { createContext, useContext, useState, useEffect } from 'react'; import { usePathname, useSearchParams } from 'next/navigation'; import { motion } from 'framer-motion'; interface LoadingContextType { isLoading: boolean; setIsLoading: (loading: boolean) => void; } const LoadingContext = createContext<LoadingContextType | undefined>(undefined); export function LoadingProvider({ children }: { children: React.ReactNode }) { const [isLoading, setIsLoading] = useState(false); const pathname = usePathname(); const searchParams = useSearchParams(); useEffect(() => { setIsLoading(true); const timer = setTimeout(() => { setIsLoading(false); }, 300); return () => clearTimeout(timer); }, [pathname, searchParams]); return ( <LoadingContext.Provider value={{ isLoading, setIsLoading }}> {isLoading && ( <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} className='fixed top-0 left-0 w-full h-1 bg-primary/80 z-50' > <motion.div className='h-full bg-primary' initial={{ width: '0%' }} animate={{ width: '100%' }} transition={{ duration: 0.3, ease: 'easeInOut' }} /> </motion.div> )} {children} </LoadingContext.Provider> ); } export const useLoading = () => { const context = useContext(LoadingContext); if (context === undefined) { throw new Error('useLoading must be used within a LoadingProvider'); } return context; };
```

# components\LoadingSpinner.tsx

```tsx
'use client'; import { Loader2 } from 'lucide-react'; interface LoadingSpinnerProps { size?: number; className?: string; } export default function LoadingSpinner({ size = 24, className = '', }: LoadingSpinnerProps) { return ( <div className={`flex items-center justify-center ${className}`}> <Loader2 className='animate-spin' size={size} /> </div> ); }
```

# components\RouteGuard.tsx

```tsx
'use client'; import { useUser } from '@/contexts/UserContext'; import { useRouter, usePathname } from 'next/navigation'; import { useEffect } from 'react'; const publicPaths = ['/select-lang', '/select-person', '/select-role']; export default function RouteGuard({ children, }: { children: React.ReactNode; }) { const { userState } = useUser(); const router = useRouter(); const pathname = usePathname(); useEffect(() => { if (!userState.isAuthenticated && !publicPaths.includes(pathname)) { if (!userState.language) { router.push('/select-lang'); } else if (!userState.type) { router.push('/select-person'); } else if (!userState.role) { router.push('/select-role'); } } }, [userState, router, pathname]); return <>{children}</>; }
```

# components\ToastProvider.tsx

```tsx
'use client'; import { Toaster } from 'sonner'; export function ToastProvider() { return ( <Toaster position='top-center' toastOptions={{ style: { background: 'white', color: 'black', border: '1px solid #E2E8F0', }, className: 'shadow-lg', }} /> ); }
```

# contexts\AppContext.tsx

```tsx
'use client'; import React, { createContext, useContext, useEffect, useState } from 'react'; import { useNotifications, Notification } from '@/hooks/useNotifications'; import { FavoriteItem, useFavorites } from '@/hooks/useFavorites'; interface AppContextType { notifications: Notification[]; notificationsCount: number; favoritesCount: number; favorites: FavoriteItem[]; addNotification: (notification: any) => void; markNotificationAsRead: (id: string) => void; markAllNotificationsAsRead: () => void; deleteNotification: (id: string) => void; clearAllNotifications: () => void; addToFavorites: (item: any) => void; removeFromFavorites: (id: number) => void; clearAllFavorites: () => void; isFavorite: (id: number) => boolean; } const AppContext = createContext<AppContextType | undefined>(undefined); export function AppProvider({ children }: { children: React.ReactNode }) { const { notifications: originalNotifications, unreadCount, addNotification: originalAddNotification, markAsRead: originalMarkAsRead, markAllAsRead: originalMarkAllAsRead, deleteNotification: originalDeleteNotification, clearAllNotifications: originalClearAllNotifications, } = useNotifications(); const { favorites: originalFavorites, addToFavorites: originalAddToFavorites, removeFromFavorites: originalRemoveFromFavorites, isFavorite: originalIsFavorite, clearAllFavorites: originalClearAllFavorites, } = useFavorites(); const [notifications, setNotifications] = useState(originalNotifications); const [favorites, setFavorites] = useState(originalFavorites); const [notificationsCount, setNotificationsCount] = useState(unreadCount); const [favoritesCount, setFavoritesCount] = useState( originalFavorites.length ); useEffect(() => { setNotifications(originalNotifications); setNotificationsCount(unreadCount); }, [originalNotifications, unreadCount]); useEffect(() => { setFavorites(originalFavorites); setFavoritesCount(originalFavorites.length); }, [originalFavorites]); // const hasNotification = (type: string, itemId: string): boolean => { // return notifications.some( // notification => notification.type === type && notification.orderId === itemId // ); // }; // const isFavorite = (type: string, itemId: string): boolean => { // return favorites.some( // favorite => favorite.type === type && favorite.orderId === itemId // ); // }; const addNotification = (notification: any) => { originalAddNotification(notification); // После добавления уведомления обновляем состояние setNotifications((prev) => [...prev, notification]); setNotificationsCount((prev) => prev + 1); }; const markNotificationAsRead = (id: string) => { originalMarkAsRead(id); setNotifications((prev) => prev.map((notif) => notif.id === id ? { ...notif, isRead: true } : notif ) ); setNotificationsCount((prev) => Math.max(0, prev - 1)); }; const markAllNotificationsAsRead = () => { originalMarkAllAsRead(); setNotifications((prev) => prev.map((notif) => ({ ...notif, isRead: true })) ); setNotificationsCount(0); }; const deleteNotification = (id: string) => { const notification = notifications.find((n) => n.id === id); originalDeleteNotification(id); setNotifications((prev) => prev.filter((notif) => notif.id !== id)); if (notification && !notification.isRead) { setNotificationsCount((prev) => Math.max(0, prev - 1)); } }; const clearAllNotifications = () => { originalClearAllNotifications(); setNotifications([]); setNotificationsCount(0); }; const addToFavorites = (item: any) => { originalAddToFavorites(item); setFavorites((prev) => [...prev, item]); setFavoritesCount((prev) => prev + 1); }; const removeFromFavorites = (id: number) => { originalRemoveFromFavorites(id); setFavorites((prev) => prev.filter((item) => item.orderId !== id)); setFavoritesCount((prev) => Math.max(0, prev - 1)); }; const clearAllFavorites = () => { originalClearAllFavorites(); setFavorites([]); setFavoritesCount(0); }; const value = { notifications, notificationsCount, favoritesCount, favorites, addNotification, markNotificationAsRead, markAllNotificationsAsRead, deleteNotification, clearAllNotifications, addToFavorites, removeFromFavorites, clearAllFavorites, isFavorite: originalIsFavorite, }; return <AppContext.Provider value={value}>{children}</AppContext.Provider>; } export function useApp() { const context = useContext(AppContext); if (context === undefined) { throw new Error('useApp must be used within an AppProvider'); } return context; }
```

# contexts\AuthContext.tsx

```tsx
// contexts/AuthContext.tsx 'use client'; import React, { createContext, useContext, useEffect, useState } from 'react'; import { api } from '@/lib/api'; import { useRouter } from 'next/navigation'; import { toast } from 'sonner'; interface User { id: string; telegram_id: string; username?: string; full_name: string; type?: 'individual' | 'legal'; role?: 'student' | 'carrier' | 'cargo-owner' | 'logistics-company'; is_verified: boolean; preferred_language?: string; [key: string]: any; } interface AuthContextType { user: User | null; isAuthenticated: boolean; isLoading: boolean; login: (telegramData: any) => Promise<void>; logout: () => void; updateUser: (data: Partial<User>) => Promise<void>; handleTelegramWebAppInit: () => Promise<void>; } const AuthContext = createContext<AuthContextType | undefined>(undefined); interface TelegramWebAppData { initData: string; initDataUnsafe: { query_id: string; user: { id: number; first_name: string; last_name?: string; username?: string; language_code?: string; }; auth_date: string; hash: string; }; } export function AuthProvider({ children }: { children: React.ReactNode }) { const [user, setUser] = useState<User | null>(null); const [isLoading, setIsLoading] = useState(true); const router = useRouter(); useEffect(() => { checkAuth(); }, []); const handleTelegramWebAppInit = async () => { try { if (typeof window !== 'undefined' && window.Telegram?.WebApp) { const webApp = window.Telegram.WebApp; if (webApp.initData) { const webAppData = { initData: webApp.initData, user: webApp.initDataUnsafe.user, auth_date: webApp.initDataUnsafe.auth_date, hash: webApp.initDataUnsafe.hash, }; await login(webAppData); } } } catch (error) { console.error('Telegram WebApp init error:', error); toast.error('Failed to initialize Telegram WebApp'); } }; const checkAuth = async () => { try { const token = localStorage.getItem('access_token'); if (!token) { setIsLoading(false); return; } const userData = await api.getCurrentUser(); setUser(userData); } catch (error) { console.error('Auth check error:', error); logout(); } finally { setIsLoading(false); } }; const login = async (telegramData: any) => { try { setIsLoading(true); const userData = await api.telegramAuth(telegramData); setUser(userData); // Redirect based on user type and verification status if (!userData.type || !userData.role) { router.push('/select-lang'); } else if (userData.role === 'carrier' && !userData.is_verified) { router.push('/driver-verification'); } else { router.push('/home'); } } catch (error) { console.error('Login error:', error); toast.error('Authentication failed. Please try again.'); } finally { setIsLoading(false); } }; const logout = () => { localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); setUser(null); router.push('/select-lang'); }; const updateUser = async (data: Partial<User>) => { try { const updatedUser = await api.updateProfile(data); setUser(updatedUser); return updatedUser; } catch (error) { console.error('Update user error:', error); toast.error('Failed to update profile'); throw error; } }; const value = { user, isAuthenticated: !!user, isLoading, login, logout, updateUser, handleTelegramWebAppInit, }; return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>; } export function useAuth() { const context = useContext(AuthContext); if (context === undefined) { throw new Error('useAuth must be used within an AuthProvider'); } return context; }
```

# contexts\ThemeContext.tsx

```tsx
// contexts/ThemeContext.tsx 'use client'; import React, { createContext, useContext, useEffect, useState } from 'react'; import { Sun, Moon } from 'lucide-react'; import { Button } from '@/components/ui/button'; type Theme = 'light' | 'dark'; interface ThemeContextType { theme: Theme; toggleTheme: () => void; } const ThemeContext = createContext<ThemeContextType | undefined>(undefined); export function ThemeProvider({ children }: { children: React.ReactNode }) { const [theme, setTheme] = useState<Theme>('light'); useEffect(() => { const savedTheme = localStorage.getItem('theme') as Theme; if (savedTheme) { setTheme(savedTheme); document.documentElement.className = savedTheme; } }, []); const toggleTheme = () => { const newTheme = theme === 'light' ? 'dark' : 'light'; setTheme(newTheme); localStorage.setItem('theme', newTheme); document.documentElement.className = newTheme; }; return ( <ThemeContext.Provider value={{ theme, toggleTheme }}> <div className={theme}> {children} <Button variant='ghost' size='icon' className='fixed top-4 right-4 z-50 rounded-full bg-background/80 backdrop-blur-sm' onClick={toggleTheme} > {theme === 'light' ? ( <Sun className='h-5 w-5' /> ) : ( <Moon className='h-5 w-5' /> )} </Button> </div> </ThemeContext.Provider> ); } export const useTheme = () => { const context = useContext(ThemeContext); if (context === undefined) { throw new Error('useTheme must be used within a ThemeProvider'); } return context; };
```

# contexts\UserContext.tsx

```tsx
import React, { createContext, useContext, useEffect, useState } from 'react'; import { useRouter } from 'next/navigation'; import { AuthService } from '@/lib/auth'; import { UserState } from '@/types'; interface UserContextType { userState: UserState; setUserType: (type: UserState['type']) => void; setUserRole: (role: UserState['role']) => void; setLanguage: (language: UserState['language']) => void; setUserData: (data: any) => void; logout: () => void; isAuthenticated: boolean; } const USER_STORAGE_KEY = 'logit_user_state'; const UserContext = createContext<UserContextType | undefined>(undefined); export function UserProvider({ children }: { children: React.ReactNode }) { const [userState, setUserState] = useState<UserState>({}); const router = useRouter(); // useEffect(() => { // const initUser = async () => { // try { // // Check if we're in Telegram WebApp // if (typeof window !== 'undefined' && window.Telegram?.WebApp) { // const webApp = window.Telegram.WebApp; // console.log('WebApp data:', { // initData: webApp.initData, // initDataUnsafe: webApp.initDataUnsafe, // }); // // const initdata = webApp.initData; // // const initdataunsafe = webApp.initDataUnsafe // // const data = {initdataunsafe, initdata} // if (webApp) { // const response = await AuthService.telegramAuth(webApp); // console.log(response); // if (response.user) { // setUserData(response.user); // } // // await AuthService.telegramAuth(webApp).catch((err) => // // console.log(err) // // ); // // setUserState((prev) => ({ // // ...prev, // // isAuthenticated: true, // // userData: { // // fullName: response.user?.username || '', // // // telegramNumber: telegramUser.user?.id?.toString() || '', // // }, // // })); // // Store user state // // localStorage.setItem( // // USER_STORAGE_KEY, // // JSON.stringify({ // // isAuthenticated: true, // // }) // // ); // } // } // } catch (error) { // console.error('Init user error:', error); // } // }; // initUser(); // }, []); // Inside UserProvider component useEffect(() => { const initUser = async () => { try { if (typeof window !== 'undefined' && window.Telegram?.WebApp) { const webApp = window.Telegram.WebApp; if (webApp.initData && webApp.initDataUnsafe) { // Проверяем, существует ли пользователь const userExists = await AuthService.checkTelegramAuth( webApp ).catch((err) => { console.error('Auth check error:', err); return false; }); if (userExists) { // Если пользователь существует, перенаправляем на home console.log('user exists'); webApp.requestFullscreen(); router.push('/menu'); } else { // Если пользователь не существует, начинаем процесс регистрации router.push('/select-lang'); } } } } catch (error) { console.error('Init user error:', error); } }; initUser(); }, []); const updateUserState = (newState: Partial<UserState>) => { const updatedState = { ...userState, ...newState }; setUserState((prev) => ({ ...prev, ...newState })); localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(updatedState)); }; const setUserType = (type: UserState['type']) => { updateUserState({ type }); }; const setUserRole = (role: UserState['role']) => { updateUserState({ role }); }; const setLanguage = (language: UserState['language']) => { updateUserState({ language }); }; const setUserData = async (data: any) => { try { // const updatedUser = await AuthService.updateProfile(data); updateUserState({ type: data.type, role: data.role, language: data.preferred_language, isAuthenticated: true, }); console.log(data.type, 'test'); } catch (error) { console.error('Update user data error:', error); } }; const logout = () => { AuthService.logout(); localStorage.removeItem(USER_STORAGE_KEY); setUserState({}); router.push('/select-lang'); }; return ( <UserContext.Provider value={{ userState, setUserType, setUserRole, // updateUserState, setLanguage, setUserData, logout, isAuthenticated: Boolean(userState.isAuthenticated), }} > {children} </UserContext.Provider> ); } export function useUser() { const context = useContext(UserContext); if (context === undefined) { throw new Error('useUser must be used within a UserProvider'); } return context; }
```

# hooks\useFavorites.ts

```ts
import { useState, useEffect } from 'react'; export interface FavoriteItem { id: string; type: 'cargo' | 'route' | 'carrier'; title: string; description: string; createdAt: Date; details: Record<string, any>; orderId?: number; } const FAVORITES_STORAGE_KEY = 'logit_favorites'; export const useFavorites = () => { const [favorites, setFavorites] = useState<FavoriteItem[]>([]); useEffect(() => { const storedFavorites = localStorage.getItem(FAVORITES_STORAGE_KEY); if (storedFavorites) { setFavorites(JSON.parse(storedFavorites)); } }, []); const saveFavorites = (newFavorites: FavoriteItem[]) => { localStorage.setItem(FAVORITES_STORAGE_KEY, JSON.stringify(newFavorites)); setFavorites(newFavorites); }; const addToFavorites = (item: Omit<FavoriteItem, 'id' | 'createdAt'>) => { const newItem: FavoriteItem = { ...item, id: Date.now().toString(), createdAt: new Date(), }; // Проверяем, нет ли уже такого элемента const exists = favorites.some( (favorite) => favorite.type === item.type && favorite.title === item.title ); if (!exists) { const updatedFavorites = [...favorites, newItem]; saveFavorites(updatedFavorites); return true; } return false; }; const removeFromFavorites = (itemId: number) => { const updatedFavorites = favorites.filter( (item) => item.orderId !== itemId ); saveFavorites(updatedFavorites); }; const isFavorite = (itemId: number) => { return favorites.some((item) => item.orderId === itemId); }; const getFavoritesByType = (type: FavoriteItem['type']) => { return favorites.filter((item) => item.type === type); }; const clearAllFavorites = () => { saveFavorites([]); }; const updateFavoriteDetails = ( itemId: string, details: Record<string, any> ) => { const updatedFavorites = favorites.map((item) => item.id === itemId ? { ...item, details: { ...item.details, ...details } } : item ); saveFavorites(updatedFavorites); }; return { favorites, addToFavorites, removeFromFavorites, isFavorite, getFavoritesByType, clearAllFavorites, updateFavoriteDetails, }; };
```

# hooks\useNotifications.ts

```ts
import { useState, useEffect } from 'react'; export interface Notification { id: string; type: 'cargo' | 'route' | 'system'; message: string; createdAt: Date; isRead: boolean; orderId?: number; } const NOTIFICATIONS_STORAGE_KEY = 'logit_notifications'; export const useNotifications = () => { const [notifications, setNotifications] = useState<Notification[]>([]); useEffect(() => { const storedNotifications = localStorage.getItem(NOTIFICATIONS_STORAGE_KEY); if (storedNotifications) { setNotifications(JSON.parse(storedNotifications)); } }, []); const saveNotifications = (newNotifications: Notification[]) => { localStorage.setItem( NOTIFICATIONS_STORAGE_KEY, JSON.stringify(newNotifications) ); setNotifications(newNotifications); }; const addNotification = ( notification: Omit<Notification, 'id' | 'createdAt' | 'isRead'> ) => { const newNotification: Notification = { ...notification, id: Date.now().toString(), createdAt: new Date(), isRead: false, }; const updatedNotifications = [...notifications, newNotification]; saveNotifications(updatedNotifications); }; const markAsRead = (notificationId: string) => { const updatedNotifications = notifications.map((notification) => notification.id === notificationId ? { ...notification, isRead: true } : notification ); saveNotifications(updatedNotifications); }; const markAllAsRead = () => { const updatedNotifications = notifications.map((notification) => ({ ...notification, isRead: true, })); saveNotifications(updatedNotifications); }; const deleteNotification = (notificationId: string) => { const updatedNotifications = notifications.filter( (notification) => notification.id !== notificationId ); saveNotifications(updatedNotifications); }; const clearAllNotifications = () => { saveNotifications([]); }; const unreadCount = notifications.filter((n) => !n.isRead).length; return { notifications, unreadCount, addNotification, markAsRead, markAllAsRead, deleteNotification, clearAllNotifications, }; };
```

# lib\api.ts

```ts
import axios, { AxiosInstance } from 'axios'; const BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api'; export class ApiClient { private static instance: ApiClient; private api: AxiosInstance; private constructor() { this.api = axios.create({ baseURL: BASE_URL, headers: { 'Content-Type': 'application/json', 'ngrok-skip-browser-warning': '69420', }, }); // Request interceptor for adding auth token this.api.interceptors.request.use( (config) => { const token = localStorage.getItem('access_token'); if (token) { config.headers.Authorization = `Bearer ${token}`; } return config; }, (error) => Promise.reject(error) ); // Response interceptor for token refresh this.api.interceptors.response.use( (response) => response, async (error) => { const originalRequest = error.config; if (error.response?.status === 401 && !originalRequest._retry) { originalRequest._retry = true; try { const refreshToken = localStorage.getItem('refresh_token'); const response = await this.api.post('/auth/token/refresh/', { refresh: refreshToken, }); const { access } = response.data; localStorage.setItem('access_token', access); originalRequest.headers.Authorization = `Bearer ${access}`; return this.api(originalRequest); } catch (refreshError) { localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); window.location.href = '/select-lang'; return Promise.reject(refreshError); } } return Promise.reject(error); } ); } public static getInstance(): ApiClient { if (!ApiClient.instance) { ApiClient.instance = new ApiClient(); } return ApiClient.instance; } // Generic request methods public async get(url: string, params?: any) { try { const response = await this.api.get(url, { params }); return response.data; } catch (error) { console.error('GET request error:', error); throw error; } } public async post(url: string, data?: any) { try { const response = await this.api.post(url, data); return response.data; } catch (error) { console.error('POST request error:', error); throw error; } } public async put(url: string, data: any) { try { const response = await this.api.put(url, data); return response.data; } catch (error) { console.error('PUT request error:', error); throw error; } } public async patch(url: string, data: any) { try { const response = await this.api.patch(url, data); return response.data; } catch (error) { console.error('PATCH request error:', error); throw error; } } public async delete(url: string) { try { const response = await this.api.delete(url); return response.data; } catch (error) { console.error('DELETE request error:', error); throw error; } } // Authentication public async telegramAuth(telegramData: any) { try { const response = await this.api.post( '/users/telegram_auth/', telegramData ); const { access, refresh, user } = response.data; localStorage.setItem('access_token', access); localStorage.setItem('refresh_token', refresh); return user; } catch (error) { console.error('Telegram auth error:', error); throw error; } } // User Profile public async getCurrentUser() { try { const response = await this.api.get('/users/me/'); return response.data; } catch (error) { console.error('Get profile error:', error); throw error; } } public async updateProfile(data: any) { try { const response = await this.api.put('/users/update_profile/', data); return response.data; } catch (error) { console.error('Update profile error:', error); throw error; } } // Cargo public async getCargos(params?: any) { try { const response = await this.api.get('/cargo/cargos/', { params }); return response.data; } catch (error) { console.error('Get cargos error:', error); throw error; } } public async createCargo(data: any) { try { console.log(data, 'createcargodata') const response = await this.api.post('/cargo/cargos/', data); return response.data; } catch (error) { console.error('Create cargo error:', error); throw error; } } public async updateCargo(id: string, data: any) { try { const response = await this.api.patch(`/cargo/${id}/`, data); return response.data; } catch (error) { console.error('Update cargo error:', error); throw error; } } // Vehicles public async getVehicles(params?: any) { try { const response = await this.api.get('/vehicles/', { params }); return response.data; } catch (error) { console.error('Get vehicles error:', error); throw error; } } public async createVehicle(data: any) { try { const response = await this.api.post('/vehicles/', data); return response.data; } catch (error) { console.error('Create vehicle error:', error); throw error; } } public async updateVehicle(id: string, data: any) { try { const response = await this.api.patch(`/vehicles/${id}/`, data); return response.data; } catch (error) { console.error('Update vehicle error:', error); throw error; } } public async deleteVehicle(id: string) { try { const response = await this.api.delete(`/vehicles/${id}/`); return response.data; } catch (error) { console.error('Delete vehicle error:', error); throw error; } } // Vehicle Documents public async addVehicleDocument( vehicleId: string, data: { file: File; type: | 'tech_passport' | 'license' | 'insurance' | 'adr_cert' | 'dozvol' | 'tir' | 'other'; title: string; expiry_date?: string; } ) { try { const formData = new FormData(); formData.append('file', data.file); formData.append('type', data.type); formData.append('title', data.title); if (data.expiry_date) { formData.append('expiry_date', data.expiry_date); } const response = await this.api.post( `/vehicles/${vehicleId}/add_document/`, formData, { headers: { 'Content-Type': 'multipart/form-data', }, } ); return response.data; } catch (error) { console.error('Add vehicle document error:', error); throw error; } } // Carrier Requests public async getCarrierRequests(params?: any) { try { const response = await this.api.get('/carrier-requests/', { params }); return response.data; } catch (error) { console.error('Get carrier requests error:', error); throw error; } } public async createCarrierRequest(data: any) { try { const response = await this.api.post('/carrier-requests/', data); return response.data; } catch (error) { console.error('Create carrier request error:', error); throw error; } } public async updateCarrierRequest(id: string, data: any) { try { const response = await this.api.patch(`/carrier-requests/${id}/`, data); return response.data; } catch (error) { console.error('Update carrier request error:', error); throw error; } } public async deleteCarrierRequest(id: string) { try { const response = await this.api.delete(`/carrier-requests/${id}/`); return response.data; } catch (error) { console.error('Delete carrier request error:', error); throw error; } } // Notifications public async getNotifications() { try { const response = await this.api.get('/core/notifications/'); return response.data; } catch (error) { console.error('Get notifications error:', error); throw error; } } public async markNotificationAsRead(id: string) { try { const response = await this.api.post( `/core/notifications/${id}/mark-read/` ); return response.data; } catch (error) { console.error('Mark notification error:', error); throw error; } } // Favorites public async getFavorites() { try { const response = await this.api.get('/core/favorites/'); return response.data; } catch (error) { console.error('Get favorites error:', error); throw error; } } public async addToFavorites(data: any) { try { const response = await this.api.post('/core/favorites/', data); return response.data; } catch (error) { console.error('Add to favorites error:', error); throw error; } } // Search public async searchCargo(filters: any) { try { const response = await this.api.post('/cargo/search/', filters); return response.data; } catch (error) { console.error('Search cargo error:', error); throw error; } } public async addUserDocument(data: { file: File; type: 'driver_license' | 'passport' | 'company_certificate' | 'other'; title: string; }) { try { const formData = new FormData(); formData.append('file', data.file); formData.append('type', data.type); formData.append('title', data.title); const response = await this.api.post( '/users/upload_document/', formData, { headers: { 'Content-Type': 'multipart/form-data', }, } ); return response.data; } catch (error) { console.error('Add user document error:', error); throw error; } } public async getUserDocuments() { try { const response = await this.api.get('/users/documents/'); return response.data; } catch (error) { console.error('Get user documents error:', error); throw error; } } public async deleteUserDocument(id: string) { try { const response = await this.api.delete(`/users/documents/${id}/`); return response.data; } catch (error) { console.error('Delete user document error:', error); throw error; } } // public async updateCargo(id: string, data: any) { // try { // const response = await this.api.patch(`/cargo/${id}/`, data); // return response.data; // } catch (error) { // console.error('Update cargo error:', error); // throw error; // } // } } export const api = ApiClient.getInstance();
```

# lib\auth.ts

```ts
import axios, { AxiosError } from 'axios'; import { toast } from 'sonner'; interface TelegramUser { id: number; first_name: string; last_name?: string; username?: string; language_code?: string; } interface TelegramAuthResponse { access: string; refresh: string; user: any; } interface RegistrationData { telegramData: any; userData: any; } const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api'; // Create axios instance with default config const api = axios.create({ baseURL: API_URL, headers: { 'Content-Type': 'application/json', 'ngrok-skip-browser-warning': '69420', }, withCredentials: true, // Important for CORS }); export class AuthService { private static async prepareAuthPayload(telegramData: any) { return { init_data: telegramData?.initData, user: telegramData?.initDataUnsafe.user, auth_date: Number(telegramData?.initDataUnsafe.auth_date), hash: telegramData?.initDataUnsafe.hash, }; } private static async handleAuthResponse(response: any) { const { access, refresh, user } = response.data; localStorage.setItem('access_token', access); localStorage.setItem('refresh_token', refresh); return response.data; } static async checkTelegramAuth(telegramData: any): Promise<boolean> { try { const authPayload = await this.prepareAuthPayload(telegramData); console.log('Checking auth payload:', authPayload); const response = await api.post('/users/telegram_auth/', authPayload); // Если пользователь найден, сохраняем токены и возвращаем true await this.handleAuthResponse(response); return true; } catch (error) { if (error instanceof AxiosError) { if (error.response?.status === 404) { // Пользователь не найден - это ожидаемый результат return false; } // Другие ошибки const message = error.response?.data?.detail || 'Authentication check failed'; toast.error(message); console.error('Auth check error:', error.response?.data); } throw error; } } private static delay(ms: number): Promise<void> { return new Promise((resolve) => setTimeout(resolve, ms)); } static async registerUser( data: RegistrationData ): Promise<TelegramAuthResponse> { try { // Шаг 1: Регистрация с Telegram данными const authPayload = await this.prepareAuthPayload(data.telegramData); const registrationResponse = await api.post('/users/register/', { ...authPayload, userData: data.userData, }); console.log(registrationResponse, 'regres'); // Сохраняем токены после регистрации await this.handleAuthResponse(registrationResponse); // Add delay before profile update (2 seconds) // await this.delay(2000); // // Configure headers with new token // const token = localStorage.getItem('access_token'); // api.defaults.headers.common['Authorization'] = `Bearer ${token}`; // // Step 2: Update user profile // const updateResponse = await api.put('/users/update_profile/', { // ...data.userData, // }); return { ...registrationResponse.data, // user: updateResponse.data, }; } catch (error) { if (error instanceof AxiosError) { const message = error.response?.data?.detail || 'Registration failed'; toast.error(message); console.error('Registration error:', error.response?.data); } throw error; } } static async refreshToken(): Promise<string> { try { const refresh = localStorage.getItem('refresh_token'); if (!refresh) throw new Error('No refresh token'); const response = await api.post<{ access: string }>( '/auth/token/refresh/', { refresh, } ); const { access } = response.data; localStorage.setItem('access_token', access); return access; } catch (error) { localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); throw error; } } static async updateProfile(data: any) { try { const token = localStorage.getItem('access_token'); const response = await api.put('/users/update_profile/', data, { headers: { Authorization: `Bearer ${token}`, }, }); return response.data; } catch (error) { if (error instanceof AxiosError) { const message = error.response?.data?.detail || 'Failed to update profile'; toast.error(message); } throw error; } } static async getProfile() { try { const token = localStorage.getItem('access_token'); if (!token) throw new Error('No auth token'); const response = await api.get('/users/me/', { headers: { Authorization: `Bearer ${token}`, }, }); return response.data; } catch (error) { if (error instanceof AxiosError) { const message = error.response?.data?.detail || 'Failed to get profile'; toast.error(message); } throw error; } } static logout() { localStorage.removeItem('access_token'); localStorage.removeItem('refresh_token'); } } // Add axios interceptor for token refresh api.interceptors.response.use( (response) => response, async (error) => { const originalRequest = error.config; if (error.response?.status === 401 && !originalRequest._retry) { originalRequest._retry = true; try { const access = await AuthService.refreshToken(); originalRequest.headers.Authorization = `Bearer ${access}`; return api(originalRequest); } catch (refreshError) { AuthService.logout(); window.location.href = '/select-lang'; return Promise.reject(refreshError); } } return Promise.reject(error); } ); export default AuthService;
```

# lib\errors.ts

```ts
export class ApiError extends Error { constructor( public statusCode: number, message: string, public code?: string ) { super(message); this.name = 'ApiError'; } } export class ValidationError extends ApiError { constructor(message: string) { super(400, message, 'VALIDATION_ERROR'); this.name = 'ValidationError'; } } export class AuthenticationError extends ApiError { constructor(message: string = 'Authentication required') { super(401, message, 'AUTHENTICATION_ERROR'); this.name = 'AuthenticationError'; } } export class AuthorizationError extends ApiError { constructor(message: string = 'Not authorized') { super(403, message, 'AUTHORIZATION_ERROR'); this.name = 'AuthorizationError'; } } export class NotFoundError extends ApiError { constructor(resource: string) { super(404, `${resource} not found`, 'NOT_FOUND'); this.name = 'NotFoundError'; } }
```

# lib\files.ts

```ts
import axios from 'axios'; const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api'; export interface FileUploadResponse { id: string; url: string; filename: string; mimetype: string; size: number; } export class FileService { static async upload( file: File, type: string, onProgress?: (progress: number) => void ): Promise<FileUploadResponse> { const formData = new FormData(); formData.append('file', file); formData.append('type', type); const response = await axios.post(`${API_URL}/upload/`, formData, { headers: { 'ngrok-skip-browser-warning': '69420', 'Content-Type': 'multipart/form-data', }, onUploadProgress: (progressEvent) => { if (onProgress && progressEvent.total) { const progress = Math.round( (progressEvent.loaded * 100) / progressEvent.total ); onProgress(progress); } }, }); return response.data; } static async delete(fileId: string): Promise<void> { await axios.delete(`${API_URL}/upload/${fileId}/`, { headers: { 'ngrok-skip-browser-warning': '69420', }, }); } static getFileType(file: File): string { if (file.type.startsWith('image/')) { return 'image'; } if (file.type === 'application/pdf') { return 'pdf'; } return 'document'; } static validateFile( file: File, options: { maxSize?: number; allowedTypes?: string[]; } = {} ): string | null { const { maxSize = 5 * 1024 * 1024, // 5MB default allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'], } = options; if (!allowedTypes.includes(file.type)) { return 'Неподдерживаемый тип файла'; } if (file.size > maxSize) { return `Размер файла не должен превышать ${maxSize / (1024 * 1024)}MB`; } return null; } static formatFileSize(bytes: number): string { if (bytes === 0) return '0 Bytes'; const k = 1024; const sizes = ['Bytes', 'KB', 'MB', 'GB']; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]; } static getFileExtension(filename: string): string { return filename.split('.').pop()?.toLowerCase() || ''; } static getFileIcon(file: File): string { const type = file.type; if (type.startsWith('image/')) return '🖼️'; if (type === 'application/pdf') return '📄'; if (type.includes('spreadsheet') || type.includes('excel')) return '📊'; if (type.includes('document') || type.includes('word')) return '📝'; return '📎'; } }
```

# lib\geocoding.ts

```ts
interface Coordinates { lat: number; lng: number; } interface GeocodingCache { [key: string]: Coordinates; } // Простой кэш для координат const coordinatesCache: GeocodingCache = { москва: { lat: 55.7558, lng: 37.6173 }, 'санкт-петербург': { lat: 59.9343, lng: 30.3351 }, ташкент: { lat: 41.2995, lng: 69.2401 }, самарканд: { lat: 39.627, lng: 66.975 }, бухара: { lat: 39.768, lng: 64.421 }, }; export async function getCoordinates( city: string ): Promise<Coordinates | null> { const normalizedCity = city.toLowerCase().trim(); // Проверяем кэш if (coordinatesCache[normalizedCity]) { return coordinatesCache[normalizedCity]; } // В реальном приложении здесь был бы запрос к геокодинг сервису // например, Google Maps Geocoding API или OpenStreetMap Nominatim return null; } export function calculateDistance(from: Coordinates, to: Coordinates): number { const R = 6371; // Радиус Земли в километрах const dLat = toRad(to.lat - from.lat); const dLon = toRad(to.lng - from.lng); const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(toRad(from.lat)) * Math.cos(toRad(to.lat)) * Math.sin(dLon / 2) * Math.sin(dLon / 2); const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); const distance = R * c; return Math.round(distance); } function toRad(degrees: number): number { return (degrees * Math.PI) / 180; } export function isWithinRadius( point: Coordinates, center: Coordinates, radius: number ): boolean { const distance = calculateDistance(point, center); return distance <= radius; } export function findNearestCities( city: string, radius: number = 100 ): string[] { const coordinates = coordinatesCache[city.toLowerCase()]; if (!coordinates) return []; return Object.entries(coordinatesCache) .filter(([name, coords]) => { if (name === city.toLowerCase()) return false; return isWithinRadius(coords, coordinates, radius); }) .map(([name]) => name); } export function getRegionForCity(city: string): string { // В реальном приложении здесь был бы более полный справочник регионов const regions: Record<string, string> = { москва: 'Московская область', 'санкт-петербург': 'Ленинградская область', ташкент: 'Ташкентская область', самарканд: 'Самаркандская область', бухара: 'Бухарская область', }; return regions[city.toLowerCase()] || 'Неизвестный регион'; }
```

# lib\jwt.ts

```ts
import jwt from 'jsonwebtoken'; const JWT_SECRET = process.env.JWT_SECRET || 'your-secret-key'; export interface JWTPayload { userId: string; role: string; } export function signToken(payload: JWTPayload): string { return jwt.sign(payload, JWT_SECRET, { expiresIn: '7d' }); } export function verifyToken(token: string): JWTPayload { try { return jwt.verify(token, JWT_SECRET) as JWTPayload; } catch (error) { throw new Error('Invalid token'); } } export function extractToken(authHeader: string | null): string { if (!authHeader || !authHeader.startsWith('Bearer ')) { throw new Error('No token provided'); } return authHeader.split(' ')[1]; }
```

# lib\utils.ts

```ts
import { clsx, type ClassValue } from 'clsx'; import { twMerge } from 'tailwind-merge'; export function cn(...inputs: ClassValue[]) { return twMerge(clsx(inputs)); } export const formatDate = (date: Date | string): string => { const d = new Date(date); return d.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit', }); }; export const formatCurrency = ( amount: number, currency: string = 'USD' ): string => { return new Intl.NumberFormat('ru-RU', { style: 'currency', currency, minimumFractionDigits: 0, maximumFractionDigits: 0, }).format(amount); }; export const generateId = (): string => { return Math.random().toString(36).substr(2, 9); }; export const formatPhoneNumber = (phone: string): string => { const cleaned = phone.replace(/\D/g, ''); if (cleaned.length === 0) return ''; let formatted = cleaned; if (cleaned.length >= 11) { formatted = `+${cleaned.slice(0, 1)} (${cleaned.slice( 1, 4 )}) ${cleaned.slice(4, 7)}-${cleaned.slice(7, 9)}-${cleaned.slice(9, 11)}`; } return formatted; }; export const isValidEmail = (email: string): boolean => { const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; return re.test(email); }; export const truncateText = (text: string, maxLength: number): string => { if (text.length <= maxLength) return text; return text.slice(0, maxLength) + '...'; }; export const debounce = <T extends (...args: any[]) => any>( func: T, wait: number ): ((...args: Parameters<T>) => void) => { let timeout: NodeJS.Timeout; return (...args: Parameters<T>) => { clearTimeout(timeout); timeout = setTimeout(() => func(...args), wait); }; }; export const getDistanceInKm = ( lat1: number, lon1: number, lat2: number, lon2: number ): number => { const R = 6371; // Earth's radius in km const dLat = ((lat2 - lat1) * Math.PI) / 180; const dLon = ((lon2 - lon1) * Math.PI) / 180; const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos((lat1 * Math.PI) / 180) * Math.cos((lat2 * Math.PI) / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2); const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); return Math.round(R * c); }; export const validatePassword = (password: string): boolean => { const minLength = 8; const hasUpperCase = /[A-Z]/.test(password); const hasLowerCase = /[a-z]/.test(password); const hasNumbers = /\d/.test(password); return ( password.length >= minLength && hasUpperCase && hasLowerCase && hasNumbers ); }; export const getCityTimezone = (city: string): string => { const timezones: Record<string, string> = { Москва: 'Europe/Moscow', 'Санкт-Петербург': 'Europe/Moscow', Ташкент: 'Asia/Tashkent', Самарканд: 'Asia/Samarkand', Бухара: 'Asia/Bukhara', }; return timezones[city] || 'UTC'; }; export const formatFileSize = (bytes: number): string => { if (bytes === 0) return '0 Bytes'; const k = 1024; const sizes = ['Bytes', 'KB', 'MB', 'GB']; const i = Math.floor(Math.log(bytes) / Math.log(k)); return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]; };
```

# middleware\auth.ts

```ts
import { NextRequest, NextResponse } from 'next/server'; import { verifyToken, extractToken } from '@/lib/jwt'; import { AuthenticationError, AuthorizationError } from '@/lib/errors'; export async function authenticateRequest( request: NextRequest, allowedRoles?: string[] ) { try { const authHeader = request.headers.get('authorization'); const token = extractToken(authHeader); const payload = verifyToken(token); if (allowedRoles && !allowedRoles.includes(payload.role)) { throw new AuthorizationError(); } return payload; } catch (error) { if (error instanceof AuthorizationError) { throw error; } throw new AuthenticationError(); } } export function withAuth(handler: Function, allowedRoles?: string[]) { return async function (request: NextRequest, ...args: any[]) { try { const payload = await authenticateRequest(request, allowedRoles); return handler(request, payload, ...args); } catch (error) { if ( error instanceof AuthenticationError || error instanceof AuthorizationError ) { return NextResponse.json( { error: error.message }, { status: error.statusCode } ); } return NextResponse.json( { error: 'Internal server error' }, { status: 500 } ); } }; }
```

# next-env.d.ts

```ts
/// <reference types="next" /> /// <reference types="next/image-types/global" /> // NOTE: This file should not be edited // see https://nextjs.org/docs/app/building-your-application/configuring/typescript for more information.
```

# next.config.mjs

```mjs
/** @type {import('next').NextConfig} */ const nextConfig = {}; export default nextConfig;
```

# package.json

```json
{ "name": "logit", "version": "0.1.0", "private": true, "scripts": { "dev": "next dev", "build": "next build", "start": "next start", "lint": "next lint" }, "dependencies": { "@radix-ui/react-accordion": "^1.2.0", "@radix-ui/react-alert-dialog": "^1.1.5", "@radix-ui/react-avatar": "^1.1.1", "@radix-ui/react-checkbox": "^1.1.2", "@radix-ui/react-dialog": "^1.1.2", "@radix-ui/react-label": "^2.1.2", "@radix-ui/react-progress": "^1.1.1", "@radix-ui/react-radio-group": "^1.2.3", "@radix-ui/react-scroll-area": "^1.2.0", "@radix-ui/react-select": "^2.1.1", "@radix-ui/react-separator": "^1.1.1", "@radix-ui/react-slot": "^1.1.2", "@radix-ui/react-tabs": "^1.1.3", "@react-three/cannon": "^6.6.0", "@react-three/drei": "^9.121.4", "@react-three/fiber": "^8.17.14", "@types/bcryptjs": "^2.4.6", "@types/jsonwebtoken": "^9.0.8", "@types/react-date-range": "^1.4.9", "@types/three": "^0.172.0", "axios": "^1.7.9", "bcryptjs": "^2.4.3", "class-variance-authority": "^0.7.0", "clsx": "^2.1.1", "date-fns": "^4.1.0", "framer-motion": "^11.11.1", "jsonwebtoken": "^9.0.2", "lucide-react": "^0.446.0", "mongoose": "^8.9.5", "next": "14.2.13", "react": "^18", "react-date-range": "^2.0.1", "react-day-picker": "^8.10.1", "react-dom": "^18", "sonner": "^1.7.2", "tailwind-merge": "^2.5.2", "tailwindcss-animate": "^1.0.7", "three": "^0.172.0" }, "devDependencies": { "@types/node": "^20", "@types/react": "^18", "@types/react-dom": "^18", "postcss": "^8", "tailwindcss": "^3.4.1", "typescript": "^5" } }
```

# postcss.config.mjs

```mjs
/** @type {import('postcss-load-config').Config} */ const config = { plugins: { tailwindcss: {}, }, }; export default config;
```

# README.md

```md
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app). ## Getting Started First, run the development server: \`\`\`bash npm run dev # or yarn dev # or pnpm dev # or bun dev \`\`\` Open [http://localhost:3000](http://localhost:3000) with your browser to see the result. You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file. This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel. ## Learn More To learn more about Next.js, take a look at the following resources: - [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API. - [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial. You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome! ## Deploy on Vercel The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js. Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
```

# tailwind.config.ts

```ts
// tailwind.config.ts import type { Config } from 'tailwindcss'; const config: Config = { darkMode: 'class', content: [ './pages/**/*.{js,ts,jsx,tsx,mdx}', './components/**/*.{js,ts,jsx,tsx,mdx}', './app/**/*.{js,ts,jsx,tsx,mdx}', ], theme: { extend: { colors: { background: { DEFAULT: 'var(--background)', secondary: 'var(--background-secondary)', }, foreground: { DEFAULT: 'var(--foreground)', secondary: 'var(--foreground-secondary)', }, primary: { DEFAULT: 'var(--primary)', foreground: 'var(--primary-foreground)', }, secondary: { DEFAULT: 'var(--secondary)', foreground: 'var(--secondary-foreground)', }, muted: { DEFAULT: 'var(--muted)', foreground: 'var(--muted-foreground)', }, accent: { DEFAULT: 'var(--accent)', foreground: 'var(--accent-foreground)', }, destructive: { DEFAULT: 'var(--destructive)', foreground: 'var(--destructive-foreground)', }, border: 'var(--border)', input: 'var(--input)', ring: 'var(--ring)', }, animation: { 'accordion-down': 'accordion-down 0.2s ease-out', 'accordion-up': 'accordion-up 0.2s ease-out', 'fade-in': 'fade-in 0.3s ease-out', 'fade-out': 'fade-out 0.2s ease-in', 'slide-in': 'slide-in 0.3s ease-out', 'slide-out': 'slide-out 0.2s ease-in', }, keyframes: { 'accordion-down': { from: { height: '0' }, to: { height: 'var(--radix-accordion-content-height)' }, }, 'accordion-up': { from: { height: 'var(--radix-accordion-content-height)' }, to: { height: '0' }, }, 'fade-in': { '0%': { opacity: '0' }, '100%': { opacity: '1' }, }, 'fade-out': { '0%': { opacity: '1' }, '100%': { opacity: '0' }, }, 'slide-in': { '0%': { transform: 'translateY(10px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' }, }, 'slide-out': { '0%': { transform: 'translateY(0)', opacity: '1' }, '100%': { transform: 'translateY(-10px)', opacity: '0' }, }, }, }, }, plugins: [require('tailwindcss-animate')], }; export default config;
```

# tsconfig.json

```json
{ "compilerOptions": { "lib": ["dom", "dom.iterable", "esnext"], "allowJs": true, "skipLibCheck": true, "strict": true, "noEmit": true, "esModuleInterop": true, "module": "esnext", "moduleResolution": "bundler", "resolveJsonModule": true, "isolatedModules": true, "jsx": "preserve", "incremental": true, "plugins": [ { "name": "next" } ], "paths": { "@/*": ["./*"] } }, "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"], "exclude": ["node_modules"] }
```

# types\index.ts

```ts
export type UserType = 'individual' | 'legal'; export type UserRole = | 'student' | 'carrier' | 'cargo-owner' | 'logistics-company' | 'transport-company' | 'logit-trans'; export type Language = 'ru' | 'uz'; export interface UserState { type?: UserType; role?: UserRole; language?: Language; isAuthenticated?: boolean; userData?: { photo?: string; companyName?: string; fullName?: string; telegramNumber?: string; whatsappNumber?: string; phoneNumber?: string; position?: string; registrationCertificate?: string; studentStatus?: string; city?: string; tariff?: string; groupName?: string; studyLanguage?: string; curatorName?: string; endDate?: string; }; }
```